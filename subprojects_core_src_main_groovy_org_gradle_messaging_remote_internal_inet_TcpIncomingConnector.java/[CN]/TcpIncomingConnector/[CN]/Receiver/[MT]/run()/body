{
  try {
    try {
      while (true) {
        SocketChannel socket=serverSocket.accept();
        InetSocketAddress remoteSocketAddress=(InetSocketAddress)socket.socket().getRemoteSocketAddress();
        if (!localAddresses.contains(remoteSocketAddress.getAddress())) {
          LOGGER.error("Cannot accept connection from remote address {}.",remoteSocketAddress.getAddress());
          socket.close();
          continue;
        }
        SocketConnection<T> connection=new SocketConnection<T>(socket,serializer);
        Address localAddress=connection.getLocalAddress();
        Address remoteAddress=connection.getRemoteAddress();
        LOGGER.debug("Accepted connection from {} to {}.",remoteAddress,localAddress);
        action.execute(new ConnectEvent<Connection<T>>(connection,localAddress,remoteAddress));
      }
    }
 catch (    ClosedChannelException e) {
    }
catch (    Exception e) {
      LOGGER.error("Could not accept remote connection.",e);
    }
  }
  finally {
    new CompositeStoppable(serverSocket).stop();
    serverSockets.remove(serverSocket);
  }
}
