{
  final ModelSchema<T> modelSchema=getModelSchema(managedType,ruleDefinition);
  if (modelSchema instanceof ValueSchema) {
    throw new InvalidModelRuleDeclarationException(ruleDefinition.getDescriptor(),"a void returning model element creation rule cannot take a value type as the first parameter, which is the element being created. Return the value from the method.");
  }
  List<ModelReference<?>> bindings=ruleDefinition.getReferences();
  List<ModelReference<?>> inputs=bindings.subList(1,bindings.size());
  final ModelRuleDescriptor descriptor=ruleDefinition.getDescriptor();
  final ModelReference<T> reference=ModelReference.of(modelPath,managedType);
  return ModelRegistrations.of(modelPath).descriptor(descriptor).action(ModelActionRole.Discover,ModelReference.of(NodeInitializerRegistry.class),new BiAction<MutableModelNode,List<ModelView<?>>>(){
    @Override public void execute(    MutableModelNode node,    List<ModelView<?>> modelViews){
      NodeInitializerRegistry nodeInitializerRegistry=(NodeInitializerRegistry)modelViews.get(0).getInstance();
      NodeInitializer initializer=getNodeInitializer(descriptor,modelSchema,nodeInitializerRegistry);
      ModelAction projector=initializer.getProjector(modelPath,descriptor);
      if (projector != null) {
        node.applyToSelf(ModelActionRole.Discover,projector);
      }
    }
  }
).action(ModelActionRole.Create,ModelReference.of(NodeInitializerRegistry.class),new BiAction<MutableModelNode,List<ModelView<?>>>(){
    @Override public void execute(    MutableModelNode node,    List<ModelView<?>> modelViews){
      NodeInitializerRegistry nodeInitializerRegistry=(NodeInitializerRegistry)modelViews.get(0).getInstance();
      NodeInitializer initializer=getNodeInitializer(descriptor,modelSchema,nodeInitializerRegistry);
      node.applyToSelf(ModelActionRole.Create,DirectNodeInputUsingModelAction.of(ModelReference.of(modelPath),descriptor,initializer.getInputs(),initializer));
    }
  }
).action(ModelActionRole.Initialize,InputUsingModelAction.of(reference,descriptor,inputs,new RuleMethodBackedMutationAction<T>(ruleDefinition.getRuleInvoker()))).build();
}
