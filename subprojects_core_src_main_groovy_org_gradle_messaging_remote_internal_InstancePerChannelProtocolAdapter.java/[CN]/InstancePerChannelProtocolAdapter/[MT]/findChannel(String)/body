{
  ProtocolContextAdapter adapter=channels.get(channel);
  if (adapter == null) {
    Protocol<T> protocol=factory.newChannel(channel);
    adapter=new ProtocolContextAdapter(channel,protocol);
    channels.put(channel,adapter);
    protocol.start(adapter);
    if (stopping) {
      adapter.stopRequested();
    }
  }
  return adapter.protocol;
}
