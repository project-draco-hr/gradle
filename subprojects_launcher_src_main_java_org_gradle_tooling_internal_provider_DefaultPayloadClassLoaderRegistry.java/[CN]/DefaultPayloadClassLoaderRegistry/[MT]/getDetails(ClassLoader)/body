{
  lock.lock();
  try {
    ClassLoaderDetails details=classLoaderDetails.get(classLoader);
    if (details != null) {
      return details;
    }
    ClassLoaderSpecVisitor visitor=new ClassLoaderSpecVisitor(classLoader);
    visitor.visit(classLoader);
    if (visitor.spec == null) {
      if (visitor.classPath == null) {
        visitor.spec=ClassLoaderSpec.SYSTEM_CLASS_LOADER;
      }
 else {
        visitor.spec=new MutableURLClassLoader.Spec(CollectionUtils.toList(visitor.classPath));
      }
    }
    UUID uuid=UUID.randomUUID();
    details=new ClassLoaderDetails(uuid,visitor.spec);
    for (    ClassLoader parent : visitor.parents) {
      details.parents.add(getDetails(parent));
    }
    classLoaderDetails.put(classLoader,details);
    classLoaderIds.put(details.uuid,classLoader);
    return details;
  }
  finally {
    lock.unlock();
  }
}
