{
  StaleClassCleaner cleaner=new SimpleStaleClassCleaner(getOutputs());
  cleaner.setDestinationDir(getDestinationDir());
  cleaner.execute();
  MinifyFileVisitor visitor=new MinifyFileVisitor(getClosureCompilerClasspath());
  getSource().visit(visitor);
  if (visitor.hasFailures) {
    throw new SourceTransformationException(String.format("Minification failed for the following files:\n\t%s",StringUtils.join(visitor.failedFiles,"\n\t")),null);
  }
}
