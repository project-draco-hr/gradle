{
  HttpURLConnection connection=null;
  try {
    connection=(HttpURLConnection)(new URL("https://twitter.com/statuses/update.xml").openConnection());
    connection.setRequestMethod("POST");
    connection.setDoInput(true);
    connection.setDoOutput(true);
    connection.setUseCaches(false);
    String credentials=EncodingGroovyMethods.encodeBase64((username + ":" + password).getBytes("UTF-8")).toString().trim();
    connection.setRequestProperty("Authorization","Basic " + credentials);
    final OutputStream outputStream=connection.getOutputStream();
    IOUtils.write("status=" + URLEncoder.encode(message,"UTF-8"),outputStream);
    IOUtils.closeQuietly(outputStream);
    logger.info("Successfully tweeted \'" + message + "\' using account \'"+ username+ "\'");
    if (logger.isDebugEnabled()) {
      logger.debug(IOUtils.toString(connection.getInputStream(),"UTF-8"));
    }
  }
 catch (  Exception e) {
    throw UncheckedException.throwAsUncheckedException(e);
  }
 finally {
    if (connection != null) {
      connection.disconnect();
    }
  }
}
