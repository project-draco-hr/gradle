{
  return cacheLockingManager.useCache(String.format("Store %s",artifact),new Factory<LocallyAvailableResource>(){
    public LocallyAvailableResource create(){
      LocallyAvailableResource cachedResource=fileStore.move(artifact.getId(),tmpFile);
      File fileInFileStore=cachedResource.getFile();
      if (resource instanceof ExternalResource) {
        ExternalResource externalResource=(ExternalResource)resource;
        ExternalResourceMetaData metaData=externalResource.getMetaData();
        artifactUrlCachedResolutionIndex.store(metaData.getLocation(),fileInFileStore,metaData);
      }
      return cachedResource;
    }
  }
);
}
