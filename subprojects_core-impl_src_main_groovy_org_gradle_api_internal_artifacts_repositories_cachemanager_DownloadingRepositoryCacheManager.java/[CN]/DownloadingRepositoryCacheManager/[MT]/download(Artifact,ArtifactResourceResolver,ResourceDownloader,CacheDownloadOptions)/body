{
  EnhancedArtifactDownloadReport adr=new EnhancedArtifactDownloadReport(artifact);
  DownloadListener listener=options.getListener();
  if (listener != null) {
    listener.needArtifact(this,artifact);
  }
  long start=System.currentTimeMillis();
  try {
    ResolvedResource artifactRef=resourceResolver.resolve(artifact);
    if (artifactRef != null) {
      ArtifactOriginWithMetaData origin=new ArtifactOriginWithMetaData(artifact,artifactRef.getResource());
      if (listener != null) {
        listener.startArtifactDownload(this,artifactRef,artifact,origin);
      }
      File artifactFile=downloadArtifactFile(artifact,resourceDownloader,artifactRef);
      adr.setDownloadTimeMillis(System.currentTimeMillis() - start);
      adr.setSize(artifactFile.length());
      adr.setDownloadStatus(DownloadStatus.SUCCESSFUL);
      adr.setArtifactOrigin(origin);
      adr.setLocalFile(artifactFile);
    }
 else {
      adr.setDownloadTimeMillis(System.currentTimeMillis() - start);
      adr.setDownloadStatus(DownloadStatus.FAILED);
      adr.setDownloadDetails(ArtifactDownloadReport.MISSING_ARTIFACT);
    }
  }
 catch (  Throwable throwable) {
    adr.setDownloadTimeMillis(System.currentTimeMillis() - start);
    adr.failed(throwable);
  }
  if (listener != null) {
    listener.endArtifactDownload(this,artifact,adr,adr.getLocalFile());
  }
  return adr;
}
