{
  final TestInfo testInfo=tests.remove(testId);
  if (!testInfo.test.isComposite()) {
    XmlTestsuite xmlTestsuite=testSuites.get(testInfo.test.getClassName());
    Collection<Throwable> failures=this.failures.containsKey(testId) ? this.failures.remove(testId) : Collections.<Throwable>emptySet();
    xmlTestsuite.addTestCase(testInfo.test.getName(),event.getResultType(),event.getEndTime() - testInfo.started,failures);
  }
 else   if (testInfo.test.getParent() == null) {
    for (    XmlTestsuite xmlTestsuite : testSuites.values()) {
      xmlTestsuite.writeSuiteData(0);
    }
    testSuites.clear();
  }
}
