{
  final TestInfo testInfo=tests.remove(testId);
  if (!testInfo.test.isComposite()) {
    XmlTestSuite xmlTestSuite=testSuites.get(testInfo.test.getClassName());
    Collection<Throwable> failures=this.failures.containsKey(testId) ? this.failures.remove(testId) : Collections.<Throwable>emptySet();
    xmlTestSuite.addTestCase(testInfo.test.getName(),event.getResultType(),event.getEndTime() - testInfo.started,failures);
  }
 else   if (testInfo.test.getParent() == null) {
    for (    XmlTestSuite xmlTestSuite : testSuites.values()) {
      xmlTestSuite.writeSuiteData(0);
    }
    testSuites.clear();
  }
}
