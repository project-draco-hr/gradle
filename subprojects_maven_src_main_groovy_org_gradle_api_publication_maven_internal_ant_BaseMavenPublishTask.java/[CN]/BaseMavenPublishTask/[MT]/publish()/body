{
  if (mainArtifact == null && (additionalArtifacts.size() == 0)) {
    throw new BuildException("You must specify a file and/or an attached artifact for Maven publishing.");
  }
  ArtifactRepository localRepo=createLocalArtifactRepository();
  ParsedMavenPom parsedMavenPom=new ParsedMavenPom(pomFile);
  Artifact artifact=createMainArtifact(parsedMavenPom);
  if (mainArtifact != null) {
    boolean isPomArtifact="pom".equals(parsedMavenPom.getPackaging());
    if (isPomArtifact) {
      doPublish(artifact,pomFile,localRepo);
    }
 else {
      ArtifactMetadata metadata=new ProjectArtifactMetadata(artifact,pomFile);
      artifact.addMetadata(metadata);
      doPublish(artifact,mainArtifact,localRepo);
    }
  }
  for (  AdditionalArtifact attachedArtifact : additionalArtifacts) {
    Artifact attach=createAttachedArtifact(artifact,attachedArtifact.getType(),attachedArtifact.getClassifier());
    doPublish(attach,attachedArtifact.getFile(),localRepo);
  }
}
