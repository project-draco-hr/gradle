{
  if (runTasks) {
    launcher.addListener(new TasksCompletionListener(){
      public void onTasksFinished(      GradleInternal gradle){
        model=builder.buildAll(gradle);
      }
    }
);
    return launcher.run();
  }
 else {
    launcher.addListener(new ModelConfigurationListener(){
      public void onConfigure(      GradleInternal gradle){
        ensureAllProjectsEvaluated(gradle);
        model=builder.buildAll(gradle);
      }
    }
);
    return launcher.getBuildAnalysis();
  }
}
