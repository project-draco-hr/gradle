{
  GradleLauncher launcher=buildController.getLauncher();
  final ToolingModelBuilder builder=new StandardToolingModelBuilderRegistry().getBuilder(type);
  if (runTasks) {
    launcher.addListener(new TasksCompletionListener(){
      public void onTasksFinished(      GradleInternal gradle){
        model=builder.buildAll(type,gradle.getDefaultProject());
      }
    }
);
    buildController.run();
  }
 else {
    launcher.addListener(new ModelConfigurationListener(){
      public void onConfigure(      GradleInternal gradle){
        ensureAllProjectsEvaluated(gradle);
        model=builder.buildAll(type,gradle.getDefaultProject());
      }
    }
);
    buildController.configure();
  }
  return model;
}
