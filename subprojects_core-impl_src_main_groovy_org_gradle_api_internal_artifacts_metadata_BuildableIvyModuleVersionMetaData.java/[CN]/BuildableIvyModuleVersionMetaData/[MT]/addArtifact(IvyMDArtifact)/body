{
  if (newArtifact.getConfigurations().isEmpty()) {
    throw new IllegalArgumentException("Artifact should be attached to at least one configuration.");
  }
  MDArtifact unattached=newArtifact.unattachedArtifact(module);
  Artifact[] allArtifacts=module.getAllArtifacts();
  for (  Artifact existing : allArtifacts) {
    if (artifactsEqual(unattached,existing)) {
      if (!(existing instanceof MDArtifact)) {
        throw new IllegalArgumentException("Cannot update an existing artifact (" + existing + ") in provided module descriptor ("+ module+ ")"+ " because the artifact is not an instance of MDArtifact."+ module);
      }
      attachArtifact((MDArtifact)existing,newArtifact.getConfigurations(),module);
      return;
    }
  }
  attachArtifact(unattached,newArtifact.getConfigurations(),module);
}
