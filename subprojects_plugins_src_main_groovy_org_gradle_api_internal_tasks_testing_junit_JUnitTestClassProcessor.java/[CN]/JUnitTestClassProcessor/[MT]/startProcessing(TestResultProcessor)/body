{
  ClassLoader applicationClassLoader=Thread.currentThread().getContextClassLoader();
  ListenerBroadcast<TestResultProcessor> processors=new ListenerBroadcast<TestResultProcessor>(TestResultProcessor.class);
  processors.add(new JUnitXmlReportGenerator(testResultsDir));
  processors.add(resultProcessor);
  TestResultProcessor resultProcessorChain=new AttachParentTestResultProcessor(new CaptureTestOutputTestResultProcessor(processors.getSource(),outputRedirector));
  TestClassExecutionEventGenerator eventGenerator=new TestClassExecutionEventGenerator(resultProcessorChain,idGenerator,timeProvider);
  resultProcessorActor=actorFactory.createBlockingActor(eventGenerator);
  TestResultProcessor threadSafeResultProcessor=resultProcessorActor.getProxy(TestResultProcessor.class);
  TestClassExecutionListener threadSafeTestClassListener=resultProcessorActor.getProxy(TestClassExecutionListener.class);
  JUnitTestEventAdapter junitEventAdapter=new JUnitTestEventAdapter(threadSafeResultProcessor,timeProvider,idGenerator);
  executer=new JUnitTestClassExecuter(applicationClassLoader,junitEventAdapter,threadSafeTestClassListener);
}
