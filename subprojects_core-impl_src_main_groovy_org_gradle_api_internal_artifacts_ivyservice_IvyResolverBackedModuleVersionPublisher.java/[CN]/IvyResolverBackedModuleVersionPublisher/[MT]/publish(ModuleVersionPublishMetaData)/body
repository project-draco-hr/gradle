{
  boolean successfullyPublished=false;
  try {
    ModuleVersionIdentifier id=moduleVersion.getId();
    ModuleRevisionId ivyId=IvyUtil.createModuleRevisionId(id.getGroup(),id.getName(),id.getVersion());
    resolver.beginPublishTransaction(ivyId,true);
    for (    ModuleVersionArtifactPublishMetaData artifactMetaData : moduleVersion.getArtifacts()) {
      Artifact artifact=createIvyArtifact(ivyId,artifactMetaData);
      File artifactFile=artifactMetaData.getFile();
      resolver.publish(artifact,artifactFile,true);
    }
    resolver.commitPublishTransaction();
    successfullyPublished=true;
  }
  finally {
    if (!successfullyPublished) {
      resolver.abortPublishTransaction();
    }
  }
}
