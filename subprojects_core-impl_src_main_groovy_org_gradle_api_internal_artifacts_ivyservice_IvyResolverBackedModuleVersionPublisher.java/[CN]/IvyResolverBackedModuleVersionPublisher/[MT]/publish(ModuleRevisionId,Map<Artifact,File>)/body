{
  boolean successfullyPublished=false;
  try {
    resolver.beginPublishTransaction(id,true);
    for (    Map.Entry<Artifact,File> entry : artifacts.entrySet()) {
      Artifact artifact=entry.getKey();
      File artifactFile=entry.getValue();
      publish(artifact,artifactFile);
    }
    resolver.commitPublishTransaction();
    successfullyPublished=true;
  }
  finally {
    if (!successfullyPublished) {
      resolver.abortPublishTransaction();
    }
  }
}
