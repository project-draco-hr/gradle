{
  expectTaskStateCreated();
  TaskArtifactState state=repository.getStateFor(task);
  assertNotNull(state);
  final TaskExecutionHistory executionHistory=context.mock(TaskExecutionHistory.class);
  context.checking(new Expectations(){
{
      one(taskArtifactState).getExecutionHistory();
      will(returnValue(executionHistory));
      one(taskArtifactState).update();
    }
  }
);
  assertThat(state.getExecutionHistory(),sameInstance(executionHistory));
  state.update();
}
