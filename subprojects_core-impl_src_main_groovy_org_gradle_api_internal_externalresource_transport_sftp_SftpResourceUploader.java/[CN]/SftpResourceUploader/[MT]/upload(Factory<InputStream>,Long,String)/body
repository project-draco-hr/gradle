{
  URI uri=toUri(destination);
  SftpClient client=sftpClientFactory.createSftpClient(uri,credentials);
  try {
    String path=uri.getPath();
    ensureParentDirectoryExists(client,path);
    OutputStream outputStream=client.write(uri.getPath());
    try {
      InputStream sourceStream=sourceFactory.create();
      try {
        IOUtils.copyLarge(sourceStream,outputStream);
      }
  finally {
        sourceStream.close();
      }
    }
  finally {
      outputStream.close();
    }
  }
  finally {
    sftpClientFactory.releaseSftpClient(client);
  }
}
