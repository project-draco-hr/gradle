{
  final Throwable failure=new RuntimeException();
  context.checking(new Expectations(){
{
      allowing(task).getEnabled();
      will(returnValue(true));
      one(spec).isSatisfiedBy(task);
      will(throwException(failure));
    }
  }
);
  TaskExecutionResult result=executer.execute(task,state);
  GradleScriptException exception=(GradleScriptException)result.getFailure();
  assertThat(exception.getOriginalMessage(),equalTo("Could not evaluate onlyIf predicate for <task>."));
  assertThat(exception.getCause(),sameInstance(failure));
  assertThat(exception.getScriptSource(),sameInstance(scriptSource));
  assertThat(result.getSkipMessage(),nullValue());
  assertTrue(state.isExecuted());
  assertFalse(state.isExecuting());
  assertFalse(state.isDidWork());
}
