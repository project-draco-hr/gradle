{
  setExtension(WAR_EXTENSION);
  setMetadataCharset("UTF-8");
  webInf=(DefaultCopySpec)getRootSpec().addChildBeforeSpec(getMainSpec()).into("WEB-INF");
  webInf.into("classes",new Action<CopySpec>(){
    @Override public void execute(    CopySpec copySpec){
      copySpec.from(new Callable<Iterable<File>>(){
        public Iterable<File> call(){
          FileCollection classpath=getClasspath();
          return classpath != null ? Iterables.filter(classpath,IS_DIRECTORY) : new ArrayList<File>();
        }
      }
);
    }
  }
);
  webInf.into("lib",new Action<CopySpec>(){
    public void execute(    CopySpec it){
      it.from(new Callable<Iterable<File>>(){
        public Iterable<File> call(){
          FileCollection classpath=getClasspath();
          return classpath != null ? Iterables.filter(classpath,IS_FILE) : new ArrayList<File>();
        }
      }
);
    }
  }
);
  webInf.into("",new Action<CopySpec>(){
    public void execute(    CopySpec it){
      it.from(new Callable<File>(){
        public File call(){
          return getWebXml();
        }
      }
);
      it.rename(new Transformer<String,String>(){
        public String transform(        String it){
          return "web.xml";
        }
      }
);
    }
  }
);
}
