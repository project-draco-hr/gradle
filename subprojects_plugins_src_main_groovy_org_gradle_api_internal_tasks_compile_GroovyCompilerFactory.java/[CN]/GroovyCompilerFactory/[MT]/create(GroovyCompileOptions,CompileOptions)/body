{
  javaCompilerFactory.setJointCompilation(true);
  Compiler<JavaCompileSpec> javaCompiler=javaCompilerFactory.create(javaOptions);
  Compiler<GroovyJavaJointCompileSpec> groovyCompiler=new ApiGroovyCompiler(javaCompiler);
  CompilerDaemonFactory daemonFactory;
  if (groovyOptions.isFork()) {
    daemonFactory=compilerDaemonManager;
  }
 else {
    daemonFactory=inProcessCompilerDaemonFactory;
  }
  groovyCompiler=new DaemonGroovyCompiler(project,groovyCompiler,project.getServices().get(ClassPathRegistry.class),daemonFactory);
  return new NormalizingGroovyCompiler(groovyCompiler);
}
