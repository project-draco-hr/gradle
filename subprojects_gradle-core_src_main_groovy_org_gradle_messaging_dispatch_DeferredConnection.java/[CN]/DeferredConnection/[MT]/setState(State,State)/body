{
  if (!this.receiveState.canTransitionTo(receiveState)) {
    throw new IllegalStateException(String.format("Cannot change receive state from %s to %s.",this.receiveState,receiveState));
  }
  if (!this.dispatchState.canTransitionTo(dispatchState)) {
    throw new IllegalStateException(String.format("Cannot change dispatch state from %s to %s.",this.dispatchState,dispatchState));
  }
  this.receiveState=receiveState;
  this.dispatchState=dispatchState;
  condition.signalAll();
}
