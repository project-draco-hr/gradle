{
  File buildFile=projectDescriptor.getBuildFile();
  ScriptSource source;
  if (embeddedScript != null) {
    source=embeddedScript;
  }
 else   if (!buildFile.exists()) {
    source=new StringScriptSource("empty build file","");
  }
 else {
    source=new UriScriptSource("build file",buildFile);
  }
  DefaultProject project=classGenerator.newInstance(DefaultProject.class,projectDescriptor.getName(),parent,projectDescriptor.getProjectDir(),source,gradle,gradle.getServiceRegistryFactory());
  if (parent != null) {
    parent.addChildProject(project);
  }
  gradle.getProjectRegistry().addProject(project);
  return project;
}
