{
  Map<Dependency,Set<Configuration>> dependencyToConfigurations=createDependencyToConfigurationsMap(configurations);
  Map<Dependency,String> dependencyToScope=new HashMap<Dependency,String>();
  for (  Dependency dependency : dependencyToConfigurations.keySet()) {
    if (dependency instanceof SelfResolvingDependency) {
      continue;
    }
    Conf2ScopeMapping conf2ScopeMapping=pom.getScopeMappings().getMapping(dependencyToConfigurations.get(dependency).toArray(new Configuration[dependencyToConfigurations.get(dependency).size()]));
    if (!useScope(pom,conf2ScopeMapping)) {
      continue;
    }
    dependencyToScope.put(findDependency(dependency,conf2ScopeMapping.getConfiguration()),conf2ScopeMapping.getScope());
  }
  return dependencyToScope;
}
