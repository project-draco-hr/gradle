{
  Map<ModuleDependency,Set<Configuration>> dependencyToConfigurations=createDependencyToConfigurationsMap(configurations);
  Map<ModuleDependency,String> dependencyToScope=new HashMap<ModuleDependency,String>();
  for (  ModuleDependency dependency : dependencyToConfigurations.keySet()) {
    Conf2ScopeMapping conf2ScopeMapping=pom.getScopeMappings().getMapping(dependencyToConfigurations.get(dependency).toArray(new Configuration[dependencyToConfigurations.get(dependency).size()]));
    if (!useScope(pom,conf2ScopeMapping)) {
      continue;
    }
    dependencyToScope.put(findDependency(dependency,conf2ScopeMapping.getConfiguration()),conf2ScopeMapping.getScope());
  }
  return dependencyToScope;
}
