{
  if (elements.isEmpty()) {
    throw new IllegalStateException("Cannot end element, as there are no started elements.");
  }
  if (context == Context.CData) {
    throw new IllegalStateException("Cannot end element, as current CDATA node has not been closed.");
  }
  if (context == Context.StartTag) {
    writeRaw("/>");
    elements.removeLast();
  }
 else {
    writeRaw("</");
    writeRaw(elements.removeLast());
    writeRaw(">");
  }
  context=Context.Character;
  if (elements.isEmpty()) {
    output.flush();
  }
  return this;
}
