{
  if (needsCDATAEscaping(ch)) {
    writeRaw("]]><![CDATA[>");
  }
 else   if (!isLegalCharacter(ch)) {
    writeRaw('?');
  }
 else   if (isRestrictedCharacter(ch)) {
    writeRaw("]]>&#x");
    writeRaw(Integer.toHexString(ch));
    writeRaw(";<![CDATA[");
  }
 else {
    writeRaw(ch);
  }
}
