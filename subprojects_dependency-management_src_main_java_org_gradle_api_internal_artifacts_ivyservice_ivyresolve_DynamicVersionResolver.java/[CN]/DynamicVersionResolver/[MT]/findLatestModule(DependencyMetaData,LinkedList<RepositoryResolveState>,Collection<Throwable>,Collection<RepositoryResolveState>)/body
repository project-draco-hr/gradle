{
  RepositoryChainModuleResolution best=null;
  while (!queue.isEmpty()) {
    RepositoryResolveState request=queue.removeFirst();
    try {
      request.resolve(dependency);
    }
 catch (    Throwable t) {
      failures.add(t);
      continue;
    }
switch (request.metaDataResolveResult.getState()) {
case Failed:
      failures.add(request.metaDataResolveResult.getFailure());
    break;
case Missing:
  if (!request.metaDataResolveResult.isAuthoritative() && request.canMakeFurtherAttempts()) {
    missing.add(request);
  }
break;
case Unknown:
if (request.canMakeFurtherAttempts()) {
queue.addFirst(request);
}
break;
case Resolved:
RepositoryChainModuleResolution moduleResolution=new RepositoryChainModuleResolution(request.repository,request.metaDataResolveResult.getMetaData());
best=chooseBest(best,moduleResolution);
break;
default :
throw new IllegalStateException("Unexpected state for resolution: " + request.metaDataResolveResult.getState());
}
}
return best;
}
