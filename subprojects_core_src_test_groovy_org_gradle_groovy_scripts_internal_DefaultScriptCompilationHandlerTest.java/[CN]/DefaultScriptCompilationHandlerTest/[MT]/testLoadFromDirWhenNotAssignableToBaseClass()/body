{
  scriptCompilationHandler.compileToDir(scriptSource,classLoader,scriptCacheDir,metadataCacheDir,null,Script.class,verifier);
  try {
    scriptCompilationHandler.loadFromDir(scriptSource,classLoader,scriptCacheDir,metadataCacheDir,null,expectedScriptClass,classLoaderId).loadClass();
    fail();
  }
 catch (  GradleException e) {
    assertThat(e.getMessage(),containsString("Could not load compiled classes for script-display-name from cache."));
    assertThat(e.getCause(),instanceOf(ClassCastException.class));
  }
}
