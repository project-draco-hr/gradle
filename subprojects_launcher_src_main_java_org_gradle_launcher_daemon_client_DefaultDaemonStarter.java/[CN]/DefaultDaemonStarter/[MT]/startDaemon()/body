{
  DefaultModuleRegistry registry=new DefaultModuleRegistry();
  Set<File> bootstrapClasspath=new LinkedHashSet<File>();
  bootstrapClasspath.addAll(registry.getModule("gradle-launcher").getImplementationClasspath().getAsFiles());
  if (registry.getGradleHome() == null) {
    bootstrapClasspath.addAll(registry.getFullClasspath());
  }
  if (bootstrapClasspath.isEmpty()) {
    throw new IllegalStateException("Unable to construct a bootstrap classpath when starting the daemon");
  }
  List<String> daemonArgs=new ArrayList<String>();
  daemonArgs.add(daemonParameters.getEffectiveJavaExecutable());
  List<String> daemonOpts=daemonParameters.getEffectiveJvmArgs();
  LOGGER.debug("Using daemon opts: {}",daemonOpts);
  daemonArgs.addAll(daemonOpts);
  daemonArgs.add("-cp");
  daemonArgs.add(CollectionUtils.join(File.pathSeparator,bootstrapClasspath));
  daemonArgs.add(GradleDaemon.class.getName());
  daemonArgs.add(GradleVersion.current().getVersion());
  daemonArgs.add(daemonDir.getBaseDir().getAbsolutePath());
  daemonArgs.add(String.valueOf(daemonParameters.getIdleTimeout()));
  daemonArgs.add(daemonParameters.getUid());
  daemonArgs.addAll(daemonOpts);
  DaemonDiagnostics diagnostics=startProcess(daemonArgs,daemonDir.getVersionedDir());
  return new DaemonStartupInfo(daemonParameters.getUid(),diagnostics);
}
