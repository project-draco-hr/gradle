{
  LOGGER.info("Starting daemon process: workingDir = {}, daemonArgs: {}",workingDir,args);
  Clock clock=new Clock();
  try {
    workingDir.mkdirs();
    ExecHandleBuilder builder=new ExecHandleBuilder();
    builder.commandLine(args);
    builder.setWorkingDir(workingDir);
    builder.redirectErrorStream();
    builder.setTimeout(30000);
    builder.setDisplayName("Gradle build daemon");
    DaemonOutputConsumer outputConsumer=new DaemonOutputConsumer();
    builder.streamsHandler(outputConsumer);
    ExecHandle handle=builder.build();
    handle.start();
    LOGGER.debug("Gradle daemon process is starting. Waiting for the daemon to detach...");
    DetachResult detachResult=handle.detach();
    LOGGER.debug("Gradle daemon process is now detached.");
    return daemonGreeter.parseDaemonOutput(outputConsumer.getProcessOutput(),detachResult);
  }
 catch (  GradleException e) {
    throw e;
  }
catch (  Exception e) {
    throw new GradleException("Could not start Gradle daemon.",e);
  }
 finally {
    LOGGER.info("An attempt to start the daemon took {}.",clock.getTime());
  }
}
