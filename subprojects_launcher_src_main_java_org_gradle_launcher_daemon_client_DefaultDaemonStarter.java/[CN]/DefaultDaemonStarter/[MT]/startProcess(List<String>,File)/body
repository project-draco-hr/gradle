{
  LOGGER.info("Starting daemon process: workingDir = {}, daemonArgs: {}",workingDir,args);
  Clock clock=new Clock();
  try {
    workingDir.mkdirs();
    return ProcessParentingInitializer.intitialize(new Factory<DaemonDiagnostics>(){
      public DaemonDiagnostics create(){
        try {
          Process process=new ProcessBuilder(args).redirectErrorStream(true).directory(workingDir).start();
          DaemonDiagnostics out=daemonGreeter.waitUntilDaemonReady(process);
          process.getOutputStream().close();
          process.getErrorStream().close();
          process.getInputStream().close();
          return out;
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
);
  }
 catch (  GradleException e) {
    throw e;
  }
catch (  Exception e) {
    throw new GradleException("Could not start Gradle daemon.",e);
  }
 finally {
    LOGGER.info("An attempt to start the daemon took {}.",clock.getTime());
  }
}
