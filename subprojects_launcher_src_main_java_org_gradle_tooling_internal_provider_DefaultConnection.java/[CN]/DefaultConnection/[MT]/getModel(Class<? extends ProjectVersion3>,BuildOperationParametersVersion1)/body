{
  if (!type.isAssignableFrom(EclipseProjectVersion3.class)) {
    throw new UnsupportedOperationException(String.format("Cannot build model of type '%s'.",type.getSimpleName()));
  }
  StartParameter startParameter=new ConnectionToStartParametersConverter().convert(operationParameters);
  GradleLauncher gradleLauncher=GradleLauncher.newInstance(startParameter);
  boolean projectDependenciesOnly=!EclipseProjectVersion3.class.isAssignableFrom(type);
  boolean includeTasks=BuildableProjectVersion1.class.isAssignableFrom(type);
  ModelBuildingAdapter adapter=new ModelBuildingAdapter(new EclipsePluginApplier(),new ModelBuilder(includeTasks,projectDependenciesOnly));
  gradleLauncher.addListener(adapter);
  run(operationParameters,gradleLauncher,new BuildAction(){
    public BuildResult execute(    GradleLauncher gradleLauncher){
      return gradleLauncher.getBuildAnalysis();
    }
  }
);
  return type.cast(adapter.getProject());
}
