{
  Credentials httpCredentials;
  for (  Authentication authentication : authentications) {
    String scheme=getAuthScheme(authentication);
    PasswordCredentials credentials=(PasswordCredentials)((AuthenticationInternal)authentication).getCredentials();
    if (authentication instanceof AllSchemesAuthentication) {
      NTLMCredentials ntlmCredentials=new NTLMCredentials(credentials);
      httpCredentials=new NTCredentials(ntlmCredentials.getUsername(),ntlmCredentials.getPassword(),ntlmCredentials.getWorkstation(),ntlmCredentials.getDomain());
      httpClient.getCredentialsProvider().setCredentials(new AuthScope(host,port,AuthScope.ANY_REALM,AuthPolicy.NTLM),httpCredentials);
      LOGGER.debug("Using {} and {} for authenticating against '{}:{}'",new Object[]{credentials,ntlmCredentials,host,port});
    }
    httpCredentials=new UsernamePasswordCredentials(credentials.getUsername(),credentials.getPassword());
    httpClient.getCredentialsProvider().setCredentials(new AuthScope(host,port,AuthScope.ANY_REALM,scheme),httpCredentials);
    LOGGER.debug("Using {} for authenticating against '{}:{}'",new Object[]{credentials,host,port});
  }
}
