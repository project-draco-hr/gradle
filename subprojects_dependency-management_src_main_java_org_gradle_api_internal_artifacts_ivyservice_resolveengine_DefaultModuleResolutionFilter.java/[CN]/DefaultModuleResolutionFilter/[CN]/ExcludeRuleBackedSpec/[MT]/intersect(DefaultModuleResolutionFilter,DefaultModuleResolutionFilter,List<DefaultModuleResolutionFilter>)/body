{
  if (spec1 instanceof ArtifactSpec) {
    merged.add(spec1);
  }
 else   if (spec2 instanceof ArtifactSpec) {
    merged.add(spec2);
  }
 else   if (spec1 instanceof GroupNameSpec) {
    intersect((GroupNameSpec)spec1,spec2,merged);
  }
 else   if (spec2 instanceof GroupNameSpec) {
    intersect((GroupNameSpec)spec2,spec1,merged);
  }
 else   if (spec1 instanceof ModuleNameSpec) {
    intersect((ModuleNameSpec)spec1,spec2,merged);
  }
 else   if (spec2 instanceof ModuleNameSpec) {
    intersect((ModuleNameSpec)spec2,spec1,merged);
  }
 else   if ((spec1 instanceof ModuleIdSpec) && (spec2 instanceof ModuleIdSpec)) {
    ModuleIdSpec moduleSpec1=(ModuleIdSpec)spec1;
    ModuleIdSpec moduleSpec2=(ModuleIdSpec)spec2;
    if (moduleSpec1.moduleId.equals(moduleSpec2.moduleId)) {
      merged.add(moduleSpec1);
    }
  }
 else {
    throw new UnsupportedOperationException(String.format("Cannot calculate intersection of exclude rules: %s, %s",spec1,spec2));
  }
}
