{
  TestFile classPath=testDir.createDir(name);
  Properties props=new Properties();
  props.putAll(properties);
  final TestFile propertiesFile=classPath.file("META-INF/gradle-plugins.properties");
  propertiesFile.getParentFile().mkdirs();
  GUtil.saveProperties(props,propertiesFile);
  final ClassLoader classLoader=context.mock(ClassLoader.class,name);
  context.checking(new Expectations(){
{
      allowing(classLoader).getResources("META-INF/gradle-plugins.properties");
      will(returnEnumeration(propertiesFile.toURI().toURL()));
    }
  }
);
  return classLoader;
}
