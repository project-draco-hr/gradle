{
  TestFile buildFile=testFile("build.gradle");
  buildFile.writelns("import org.gradle.integtests.TaskExecutionIntegrationTest","createTask('a', dependsOn: 'b') { task ->","    assertTrue(build.taskGraph.hasTask(task))","    assertTrue(build.taskGraph.hasTask(':a'))","    assertTrue(build.taskGraph.hasTask(a))","    assertTrue(build.taskGraph.hasTask(':b'))","    assertTrue(build.taskGraph.hasTask(b))","    assertTrue(build.taskGraph.allTasks.contains(task))","    assertTrue(build.taskGraph.allTasks.contains(project.task('b')))","}","createTask('b')","build.taskGraph.whenReady { graph ->","    assertTrue(graph.hasTask(':a'))","    assertTrue(graph.hasTask(a))","    assertTrue(graph.hasTask(':b'))","    assertTrue(graph.hasTask(b))","    assertTrue(graph.allTasks.contains(a))","    assertTrue(graph.allTasks.contains(b))","    TaskExecutionIntegrationTest.graphListenerNotified = true","}");
  usingBuildFile(buildFile).withTasks("a").run().assertTasksExecuted(":b",":a");
  assertTrue(graphListenerNotified);
}
