{
  TestFile buildFile=testFile("build.gradle");
  buildFile.writelns("import org.gradle.integtests.TaskExecutionIntegrationTest","createTask('a', dependsOn: 'b') { task ->","    assertTrue(build.taskGraph.hasTask(':a'))","    assertTrue(build.taskGraph.hasTask(':b'))","    assertTrue(build.taskGraph.allTasks.contains(task))","    assertTrue(build.taskGraph.allTasks.contains(project.task('b')))","}","createTask('b')","build.taskGraph.whenReady { graph ->","    assertTrue(graph.hasTask(':a'))","    assertTrue(graph.hasTask(':b'))","    assertTrue(graph.allTasks.contains(task('a')))","    assertTrue(graph.allTasks.contains(task('b')))","    TaskExecutionIntegrationTest.graphListenerNotified = true","}");
  usingBuildFile(buildFile).runTasks("a").assertTasksExecuted(":b",":a");
  assertTrue(graphListenerNotified);
}
