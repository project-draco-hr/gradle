{
  GradleConnectionBuilder builder=GradleConnector.newGradleConnection();
  File gradleHome=new File(args[0]);
  File gradleUserHome=new File(args[1]);
  builder.useGradleUserHomeDir(gradleUserHome);
  for (int i=2; i < args.length; i++) {
    File projectDir=new File(args[i]);
    builder.addParticipant(projectDir).useInstallation(gradleHome);
  }
  File interestingProjectDir=new File(args[args.length - 1]);
  GradleConnection connection=builder.build();
  try {
    ModelResults<GradleProject> gradleProjects=connection.getModels(GradleProject.class);
    BuildIdentifier buildIdentifier=findInterestingBuild(interestingProjectDir,gradleProjects);
    List<Launchable> tasksToRun=findTasksToRun(buildIdentifier,gradleProjects);
    if (tasksToRun.isEmpty()) {
      System.err.println(String.format("Could not find any build tasks to run in ",buildIdentifier));
      System.exit(-1);
    }
    BuildLauncher buildLauncher=connection.newBuild();
    buildLauncher.forLaunchables(tasksToRun);
    buildLauncher.setStandardError(System.err);
    buildLauncher.setStandardOutput(System.out);
    buildLauncher.run();
  }
  finally {
    connection.close();
  }
}
