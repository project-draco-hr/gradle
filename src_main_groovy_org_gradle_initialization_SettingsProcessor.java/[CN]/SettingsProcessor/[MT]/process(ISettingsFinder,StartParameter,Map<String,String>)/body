{
  Clock settingsProcessingClock=new Clock();
  initDependencyManagerFactory(settingsFinder);
  SettingsInternal settings=settingsFactory.createSettings(dependencyManagerFactory,buildSourceBuilder,settingsFinder.getSettingsDir(),gradleProperties,startParameter);
  if (settingsFinder.getSettingsScriptSource().getText() != null) {
    applySettingsScript(settingsFinder,settings);
    if (!isSettingsFileApplicableToCurrentDir(settings)) {
      settings=createBasicSettings(settingsFinder,startParameter);
    }
  }
 else {
    settings=createBasicSettings(settingsFinder,startParameter);
  }
  logger.debug("Timing: Processing settings took: {}",settingsProcessingClock.getTime());
  return settings;
}
