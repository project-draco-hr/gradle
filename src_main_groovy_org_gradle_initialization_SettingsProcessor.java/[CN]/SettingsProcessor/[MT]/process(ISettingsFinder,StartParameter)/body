{
  Clock settingsProcessingClock=new Clock();
  initDependencyManagerFactory(settingsFinder);
  DefaultSettings settings=settingsFactory.createSettings(dependencyManagerFactory,buildSourceBuilder,settingsFinder,startParameter);
  ScriptSource source=new ImportsScriptSource(settingsFinder.getSettingsScript(),importsReader,settingsFinder.getSettingsDir());
  try {
    Script settingsScript=scriptProcessor.createScript(source,Thread.currentThread().getContextClassLoader(),Script.class);
    settingsScriptMetaData.applyMetaData(settingsScript,settings);
    Clock clock=new Clock();
    settingsScript.run();
    logger.debug("Timing: Evaluating settings file took: {}",clock.getTime());
  }
 catch (  Throwable t) {
    throw new GradleScriptException("A problem occurred evaluating the settings file.",t,source);
  }
  logger.debug("Timing: Processing settings took: {}",settingsProcessingClock.getTime());
  if (!startParameter.getCurrentDir().equals(settingsFinder.getSettingsDir()) && !isCurrentDirIncluded(settings)) {
    return createBasicSettings(settingsFinder,startParameter);
  }
  return settings;
}
