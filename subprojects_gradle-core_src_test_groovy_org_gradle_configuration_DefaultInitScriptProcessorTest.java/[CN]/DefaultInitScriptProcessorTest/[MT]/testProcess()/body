{
  final ScriptProcessorFactory scriptProcessorFactoryMock=context.mock(ScriptProcessorFactory.class);
  final ScriptProcessor scriptProcessorMock=context.mock(ScriptProcessor.class);
  final ScriptSource initScriptMock=context.mock(ScriptSource.class);
  final GradleInternal gradleMock=context.mock(GradleInternal.class);
  final ScriptClassLoaderProvider buildClassLoaderProviderMock=context.mock(ScriptClassLoaderProvider.class);
  final URLClassLoader classLoader=new URLClassLoader(new URL[0]);
  final groovy.lang.Script classPathScriptMock=new EmptyScript();
  final groovy.lang.Script buildScriptMock=new EmptyScript();
  context.checking(new Expectations(){
{
      one(scriptProcessorFactoryMock).createProcessor(initScriptMock);
      will(returnValue(gradleMock));
      allowing(gradleMock).getClassLoaderProvider();
      will(returnValue(buildClassLoaderProviderMock));
      one(buildClassLoaderProviderMock).getClassLoader();
      will(returnValue(classLoader));
      one(scriptProcessorMock).setClassloader(classLoader);
      one(scriptProcessorMock).setTransformer(with(any(InitScriptClasspathScriptTransformer.class)));
      one(scriptProcessorMock).compile(Script.class);
      will(returnValue(classPathScriptMock));
      one(buildClassLoaderProviderMock).updateClassPath();
      one(scriptProcessorMock).setTransformer(with(any(InitScriptTransformer.class)));
      one(scriptProcessorMock).compile(Script.class);
      will(returnValue(buildScriptMock));
    }
  }
);
}
