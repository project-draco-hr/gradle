{
  for (  RuleAction<? super VersionSelection> rule : versionSelectionRules) {
    List<Object> inputs=Lists.newArrayList();
    for (    Class<?> inputType : rule.getInputTypes()) {
      BuildableModuleVersionMetaDataResolveResult descriptorResult=new DefaultBuildableModuleVersionMetaDataResolveResult();
      moduleAccess.resolveComponentMetaData(((VersionSelectionInternal)selection).getDependencyMetaData(),selection.getCandidate(),descriptorResult);
      if (inputType == ComponentMetadata.class) {
        ComponentMetadataDetails componentMetadata=new ComponentMetadataDetailsAdapter(descriptorResult.getMetaData());
        inputs.add(componentMetadata);
        continue;
      }
      if (inputType == IvyModuleDescriptor.class) {
        if (descriptorResult.getMetaData() instanceof IvyModuleVersionMetaData) {
          IvyModuleVersionMetaData ivyMetadata=(IvyModuleVersionMetaData)descriptorResult.getMetaData();
          inputs.add(new DefaultIvyModuleDescriptor(ivyMetadata.getExtraInfo(),ivyMetadata.getBranch(),ivyMetadata.getStatus()));
          continue;
        }
 else {
          return;
        }
      }
      throw new InvalidUserCodeException(String.format(UNSUPPORTED_PARAMETER_TYPE_ERROR,inputType.getName()));
    }
    try {
      rule.execute(selection,inputs);
    }
 catch (    Exception e) {
      throw new InvalidUserCodeException(USER_CODE_ERROR,e);
    }
  }
}
