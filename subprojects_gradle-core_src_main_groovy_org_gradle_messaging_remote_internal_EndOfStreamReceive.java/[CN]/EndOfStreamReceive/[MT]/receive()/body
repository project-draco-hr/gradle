{
  if (ended) {
    return null;
  }
  Message message=receive.receive();
  if (message == null) {
    ended=true;
    return new EndOfStreamEvent();
  }
  if (message instanceof EndOfStreamEvent) {
    ended=true;
  }
  return message;
}
