{
  DefaultExecutorFactory executorFactory=new DefaultExecutorFactory();
  TcpIncomingConnector incomingConnector=new TcpIncomingConnector(executorFactory,getClass().getClassLoader());
  final CompletionHandler finished=new CompletionHandler();
  LOGGER.lifecycle("Awaiting requests.");
  Address address=incomingConnector.accept(new Action<ConnectEvent<Connection<Object>>>(){
    public void execute(    ConnectEvent<Connection<Object>> connectionConnectEvent){
      try {
        finished.onStartActivity();
        handler.handle(connectionConnectEvent.getConnection(),finished);
      }
  finally {
        finished.onActivityComplete();
        connectionConnectEvent.getConnection().stop();
      }
    }
  }
);
  storeDaemonAddress(address);
  boolean stopped=finished.awaitStop();
  if (!stopped) {
    LOGGER.lifecycle("Time-out waiting for requests. Stopping.");
  }
  new CompositeStoppable(incomingConnector,executorFactory).stop();
  getRegistryFile().delete();
}
