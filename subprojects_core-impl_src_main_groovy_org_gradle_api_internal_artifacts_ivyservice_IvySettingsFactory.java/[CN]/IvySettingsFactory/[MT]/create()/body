{
  IvySettings ivySettings=new IvySettings();
  ivySettings.setDefaultCache(cacheMetaData.getCacheDir());
  ivySettings.setDefaultCacheIvyPattern(ArtifactRepositoryContainer.DEFAULT_CACHE_IVY_PATTERN);
  ivySettings.setDefaultCacheArtifactPattern(ArtifactRepositoryContainer.DEFAULT_CACHE_ARTIFACT_PATTERN);
  ivySettings.setVariable("ivy.log.modules.in.use","false");
  WharfCacheManager cacheManager=WharfCacheManager.newInstance(ivySettings);
  try {
    Field field=WharfCacheManager.class.getDeclaredField("lockFactory");
    field.setAccessible(true);
    field.set(cacheManager,lockHolderFactory);
  }
 catch (  Exception e) {
    throw UncheckedException.asUncheckedException(e);
  }
  ivySettings.setDefaultRepositoryCacheManager(cacheManager);
  ResolutionCacheManager resolutionCacheManager=new TempFileResolutionCacheManager(cacheMetaData.getCacheDir());
  ivySettings.setResolutionCacheManager(resolutionCacheManager);
  return ivySettings;
}
