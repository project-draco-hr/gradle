{
  ScriptHandlerFactory factory=new DefaultScriptHandlerFactory(get(DependencyManagementServices.class),get(FileResolver.class),get(DependencyMetaDataProvider.class));
  ClassLoader parentClassLoader;
  if (project.getParent() != null) {
    parentClassLoader=project.getParent().getBuildscript().getClassLoader();
  }
 else {
    parentClassLoader=get(BuildClassLoaderRegistry.class).getScriptClassLoader();
  }
  return factory.create(project.getBuildScriptSource(),parentClassLoader,project);
}
