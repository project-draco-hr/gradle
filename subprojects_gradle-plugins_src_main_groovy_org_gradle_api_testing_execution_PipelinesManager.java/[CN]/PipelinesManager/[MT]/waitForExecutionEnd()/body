{
  ThreadUtils.interleavedConditionWait(lock,allStoppedCondition,100L,TimeUnit.MILLISECONDS,new ConditionWaitHandle(){
    public boolean checkCondition(){
      return notStopped.isEmpty();
    }
    public void conditionMatched(){
    }
  }
);
  serverFactory.stop();
}
