{
  ModuleRevisionId revisionId=dependencyDescriptor.getDependencyRevisionId();
  ModuleVersionSelector requested=DefaultModuleVersionSelector.newSelector(revisionId.getOrganisation(),revisionId.getName(),revisionId.getRevision());
  Dependency dep=state.addDependency(requested,dependencyDescriptor.getDynamicConstraintDependencyRevisionId().getRevision(),false,dependencyDescriptor.isChanging(),dependencyDescriptor.isTransitive());
  Map<String,List<String>> configMappings=readConfigMappings(dependencyDescriptor);
  for (  String from : configMappings.keySet()) {
    for (    String to : configMappings.get(from)) {
      dep.addDependencyConfiguration(from,to);
    }
  }
  for (  DependencyArtifactDescriptor ivyArtifact : dependencyDescriptor.getAllDependencyArtifacts()) {
    IvyArtifactName ivyArtifactName=new DefaultIvyArtifactName(ivyArtifact.getName(),ivyArtifact.getType(),ivyArtifact.getExt(),(String)ivyArtifact.getExtraAttributes().get(CLASSIFIER));
    dep.addArtifact(ivyArtifactName,Sets.newHashSet(ivyArtifact.getConfigurations()));
  }
  for (  ExcludeRule excludeRule : dependencyDescriptor.getAllExcludeRules()) {
    dep.addExcludeRule(forIvyExclude(excludeRule));
  }
}
