{
  try {
    connection.dispatch(command);
    while (true) {
      Object object=null;
      try {
        object=connection.receive();
      }
 catch (      Exception e) {
        LOGGER.warn("Client was unable to receive the message from daemon. Will retry...",e);
      }
      if (object instanceof CommandComplete) {
        CommandComplete commandComplete=(CommandComplete)object;
        if (commandComplete.getFailure() != null) {
          throw commandComplete.getFailure();
        }
        return commandComplete;
      }
      OutputEvent outputEvent=(OutputEvent)object;
      outputEventListener.onOutput(outputEvent);
    }
  }
  finally {
    connection.stop();
  }
}
