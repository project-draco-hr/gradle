{
  if (parent != null) {
    return parent.loadPlugin(pluginClass);
  }
  if (!Plugin.class.isAssignableFrom(pluginClass)) {
    throw new InvalidUserDataException(String.format("Cannot create plugin of type '%s' as it does not implement the Plugin interface.",pluginClass.getSimpleName()));
  }
  try {
    DefaultServiceRegistry services=new DefaultServiceRegistry();
    Instantiator instantiator=new DependencyInjectingInstantiator(services);
    services.add(Instantiator.class,instantiator);
    return instantiator.newInstance(pluginClass);
  }
 catch (  ObjectInstantiationException e) {
    throw new PluginInstantiationException(String.format("Could not create plugin of type '%s'.",pluginClass.getSimpleName()),e.getCause());
  }
}
