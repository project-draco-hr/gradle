{
  this.parent=parent;
  this.pluginInspector=pluginInspector;
  this.classLoaderFactory=classLoaderFactory;
  this.classMappings=CacheBuilder.newBuilder().build(new PotentialPluginCacheLoader(pluginInspector));
  this.idMappings=CacheBuilder.newBuilder().build(new CacheLoader<PluginIdLookupCacheKey,Optional<PotentialPluginWithId<?>>>(){
    @Override public Optional<PotentialPluginWithId<?>> load(    @SuppressWarnings("NullableProblems") PluginIdLookupCacheKey key) throws Exception {
      final PluginId pluginId=key.getId();
      ClassLoader classLoader=key.getClassLoader();
      PluginDescriptorLocator locator=new ClassloaderBackedPluginDescriptorLocator(classLoader);
      PluginDescriptor pluginDescriptor=locator.findPluginDescriptor(pluginId.toString());
      if (pluginDescriptor == null) {
        return Optional.absent();
      }
      String implClassName=pluginDescriptor.getImplementationClassName();
      if (!GUtil.isTrue(implClassName)) {
        throw new PluginInstantiationException(String.format("No implementation class specified for plugin '%s' in %s.",pluginId,pluginDescriptor));
      }
      final Class<?> implClass;
      try {
        implClass=classLoader.loadClass(implClassName);
      }
 catch (      ClassNotFoundException e) {
        throw new InvalidPluginException(String.format("Could not find implementation class '%s' for plugin '%s' specified in %s.",implClassName,pluginId,pluginDescriptor),e);
      }
      PotentialPlugin<?> potentialPlugin=inspect(implClass);
      PotentialPluginWithId<?> withId=new DefaultPotentialPluginWithId<Object>(pluginId,potentialPlugin){
        @Override public boolean isAlsoKnownAs(        PluginId id){
          if (pluginId.equals(id)) {
            return true;
          }
          PotentialPluginWithId<?> other=lookupSelf(id);
          return other != null && other.asClass().equals(implClass);
        }
      }
;
      return Cast.uncheckedCast(Optional.of(withId));
    }
  }
);
}
