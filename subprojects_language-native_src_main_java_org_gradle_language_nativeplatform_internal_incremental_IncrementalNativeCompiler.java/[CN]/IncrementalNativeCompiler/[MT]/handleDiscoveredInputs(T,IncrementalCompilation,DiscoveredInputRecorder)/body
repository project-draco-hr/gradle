{
  for (  File includeFile : compilation.getDiscoveredInputs()) {
    discoveredInputRecorder.newInput(includeFile);
  }
  if (sourceFilesUseMacroIncludes(spec.getSourceFiles(),compilation.getFinalState())) {
    logger.info("After parsing the source files, Gradle cannot calculate the exact set of include files for {}. Every file in the include search path will be considered an input.",task.getName());
    for (    final File includeRoot : spec.getIncludeRoots()) {
      logger.info("adding files in {} to discovered inputs for {}",includeRoot,task.getName());
      new DirectoryFileTree(includeRoot).visit(new EmptyFileVisitor(){
        @Override public void visitFile(        FileVisitDetails fileDetails){
          discoveredInputRecorder.newInput(fileDetails.getFile());
        }
      }
);
    }
  }
}
