{
  ModelPath path=node.getPath();
  if (!transitionedNodes.add(path)) {
    List<ModelPath> transitionedNodesList=Lists.newArrayList(transitionedNodes);
    List<ModelPath> cycleElements=transitionedNodesList.subList(transitionedNodesList.indexOf(path),transitionedNodesList.size());
    cycleElements.add(path);
    throw new ConfigurationCycleException("A cycle in model rule dependencies has been detected. Nodes forming the cycle: " + Joiner.on(" -> ").join(cycleElements));
  }
  try {
    performTransition(node,desired,laterOk);
  }
  finally {
    transitionedNodes.remove(path);
  }
}
