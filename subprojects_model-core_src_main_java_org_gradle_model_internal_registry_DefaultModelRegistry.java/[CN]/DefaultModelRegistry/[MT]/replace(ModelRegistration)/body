{
  ModelNodeInternal node=modelGraph.find(newRegistration.getPath());
  if (node == null) {
    throw new IllegalStateException("can not replace node " + newRegistration.getPath() + " as it does not exist");
  }
  replace=true;
  try {
    boolean wasDiscovered=node.isAtLeast(Discovered);
    ruleBindings.remove(node,node.getRegistrationBinder());
    for (    RuleBinder ruleBinder : node.getInitializerRuleBinders()) {
      ruleBindings.remove(node,ruleBinder);
    }
    node.getInitializerRuleBinders().clear();
    node.replaceCreatorRuleBinder(toCreatorBinder(newRegistration));
    node.setState(Registered);
    addRuleBindings(node);
    if (wasDiscovered) {
      transition(node,Discovered,false);
    }
  }
  finally {
    replace=false;
  }
  return this;
}
