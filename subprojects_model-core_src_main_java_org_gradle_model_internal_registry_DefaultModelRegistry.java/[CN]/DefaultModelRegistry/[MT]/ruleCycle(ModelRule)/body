{
  boolean cycleStartFound=false;
  String indent="  ";
  StringBuilder prefix=new StringBuilder(indent);
  StringWriter out=new StringWriter();
  PrintWriter writer=new PrintWriter(out);
  writer.println("A cycle has been detected in model rule dependencies. References forming the cycle:");
  for (  Map.Entry<ModelRule,ModelReference<?>> ruleInputInClosing : rulesWithInputsBeingClosed.entrySet()) {
    ModelRule rule=ruleInputInClosing.getKey();
    ModelRuleDescriptor ruleDescriptor=rule.getDescriptor();
    String referenceDescription=ruleInputInClosing.getValue().getDescription();
    if (cycleStartFound) {
      reportRuleInputBeingClosed(indent,prefix,writer,ruleDescriptor,referenceDescription);
    }
 else {
      if (rule.equals(cycleStartRule)) {
        cycleStartFound=true;
        reportRuleInputBeingClosed(indent,prefix,writer,ruleDescriptor,referenceDescription);
      }
    }
  }
  writer.print(cycleStartRule.getDescriptor().toString());
  return new ConfigurationCycleException(out.toString());
}
