{
  ModelPath.validateName(name);
  ModelNodeImpl node=new ModelNodeImpl(creationPath.child(name),descriptor,promise,adapter);
  ModelNodeImpl previous=links.put(name,node);
  if (previous != null) {
    throw new DuplicateModelException(String.format("Cannot create '%s' as it was already created by: %s",node.getCreationPath(),previous.getCreationDescriptor()));
  }
  for (  Map.Entry<ModelPath,ModelNodeImpl> entry : ImmutableSet.copyOf(modelGraph.flattened.entrySet())) {
    if (entry.getValue() == this) {
      modelGraph.flattened.put(entry.getKey().child(name),node);
    }
  }
  List<ModelPath> paths=modelGraph.getPaths(node);
  for (  ModelPath path : paths) {
    notifyCreationListeners(descriptor,path,promise);
  }
  return node;
}
