{
  ModuleRevisionId original=descriptor.getModuleRevisionId();
  ModuleRevisionId id=new ModuleRevisionId(new ModuleId(original.getOrganisation(),original.getName()),original.getRevision());
  ModuleRevisionResolveState moduleRevision=revisions.get(id);
  if (moduleRevision == null) {
    moduleRevision=new ModuleRevisionResolveState(id,descriptor);
    revisions.put(id,moduleRevision);
    ModuleId moduleId=id.getModuleId();
    modules.put(moduleId,moduleRevision);
    Set<ModuleRevisionResolveState> revisionsForModule=modules.get(moduleId);
    if (revisionsForModule.size() > 1) {
      for (      ModuleRevisionResolveState revision : revisionsForModule) {
        revision.status=Status.Conflict;
      }
    }
  }
  return moduleRevision;
}
