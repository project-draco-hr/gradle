{
  long id=idGenerator.generateId();
  ResolvedConfigurationIdentifier configurationIdentifier=childConfiguration.getNodeId();
  ConfigurationMetaData metaData=childConfiguration.getMetaData();
  ComponentResolveMetaData component=metaData.getComponent();
  Set<ComponentArtifactMetaData> artifacts=dependency.getArtifacts(metaData);
  if (!artifacts.isEmpty()) {
    return new DefaultArtifactSet(component.getId(),component.getSource(),ModuleExcludeRuleFilters.excludeNone(),artifacts,artifactResolver,allResolvedArtifacts,id);
  }
  ArtifactSet configurationArtifactSet=artifactSetsByConfiguration.get(configurationIdentifier);
  if (configurationArtifactSet == null) {
    artifacts=doResolve(component,configurationIdentifier);
    configurationArtifactSet=new DefaultArtifactSet(component.getId(),component.getSource(),dependency.getSelector(),artifacts,artifactResolver,allResolvedArtifacts,id);
    if (!dependency.getSelector().mayExcludeArtifacts()) {
      artifactSetsByConfiguration.put(configurationIdentifier,configurationArtifactSet);
    }
  }
  return configurationArtifactSet;
}
