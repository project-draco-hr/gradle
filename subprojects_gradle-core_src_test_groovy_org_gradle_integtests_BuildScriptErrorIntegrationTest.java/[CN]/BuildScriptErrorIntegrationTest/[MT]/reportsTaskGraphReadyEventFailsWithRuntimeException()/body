{
  TestFile buildFile=testFile("build.gradle");
  buildFile.writelns("gradle.taskGraph.whenReady {","throw new RuntimeException('broken closure')","}","task a");
  ExecutionFailure failure=usingBuildFile(buildFile).withTasks("a").runWithFailure();
  failure.assertHasFileName(String.format("Build file '%s'",buildFile));
  failure.assertHasLineNumber(2);
  failure.assertHasDescription("Failed to notify task execution graph listener");
  failure.assertHasCause("broken closure");
}
