{
  if (!perThreadStacks.containsKey(currentThread())) {
    throw new IllegalStateException("operations stack not ready. Was push action invoked?");
  }
  return perThreadStacks.get(currentThread());
}
