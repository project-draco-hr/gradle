{
  Set<GradleParticipantBuild> participants=CollectionUtils.collect(participantBuilders,new Transformer<GradleParticipantBuild,DefaultGradleConnectionParticipantBuilder>(){
    @Override public GradleParticipantBuild transform(    DefaultGradleConnectionParticipantBuilder participantBuilder){
      return participantBuilder.build();
    }
  }
);
  DefaultCompositeConnectionParameters.Builder compositeConnectionParametersBuilder=DefaultCompositeConnectionParameters.builder();
  compositeConnectionParametersBuilder.setBuilds(participants);
  compositeConnectionParametersBuilder.setGradleUserHomeDir(gradleUserHomeDir);
  compositeConnectionParametersBuilder.setDaemonMaxIdleTimeValue(daemonMaxIdleTimeValue);
  compositeConnectionParametersBuilder.setDaemonMaxIdleTimeUnits(daemonMaxIdleTimeUnits);
  compositeConnectionParametersBuilder.setDaemonBaseDir(daemonBaseDir);
  if (integrated) {
    compositeConnectionParametersBuilder.setEmbedded(embedded);
    DefaultCompositeConnectionParameters connectionParameters=compositeConnectionParametersBuilder.build();
    SingleMessageLogger.incubatingFeatureUsed("Integrated composite build",WARNING_MESSAGE);
    Distribution distribution=coordinatorDistribution;
    if (distribution == null) {
      distribution=distributionFactory.getDistribution(GradleVersion.current().getVersion());
    }
    return gradleConnectionFactory.create(distribution,connectionParameters,true);
  }
 else {
    DefaultCompositeConnectionParameters connectionParameters=compositeConnectionParametersBuilder.build();
    return gradleConnectionFactory.create(distributionFactory.getClasspathDistribution(),connectionParameters,false);
  }
}
