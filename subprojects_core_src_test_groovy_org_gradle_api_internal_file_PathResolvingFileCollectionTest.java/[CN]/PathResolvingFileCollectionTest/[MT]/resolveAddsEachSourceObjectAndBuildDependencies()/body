{
  final FileCollectionResolveContext resolveContext=context.mock(FileCollectionResolveContext.class);
  final FileCollectionResolveContext nestedContext=context.mock(FileCollectionResolveContext.class);
  final FileCollection fileCollectionMock=context.mock(FileCollection.class);
  collection.from("file");
  collection.from(fileCollectionMock);
  context.checking(new Expectations(){
{
      one(resolveContext).push(resolverMock);
      will(returnValue(nestedContext));
      one(nestedContext).add(with(notNullValue(TaskDependency.class)));
      one(nestedContext).add(collection.getSources());
    }
  }
);
  collection.resolve(resolveContext);
}
