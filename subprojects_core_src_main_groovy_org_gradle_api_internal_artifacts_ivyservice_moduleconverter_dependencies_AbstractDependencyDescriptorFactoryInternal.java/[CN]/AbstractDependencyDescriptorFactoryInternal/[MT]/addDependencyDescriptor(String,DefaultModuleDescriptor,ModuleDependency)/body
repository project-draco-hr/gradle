{
  ModuleRevisionId moduleRevisionId=createModuleRevisionId(dependency);
  DependencyDescriptor newDescriptor=createDependencyDescriptor(dependency,configuration,moduleDescriptor,moduleRevisionId);
  DefaultDependencyDescriptor existingDependencyDescriptor=findExistingDescriptor(moduleDescriptor,newDescriptor);
  if (existingDependencyDescriptor == null) {
    moduleDescriptor.addDependency(newDescriptor);
  }
 else {
    existingDependencyDescriptor.addDependencyConfiguration(configuration,dependency.getConfiguration());
  }
}
