{
  GroovyForkOptions options=spec.getGroovyCompileOptions().getForkOptions();
  List<File> additionalJars=new ArrayList<File>();
  for (  File file : spec.getClasspath()) {
    if (file.getName().matches("junit(-.*)\\.jar")) {
      additionalJars.add(file);
    }
  }
  Collection<File> antFiles=project.getServices().get(ClassPathRegistry.class).getClassPath("ANT").getAsFiles();
  Iterable<File> groovyFiles=Iterables.concat(spec.getGroovyClasspath(),antFiles,additionalJars);
  List<String> groovyPackages=Arrays.asList("groovy","org.codehaus.groovy","groovyjarjarantlr","groovyjarjarasm","groovyjarjarcommonscli","org.apache.tools.ant","com.sun.tools.javac","junit","org.junit");
  return new DaemonForkOptions(options.getMemoryInitialSize(),options.getMemoryMaximumSize(),options.getJvmArgs(),groovyFiles,groovyPackages);
}
