{
  final Pair<Collection<DaemonInfo>,Collection<DaemonInfo>> idleBusy=partitionByIdleState(daemonRegistry.getAll());
  final Collection<DaemonInfo> idleDaemons=idleBusy.getLeft();
  final Collection<DaemonInfo> busyDaemons=idleBusy.getRight();
  final List<DaemonInfo> compatibleIdleDaemons=getCompatibleDaemons(idleDaemons,constraint);
  DaemonClientConnection connection=findConnection(compatibleIdleDaemons);
  if (connection != null) {
    return connection;
  }
  final List<DaemonStopEvent> stopEvents=daemonRegistry.getStopEvents();
  daemonRegistry.removeStopEvents(stopEvents);
  LOGGER.lifecycle(DaemonStartingMessage.generate(busyDaemons.size(),idleDaemons.size(),stopEvents));
  return startDaemon(constraint);
}
