{
  final Pair<Collection<DaemonInfo>,Collection<DaemonInfo>> idleBusy=partitionByIdleState(daemonRegistry.getAll());
  final Collection<DaemonInfo> idleDaemons=idleBusy.getLeft();
  final Collection<DaemonInfo> busyDaemons=idleBusy.getRight();
  final List<DaemonInfo> compatibleIdleDaemons=getCompatibleDaemons(idleDaemons,constraint);
  DaemonClientConnection connection=findConnection(compatibleIdleDaemons);
  if (connection != null) {
    return connection;
  }
  final List<DaemonStopEvent> stopEvents=daemonRegistry.getStopEvents();
  daemonRegistry.removeStopEvents(stopEvents);
  List<DaemonStopEvent> recentStopEvents=CollectionUtils.filter(stopEvents,new Spec<DaemonStopEvent>(){
    public boolean isSatisfiedBy(    DaemonStopEvent event){
      return event.occurredInLastHours(1);
    }
  }
);
  for (  DaemonStopEvent stopEvent : recentStopEvents) {
    LOGGER.info("Previous Daemon stopped at " + stopEvent.getTimestamp() + " "+ stopEvent.getReason());
  }
  LOGGER.lifecycle(DaemonStartupMessage.generate(busyDaemons.size(),idleDaemons.size(),recentStopEvents.size()));
  return startDaemon(constraint);
}
