{
  Set<TemporaryFolder> matches=new HashSet<TemporaryFolder>();
  for (Class<?> cl=target.getClass(); cl != Object.class; cl=cl.getSuperclass()) {
    for (    Field field : cl.getDeclaredFields()) {
      if (TemporaryFolder.class.isAssignableFrom(field.getType())) {
        field.setAccessible(true);
        try {
          matches.add((TemporaryFolder)field.get(target));
        }
 catch (        IllegalAccessException e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
  if (matches.isEmpty()) {
    throw new RuntimeException(String.format("No TemporaryFolder field found for test class %s.",target.getClass().getSimpleName()));
  }
  if (matches.size() > 1) {
    throw new RuntimeException(String.format("Multiple TemporaryFolder fields found for test class %s.",target.getClass().getSimpleName()));
  }
  return matches.iterator().next();
}
