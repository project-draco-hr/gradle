{
  FilterChain filterChain=spec.getFilterChain();
  if (filterChain.hasFilters()) {
    final Reader reader=new InputStreamReader(fileDetails.open());
    filterChain.findFirstFilterChain().setInputSource(reader);
    return new ReaderInputStream(filterChain){
      @Override public void close() throws IOException {
        reader.close();
      }
    }
;
  }
 else {
    return fileDetails.open();
  }
}
