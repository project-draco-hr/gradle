{
  if (!(publication instanceof IvyPublicationInternal)) {
    return;
  }
  final IvyPublicationInternal publicationInternal=(IvyPublicationInternal)publication;
  String publicationName=publication.getName();
  String descriptorTaskName=calculateDescriptorTaskName(publicationName);
  GenerateIvyDescriptor descriptorTask=tasks.add(descriptorTaskName,GenerateIvyDescriptor.class);
  ConventionMapping descriptorTaskConventionMapping=new DslObject(descriptorTask).getConventionMapping();
  descriptorTaskConventionMapping.map("destination",new Callable<Object>(){
    public Object call() throws Exception {
      return publicationInternal.getDescriptor().getFile();
    }
  }
);
  descriptorTaskConventionMapping.map("module",new Callable<Object>(){
    public Object call() throws Exception {
      return publicationInternal.getModule();
    }
  }
);
  descriptorTaskConventionMapping.map("configurations",new Callable<Object>(){
    public Object call() throws Exception {
      return publicationInternal.getConfigurations().iterator().next().getAll();
    }
  }
);
  descriptorTaskConventionMapping.map("xmlAction",new Callable<Object>(){
    public Object call() throws Exception {
      return publicationInternal.getDescriptor().getXmlAction();
    }
  }
);
  publicationInternal.getDescriptor().builtBy(descriptorTask);
}
