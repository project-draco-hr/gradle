{
  loggingConfigurer.configure(startParameter.getLogLevel());
  ImportsReader importsReader=new ImportsReader(startParameter.getDefaultImportsFile());
  CachePropertiesHandler cachePropertiesHandler=new DefaultCachePropertiesHandler();
  ISettingsFinder settingsFinder=new EmbeddedScriptSettingsFinder(new DefaultSettingsFinder(WrapUtil.<ISettingsFileSearchStrategy>toList(new MasterDirSettingsFinderStrategy(),new ParentDirSettingsFinderStrategy())));
  ConfigurationContainerFactory configurationContainerFactory=new DefaultConfigurationContainerFactory(startParameter.getProjectDependenciesBuildInstruction());
  DefaultInternalRepository internalRepository=new DefaultInternalRepository();
  DependencyFactory dependencyFactory=new DefaultDependencyFactory(WrapUtil.<IDependencyImplementationFactory>toSet(new ModuleDependencyFactory(),new SelfResolvingDependencyFactory()),new DefaultClientModuleFactory(),new DefaultProjectDependencyFactory());
  ResolverFactory resolverFactory=new DefaultResolverFactory();
  DefaultProjectEvaluator projectEvaluator=new DefaultProjectEvaluator(new BuildScriptCompiler(importsReader,new DefaultScriptProcessorFactory(new DefaultScriptCompilationHandler(cachePropertiesHandler),startParameter.getCacheUsage()),new DefaultProjectScriptMetaData()),new BuildScriptEvaluator());
  DefaultBuild build=new DefaultBuild(startParameter,internalRepository);
  build.addBuildListener(internalRepository);
  build.addBuildListener(projectEvaluator);
  ClassGenerator classGenerator=new DefaultClassGenerator();
  Gradle gradle=new Gradle(build,new SettingsHandler(settingsFinder,new PropertiesLoadingSettingsProcessor(new ScriptEvaluatingSettingsProcessor(new DefaultSettingsScriptMetaData(),new DefaultScriptProcessorFactory(new DefaultScriptCompilationHandler(cachePropertiesHandler),startParameter.getCacheUsage()),importsReader,new SettingsFactory(new DefaultProjectDescriptorRegistry()))),new BuildSourceBuilder(new DefaultGradleFactory(new LoggingConfigurer(){
    public void configure(    LogLevel logLevel){
    }
  }
,commandLine2StartParameterConverter),new DefaultCacheInvalidationStrategy())),new DefaultGradlePropertiesLoader(),new BuildLoader(new ProjectFactory(new DefaultProjectServiceRegistryFactory(new DefaultRepositoryHandlerFactory(resolverFactory,classGenerator),configurationContainerFactory,new DefaultPublishArtifactFactory(),dependencyFactory,projectEvaluator,classGenerator),startParameter.getBuildScriptSource())),new BuildConfigurer(new ProjectDependencies2TaskResolver()));
  return gradle;
}
