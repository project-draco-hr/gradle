{
  final Transformer transformer=context.mock(Transformer.class);
  context.checking(new Expectations(){
{
      allowing(transformer).getId();
      will(returnValue("transformer"));
      one(cacheRepositoryMock).cache("scripts/class-name/Script/transformer");
      will(returnValue(cacheBuilder));
      one(cacheBuilder).withProperties(expectedCacheProperties);
      will(returnValue(cacheBuilder));
      one(cacheBuilder).withInitializer(with(notNullValue(Action.class)));
      will(returnValue(cacheBuilder));
      one(cacheBuilder).open();
      will(returnValue(cacheMock));
      one(scriptCompilationHandlerMock).loadFromDir(expectedSource,testClassLoader,expectedScriptCacheDir,expectedScriptBaseClass);
      will(returnValue(TestScript.class));
      one(scriptRunnerFactoryMock).create(with(notNullValue(TestScript.class)));
      will(returnValue(expectedScriptRunner));
    }
  }
);
  assertSame(expectedScriptRunner,scriptProcessor.createCompiler(source).setTransformer(transformer).compile(expectedScriptBaseClass));
}
