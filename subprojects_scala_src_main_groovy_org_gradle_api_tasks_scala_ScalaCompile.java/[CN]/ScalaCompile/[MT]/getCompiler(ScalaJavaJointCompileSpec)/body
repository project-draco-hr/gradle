{
  assertScalaClasspathIsNonEmpty();
  if (compiler == null) {
    ProjectInternal projectInternal=(ProjectInternal)getProject();
    IsolatedAntBuilder antBuilder=getServices().get(IsolatedAntBuilder.class);
    CompilerDaemonFactory compilerDaemonFactory=getServices().get(CompilerDaemonManager.class);
    JavaCompilerFactory javaCompilerFactory=getServices().get(JavaCompilerFactory.class);
    ScalaCompilerFactory scalaCompilerFactory=new ScalaCompilerFactory(projectInternal.getRootProject().getProjectDir(),antBuilder,javaCompilerFactory,compilerDaemonFactory,getScalaClasspath(),getZincClasspath());
    org.gradle.language.base.internal.compile.Compiler<ScalaJavaJointCompileSpec> delegatingCompiler=scalaCompilerFactory.newCompiler(spec);
    compiler=new CleaningScalaCompiler(delegatingCompiler,getOutputs());
  }
  return compiler;
}
