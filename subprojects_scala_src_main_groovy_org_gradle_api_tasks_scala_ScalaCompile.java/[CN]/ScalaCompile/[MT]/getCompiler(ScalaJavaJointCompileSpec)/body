{
  assertScalaClasspathIsNonEmpty();
  if (compiler == null) {
    ProjectInternal projectInternal=(ProjectInternal)getProject();
    IsolatedAntBuilder antBuilder=getServices().get(IsolatedAntBuilder.class);
    CompilerDaemonFactory compilerDaemonFactory=getServices().get(CompilerDaemonManager.class);
    JavaCompilerFactory javaCompilerFactory=getServices().get(JavaCompilerFactory.class);
    ScalaCompilerFactory scalaCompilerFactory=new ScalaCompilerFactory(projectInternal.getRootProject().getProjectDir(),antBuilder,javaCompilerFactory,compilerDaemonFactory,getScalaClasspath(),getZincClasspath(),getProject().getGradle().getGradleUserHomeDir());
    compiler=scalaCompilerFactory.newCompiler(spec);
    if (((ScalaCompileOptionsInternal)getScalaCompileOptions()).internalIsUseAnt()) {
      compiler=new CleaningScalaCompiler(compiler,getOutputs());
    }
  }
  return compiler;
}
