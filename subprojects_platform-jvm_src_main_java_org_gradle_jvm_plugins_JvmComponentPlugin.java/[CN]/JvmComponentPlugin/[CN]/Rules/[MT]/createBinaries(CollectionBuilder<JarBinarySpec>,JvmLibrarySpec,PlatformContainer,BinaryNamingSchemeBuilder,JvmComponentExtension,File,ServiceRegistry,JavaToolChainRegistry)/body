{
  List<Action<? super JarBinarySpec>> actions=Lists.newArrayList();
  actions.add(new JarBinarySpecInitializer(buildDir));
  actions.add(new MarkBinariesBuildable());
  final Action<JarBinarySpec> initAction=Actions.composite(actions);
  List<String> targetPlatforms=jvmLibrary.getTargetPlatforms();
  if (targetPlatforms.isEmpty()) {
    targetPlatforms=Collections.singletonList(new DefaultJavaPlatform(JavaVersion.current()).getName());
  }
  List<JavaPlatform> selectedPlatforms=platforms.chooseFromTargets(JavaPlatform.class,targetPlatforms);
  for (  final JavaPlatform platform : selectedPlatforms) {
    final JavaToolChain toolChain=toolChains.getForPlatform(platform);
    final String binaryName=createBinaryName(jvmLibrary,namingSchemeBuilder,selectedPlatforms,platform);
    binaries.create(binaryName,new Action<JarBinarySpec>(){
      public void execute(      JarBinarySpec jarBinary){
        ((JarBinarySpecInternal)jarBinary).setBaseName(jvmLibrary.getName());
        FunctionalSourceSet binarySourceSet=((ComponentSpecInternal)jvmLibrary).getSources().copy(binaryName);
        ((JarBinarySpecInternal)jarBinary).setBinarySources(binarySourceSet);
        jarBinary.setToolChain(toolChain);
        jarBinary.setTargetPlatform(platform);
        initAction.execute(jarBinary);
        jvmComponentExtension.getAllBinariesAction().execute(jarBinary);
      }
    }
);
  }
}
