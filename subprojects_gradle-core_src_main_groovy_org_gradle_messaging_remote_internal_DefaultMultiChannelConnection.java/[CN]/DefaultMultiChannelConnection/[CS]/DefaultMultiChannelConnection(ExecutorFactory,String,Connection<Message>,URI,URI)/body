{
  this.connection=connection;
  this.executor=executorFactory.create(displayName);
  this.sourceAddress=sourceAddress;
  this.destinationAddress=destinationAddress;
  outgoingQueue=new AsyncDispatch<Message>(executor);
  outgoingQueue.dispatchTo(wrapFailures(connection));
  outgoingDispatch=new EndOfStreamDispatch(new ChannelMessageMarshallingDispatch(outgoingQueue));
  incomingDemux=new IncomingDemultiplex();
  incomingDispatch=new EndOfStreamFilter(incomingDemux,new Runnable(){
    public void run(){
      requestStop();
    }
  }
);
  incomingReceive=new AsyncReceive<Message>(executor,wrapFailures(new ChannelMessageUnmarshallingDispatch(incomingDispatch)));
  incomingReceive.receiveFrom(new EndOfStreamReceive(connection));
}
