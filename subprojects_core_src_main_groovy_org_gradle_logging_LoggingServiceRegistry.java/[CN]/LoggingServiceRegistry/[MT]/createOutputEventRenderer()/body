{
  ConsoleDetector consoleDetector;
  ConsoleMetaData consoleMetaData;
  if (type == Type.CommandLine) {
    StartParameter startParameter=new StartParameter();
    NativeServices.initialize(startParameter.getGradleUserHomeDir());
    consoleDetector=NativeServices.getInstance().get(ConsoleDetector.class);
    consoleMetaData=NativeServices.getInstance().get(ConsoleMetaData.class);
  }
 else {
    consoleDetector=new NoOpConsoleDetector();
    consoleMetaData=new FallbackConsoleMetaData();
  }
  OutputEventRenderer renderer=new OutputEventRenderer(consoleDetector,consoleMetaData);
  renderer.addStandardOutputAndError();
  return renderer;
}
