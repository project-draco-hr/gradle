{
  LOGGER.debug("Connecting from tooling API consumer version {}",GradleVersion.current().getVersion());
  if (projectDir == null) {
    throw new IllegalStateException("A project directory must be specified before creating a connection.");
  }
  if (distribution == null) {
    distribution=distributionFactory.getCurrentDistribution();
  }
  return connectionFactory.create(distribution,new DefaultConnectionParametersVersion1(projectDir,gradleUserHomeDir,searchUpwards));
}
