{
  State state=new State();
  List<ProjectInternal> orderedProjects=Ordering.usingToString().sortedCopy(projectRegistry.getAllProjects());
  for (  ProjectInternal project : orderedProjects) {
    if (project.getPlugins().hasPlugin(ComponentModelBasePlugin.class)) {
      ModelRegistry modelRegistry=projectModelResolver.resolveProjectModel(project.getPath());
      ModelMap<NativeComponentSpec> components=modelRegistry.realize("components",ModelTypes.modelMap(NativeComponentSpec.class));
      for (      NativeBinarySpecInternal binary : allBinariesOf(components.withType(VariantComponentSpec.class))) {
        state.binaries.put(stateKeyOf(binary),binary);
      }
    }
    for (    NativeBinarySpecInternal extraBinary : getExtraBinaries(project,projectModelResolver)) {
      state.binaries.put(stateKeyOf(extraBinary),extraBinary);
    }
  }
  for (  Map.Entry<String,NativeBinarySpecInternal> entry : state.binaries.entrySet()) {
    String key=entry.getKey();
    NativeBinarySpecInternal nativeBinary=entry.getValue();
    if (state.dependencies.get(key) == null) {
      state.dependencies.put(key,Lists.<NativeBinarySpecInternal>newArrayList());
    }
    for (    NativeLibraryBinary libraryBinary : nativeBinary.getDependentBinaries()) {
      if (libraryBinary instanceof NativeBinarySpecInternal) {
        state.dependencies.get(key).add((NativeBinarySpecInternal)libraryBinary);
      }
    }
    state.dependencies.get(key).addAll(getExtraDependents(nativeBinary));
  }
  return state;
}
