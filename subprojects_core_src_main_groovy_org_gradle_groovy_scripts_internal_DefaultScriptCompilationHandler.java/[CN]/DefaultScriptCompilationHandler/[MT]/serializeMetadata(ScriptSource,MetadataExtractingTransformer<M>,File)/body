{
  if (extractingTransformer == null || extractingTransformer.getMetadataSerializer() == null) {
    return;
  }
  GFileUtils.mkdirs(metadataDir);
  File metadataFile=new File(metadataDir,METADATA_FILE_NAME);
  FileOutputStream outputStream;
  try {
    outputStream=new FileOutputStream(metadataFile);
  }
 catch (  FileNotFoundException e) {
    throw new UncheckedIOException("Could not create or open build script metadata file " + metadataFile.getAbsolutePath(),e);
  }
  KryoBackedEncoder encoder=new KryoBackedEncoder(outputStream);
  Serializer<M> serializer=extractingTransformer.getMetadataSerializer();
  try {
    serializer.write(encoder,extractingTransformer.getExtractedMetadata());
  }
 catch (  Exception e) {
    String transformerName=extractingTransformer.getTransformer().getClass().getName();
    throw new IllegalStateException(String.format("Failed to serialize script metadata extracted using %s for %s",transformerName,scriptSource.getDisplayName()),e);
  }
 finally {
    encoder.close();
  }
}
