{
  Set<String> resolveDimensions=variantsMetaData.getNonNullDimensions();
  if (resolveDimensions.size() == 1) {
    List<String> availablePlatforms=Lists.transform(Lists.newArrayList(allBinaries),new Function<BinarySpec,String>(){
      @Override public String apply(      BinarySpec input){
        return input instanceof JvmBinarySpec ? ((JvmBinarySpec)input).getTargetPlatform().toString() : input.toString();
      }
    }
);
    return String.format("Cannot find a compatible binary for library '%s' (%s). Available platforms: %s",libraryName,javaPlatform,availablePlatforms);
  }
 else {
    final boolean moreThanOneBinary=allBinaries.size() > 1;
    Set<String> availablePlatforms=new TreeSet<String>(Lists.transform(Lists.newArrayList(allBinaries),new Function<BinarySpec,String>(){
      @Override public String apply(      BinarySpec input){
        if (input instanceof JvmBinarySpec) {
          JavaPlatform targetPlatform=((JvmBinarySpec)input).getTargetPlatform();
          if (moreThanOneBinary) {
            return String.format("'%s' on %s",targetPlatform.getName(),input.getDisplayName());
          }
          return String.format("'%s'",targetPlatform.getName(),input.getDisplayName());
        }
        return null;
      }
    }
));
    StringBuilder error=new StringBuilder(String.format("Cannot find a compatible binary for library '%s' (%s).\n",libraryName,javaPlatform));
    Joiner joiner=Joiner.on(",").skipNulls();
    error.append("    Required platform '").append(javaPlatform.getName()).append("', ");
    error.append("available: ").append(joiner.join(availablePlatforms));
    error.append("\n");
    HashMultimap<String,String> variants=HashMultimap.create();
    for (    BinarySpec spec : allBinaries) {
      VariantsMetaData md=DefaultVariantsMetaData.extractFrom(spec);
      for (      String dimension : resolveDimensions) {
        String value=md.getValueAsString(dimension);
        if (value != null) {
          if (moreThanOneBinary) {
            variants.put(dimension,String.format("'%s' on %s",value,spec.getDisplayName()));
          }
 else {
            variants.put(dimension,String.format("'%s'",value,spec.getDisplayName()));
          }
        }
      }
    }
    for (    String dimension : resolveDimensions) {
      if (!isPlatformDimension(dimension)) {
        error.append("    Required ").append(dimension).append(" '").append(variantsMetaData.getValueAsString(dimension)).append("'");
        Set<String> available=new TreeSet<String>(variants.get(dimension));
        if (!available.isEmpty()) {
          error.append(", available: ").append(joiner.join(available)).append("\n");
        }
 else {
          error.append(" but no compatible binary was found\n");
        }
      }
    }
    return error.toString();
  }
}
