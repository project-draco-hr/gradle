{
  if (dependency.getSelector() instanceof LibraryComponentSelector) {
    LibraryComponentSelector selector=(LibraryComponentSelector)dependency.getSelector();
    final String selectorProjectPath=selector.getProjectPath();
    final String libraryName=selector.getLibraryName();
    LibraryResolutionResult resolutionResult=doResolve(selectorProjectPath,libraryName);
    LibrarySpec selectedLibrary=resolutionResult.getSelectedLibrary();
    if (selectedLibrary != null) {
      DefaultTaskDependency buildDependencies=new DefaultTaskDependency();
      Collection<BinarySpec> allVariants=selectedLibrary.getBinaries().values();
      Collection<? extends BinarySpec> variants=filterBinaries(allVariants);
      if (!allVariants.isEmpty() && variants.isEmpty()) {
        result.failed(new ModuleVersionResolveException(selector,noCompatiblePlatformErrorMessage(libraryName,javaPlatform,allVariants)));
      }
 else       if (variants.size() > 1) {
        result.failed(new ModuleVersionResolveException(selector,multipleBinariesForSameVariantErrorMessage(libraryName,javaPlatform,variants)));
      }
 else {
        for (        BinarySpec spec : variants) {
          buildDependencies.add(spec);
          DefaultLibraryLocalComponentMetaData metaData=DefaultLibraryLocalComponentMetaData.newMetaData(selectorProjectPath,selectedLibrary.getName(),spec.getName(),buildDependencies);
          ComponentResolveMetaData resolveMetaData=metaData.toResolveMetaData();
          result.resolved(resolveMetaData);
          if (spec instanceof JvmBinarySpec) {
            Jar jar=((JvmBinarySpec)spec).getTasks().getJar();
            PublishArtifact publishArtifact=new ArchivePublishArtifact(jar);
            metaData.addArtifacts(DefaultLibraryBinaryIdentifier.CONFIGURATION_NAME,Collections.singleton(publishArtifact));
          }
        }
      }
    }
    if (!result.hasResult()) {
      String message=prettyResolutionErrorMessage(selector,resolutionResult);
      ModuleVersionResolveException failure=new ModuleVersionResolveException(selector,new LibraryResolveException(message));
      result.failed(failure);
    }
  }
}
