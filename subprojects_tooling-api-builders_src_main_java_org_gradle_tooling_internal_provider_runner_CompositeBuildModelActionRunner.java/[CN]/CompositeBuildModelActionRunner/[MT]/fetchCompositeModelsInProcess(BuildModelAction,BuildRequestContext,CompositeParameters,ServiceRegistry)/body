{
  try {
    registerParticipantsInContext(compositeParameters,buildRequestContext,sharedServices);
  }
 catch (  Exception e) {
    LOGGER.debug("Ignoring exception thrown when constructing composite context: " + e.getMessage(),e);
  }
  BuildActionRunner runner=new SubscribableBuildActionRunner(new BuildModelsActionRunner());
  BuildActionExecuter<BuildActionParameters> buildActionExecuter=new InProcessBuildActionExecuter(sharedServices.get(GradleLauncherFactory.class),runner);
  final List<Object> results=Lists.newArrayList();
  for (  IncludedBuild build : compositeParameters.getBuilds()) {
    DefaultBuildActionParameters actionParameters=new DefaultBuildActionParameters(Collections.EMPTY_MAP,Collections.<String,String>emptyMap(),build.getProjectDir(),LogLevel.INFO,false,false,true,ClassPath.EMPTY);
    StartParameter startParameter=modelAction.getStartParameter().newInstance();
    startParameter.setProjectDir(build.getProjectDir());
    BuildModelAction participantAction=new BuildModelAction(startParameter,modelAction.getModelName(),false,modelAction.getClientSubscriptions());
    try {
      Map<String,Object> result=Cast.uncheckedCast(buildActionExecuter.execute(participantAction,buildRequestContext,actionParameters,sharedServices));
      for (      Map.Entry<String,Object> e : result.entrySet()) {
        String projectPath=e.getKey();
        Object modelValue=e.getValue();
        results.add(compositeModelResult(build,projectPath,modelValue));
      }
    }
 catch (    BuildCancelledException e) {
      InternalBuildCancelledException buildCancelledException=new InternalBuildCancelledException(e.getCause());
      results.add(compositeModelResult(build,null,buildCancelledException));
    }
catch (    ReportedException e) {
      results.add(compositeModelResult(build,null,unwrap(e)));
    }
catch (    Exception e) {
      results.add(compositeModelResult(build,null,e));
    }
  }
  return results;
}
