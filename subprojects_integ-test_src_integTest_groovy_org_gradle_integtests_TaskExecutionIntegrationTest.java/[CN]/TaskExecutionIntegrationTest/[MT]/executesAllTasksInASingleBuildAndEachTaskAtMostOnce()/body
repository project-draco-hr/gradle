{
  TestFile buildFile=testFile("build.gradle");
  buildFile.writelns("gradle.taskGraph.whenReady { assert !project.hasProperty('graphReady'); ext.graphReady = true }","task a << { task -> project.ext.executedA = task }","task b << { ","    assert a == project.executedA","    assert gradle.taskGraph.hasTask(':a')","}","task c(dependsOn: a)","task d(dependsOn: a)","task e(dependsOn: [a, d])");
  usingBuildFile(buildFile).withTasks("a","b").run().assertTasksExecuted(":a",":b");
  usingBuildFile(buildFile).withTasks("a","a").run().assertTasksExecuted(":a");
  usingBuildFile(buildFile).withTasks("c","a").run().assertTasksExecuted(":a",":c");
  usingBuildFile(buildFile).withTasks("c","e").run().assertTasksExecuted(":a",":c",":d",":e");
}
