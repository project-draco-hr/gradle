{
  InstanceFactory.TypeRegistrationBuilder<S> registration=components.register(publicType,descriptor);
  if (implementationType != null) {
    ServiceRegistry serviceRegistry=ModelViews.assertType(inputs.get(0),ModelType.of(ServiceRegistry.class)).getInstance();
    final Instantiator instantiator=serviceRegistry.get(Instantiator.class);
    final ProjectIdentifier projectIdentifier=ModelViews.assertType(inputs.get(1),ModelType.of(ProjectIdentifier.class)).getInstance();
    registration.withImplementation(Cast.<ModelType<? extends S>>uncheckedCast(implementationType),new InstanceFactory.ImplementationFactory<S>(){
      @Override public S create(      ModelType<? extends S> publicType,      String name,      MutableModelNode componentNode){
        ComponentSpecIdentifier id=new DefaultComponentSpecIdentifier(projectIdentifier.getPath(),name);
        return Cast.uncheckedCast(BaseComponentSpec.create(publicType.getConcreteClass(),implementationType.getConcreteClass(),id,componentNode,instantiator));
      }
    }
);
  }
  for (  Class<?> internalView : internalViews) {
    registration.withInternalView(ModelType.of(internalView));
  }
}
