{
  DefaultExecutorFactory executorFactory=new DefaultExecutorFactory();
  TcpIncomingConnector<Object> incomingConnector=new TcpIncomingConnector<Object>(executorFactory,new DefaultMessageSerializer<Object>(getClass().getClassLoader()),new InetAddressFactory(),new UUIDGenerator());
  final CompletionHandler finished=new CompletionHandler(idleTimeout);
  LOGGER.lifecycle("Awaiting requests.");
  Action<ConnectEvent<Connection<Object>>> connectEvent=new Action<ConnectEvent<Connection<Object>>>(){
    public void execute(    ConnectEvent<Connection<Object>> connectionConnectEvent){
      handler.handle(connectionConnectEvent.getConnection(),finished);
    }
  }
;
  final Address address=incomingConnector.accept(connectEvent,false);
  finished.setActivityListener(new CompletionHandler.ActivityListener(){
    public void onStart(){
      daemonRegistry.markBusy(address);
    }
    public void onComplete(){
      daemonRegistry.markIdle(address);
    }
  }
);
  daemonRegistry.store(address);
  boolean stopped=finished.awaitStop();
  if (!stopped) {
    LOGGER.lifecycle("Time-out waiting for requests. Stopping.");
  }
  daemonRegistry.remove(address);
  new CompositeStoppable(incomingConnector,executorFactory).stop();
}
