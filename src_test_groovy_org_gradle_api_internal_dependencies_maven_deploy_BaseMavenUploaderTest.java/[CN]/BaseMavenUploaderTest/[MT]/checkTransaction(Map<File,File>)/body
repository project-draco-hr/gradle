{
  context.checking(new Expectations(){
{
      allowing(deployTaskFactoryMock).createDeployTask();
      will(returnValue(deployTaskMock));
      allowing(deployTaskMock).getContainer();
      will(returnValue(plexusContainerMock));
      for (      File protocolProviderJar : TEST_PROTOCOL_PROVIDER_JARS) {
        one(plexusContainerMock).addJarResource(protocolProviderJar);
      }
      one(deployTaskMock).setProject(with(any(Project.class)));
      one(deployTaskMock).addRemoteRepository(testRepository);
      one(deployTaskMock).addRemoteSnapshotRepository(testSnapshotRepository);
      for (      File pomFile : deployableUnits.keySet()) {
        one(deployTaskMock).setFile(deployableUnits.get(pomFile));
        one(deployTaskMock).addPom(with(pomMatcher(pomFile)));
        one(deployTaskMock).execute();
      }
    }
  }
);
  mavenUploader.commitPublishTransaction();
}
