{
  ArtifactBuilder builder=artifactBuilder();
  builder.sourceFile("org/gradle/test/BuildClass.java").writelns("package org.gradle.test;","public class BuildClass { }");
  builder.buildJar(testFile("repo/test-1.3.jar"));
  testFile("settings.gradle").writelns("include 'child'");
  testFile("build.gradle").writelns("assert gradle.scriptClassLoader == buildscript.classLoader.parent","buildscript {","    repositories { flatDir(dirs: file('repo')) }","    dependencies { classpath name: 'test', version: '1.3' }","}");
  testFile("child/build.gradle").writelns("assert parent.buildscript.classLoader == buildscript.classLoader.parent","task hello << ","{","    new org.gradle.test.BuildClass()","}");
  inTestDirectory().withTasks("hello").run();
}
