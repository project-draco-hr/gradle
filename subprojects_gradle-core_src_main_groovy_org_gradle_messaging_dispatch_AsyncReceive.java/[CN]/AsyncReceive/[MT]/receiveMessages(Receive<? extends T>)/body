{
  while (true) {
    T message=receive.receive();
    if (message == null) {
      return;
    }
    dispatch.dispatch(message);
    lock.lock();
    try {
      if (state != State.Init) {
        return;
      }
    }
  finally {
      lock.unlock();
    }
  }
}
