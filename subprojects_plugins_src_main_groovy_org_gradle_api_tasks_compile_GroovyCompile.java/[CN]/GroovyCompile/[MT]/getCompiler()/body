{
  if (compiler == null) {
    ProjectInternal projectInternal=(ProjectInternal)getProject();
    CompilerDaemonFactory compilerDaemonManager=getServices().get(CompilerDaemonManager.class);
    InProcessCompilerDaemonFactory inProcessCompilerDaemonFactory=getServices().get(InProcessCompilerDaemonFactory.class);
    DefaultJavaCompilerFactory javaCompilerFactory=new DefaultJavaCompilerFactory(projectInternal.getRootProject().getProjectDir(),compilerDaemonManager);
    GroovyCompilerFactory groovyCompilerFactory=new GroovyCompilerFactory(projectInternal,javaCompilerFactory,compilerDaemonManager,inProcessCompilerDaemonFactory);
    Compiler<GroovyJavaJointCompileSpec> delegatingCompiler=new DelegatingGroovyCompiler(groovyCompilerFactory);
    compiler=new CleaningGroovyCompiler(delegatingCompiler,getOutputs());
  }
  return compiler;
}
