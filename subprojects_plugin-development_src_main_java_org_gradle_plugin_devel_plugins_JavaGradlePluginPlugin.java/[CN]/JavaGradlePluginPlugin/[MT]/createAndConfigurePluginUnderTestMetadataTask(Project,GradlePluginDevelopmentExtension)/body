{
  final PluginUnderTestMetadata pluginUnderTestMetadataTask=project.getTasks().create(PLUGIN_UNDER_TEST_METADATA_TASK_NAME,PluginUnderTestMetadata.class);
  ConventionMapping conventionMapping=new DslObject(pluginUnderTestMetadataTask).getConventionMapping();
  conventionMapping.map("pluginClasspath",new Callable<Object>(){
    public Object call() throws Exception {
      FileCollection gradleApi=project.files(classPathRegistry.getClassPath(GRADLE_API.name()).getAsFiles());
      return extension.getPluginSourceSet().getRuntimeClasspath().minus(gradleApi);
    }
  }
);
  conventionMapping.map("outputDirectory",new Callable<Object>(){
    public Object call() throws Exception {
      return new File(project.getBuildDir(),pluginUnderTestMetadataTask.getName());
    }
  }
);
  return pluginUnderTestMetadataTask;
}
