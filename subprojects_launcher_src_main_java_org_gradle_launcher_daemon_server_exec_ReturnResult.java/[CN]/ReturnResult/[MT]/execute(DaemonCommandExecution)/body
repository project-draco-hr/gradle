{
  execution.proceed();
  Result result;
  Throwable commandException=execution.getException();
  if (commandException != null) {
    result=new CommandFailure(commandException);
  }
 else {
    if (execution.getDaemonStateControl().getCancellationToken().isCancellationRequested()) {
      result=new CommandFailure(new BuildCancelledException("Build was cancelled"));
    }
 else {
      result=new Success(execution.getResult());
    }
  }
  LOGGER.debug("Daemon is dispatching the build result: {}",result);
  execution.getConnection().completed(result);
}
