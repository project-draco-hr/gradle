{
  try {
    String resourceName="META-INF/services/" + ConnectionFactoryVersion3.class.getName();
    InputStream inputStream=classLoader.getResourceAsStream(resourceName);
    if (inputStream == null) {
      Matcher m=Pattern.compile("\\w+Version(\\d+)").matcher(ConnectionFactoryVersion3.class.getSimpleName());
      m.matches();
      String protocolVersion=m.group(1);
      throw new UnsupportedVersionException(String.format("The specified %s is not supported by this tooling API version (%s, protocol version %s)",distribution.getDisplayName(),GradleVersion.current().getVersion(),protocolVersion));
    }
    try {
      BufferedReader reader=new BufferedReader(new InputStreamReader(inputStream));
      String line;
      while ((line=reader.readLine()) != null) {
        line=line.replaceAll("#.*","").trim();
        if (line.length() > 0) {
          return line;
        }
      }
    }
  finally {
      inputStream.close();
    }
    throw new UnsupportedOperationException(String.format("No implementation class specified in resource '%s'.",resourceName));
  }
 catch (  UnsupportedVersionException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new GradleConnectionException(String.format("Could not determine class name of Tooling API implementation."),t);
  }
}
