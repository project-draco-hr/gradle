{
  ProxySelectorRoutePlanner routePlanner=new ProxySelectorRoutePlanner(httpClient.getConnectionManager().getSchemeRegistry(),ProxySelector.getDefault());
  httpClient.setRoutePlanner(routePlanner);
  HttpProxySettings.HttpProxy proxy=proxySettings.getProxy();
  if (proxy != null && proxy.credentials != null) {
    useCredentials(httpClient,proxy.credentials,proxy.host,proxy.port);
  }
}
