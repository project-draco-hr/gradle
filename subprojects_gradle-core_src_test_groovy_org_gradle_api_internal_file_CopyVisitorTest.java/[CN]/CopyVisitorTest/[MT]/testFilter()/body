{
  FilterChain filters=new FilterChain();
  ReplaceTokens filter=new ReplaceTokens(filters.getLastFilter());
  filters.addFilter(filter);
  ReplaceTokens.Token token=new ReplaceTokens.Token();
  token.setKey("MAGIC");
  token.setValue("42");
  filter.addConfiguredToken(token);
  visitor=new CopyVisitor(testDir,null,null,filters);
  FileVisitDetails sourceFile=file(getResource("testfiles/rootfile.txt"),new RelativePath(true,"rootfile.txt"));
  File destFile=new File(testDir,"rootfile.txt");
  visitor.copyFile(sourceFile,destFile);
  assertTrue(destFile.exists());
  BufferedReader reader=new BufferedReader(new FileReader(destFile));
  assertTrue(reader.readLine().startsWith("The magic number is 42"));
}
