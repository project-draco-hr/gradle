{
  UnionFileCollection unionFileCollection=new UnionFileCollection();
  Collection<DirectoryFileTree> fileTrees=getAsFileTrees();
  List<File> singleFiles=new ArrayList<File>();
  for (  DirectoryFileTree tree : fileTrees) {
    if (tree instanceof FileBackedDirectoryFileTree) {
      singleFiles.add(((FileBackedDirectoryFileTree)tree).getFile());
    }
 else {
      unionFileCollection.add(new FileTreeAdapter(tree));
    }
  }
  if (!singleFiles.isEmpty()) {
    unionFileCollection.add(new SimpleFileCollection(singleFiles));
  }
  return unionFileCollection;
}
