{
  final ScriptClassLoaderProvider buildClassLoaderProviderMock=context.mock(ScriptClassLoaderProvider.class);
  final ScriptCompiler scriptCompilerMock=context.mock(ScriptCompiler.class);
  final ScriptSource initScriptMock=context.mock(ScriptSource.class);
  final Object target=new Object();
  final URLClassLoader classLoader=new URLClassLoader(new URL[0]);
  final ScriptRunner classPathScriptRunnerMock=context.mock(ScriptRunner.class,"classpathScriptRunner");
  final ScriptRunner scriptRunnerMock=context.mock(ScriptRunner.class,"scriptRunner");
  final Script scriptMock=context.mock(Script.class);
  final Action<Script> initAction=context.mock(Action.class);
  context.checking(new Expectations(){
{
      Sequence sequence=context.sequence("seq");
      one(scriptCompilerFactoryMock).createCompiler(with(reflectionEquals(new ImportsScriptSource(initScriptMock,importsReaderMock,null))));
      will(returnValue(scriptCompilerMock));
      allowing(buildClassLoaderProviderMock).getClassLoader();
      will(returnValue(classLoader));
      one(scriptCompilerMock).setClassloader(classLoader);
      inSequence(sequence);
      one(scriptCompilerMock).setTransformer(with(any(ClasspathScriptTransformer.class)));
      inSequence(sequence);
      one(scriptCompilerMock).compile(Script.class);
      will(returnValue(classPathScriptRunnerMock));
      one(classPathScriptRunnerMock).setDelegate(target);
      inSequence(sequence);
      one(classPathScriptRunnerMock).run();
      inSequence(sequence);
      one(buildClassLoaderProviderMock).updateClassPath();
      inSequence(sequence);
      one(scriptCompilerMock).setTransformer(with(notNullValue(Transformer.class)));
      inSequence(sequence);
      one(scriptCompilerMock).compile(Script.class);
      will(returnValue(scriptRunnerMock));
      inSequence(sequence);
      one(scriptRunnerMock).setDelegate(target);
      inSequence(sequence);
      allowing(scriptRunnerMock).getScript();
      will(returnValue(scriptMock));
      one(initAction).execute(scriptMock);
      inSequence(sequence);
      one(scriptRunnerMock).run();
      inSequence(sequence);
    }
  }
);
  ScriptObjectConfigurer configurer=factory.create(initScriptMock);
  configurer.setClassLoaderProvider(buildClassLoaderProviderMock);
  configurer.setInitAction(initAction);
  configurer.apply(target);
}
