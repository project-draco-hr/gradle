{
  if (targetType instanceof ParameterizedType) {
    ParameterizedType parameterizedTargetType=(ParameterizedType)targetType;
    if (parameterizedTargetType.getRawType().equals(DomainObjectSet.class)) {
      Type targetElementType=getElementType(parameterizedTargetType);
      List<Object> convertedElements=new ArrayList<Object>();
      for (      Object element : (Iterable)value) {
        convertedElements.add(convert(element,targetElementType));
      }
      return new ImmutableDomainObjectSet(convertedElements);
    }
  }
  if (targetType instanceof Class) {
    if (((Class)targetType).isPrimitive()) {
      return value;
    }
    return adapt((Class)targetType,value);
  }
  throw new UnsupportedOperationException(String.format("Cannot convert object of %s to %s.",value.getClass(),targetType));
}
