{
  this.testTask=testTask;
  this.filter=filter;
  options=instantiator.newInstance(TestNGOptions.class,testTask.getProject().getProjectDir());
  options.setAnnotationsOnSourceCompatibility(JavaVersion.toVersion(testTask.getProject().property("sourceCompatibility")));
  conventionMapOutputDirectory(options,testTask.getReports().getHtml());
  detector=new TestNGDetector(new ClassFileExtractionManager(testTask.getTemporaryDirFactory()));
  classLoaderFactory=new TestClassLoaderFactory(classLoaderCache,testTask);
}
