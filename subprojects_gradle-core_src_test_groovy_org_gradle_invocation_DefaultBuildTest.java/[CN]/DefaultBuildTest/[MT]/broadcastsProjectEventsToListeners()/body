{
  final ProjectEvaluationListener listener=context.mock(ProjectEvaluationListener.class);
  final Project project=context.mock(Project.class);
  final RuntimeException failure=new RuntimeException();
  context.checking(new Expectations(){
{
      one(listener).beforeEvaluate(project);
      one(listener).afterEvaluate(project,failure);
    }
  }
);
  build.addProjectEvaluationListener(listener);
  build.getProjectEvaluationBroadcaster().beforeEvaluate(project);
  build.getProjectEvaluationBroadcaster().afterEvaluate(project,failure);
}
