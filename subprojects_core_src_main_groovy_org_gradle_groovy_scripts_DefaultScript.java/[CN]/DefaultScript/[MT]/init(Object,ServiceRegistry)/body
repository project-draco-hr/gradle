{
  super.init(target,services);
  this.services=services;
  loggingManager=services.get(LoggingManager.class);
  Instantiator instantiator=services.get(Instantiator.class);
  if (target instanceof FileOperations) {
    fileOperations=(FileOperations)target;
  }
 else   if (getScriptSource().getResource().getFile() != null) {
    fileOperations=new DefaultFileOperations(new BaseDirFileResolver(FileSystems.getDefault(),getScriptSource().getResource().getFile().getParentFile()),null,null,instantiator);
  }
 else {
    fileOperations=new DefaultFileOperations(new IdentityFileResolver(),null,null,instantiator);
  }
  processOperations=(ProcessOperations)fileOperations;
  if (target instanceof PluginAware) {
    pluginHandler=new DefaultPluginHandler((PluginAware)target);
  }
 else {
    throw new IllegalStateException("script target " + target + " is not plugin aware");
  }
}
