{
  String pluginId=pluginRequest.getId();
  PluginDescriptor pluginDescriptor=pluginDescriptorLocator.findPluginDescriptor(pluginId);
  if (pluginDescriptor == null || isCorePlugin(pluginId)) {
    return delegate.resolve(pluginRequest);
  }
 else {
    throw new InvalidPluginRequestException(pluginRequest,String.format("Plugin '%s' is already on the script classpath (plugins on the script classpath cannot be used in a plugins {} block; move \"apply plugin: '%s'\" outside of the plugins {} block)",pluginId,pluginId));
  }
}
