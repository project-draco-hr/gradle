{
  Properties originalSystemProperties=new Properties();
  originalSystemProperties.putAll(System.getProperties());
  File currentDir=new File(".").getAbsoluteFile();
  Properties clientSystemProperties=new Properties();
  clientSystemProperties.putAll(build.getParameters().getSystemProperties());
  System.setProperties(clientSystemProperties);
  Map<String,String> originalEnv=System.getenv();
  processEnvironment.setenv(build.getParameters().getEnvVariables());
  processEnvironment.setProcessDir(build.getParameters().getCurrentDir());
  try {
    execution.proceed();
  }
  finally {
    System.setProperties(originalSystemProperties);
    processEnvironment.setenv(originalEnv);
    processEnvironment.setProcessDir(currentDir);
  }
}
