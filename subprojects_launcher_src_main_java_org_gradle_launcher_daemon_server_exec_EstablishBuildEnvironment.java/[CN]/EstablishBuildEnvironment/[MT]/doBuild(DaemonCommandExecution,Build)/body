{
  Properties originalSystemProperties=new Properties();
  originalSystemProperties.putAll(System.getProperties());
  Map<String,String> originalEnv=System.getenv();
  File originalProcessDir=GFileUtils.canonicalise(new File("."));
  for (  Map.Entry<String,String> entry : build.getParameters().getSystemProperties().entrySet()) {
    if (SystemProperties.getStandardProperties().contains(entry.getKey())) {
      continue;
    }
    if (entry.getKey().startsWith("sun.")) {
      continue;
    }
    System.setProperty(entry.getKey(),entry.getValue());
  }
  LOGGER.debug("Configuring env variables: {}",build.getParameters().getEnvVariables());
  processEnvironment.maybeSetEnvironment(build.getParameters().getEnvVariables());
  processEnvironment.maybeSetProcessDir(build.getParameters().getCurrentDir());
  try {
    execution.proceed();
  }
  finally {
    System.setProperties(originalSystemProperties);
    processEnvironment.maybeSetEnvironment(originalEnv);
    processEnvironment.maybeSetProcessDir(originalProcessDir);
  }
}
