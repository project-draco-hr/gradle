{
  if (patternSet == null || patternSet.isEmpty()) {
    return noPatternTree;
  }
 else   if (treesPerPattern != null) {
    VisitedTree cachedTree=treesPerPattern.get(patternSet);
    if (cachedTree == null && noPatternTree != null) {
      cachedTree=filterTree(noPatternTree,patternSet,nextId);
    }
    return cachedTree;
  }
 else {
    return null;
  }
}
