{
  LogLevel currentLevel=getCurrentLogLevel();
  TestLogging levelLogging=testLogging.get(currentLevel);
  TestExceptionFormatter exceptionFormatter=getExceptionFormatter(levelLogging);
  TestEventLogger eventLogger=new TestEventLogger(textOutputFactory,currentLevel,levelLogging,exceptionFormatter);
  addTestListener(eventLogger);
  addTestOutputListener(eventLogger);
  File binaryResultsDir=new File(getTemporaryDir(),"binary-test-results");
  TestReportDataCollector testReportDataCollector=null;
  if (isTestReport() && testFramework instanceof TestNGTestFramework) {
    getProject().delete(binaryResultsDir);
    getProject().mkdir(binaryResultsDir);
    testReportDataCollector=new TestReportDataCollector(binaryResultsDir);
    addTestListener(testReportDataCollector);
    addTestOutputListener(testReportDataCollector);
  }
  ProgressLoggerFactory progressLoggerFactory=getServices().get(ProgressLoggerFactory.class);
  TestCountLogger testCountLogger=new TestCountLogger(progressLoggerFactory);
  addTestListener(testCountLogger);
  TestResultProcessor resultProcessor=new TestListenerAdapter(getTestListenerBroadcaster().getSource(),testOutputListenerBroadcaster.getSource());
  testExecuter.execute(this,resultProcessor);
  if (testReportDataCollector != null) {
    removeTestListener(testReportDataCollector);
    removeTestOutputListener(testReportDataCollector);
    new Binary2JUnitXmlReportGenerator(getTestResultsDir(),testReportDataCollector).generate();
  }
  testFramework.report();
  testFramework=null;
  if (testCountLogger.hadFailures()) {
    handleTestFailures();
  }
}
