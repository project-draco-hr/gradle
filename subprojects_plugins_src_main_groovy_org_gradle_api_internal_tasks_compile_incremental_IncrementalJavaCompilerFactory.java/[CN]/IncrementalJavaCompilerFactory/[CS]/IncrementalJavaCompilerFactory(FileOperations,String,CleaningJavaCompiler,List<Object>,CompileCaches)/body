{
  Hasher hasher=new DefaultHasher();
  ClassDependenciesAnalyzer analyzer=new CachingClassDependenciesAnalyzer(new DefaultClassDependenciesAnalyzer(),hasher,compileCaches.getClassAnalysisCache());
  JarSnapshotter jarSnapshotter=new CachingJarSnapshotter(hasher,analyzer,compileCaches.getJarSnapshotCache());
  LocalJarClasspathSnapshot localJarClasspathSnapshot=new LocalJarClasspathSnapshot(compileCaches.getLocalJarClasspathSnapshotStore(),compileCaches.getJarSnapshotCache());
  JarSnapshotsMaker jarSnapshotsMaker=new JarSnapshotsMaker(localJarClasspathSnapshot,jarSnapshotter,new ClasspathJarFinder(fileOperations));
  CompilationSourceDirs sourceDirs=new CompilationSourceDirs(source);
  SourceToNameConverter sourceToNameConverter=new SourceToNameConverter(sourceDirs);
  RecompilationSpecProvider recompilationSpecProvider=new RecompilationSpecProvider(sourceToNameConverter,fileOperations,localJarClasspathSnapshot);
  ClassDependencyInfoUpdater classDependencyInfoUpdater=new ClassDependencyInfoUpdater(compileCaches.getLocalClassDependencyInfoStore(),fileOperations,analyzer);
  incrementalSupport=new IncrementalCompilationSupport(jarSnapshotsMaker,compileCaches.getLocalClassDependencyInfoStore(),fileOperations,cleaningJavaCompiler,compileDisplayName,recompilationSpecProvider,classDependencyInfoUpdater,sourceDirs);
}
