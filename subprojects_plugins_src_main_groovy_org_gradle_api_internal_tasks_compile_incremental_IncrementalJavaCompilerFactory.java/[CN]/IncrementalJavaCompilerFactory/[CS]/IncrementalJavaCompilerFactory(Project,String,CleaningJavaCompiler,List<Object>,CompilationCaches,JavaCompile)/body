{
  Hasher hasher=new DefaultHasher();
  ClassDependenciesAnalyzer analyzer=new CachingClassDependenciesAnalyzer(new DefaultClassDependenciesAnalyzer(),hasher,compilationCaches.getClassAnalysisCache());
  JarSnapshotter jarSnapshotter=new CachingJarSnapshotter(new DefaultJarSnapshotter(hasher,analyzer),hasher,compilationCaches.getJarSnapshotCache());
  String cacheFileBaseName=compileTaskPath.replaceAll(":","_");
  LocalJarSnapshots localJarSnapshots=new LocalJarSnapshots(compilationCaches.getCacheRepository(),javaCompile,compilationCaches.getJarSnapshotCache(),hasher);
  LocalClassDependencyInfoCache localClassDependencyInfo=new LocalClassDependencyInfoCache(new File(project.getBuildDir(),cacheFileBaseName + "-class-info.bin"));
  JarSnapshotsMaker jarSnapshotsMaker=new JarSnapshotsMaker(localJarSnapshots,jarSnapshotter,new ClasspathJarFinder((FileOperations)project));
  CompilationSourceDirs sourceDirs=new CompilationSourceDirs(source);
  SourceToNameConverter sourceToNameConverter=new SourceToNameConverter(sourceDirs);
  RecompilationSpecProvider recompilationSpecProvider=new RecompilationSpecProvider(sourceToNameConverter,localClassDependencyInfo,(FileOperations)project,jarSnapshotter,localJarSnapshots);
  ClassDependencyInfoUpdater classDependencyInfoUpdater=new ClassDependencyInfoUpdater(localClassDependencyInfo,(FileOperations)project,analyzer);
  incrementalSupport=new IncrementalCompilationSupport(jarSnapshotsMaker,localClassDependencyInfo,(FileOperations)project,cleaningJavaCompiler,compileTaskPath,recompilationSpecProvider,classDependencyInfoUpdater,sourceDirs);
}
