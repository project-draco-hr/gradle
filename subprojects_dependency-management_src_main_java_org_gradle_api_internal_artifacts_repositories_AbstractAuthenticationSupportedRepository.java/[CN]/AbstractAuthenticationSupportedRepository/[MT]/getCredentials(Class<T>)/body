{
  if (credentials == null) {
    credentials=newCredentials(clazz);
  }
 else   if (!(clazz.isAssignableFrom(credentials.getClass()))) {
    throw new IllegalStateException(String.format("Credentials already configured. Requested credentials must be of type '%s'.",credentials.getClass().getName()));
  }
  return (T)credentials;
}
