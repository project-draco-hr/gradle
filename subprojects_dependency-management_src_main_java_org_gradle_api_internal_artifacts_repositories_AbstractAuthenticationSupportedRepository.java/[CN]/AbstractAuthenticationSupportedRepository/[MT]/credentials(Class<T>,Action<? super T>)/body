{
  if (credentials != null) {
    throw new IllegalStateException("Cannot overwrite already configured credentials.");
  }
  if (clazz == AwsCredentials.class) {
    credentials=instantiator.newInstance(DefaultAwsCredentials.class);
  }
 else   if (clazz == PasswordCredentials.class) {
    credentials=instantiator.newInstance(DefaultPasswordCredentials.class);
  }
  action.execute((T)credentials);
}
