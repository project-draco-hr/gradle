{
  if (!(destinationAddress instanceof InetEndpoint)) {
    throw new IllegalArgumentException(String.format("Cannot create a connection to address of unknown type: %s.",destinationAddress));
  }
  InetEndpoint address=(InetEndpoint)destinationAddress;
  LOGGER.debug("Attempting to connect to {}.",address);
  List<InetAddress> candidateAddresses=address.getCandidates();
  try {
    Exception lastFailure=null;
    for (    InetAddress candidate : candidateAddresses) {
      LOGGER.debug("Trying to connect to address {}.",candidate);
      SocketChannel socketChannel;
      try {
        socketChannel=SocketChannel.open(new InetSocketAddress(candidate,address.getPort()));
      }
 catch (      java.net.ConnectException e) {
        LOGGER.debug("Cannot connect to address {}, skipping.",candidate);
        lastFailure=e;
        continue;
      }
catch (      SocketException e) {
        LOGGER.debug("Cannot connect to address {}, skipping.",candidate);
        lastFailure=new RuntimeException(String.format("Could not connect to address %s.",candidate),e);
        continue;
      }
      LOGGER.debug("Connected to address {}.",candidate);
      return new SocketConnection<T>(socketChannel,serializer);
    }
    throw lastFailure;
  }
 catch (  java.net.ConnectException e) {
    throw new ConnectException(String.format("Could not connect to server %s. Tried addresses: %s.",destinationAddress,candidateAddresses),e);
  }
catch (  Exception e) {
    throw new RuntimeException(String.format("Could not connect to server %s. Tried addresses: %s.",destinationAddress,candidateAddresses),e);
  }
}
