{
  if (!(destinationAddress instanceof InetEndpoint)) {
    throw new IllegalArgumentException(String.format("Cannot create a connection to address of unknown type: %s.",destinationAddress));
  }
  InetEndpoint address=(InetEndpoint)destinationAddress;
  LOGGER.debug("Attempting to connect to {}.",address);
  List<InetAddress> candidateAddresses=address.getCandidates();
  Exception lastFailure=null;
  for (  InetAddress candidate : candidateAddresses) {
    LOGGER.debug("Trying to connect to address {}.",candidate);
    SocketChannel socketChannel;
    try {
      socketChannel=SocketChannel.open(new InetSocketAddress(candidate,address.getPort()));
    }
 catch (    Exception e) {
      LOGGER.debug("Cannot connect to address {}, skipping.",candidate);
      lastFailure=e;
      continue;
    }
    LOGGER.debug("Connected to address {}.",candidate);
    return new SocketConnection<T>(socketChannel,serializer);
  }
  throw new ConnectException(String.format("Could not connect to server %s. Tried addresses: %s.",destinationAddress,candidateAddresses),lastFailure);
}
