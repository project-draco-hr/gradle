{
  File tmpDir=new File(storageDir,"jna");
  tmpDir.mkdirs();
  String jnaLibName=OperatingSystem.current() instanceof OperatingSystem.MacOs ? "libjnidispatch.jnilib" : System.mapLibraryName("jnidispatch");
  File libFile=new File(tmpDir,jnaLibName);
  if (!libFile.exists()) {
    String resourceName="/com/sun/jna/" + OperatingSystem.current().getNativePrefix() + "/"+ jnaLibName;
    try {
      InputStream lib=getClass().getResourceAsStream(resourceName);
      if (lib == null) {
        throw new JnaNotAvailableException(String.format("Could not locate JNA native lib resource '%s'.",resourceName));
      }
      try {
        FileOutputStream outputStream=new FileOutputStream(libFile);
        try {
          IOUtils.copy(lib,outputStream);
        }
  finally {
          outputStream.close();
        }
      }
  finally {
        lib.close();
      }
    }
 catch (    IOException e) {
      throw new UncheckedIOException(e);
    }
  }
  System.setProperty("jna.boot.library.path",tmpDir.getAbsolutePath());
}
