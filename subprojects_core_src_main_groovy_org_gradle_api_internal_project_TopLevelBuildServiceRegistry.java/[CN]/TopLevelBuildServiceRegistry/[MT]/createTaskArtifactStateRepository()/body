{
  CacheRepository cacheRepository=get(CacheRepository.class);
  FileSnapshotter fileSnapshotter=new DefaultFileSnapshotter(new CachingHasher(new DefaultHasher(),cacheRepository));
  FileSnapshotter outputFilesSnapshotter=new OutputFilesSnapshotter(fileSnapshotter,new RandomLongIdGenerator(),cacheRepository);
  return new ShortCircuitTaskArtifactStateRepository(startParameter,new DefaultTaskArtifactStateRepository(cacheRepository,fileSnapshotter,outputFilesSnapshotter));
}
