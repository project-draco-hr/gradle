{
  PercentageProgressFormatter progressFormatter=new PercentageProgressFormatter("Generating",Iterables.size(files));
  for (  File file : files) {
    progressLogger.progress(progressFormatter.getProgress());
    if (file.getName().endsWith(".jar")) {
      processJarFile(outputStream,file,buffer,seenPaths,services);
    }
 else {
      throw new RuntimeException("non JAR on classpath: " + file.getAbsolutePath());
    }
    progressFormatter.incrementAndGetProgress();
  }
  for (  Map.Entry<String,List<String>> service : services.entrySet()) {
    String allProviders=Joiner.on("\n").join(service.getValue());
    writeEntry(outputStream,SERVICES_DIR_PREFIX + service.getKey(),allProviders.getBytes(Charsets.UTF_8));
  }
}
