{
  try {
    ZipEntry archiveEntry=new ZipEntry(fileDetails.getRelativePath().getPathString());
    archiveEntry.setTime(fileDetails.getLastModified());
    archiveEntry.setUnixMode(UnixStat.FILE_FLAG | fileDetails.getMode());
    zipOutStr.putNextEntry(archiveEntry);
    fileCount++;
    if (fileCount > 65535 && !compressor.isZip64Supported()) {
      throw new RuntimeException("Tried to create a zip with too many files. Please set zip64=true.");
    }
    fileDetails.copyTo(zipOutStr);
    zipOutStr.closeEntry();
  }
 catch (  Exception e) {
    throw new GradleException(String.format("Could not add %s to ZIP '%s'.",fileDetails,zipFile),e);
  }
}
