{
  MethodNode method=AstUtils.getGeneratedClosureImplMethod(node);
  Statement closureCode=method.getCode();
  SourceLocation sourceLocation=closureCode.getNodeMetaData(AST_NODE_METADATA_LOCATION_KEY);
  if (sourceLocation != null) {
    AnnotationNode metadataAnnotation=new AnnotationNode(RULE_METADATA);
    metadataAnnotation.addMember("scriptSourceDescription",new ConstantExpression(sourceLocation.getScriptSourceDescription()));
    metadataAnnotation.addMember("absoluteScriptSourceLocation",new ConstantExpression(sourceLocation.getUri()));
    metadataAnnotation.addMember("lineNumber",new ConstantExpression(sourceLocation.getLineNumber()));
    metadataAnnotation.addMember("columnNumber",new ConstantExpression(sourceLocation.getColumnNumber()));
    InputReferences inputs=closureCode.getNodeMetaData(AST_NODE_METADATA_INPUTS_KEY);
    if (!inputs.isEmpty()) {
      metadataAnnotation.addMember("absoluteInputPaths",new ListExpression(constants(inputs.getAbsolutePaths())));
      metadataAnnotation.addMember("absoluteInputLineNumbers",new ListExpression(constants(inputs.getAbsolutePathLineNumbers())));
      metadataAnnotation.addMember("relativeInputPaths",new ListExpression(constants(inputs.getRelativePaths())));
      metadataAnnotation.addMember("relativeInputLineNumbers",new ListExpression(constants(inputs.getRelativePathLineNumbers())));
    }
    node.addAnnotation(metadataAnnotation);
  }
}
