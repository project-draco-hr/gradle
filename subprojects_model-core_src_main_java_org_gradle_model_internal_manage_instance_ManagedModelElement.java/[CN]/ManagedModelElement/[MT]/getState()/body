{
  return new ModelElementState(){
    public Object get(    String name){
      return doGet(getPropertyType(name),name);
    }
    private <T>T doGet(    ModelType<T> type,    String name){
      ModelPropertyInstance<T> propertyInstance=ManagedModelElement.this.get(type,name);
      T value=propertyInstance.get();
      if (value == null && !propertyInstance.getMeta().isWritable()) {
        value=instantiator.newInstance(schemaStore.getSchema(type));
        propertyInstance.set(value);
      }
      return value;
    }
    public void set(    String name,    Object value){
      doSet(getPropertyType(name),name,value);
    }
    private <P>void doSet(    ModelType<P> propertyType,    String name,    Object value){
      ModelPropertyInstance<P> modelPropertyInstance=ManagedModelElement.this.get(propertyType,name);
      ModelSchema<P> propertySchema=schemaStore.getSchema(propertyType);
      if (propertySchema.getKind().isManaged() && !ManagedInstance.class.isInstance(value)) {
        throw new IllegalArgumentException(String.format("Only managed model instances can be set as property '%s' of class '%s'",name,getType()));
      }
      modelPropertyInstance.set(Cast.cast(propertyType.getConcreteClass(),value));
    }
  }
;
}
