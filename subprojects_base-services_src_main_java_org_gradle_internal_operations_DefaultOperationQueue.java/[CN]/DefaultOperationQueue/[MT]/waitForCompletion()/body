{
  completed=true;
  boolean cancelExecution=false;
  for (  ListenableFuture<?> future : workFutures) {
    if (!cancelExecution) {
      if (hasFailed(future)) {
        cancelExecution=true;
      }
    }
 else {
      future.cancel(false);
    }
  }
  if (!failures.isEmpty()) {
    Throwable firstFailure=failures.get(0);
    if (firstFailure instanceof GradleException) {
      throw (GradleException)firstFailure;
    }
    throw new GradleException("build operation failed",failures.get(0));
  }
}
