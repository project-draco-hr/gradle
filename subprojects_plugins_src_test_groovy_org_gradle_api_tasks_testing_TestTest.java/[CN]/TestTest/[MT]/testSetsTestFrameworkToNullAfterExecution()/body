{
  configureTask();
  test.useTestFramework(new TestFramework(){
    public TestFrameworkDetector getDetector(){
      return null;
    }
    public TestFrameworkOptions getOptions(){
      return null;
    }
    public WorkerTestClassProcessorFactory getProcessorFactory(){
      return null;
    }
    public org.gradle.api.Action<WorkerProcessBuilder> getWorkerConfigurationAction(){
      return null;
    }
  }
);
  context.checking(new Expectations(){
{
      one(testExecuterMock).execute(with(sameInstance(test)),with(notNullValue(TestResultProcessor.class)));
    }
  }
);
  WeakReference<TestFramework> weakRef=new WeakReference<TestFramework>(test.getTestFramework());
  test.executeTests();
  System.gc();
  assertNull(weakRef.get());
}
