{
  File[] children=file.listFiles();
  List<File> dirs=new ArrayList<File>();
  for (int i=0; !stopFlag.get() && i < children.length; i++) {
    File child=children[i];
    boolean isFile=child.isFile();
    RelativePath childPath=new RelativePath(isFile,path,child.getName());
    if (isAllowed(childPath)) {
      if (isFile) {
        notifyFile(child,childPath,stopFlag);
      }
 else {
        dirs.add(child);
      }
    }
  }
  for (int i=0; !stopFlag.get() && i < dirs.size(); i++) {
    File dir=dirs.get(i);
    RelativePath dirPath=new RelativePath(false,path,dir.getName());
    notifyDir(dir,dirPath,stopFlag);
    walkDir(dir,dirPath,stopFlag);
  }
}
