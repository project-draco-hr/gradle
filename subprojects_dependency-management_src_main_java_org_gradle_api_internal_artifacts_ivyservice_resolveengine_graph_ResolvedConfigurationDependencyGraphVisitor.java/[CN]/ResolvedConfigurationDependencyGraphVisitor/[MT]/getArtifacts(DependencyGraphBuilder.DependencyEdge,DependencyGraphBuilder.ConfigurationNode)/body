{
  long id=idGenerator.generateId();
  ResolvedConfigurationIdentifier configurationIdentifier=childConfiguration.id;
  ConfigurationMetaData metaData=childConfiguration.getMetaData();
  ComponentResolveMetaData component=metaData.getComponent();
  Set<ComponentArtifactMetaData> artifacts=dependency.getArtifacts(metaData);
  if (!artifacts.isEmpty()) {
    return new DependencyArtifactSet(component.getId(),component.getSource(),artifacts,artifactResolver,allResolvedArtifacts,id);
  }
  ArtifactSet configurationArtifactSet=artifactSetsByConfiguration.get(configurationIdentifier);
  if (configurationArtifactSet == null) {
    configurationArtifactSet=new ConfigurationArtifactSet(component,configurationIdentifier,dependency.getSelector(),artifactResolver,allResolvedArtifacts,id);
    if (dependency.getSelector().acceptsAllArtifacts()) {
      artifactSetsByConfiguration.put(configurationIdentifier,configurationArtifactSet);
    }
  }
  return configurationArtifactSet;
}
