{
  VersionDetails version=connection.getVersionDetails();
  if (operationParameters.getJavaHome() != null) {
    if (!version.supportsConfiguringJavaHome()) {
      throw Exceptions.unsupportedOperationConfiguration("modelBuilder.setJavaHome() and buildLauncher.setJavaHome()");
    }
  }
  if (operationParameters.getJvmArguments() != null) {
    if (!version.supportsConfiguringJvmArguments()) {
      throw Exceptions.unsupportedOperationConfiguration("modelBuilder.setJvmArguments() and buildLauncher.setJvmArguments()");
    }
  }
  if (operationParameters.getStandardInput() != null) {
    if (!version.supportsConfiguringStandardInput()) {
      throw Exceptions.unsupportedOperationConfiguration("modelBuilder.setStandardInput() and buildLauncher.setStandardInput()");
    }
  }
  if (type != Void.class && operationParameters.getTasks() != null) {
    if (!version.supportsRunningTasksWhenBuildingModel()) {
      throw Exceptions.unsupportedOperationConfiguration("modelBuilder.forTasks()");
    }
  }
  if (type == InternalBuildEnvironment.class && !version.supportsCompleteBuildEnvironment()) {
    VersionOnlyBuildEnvironment out=new VersionOnlyBuildEnvironment(version.getVersion());
    return type.cast(out);
  }
  if (version.clientHangsOnEarlyDaemonFailure() && version.isPostM6Model(type)) {
    String message=String.format("I don't know how to build a model of type '%s'.",type.getSimpleName());
    throw new UnsupportedOperationException(message);
  }
  if (type == InternalGradleProject.class && !version.supportsGradleProjectModel()) {
    EclipseProjectVersion3 project=connection.run(EclipseProjectVersion3.class,operationParameters);
    GradleProject gradleProject=new GradleProjectConverter().convert(project);
    return (T)gradleProject;
  }
  return connection.run(type,operationParameters);
}
