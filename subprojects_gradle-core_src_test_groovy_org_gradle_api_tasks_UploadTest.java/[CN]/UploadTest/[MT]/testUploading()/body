{
  final Configuration configurationMock=context.mock(Configuration.class);
  final PublishInstruction publishInstruction=new PublishInstruction(true,new File("somePath"));
  upload.setUploadDescriptor(publishInstruction.isUploadDescriptor());
  upload.setDescriptorDestination(publishInstruction.getDescriptorDestination());
  upload.setConfiguration(configurationMock);
  upload.setProject(HelperUtil.createRootProject(projectRootDir));
  final DependencyResolver repository=upload.getRepositories().mavenCentral();
  context.checking(new Expectations(){
{
      one(configurationMock).publish(WrapUtil.toList(repository),publishInstruction);
    }
  }
);
  upload.execute();
}
