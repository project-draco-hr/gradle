{
  CachedClassLoader cachedLoader=bySpec.get(spec);
  if (cachedLoader == null) {
    ClassLoader classLoader;
    CachedClassLoader parentCachedLoader=null;
    if (spec.isFiltered()) {
      parentCachedLoader=getLoader(classPath,spec.unfiltered()).retain();
      classLoader=new FilteringClassLoader(parentCachedLoader.classLoader,spec.filterSpec);
    }
 else {
      classLoader=new URLClassLoader(classPath.getAsURLArray(),spec.parent);
    }
    cachedLoader=new CachedClassLoader(classLoader,spec,parentCachedLoader);
    bySpec.put(spec,cachedLoader);
  }
  return cachedLoader;
}
