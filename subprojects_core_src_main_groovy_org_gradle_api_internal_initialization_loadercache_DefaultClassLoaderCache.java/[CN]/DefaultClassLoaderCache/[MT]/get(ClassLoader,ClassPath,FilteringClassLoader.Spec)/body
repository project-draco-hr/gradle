{
  try {
    ClassPathSnapshot s=snapshotter.snapshot(classPath);
    Key key=new Key(parent,s,filterSpec);
    return cache.get(key,new Callable<ClassLoader>(){
      public ClassLoader call() throws Exception {
        if (filterSpec == null) {
          return new URLClassLoader(classPath.getAsURLArray(),parent);
        }
 else {
          return new FilteringClassLoader(get(parent,classPath,null),filterSpec);
        }
      }
    }
);
  }
 catch (  ExecutionException e) {
    throw UncheckedException.throwAsUncheckedException(e);
  }
}
