{
  TaskFilePropertyCompareType compareType=TaskFilePropertyCompareType.values()[decoder.readSmallInt()];
  List<TreeSnapshot> treeSnapshots=new ArrayList<TreeSnapshot>();
  int sharedTreeCount=decoder.readSmallInt();
  for (int i=0; i < sharedTreeCount; i++) {
    long treeId=decoder.readLong();
    treeSnapshots.add(treeSnapshotRepository.getTreeSnapshot(treeId));
  }
  TreeSnapshot nonShared=TreeSnapshotSerializer.readStoredTreeSnapshot(-1,decoder,incrementalFileSnapshotSerializer,stringInterner);
  if (!nonShared.getFileSnapshots().isEmpty()) {
    treeSnapshots.add(nonShared);
  }
  return new FileCollectionSnapshotImpl(treeSnapshots,compareType);
}
