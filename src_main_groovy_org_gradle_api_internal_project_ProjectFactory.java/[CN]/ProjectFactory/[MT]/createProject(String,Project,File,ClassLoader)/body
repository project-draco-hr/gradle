{
  ScriptSource source;
  if (embeddedScript != null) {
    source=embeddedScript;
  }
 else {
    source=new FileScriptSource("build file",new File(projectDir,startParameter.getBuildFileName()));
  }
  Build build;
  if (parent == null) {
    build=new DefaultBuild(null,taskGraph,startParameter);
  }
 else {
    build=parent.getBuild();
  }
  DefaultProject project=new DefaultProject(name,parent,projectDir,startParameter.getBuildFileName(),source,buildScriptClassLoader,taskFactory,dependencyManagerFactory,buildScriptProcessor,pluginRegistry,projectRegistry,this,build);
  if (parent == null) {
    ((DefaultBuild)build).setRootProject(project.getRootProject());
  }
  return project;
}
