{
  ScriptSource source;
  if (embeddedScript != null) {
    source=embeddedScript;
  }
 else {
    source=new FileScriptSource("build file",new File(projectDir,buildFileName));
  }
  Build build;
  if (parent == null) {
    build=new DefaultBuild(null,taskGraph);
  }
 else {
    build=parent.getBuild();
  }
  DefaultProject project=new DefaultProject(name,parent,projectDir,buildFileName,source,buildScriptClassLoader,taskFactory,dependencyManagerFactory,buildScriptProcessor,pluginRegistry,projectRegistry,this,build);
  if (parent == null) {
    ((DefaultBuild)build).setRootProject(project.getRootProject());
  }
  return project;
}
