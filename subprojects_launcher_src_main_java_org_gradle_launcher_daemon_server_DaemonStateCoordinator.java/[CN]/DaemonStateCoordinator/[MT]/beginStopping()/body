{
switch (state) {
case NotStarted:
    throw new IllegalStateException("This daemon has not been started.");
case Running:
  onStopRequested.run();
state=State.StopRequested;
break;
case StopRequested:
case Stopped:
break;
default :
throw new IllegalStateException("Daemon is in unexpected state: " + state);
}
}
