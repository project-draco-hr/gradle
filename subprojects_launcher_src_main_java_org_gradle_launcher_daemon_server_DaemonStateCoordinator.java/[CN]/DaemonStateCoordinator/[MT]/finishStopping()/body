{
switch (state) {
case NotStarted:
case Running:
    throw new IllegalStateException("This daemon has not been stopped.");
case StopRequested:
  onStop.run();
state=State.Stopped;
condition.signalAll();
break;
case Stopped:
break;
default :
throw new IllegalStateException("Daemon is in unexpected state: " + state);
}
}
