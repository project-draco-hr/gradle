{
  lock.lock();
  try {
    String execution=currentCommandExecution;
    LOGGER.debug("onFinishCommand() called while execution = {}",execution);
    currentCommandExecution=null;
    onDisconnect=null;
    updateActivityTimestamp();
switch (state) {
case Running:
      try {
        onFinishCommand.run();
        condition.signalAll();
      }
 catch (      Throwable throwable) {
        setState(State.Broken);
        throw UncheckedException.throwAsUncheckedException(throwable);
      }
    break;
case StopRequested:
  stop();
break;
case Stopped:
break;
default :
throw new IllegalStateException("Daemon is in unexpected state: " + state);
}
}
  finally {
lock.unlock();
}
}
