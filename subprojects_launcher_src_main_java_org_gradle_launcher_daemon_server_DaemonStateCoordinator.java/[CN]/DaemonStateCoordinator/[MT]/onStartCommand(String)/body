{
  lock.lock();
  try {
switch (state) {
case NotStarted:
      throw new IllegalStateException("This daemon has not been started.");
case Broken:
    throw new IllegalStateException("This daemon is in a broken state.");
case StopRequested:
  throw new IllegalStateException("This daemon is stopping.");
case Stopped:
throw new IllegalStateException("This daemon has stopped.");
}
if (currentCommandExecution != null) {
throw new DaemonBusyException(currentCommandExecution);
}
 else {
LOGGER.debug("onStartCommand({}) called after {} minutes of idle",commandDisplayName,getIdleMinutes());
currentCommandExecution=commandDisplayName;
updateActivityTimestamp();
try {
onStartCommand.run();
condition.signalAll();
}
 catch (Throwable throwable) {
setState(State.Broken);
throw UncheckedException.throwAsUncheckedException(throwable);
}
}
}
  finally {
lock.unlock();
}
}
