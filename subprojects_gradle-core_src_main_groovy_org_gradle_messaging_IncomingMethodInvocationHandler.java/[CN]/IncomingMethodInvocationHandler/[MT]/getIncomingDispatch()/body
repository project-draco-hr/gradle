{
  Dispatch<MethodInvocation> invocationDispatch=new Dispatch<MethodInvocation>(){
    public void dispatch(    MethodInvocation methodInvocation){
      Dispatch<? super MethodInvocation> dispatchForType=incoming.get(methodInvocation.getTargetClass());
      if (dispatchForType == null) {
        throw new IllegalStateException(String.format("Received method invocation for unknown type '%s'.",methodInvocation.getTargetClass().getName()));
      }
      dispatchForType.dispatch(methodInvocation);
    }
  }
;
  return new MethodInvocationUnmarshallingDispatch(invocationDispatch,classLoader);
}
