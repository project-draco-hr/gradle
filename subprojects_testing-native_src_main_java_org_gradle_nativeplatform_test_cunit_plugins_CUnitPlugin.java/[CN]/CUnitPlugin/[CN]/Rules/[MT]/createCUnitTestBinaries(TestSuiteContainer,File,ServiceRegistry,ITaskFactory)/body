{
  testSuites.withType(CUnitTestSuiteSpec.class).afterEach(new Action<CUnitTestSuiteSpec>(){
    @Override public void execute(    CUnitTestSuiteSpec cUnitTestSuite){
      for (      NativeBinarySpec testedBinary : cUnitTestSuite.getTestedComponent().getBinaries().withType(NativeBinarySpec.class)) {
        if (testedBinary instanceof SharedLibraryBinary) {
          continue;
        }
        DefaultCUnitTestSuiteBinary testBinary=createTestBinary(serviceRegistry,cUnitTestSuite,testedBinary,taskFactory);
        configure(testBinary,buildDir);
        cUnitTestSuite.getBinaries().add(testBinary);
      }
    }
  }
);
}
