{
  LOGGER.debug("Determining if {} is up-to-date",task);
  TaskArtifactState taskArtifactState=repository.getStateFor(task);
  try {
    if (taskArtifactState.isUpToDate()) {
      LOGGER.info("Skipping {} as it is up-to-date",task);
      state.upToDate();
      return;
    }
    logOutOfDateMessages(taskArtifactState.getOutOfDateMessages(),task);
    task.getOutputs().setHistory(taskArtifactState.getExecutionHistory());
    context.setTaskArtifactState(taskArtifactState);
    taskArtifactState.beforeTask();
    try {
      executer.execute(task,state,context);
      if (state.getFailure() == null) {
        taskArtifactState.afterTask();
      }
    }
  finally {
      task.getOutputs().setHistory(null);
      context.setTaskArtifactState(null);
    }
  }
  finally {
    taskArtifactState.finished();
  }
}
