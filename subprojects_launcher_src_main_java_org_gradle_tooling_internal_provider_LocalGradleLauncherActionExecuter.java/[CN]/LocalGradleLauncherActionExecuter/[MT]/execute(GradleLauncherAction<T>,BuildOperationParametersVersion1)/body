{
  StartParameter startParameter=new ConnectionToStartParametersConverter().convert(actionParameters);
  if (action instanceof InitializationAware) {
    InitializationAware initializationAware=(InitializationAware)action;
    initializationAware.configureStartParameter(startParameter);
  }
  GradleLauncher gradleLauncher=gradleLauncherFactory.newInstance(startParameter);
  if (actionParameters.getStandardOutput() != null) {
    gradleLauncher.addStandardOutputListener(new StreamBackedStandardOutputListener(actionParameters.getStandardOutput()));
  }
  if (actionParameters.getStandardError() != null) {
    gradleLauncher.addStandardErrorListener(new StreamBackedStandardOutputListener(actionParameters.getStandardError()));
  }
  ProgressListenerVersion1 progressListener=actionParameters.getProgressListener();
  OutputEventListenerAdapter listener=new OutputEventListenerAdapter(progressListener);
  loggingOutput.addOutputEventListener(listener);
  try {
    BuildResult result=action.run(gradleLauncher);
    if (result.getFailure() != null) {
      throw new BuildExceptionVersion1(result.getFailure());
    }
  }
  finally {
    loggingOutput.removeOutputEventListener(listener);
  }
  return action.getResult();
}
