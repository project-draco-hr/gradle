{
  final GradleLauncher gradleMockLauncher=context.mock(GradleLauncher.class);
  final GradleLauncherFactory gradleLauncherFactoryMock=context.mock(GradleLauncherFactory.class);
  GradleLauncher.injectCustomFactory(gradleLauncherFactoryMock);
  context.checking(new Expectations(){
{
      one(gradleLauncherFactoryMock).newInstance(startParameter);
      will(returnValue(gradleMockLauncher));
      allowing(gradleMockLauncher).addListener(with(any(BuildListener.class)));
      one(gradleMockLauncher).run();
      will(returnValue(buildResult));
    }
  }
);
}
