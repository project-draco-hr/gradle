{
  final GradleLauncher gradleMockLauncher=context.mock(GradleLauncher.class);
  final GradleFactory gradleFactoryMock=context.mock(GradleFactory.class);
  GradleLauncher.injectCustomFactory(gradleFactoryMock);
  context.checking(new Expectations(){
{
      one(gradleFactoryMock).newInstance(startParameter);
      will(returnValue(gradleMockLauncher));
      allowing(gradleMockLauncher).addBuildListener(with(any(BuildListener.class)));
      one(gradleMockLauncher).run();
      will(returnValue(buildResult));
    }
  }
);
}
