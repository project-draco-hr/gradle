{
  final ProcessBuilder processBuilder=processBuilderFactory.createProcessBuilder(execHandle);
  final long keepWaitingTimeout=execHandle.getKeepWaitingTimeout();
  try {
    final Process process=processBuilder.start();
    final ExecOutputHandleRunner standardOutputHandleRunner=new ExecOutputHandleRunner(process.getInputStream(),execHandle.getStandardOutputHandle());
    final ExecOutputHandleRunner errorOutputHandleRunner=new ExecOutputHandleRunner(process.getErrorStream(),execHandle.getErrorOutputHandle());
    threadPool.execute(standardOutputHandleRunner);
    threadPool.execute(errorOutputHandleRunner);
    execHandle.started();
    int exitCode=-1;
    boolean processFinishedNormally=false;
    while (keepWaiting.get() && !processFinishedNormally) {
      try {
        exitCode=process.exitValue();
        processFinishedNormally=true;
      }
 catch (      IllegalThreadStateException e) {
      }
      try {
        Thread.sleep(keepWaitingTimeout);
      }
 catch (      InterruptedException e) {
      }
    }
    if (!keepWaiting.get()) {
      process.destroy();
      execHandle.aborted();
    }
 else {
      execHandle.finished(exitCode);
    }
  }
 catch (  Throwable t) {
    execHandle.failed(t);
  }
}
