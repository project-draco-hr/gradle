{
  final List<String> visitedFilePaths=Lists.newLinkedList();
  final Set<File> visitedDirs=Sets.newLinkedHashSet();
  final List<File> cpFiles=classPath.getAsFiles();
  final Adler32 checksum=new Adler32();
  cacheAccess.useCache("Snapshot classpath",new Runnable(){
    @Override public void run(){
      hash(checksum,visitedFilePaths,visitedDirs,cpFiles.iterator());
    }
  }
);
  return new ClassPathSnapshotImpl(visitedFilePaths,checksum.getValue());
}
