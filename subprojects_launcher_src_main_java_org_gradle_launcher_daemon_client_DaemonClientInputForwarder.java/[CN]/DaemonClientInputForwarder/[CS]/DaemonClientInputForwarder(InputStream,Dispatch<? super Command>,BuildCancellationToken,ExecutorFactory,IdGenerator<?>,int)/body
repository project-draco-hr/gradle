{
  TextStream handler=new ForwardTextStreamToConnection(dispatch,idGenerator,connectionMutex);
  forwarder=new InputForwarder(inputStream,handler,cancellationToken,executorFactory,bufferSize);
  cancellationCallback=new Runnable(){
    public void run(){
      connectionMutex.lock();
      try {
        LOGGER.info("Request daemon to cancel build...");
        dispatch.dispatch(new Cancel(idGenerator.generateId()));
      }
  finally {
        connectionMutex.unlock();
      }
    }
  }
;
}
