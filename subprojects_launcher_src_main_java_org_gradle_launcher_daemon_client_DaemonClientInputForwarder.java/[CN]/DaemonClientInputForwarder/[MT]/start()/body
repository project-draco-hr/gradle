{
  lifecycleLock.lock();
  try {
    if (started) {
      throw new IllegalStateException("DaemonClientInputForwarder already started");
    }
    Action<String> dispatcher=new Action<String>(){
      public void execute(      String input){
        dispatch.dispatch(new ForwardInput(clientMetadata,input.getBytes()));
      }
    }
;
    Runnable onFinish=new Runnable(){
      public void run(){
        dispatch.dispatch(new CloseInput(clientMetadata));
      }
    }
;
    forwarder=new InputForwarder(inputStream,dispatcher,onFinish,executorFactory,bufferSize).start();
    started=true;
    return this;
  }
  finally {
    lifecycleLock.unlock();
  }
}
