{
  byte protocolVersion=inputStream.readByte();
  if (protocolVersion != PROTOCOL_VERSION) {
    return new UnknownMessage(String.format("unknown protocol version %s",protocolVersion));
  }
  byte messageType=inputStream.readByte();
switch (messageType) {
case LOOKUP_REQUEST:
    return readLookupRequest(inputStream);
case CHANNEL_AVAILABLE:
  return readChannelAvailable(inputStream,remoteAddress);
case CHANNEL_UNAVAILABLE:
return readChannelUnavailable(inputStream);
}
return new UnknownMessage(String.format("unknown message type %s",messageType));
}
