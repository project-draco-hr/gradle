{
  project.getPluginManager().apply(JavaBasePlugin.class);
  final OsgiPluginConvention osgiConvention=new OsgiPluginConvention((ProjectInternal)project);
  project.getConvention().getPlugins().put("osgi",osgiConvention);
  project.getPlugins().withType(JavaPlugin.class,new Closure<OsgiManifest>(this,this){
    @SuppressWarnings("unused") public OsgiManifest doCall(    JavaPlugin it){
      OsgiManifest osgiManifest=osgiConvention.osgiManifest(new Closure<Void>(OsgiPlugin.this){
        public void doCall(        OsgiManifest manifest){
          manifest.setClassesDir(project.getConvention().getPlugin(JavaPluginConvention.class).getSourceSets().getByName("main").getOutput().getClassesDir());
          manifest.setClasspath(project.getConfigurations().getByName("runtime"));
        }
      }
);
      Jar jarTask=(Jar)project.getTasks().getByName("jar");
      jarTask.setManifest(osgiManifest);
      return osgiManifest;
    }
  }
);
}
