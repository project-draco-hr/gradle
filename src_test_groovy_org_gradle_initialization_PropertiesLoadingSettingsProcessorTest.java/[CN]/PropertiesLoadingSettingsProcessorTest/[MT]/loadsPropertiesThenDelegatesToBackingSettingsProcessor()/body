{
  final SettingsProcessor delegate=context.mock(SettingsProcessor.class);
  final ISettingsFinder settingsFinder=context.mock(ISettingsFinder.class);
  final IGradlePropertiesLoader propertiesLoader=context.mock(IGradlePropertiesLoader.class);
  final StartParameter startParameter=new StartParameter();
  final SettingsInternal settings=context.mock(SettingsInternal.class);
  final File settingsDir=new File("root");
  PropertiesLoadingSettingsProcessor processor=new PropertiesLoadingSettingsProcessor(delegate);
  context.checking(new Expectations(){
{
      allowing(settingsFinder).getSettingsDir();
      will(returnValue(settingsDir));
      one(propertiesLoader).loadProperties(settingsDir,startParameter);
      one(delegate).process(settingsFinder,startParameter,propertiesLoader);
      will(returnValue(settings));
    }
  }
);
  assertThat(processor.process(settingsFinder,startParameter,propertiesLoader),sameInstance(settings));
}
