{
  if (cache == null) {
    loadTasks(task);
  }
  final TaskKey key=new TaskKey(task);
  final TaskInfo thisExecution=getThisExecution(task);
  final TaskExecution lastExecution=getLastExecution(key,thisExecution);
  return new TaskArtifactState(){
    public boolean isUpToDate(){
      List<String> messages=thisExecution.isSameAs(lastExecution);
      if (messages == null || messages.isEmpty()) {
        logger.info("Skipping {} as it is up-to-date.",task);
        return true;
      }
      if (logger.isInfoEnabled()) {
        Formatter formatter=new Formatter();
        formatter.format("Executing %s due to:",task);
        for (        String message : messages) {
          formatter.format("%n%s",message);
        }
        logger.info(formatter.toString());
      }
      return false;
    }
    public void invalidate(){
      for (      File file : thisExecution.outputFiles.keySet()) {
        OutputGenerators generators=cache.get(file);
        generators.remove(key);
        cache.put(file,generators);
      }
    }
    public void update(){
      thisExecution.snapshotOutputFiles();
      for (      Map.Entry<File,OutputFileInfo> entry : thisExecution.outputFiles.entrySet()) {
        OutputGenerators generators=cache.get(entry.getKey());
        generators.update(entry.getValue(),key,thisExecution);
        cache.put(entry.getKey(),generators);
      }
    }
  }
;
}
