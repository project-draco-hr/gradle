{
  Jvm jvm=Jvm.current();
  File jreHome=null;
  if (jvm.getJavaVersion().isJava6Compatible()) {
    jreHome=firstAvailableJRE("15","17");
  }
 else   if (jvm.getJavaVersion().isJava5Compatible()) {
    jreHome=firstAvailableJRE();
  }
  if (jreHome != null) {
    return jreHome;
  }
  if (OperatingSystem.current().isMacOsX()) {
    File registeredJvms=new File("/Library/Java/JavaVirtualMachines");
    if (registeredJvms.isDirectory()) {
      for (      File candidate : registeredJvms.listFiles()) {
        jreHome=GFileUtils.canonicalise(new File(candidate,"Contents/Home/jre"));
        if (!jreHome.equals(jvm.getJavaHome()) && jreHome.isDirectory() && new File(jreHome,"bin/java").isFile()) {
          return jreHome;
        }
      }
    }
  }
 else   if (OperatingSystem.current().isLinux()) {
    File installedJvms=new File("/usr/lib/jvm");
    if (installedJvms.isDirectory()) {
      for (      File candidate : installedJvms.listFiles()) {
        jreHome=new File(GFileUtils.canonicalise(candidate),"jre");
        if (!jreHome.equals(jvm.getJavaHome()) && jreHome.isDirectory() && new File(jreHome,"bin/java").isFile()) {
          return jreHome;
        }
      }
    }
  }
 else   if (OperatingSystem.current().isWindows()) {
    File installedJavas=new File("c:/Program Files/Java");
    File[] files=installedJavas.listFiles();
    for (    File file : files) {
      if (file.getName().startsWith("jre")) {
        if (jvm.getJavaVersion().isJava6() && !file.getName().contains("1.6")) {
          return file;
        }
        if (jvm.getJavaVersion().isJava7() && !file.getName().contains("1.7")) {
          return file;
        }
      }
    }
  }
  return null;
}
