{
  Jvm jvm=Jvm.current();
  File javaHome=null;
  if (jvm.isJava6Compatible()) {
    javaHome=firstAvailable("15","17");
  }
 else   if (jvm.isJava5Compatible()) {
    javaHome=firstAvailable("16","17");
  }
  if (javaHome != null) {
    return javaHome;
  }
  if (OperatingSystem.current().isMacOsX()) {
    File registeredJvms=new File("/Library/Java/JavaVirtualMachines");
    if (registeredJvms.isDirectory()) {
      for (      File candidate : registeredJvms.listFiles()) {
        javaHome=GFileUtils.canonicalise(new File(candidate,"Contents/Home"));
        if (!javaHome.equals(jvm.getJavaHome()) && javaHome.isDirectory() && new File(javaHome,"bin/java").isFile()) {
          return javaHome;
        }
      }
    }
  }
 else   if (OperatingSystem.current().isLinux()) {
    File installedJvms=new File("/usr/lib/jvm");
    if (installedJvms.isDirectory()) {
      for (      File candidate : installedJvms.listFiles()) {
        javaHome=GFileUtils.canonicalise(candidate);
        if (!javaHome.equals(jvm.getJavaHome()) && javaHome.isDirectory() && new File(javaHome,"bin/java").isFile()) {
          return javaHome;
        }
      }
    }
  }
  return null;
}
