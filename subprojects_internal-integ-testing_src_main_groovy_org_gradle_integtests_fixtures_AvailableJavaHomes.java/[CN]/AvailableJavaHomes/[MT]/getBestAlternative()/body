{
  Jvm jvm=Jvm.current();
  File javaHome=null;
  if (jvm.getJavaVersion().isJava6Compatible()) {
    javaHome=firstAvailable("15","17");
  }
 else   if (jvm.getJavaVersion().isJava5Compatible()) {
    javaHome=firstAvailable("16","17");
  }
  if (javaHome != null) {
    return javaHome;
  }
  if (OperatingSystem.current().isMacOsX()) {
    File registeredJvms=new File("/Library/Java/JavaVirtualMachines");
    if (registeredJvms.isDirectory()) {
      for (      File candidate : registeredJvms.listFiles()) {
        javaHome=GFileUtils.canonicalise(new File(candidate,"Contents/Home"));
        if (!javaHome.equals(jvm.getJavaHome()) && javaHome.isDirectory() && new File(javaHome,"bin/java").isFile()) {
          return javaHome;
        }
      }
    }
  }
 else   if (OperatingSystem.current().isLinux()) {
    File installedJvms=new File("/usr/lib/jvm");
    if (installedJvms.isDirectory()) {
      for (      File candidate : installedJvms.listFiles()) {
        javaHome=GFileUtils.canonicalise(candidate);
        if (!javaHome.equals(jvm.getJavaHome()) && javaHome.isDirectory() && new File(javaHome,"bin/java").isFile()) {
          return javaHome;
        }
      }
    }
  }
 else   if (OperatingSystem.current().isWindows()) {
    List<File> installDirs=new ArrayList<File>();
    File candidate=new File("c:/Program Files/Java");
    if (candidate.isDirectory()) {
      installDirs.add(candidate);
    }
    candidate=new File("c:/Program Files (x86)/Java");
    if (candidate.isDirectory()) {
      installDirs.add(candidate);
    }
    for (    File installDir : installDirs) {
      for (      File file : installDir.listFiles()) {
        if (file.getName().startsWith("jdk")) {
          javaHome=GFileUtils.canonicalise(file);
          if (!javaHome.equals(jvm.getJavaHome()) && javaHome.isDirectory() && new File(javaHome,"bin/java.exe").isFile()) {
            return javaHome;
          }
        }
      }
    }
  }
  return null;
}
