{
  buildController.setStartParameter(startParameter);
  GradleInternal gradle=buildController.getGradle();
  if (runTasks) {
    buildController.run();
  }
 else {
    buildController.configure();
    gradle.getServices().get(ProjectConfigurer.class).configureHierarchy(gradle.getRootProject());
    for (    Project project : gradle.getRootProject().getAllprojects()) {
      ProjectInternal projectInternal=(ProjectInternal)project;
      projectInternal.getTasks().discoverTasks();
      projectInternal.bindAllModelRules();
    }
  }
  ToolingModelBuilderRegistry builderRegistry=getToolingModelBuilderRegistry(gradle);
  ToolingModelBuilder builder;
  try {
    builder=builderRegistry.getBuilder(modelName);
  }
 catch (  UnknownModelException e) {
    throw (InternalUnsupportedModelException)new InternalUnsupportedModelException().initCause(e);
  }
  Object result;
  if (builder instanceof ProjectSensitiveToolingModelBuilder) {
    result=((ProjectSensitiveToolingModelBuilder)builder).buildAll(modelName,gradle.getDefaultProject(),true);
  }
 else {
    result=builder.buildAll(modelName,gradle.getDefaultProject());
  }
  PayloadSerializer payloadSerializer=gradle.getServices().get(PayloadSerializer.class);
  return new BuildActionResult(payloadSerializer.serialize(result),null);
}
