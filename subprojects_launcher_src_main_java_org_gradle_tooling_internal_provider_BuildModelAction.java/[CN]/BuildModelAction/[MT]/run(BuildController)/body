{
  DefaultGradleLauncher launcher=(DefaultGradleLauncher)buildController.getLauncher();
  if (runTasks) {
    launcher.addListener(new TasksCompletionListener(){
      public void onTasksFinished(      GradleInternal gradle){
        ToolingModelBuilder builder=getToolingModelBuilderRegistry(gradle).getBuilder(modelName);
        Object result=builder.buildAll(modelName,gradle.getDefaultProject());
        model=getPayloadSerializer(gradle).serialize(result);
      }
    }
);
    buildController.run();
  }
 else {
    launcher.addListener(new ModelConfigurationListener(){
      public void onConfigure(      GradleInternal gradle){
        ensureAllProjectsEvaluated(gradle);
        ToolingModelBuilder builder=getToolingModelBuilderRegistry(gradle).getBuilder(modelName);
        Object result=builder.buildAll(modelName,gradle.getDefaultProject());
        model=getPayloadSerializer(gradle).serialize(result);
      }
    }
);
    buildController.configure();
  }
  return model;
}
