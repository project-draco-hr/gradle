{
  final IoAcceptorFactory ioAcceptorFactory=new ExternalIoAcceptorFactory();
  final PipelineDispatcher pipelineDispatcher=new PipelineDispatcher(pipeline);
  pipeline.setDispatcher(pipelineDispatcher);
  for (  TestControlMessageHandlerFactory messageHandlerFactory : messageHandlerFactories) {
    TestControlMessageHandler messageHandler=messageHandlerFactory.createTestControlMessageHandler(pipelineDispatcher);
    pipelineDispatcher.addMessageHandler(messageHandlerFactory.getMessageClasses(),messageHandler);
  }
  return new DefaultTestControlServer(ioAcceptorFactory,pipelineDispatcher);
}
