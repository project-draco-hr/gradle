{
  final ProjectSourceSet projectSourceSet=extensions.getByType(ProjectSourceSet.class);
  ComponentSpecContainer componentSpecs=extensions.getByType(ComponentSpecContainer.class);
  final ProjectIdentifier projectIdentifier=inputs.get(0,ModelType.of(ProjectIdentifier.class)).getInstance();
  componentSpecs.registerFactory(type,new NamedDomainObjectFactory<V>(){
    public V create(    String name){
      FunctionalSourceSet componentSourceSet=projectSourceSet.maybeCreate(name);
      ComponentSpecIdentifier id=new DefaultComponentSpecIdentifier(projectIdentifier.getPath(),name);
      @SuppressWarnings("unchecked") V created=(V)BaseComponentSpec.create(implementation,id,componentSourceSet,instantiator);
      return created;
    }
  }
);
}
