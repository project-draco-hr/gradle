{
  ModuleDescriptor moduleDescriptor=createAnonymousModuleDescriptor();
  prepareTestsThatRetrieveDependencies(moduleDescriptor);
  prepareResolveReportWithError();
  ResolvedConfiguration configuration=ivyDependencyResolver.resolve(configurationStub,ivyStub,moduleDescriptor);
  assertTrue(configuration.hasError());
  try {
    configuration.rethrowFailure();
    fail();
  }
 catch (  GradleException e) {
    assertThat(e.getMessage(),startsWith("Could not resolve all dependencies for <configuration>"));
  }
}
