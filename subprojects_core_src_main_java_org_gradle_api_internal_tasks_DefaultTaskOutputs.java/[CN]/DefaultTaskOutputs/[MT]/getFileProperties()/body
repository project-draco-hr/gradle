{
  if (fileProperties == null) {
    TaskPropertyUtils.ensurePropertiesHaveNames(filePropertiesInternal);
    final Iterator<BasePropertySpec> rootIterator=filePropertiesInternal.iterator();
    fileProperties=TaskPropertyUtils.collectFileProperties("output",new AbstractIterator<TaskOutputFilePropertySpec>(){
      private Iterator<TaskOutputFilePropertySpec> childIterator;
      @Override protected TaskOutputFilePropertySpec computeNext(){
        while (true) {
          if (childIterator != null) {
            if (childIterator.hasNext()) {
              return childIterator.next();
            }
            childIterator=null;
          }
          if (!rootIterator.hasNext()) {
            return endOfData();
          }
          BasePropertySpec propertySpec=rootIterator.next();
          if (propertySpec instanceof CompositePropertySpec) {
            childIterator=((CompositePropertySpec)propertySpec).iterator();
          }
 else {
            return (TaskOutputFilePropertySpec)propertySpec;
          }
        }
      }
    }
);
  }
  return fileProperties;
}
