{
  FileCollectionSnapshot lastExecutionOutputFiles;
  if (previousExecution == null || previousExecution.getOutputFilesSnapshot() == null) {
    lastExecutionOutputFiles=outputFilesSnapshotter.emptySnapshot();
  }
 else {
    lastExecutionOutputFiles=previousExecution.getOutputFilesSnapshot();
  }
  FileCollectionSnapshot newOutputFiles=lastExecutionOutputFiles.updateFrom(outputFilesBefore);
  FileCollectionSnapshot.PreCheck outputFilesAfterPreCheck=createSnapshotPreCheck(outputFilesSnapshotter,task.getOutputs().getFiles());
  FileCollectionSnapshot outputFilesAfter=createSnapshot(outputFilesSnapshotter,outputFilesAfterPreCheck);
  currentExecution.setOutputFilesSnapshot(outputFilesAfter.applyAllChangesSince(outputFilesBefore,newOutputFiles));
  currentExecution.setOutputFilesHash(outputFilesAfterPreCheck.getHash());
}
