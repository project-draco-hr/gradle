{
  if (working) {
    throw new UnsupportedOperationException("Creating a cache inside a unit of work not supported yet.");
  }
  Factory<BTreePersistentIndexedCache<K,V>> indexedCacheFactory=new Factory<BTreePersistentIndexedCache<K,V>>(){
    public BTreePersistentIndexedCache<K,V> create(){
      return doCreateCache(cacheFile,keyType,valueType);
    }
  }
;
  MultiProcessSafePersistentIndexedCache<K,V> indexedCache=new MultiProcessSafePersistentIndexedCache<K,V>(indexedCacheFactory,fileAccess);
  caches.add(indexedCache);
  return indexedCache;
}
