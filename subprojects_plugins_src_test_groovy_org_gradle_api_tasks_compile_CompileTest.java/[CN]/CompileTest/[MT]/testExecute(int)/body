{
  setUpMocksAndAttributes(compile);
  context.checking(new Expectations(){
{
      WorkResult result=context.mock(WorkResult.class);
      one(compilerMock).setSource(with(hasSameItems(compile.getSource())));
      one(compilerMock).setClasspath(compile.getClasspath());
      one(compilerMock).setDestinationDir(compile.getDestinationDir());
      one(compilerMock).setDependencyCacheDir(compile.getDependencyCacheDir());
      one(compilerMock).setSourceCompatibility(compile.getSourceCompatibility());
      one(compilerMock).setTargetCompatibility(compile.getTargetCompatibility());
      one(compilerMock).execute();
      will(returnValue(result));
      allowing(result).getDidWork();
      will(returnValue(numFilesCompiled > 0));
    }
  }
);
  compile.compile();
}
