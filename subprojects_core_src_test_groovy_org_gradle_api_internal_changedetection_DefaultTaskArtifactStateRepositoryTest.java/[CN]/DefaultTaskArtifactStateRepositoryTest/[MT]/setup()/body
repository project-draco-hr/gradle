{
  CacheRepository cacheRepository=new DefaultCacheRepository(tmpDir.createDir("user-home"),null,CacheUsage.ON,new InMemoryCacheFactory());
  FileSnapshotter inputFilesSnapshotter=new DefaultFileSnapshotter(new DefaultHasher());
  FileSnapshotter outputFilesSnapshotter=new OutputFilesSnapshotter(inputFilesSnapshotter,new RandomLongIdGenerator(),cacheRepository,gradle);
  TaskHistoryRepository taskHistoryRepository=new CacheBackedTaskHistoryRepository(cacheRepository,new CacheBackedFileSnapshotRepository(cacheRepository,gradle),gradle);
  repository=new DefaultTaskArtifactStateRepository(taskHistoryRepository,inputFilesSnapshotter,outputFilesSnapshotter);
}
