{
  context.checking(new Expectations(){
{
      CacheBuilder builder=context.mock(CacheBuilder.class);
      one(cacheRepository).cache("taskArtifacts");
      will(returnValue(builder));
      one(builder).forObject(gradle);
      will(returnValue(builder));
      one(builder).open();
      will(returnValue(persistentCache));
      one(persistentCache).openIndexedCache(with(notNullValue(Serializer.class)));
      will(returnValue(new TestIndexedCache()));
    }
  }
);
}
