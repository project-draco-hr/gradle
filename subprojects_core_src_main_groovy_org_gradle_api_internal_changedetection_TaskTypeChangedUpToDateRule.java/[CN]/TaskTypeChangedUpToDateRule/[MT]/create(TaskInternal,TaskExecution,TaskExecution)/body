{
  final String taskClass=task.getClass().getName();
  return new TaskUpToDateState(){
    public void checkUpToDate(    Collection<String> messages){
      if (!taskClass.equals(previousExecution.getTaskClass())) {
        messages.add(String.format("%s has changed type from '%s' to '%s'.",StringUtils.capitalize(task.toString()),previousExecution.getTaskClass(),task.getClass().getName()));
      }
    }
    public void snapshotBeforeTask(){
      currentExecution.setTaskClass(taskClass);
    }
    public void snapshotAfterTask(){
    }
  }
;
}
