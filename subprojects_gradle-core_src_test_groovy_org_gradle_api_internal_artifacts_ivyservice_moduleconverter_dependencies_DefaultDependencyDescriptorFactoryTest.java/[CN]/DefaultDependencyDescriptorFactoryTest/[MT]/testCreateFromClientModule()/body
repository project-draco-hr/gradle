{
  dependencyDescriptorFactory.setClientModuleDescriptorFactory(context.mock(ClientModuleDescriptorFactory.class));
  final HashMap testModuleRegistry=new HashMap();
  final DefaultClientModule clientModule=(DefaultClientModule)setUpExternalDependency(new DefaultClientModule("org.gradle","gradle-core","1.0",TEST_DEP_CONF));
  final ModuleDependency dependencyDependency=context.mock(ModuleDependency.class,"dependencyDependency");
  clientModule.addDependency(dependencyDependency);
  final ModuleRevisionId testModuleRevisionId=createModuleRevisionIdFromDependency(clientModule,WrapUtil.toMap(ClientModule.CLIENT_MODULE_KEY,clientModule.getId()));
  context.checking(new Expectations(){
{
      allowing(dependencyDescriptorFactory.getClientModuleDescriptorFactory()).createModuleDescriptor(testModuleRevisionId,WrapUtil.toSet(dependencyDependency),dependencyDescriptorFactory,testModuleRegistry);
    }
  }
);
  dependencyDescriptorFactory.addDependencyDescriptor(TEST_CONF,moduleDescriptor,clientModule,testModuleRegistry);
  DefaultDependencyDescriptor dependencyDescriptor=(DefaultDependencyDescriptor)moduleDescriptor.getDependencies()[0];
  assertDependencyDescriptorHasFixtureValuesForExternalDependencies(dependencyDescriptor,testModuleRevisionId);
  assertFalse(dependencyDescriptor.isChanging());
}
