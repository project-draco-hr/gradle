{
  final Factory<AntBuilder> antBuilderFactory=getServices().getFactory(AntBuilder.class);
  JavaCompiler maybeForkingCompiler=new SwitchableJavaCompiler(new CompilerChooser(){
    public JavaCompiler choose(    CompileOptions options){
      if (options.isFork() && !options.getForkOptions().isUseAntForking()) {
        return new ForkingJavaCompiler(((ProjectInternal)getProject()).getServices(),getProject().getProjectDir());
      }
      return new AntJavaCompiler(antBuilderFactory);
    }
  }
);
  javaCompiler=new IncrementalJavaCompiler(maybeForkingCompiler,antBuilderFactory,getOutputs());
}
