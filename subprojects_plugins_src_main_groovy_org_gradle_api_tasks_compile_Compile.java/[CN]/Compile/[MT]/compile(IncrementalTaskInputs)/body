{
  if (!compileOptions.isIncremental()) {
    compile();
    return;
  }
  SingleMessageLogger.incubatingFeatureUsed("Incremental java compilation");
  ClassDependenciesAnalyzer analyzer=new ClassDependenciesAnalyzer();
  ClassDependencyInfoExtractor extractor=new ClassDependencyInfoExtractor(analyzer);
  JarSnapshotCache jarSnapshotCache=new JarSnapshotCache(new File(getProject().getRootProject().getProjectDir(),".gradle/jar-snapshot-cache.bin"));
  JarSnapshotFeeder jarSnapshotFeeder=new JarSnapshotFeeder(jarSnapshotCache,new JarSnapshotter(new ClassSnapshotter(new DefaultHasher(),analyzer)));
  ClassDependencyInfoSerializer dependencyInfoSerializer=new ClassDependencyInfoSerializer(new File(getProject().getBuildDir(),"class-info.bin"));
  IncrementalCompilationSupport incrementalSupport=new IncrementalCompilationSupport(jarSnapshotFeeder,dependencyInfoSerializer,(FileOperations)getProject(),extractor,(CleaningJavaCompiler)cleaningCompiler,getPath());
  Compiler<JavaCompileSpec> compiler=incrementalSupport.prepareCompiler(inputs,new CompilationSourceDirs(source));
  performCompilation(compiler);
}
