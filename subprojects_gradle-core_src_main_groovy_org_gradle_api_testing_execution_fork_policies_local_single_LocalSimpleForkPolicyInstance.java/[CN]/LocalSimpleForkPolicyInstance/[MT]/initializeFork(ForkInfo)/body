{
  final LocalSimpleForkPolicyForkInfo policyInfo=(LocalSimpleForkPolicyForkInfo)forkInfo.getForkPolicyInfo();
  final Pipeline pipeline=forkInfo.getPipeline();
  final NativeTest testTask=pipeline.getTestTask();
  final int pipelineId=pipeline.getId();
  final Project project=testTask.getProject();
  final TestFrameworkInstance testFramework=testTask.getTestFramework();
  final int forkId=forkControl.getNextForkId();
  final ForkConfigWriter forkConfigWriter=new ForkConfigWriter(testTask,pipelineId,forkId,controlServerPort);
  final File forkConfigFile=forkConfigWriter.writeConfigFile();
  final ExecHandleBuilder forkHandleBuilder=new ExecHandleBuilder(false).execDirectory(project.getRootDir()).execCommand("java");
  testFramework.applyForkJvmArguments(forkHandleBuilder);
  forkHandleBuilder.arguments("-cp",System.getProperty("gradle.fork.launcher.cp"),"org.gradle.api.testing.execution.fork.ForkLaunchMain",forkConfigFile.getAbsolutePath(),"org.gradle.api.testing.execution.control.client.TestForkExecuter");
  testFramework.applyForkArguments(forkHandleBuilder);
  policyInfo.setForkHandleBuilder(forkHandleBuilder);
}
