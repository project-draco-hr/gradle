{
  StringBuilder message=new StringBuilder();
  if (loggingEvent.getMarker() == Logging.PROGRESS_STARTED) {
    if (atEndOfLine) {
      message.append(EOL);
    }
    message.append(loggingEvent.getFormattedMessage());
    atEndOfLine=true;
    needTrailingSpace=true;
  }
 else   if (loggingEvent.getMarker() == Logging.PROGRESS) {
    if (atEndOfLine && needTrailingSpace) {
      message.append(" ");
    }
    message.append(".");
    atEndOfLine=true;
    needTrailingSpace=false;
  }
 else   if (loggingEvent.getMarker() == Logging.PROGRESS_COMPLETE) {
    message.append(loggingEvent.getFormattedMessage());
    if (!atEndOfLine && message.length() == 0) {
      return null;
    }
    if (message.length() > 0) {
      message.insert(0," ");
    }
    message.append(EOL);
    atEndOfLine=false;
    needTrailingSpace=false;
  }
 else {
    if (atEndOfLine) {
      message.append(EOL);
    }
    message.append(super.doLayout(loggingEvent));
    atEndOfLine=false;
    needTrailingSpace=false;
  }
  return message.toString();
}
