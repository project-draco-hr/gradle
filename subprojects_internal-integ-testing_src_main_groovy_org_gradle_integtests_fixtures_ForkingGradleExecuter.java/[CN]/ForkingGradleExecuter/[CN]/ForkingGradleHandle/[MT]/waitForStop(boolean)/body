{
  ExecHandle execHandle=getExecHandle();
  ExecResult execResult=execHandle.waitForFinish();
  execResult.rethrowFailure();
  String output=getStandardOutput();
  String error=getErrorOutput();
  boolean didFail=execResult.getExitValue() != 0;
  if (didFail != expectFailure) {
    String message=String.format("Gradle execution %s in %s with: %s",expectFailure ? "did not fail" : "failed",execHandle.getDirectory(),execHandle.getCommand());
    throw new RuntimeException(message);
  }
  return expectFailure ? toExecutionFailure(output,error) : toExecutionResult(output,error);
}
