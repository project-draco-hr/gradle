{
  ExecHandle execHandle=getExecHandle();
  ExecResult execResult=execHandle.waitForFinish();
  execResult.rethrowFailure();
  String output=getStandardOutput();
  String error=getErrorOutput();
  LOG.info("OUTPUT: " + output);
  LOG.info("ERROR: " + error);
  boolean didFail=execResult.getExitValue() != 0;
  if (didFail != expectFailure) {
    String message=String.format("Gradle execution %s in %s with: %s %nOutput:%n%s%nError:%n%s%n-----%n",expectFailure ? "did not fail" : "failed",execHandle.getDirectory(),execHandle.getCommand(),output,error);
    System.out.println(message);
    throw new RuntimeException(message);
  }
  return expectFailure ? toExecutionFailure(output,error) : toExecutionResult(output,error);
}
