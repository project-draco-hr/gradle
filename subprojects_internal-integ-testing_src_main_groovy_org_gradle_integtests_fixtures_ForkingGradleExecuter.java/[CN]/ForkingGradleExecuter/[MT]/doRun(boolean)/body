{
  ExecHandleBuilder builder=createExecHandleBuilder();
  ByteArrayOutputStream outStream=new ByteArrayOutputStream();
  ByteArrayOutputStream errStream=new ByteArrayOutputStream();
  builder.setStandardOutput(outStream);
  builder.setErrorOutput(errStream);
  ExecHandle proc=builder.build();
  int exitValue=proc.start().waitForFinish().getExitValue();
  String output=outStream.toString();
  String error=errStream.toString();
  boolean failed=exitValue != 0;
  LOG.info("OUTPUT: " + output);
  LOG.info("ERROR: " + error);
  if (failed != expectFailure) {
    String message=String.format("Gradle execution %s in %s with: %s %nOutput:%n%s%nError:%n%s%n-----%n",expectFailure ? "did not fail" : "failed",proc.getDirectory(),proc.getCommand(),output,error);
    System.out.println(message);
    throw new RuntimeException(message);
  }
  return new GradleOutput(output,error);
}
