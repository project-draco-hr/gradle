{
  buffer.flip();
  while (buffer.remaining() > 0) {
    selector.select();
    if (!selector.isOpen()) {
      throw new EOFException();
    }
    socket.write(buffer);
  }
  buffer.clear();
}
