{
  Map<String,FileSnapshot> snapshots=new LinkedHashMap<String,FileSnapshot>();
  for (  File file : sourceFiles.getAsFileTree()) {
    if (file.isFile()) {
      snapshots.put(file.getAbsolutePath(),new FileHashSnapshot(hasher.hash(file)));
    }
 else     if (file.isDirectory()) {
      snapshots.put(file.getAbsolutePath(),new DirSnapshot());
    }
 else {
      snapshots.put(file.getAbsolutePath(),new MissingFileSnapshot());
    }
  }
  return new FileCollectionSnapshotImpl(snapshots);
}
