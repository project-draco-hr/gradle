{
  if (effectiveLocalClassLoader == null) {
    if (locked) {
      if (local.isEmpty() && export.isEmpty()) {
        effectiveLocalClassLoader=parent.getExportClassLoader();
        effectiveExportClassLoader=parent.getExportClassLoader();
      }
 else       if (export.isEmpty()) {
        effectiveLocalClassLoader=buildLockedLoader(local);
        effectiveExportClassLoader=parent.getExportClassLoader();
      }
 else       if (local.isEmpty()) {
        effectiveLocalClassLoader=buildLockedLoader(export);
        effectiveExportClassLoader=effectiveLocalClassLoader;
      }
 else {
        effectiveExportClassLoader=buildLockedLoader(export);
        effectiveLocalClassLoader=buildLockedLoader(effectiveExportClassLoader,local);
      }
    }
 else {
      if (Boolean.getBoolean(STRICT_MODE_PROPERTY)) {
        throw new IllegalStateException("Attempt to define scope class loader before scope is locked");
      }
      exportingClassLoader=buildOpenLoader(parent.getExportClassLoader(),export);
      effectiveExportClassLoader=new CachingClassLoader(exportingClassLoader);
      localClassLoader=buildOpenLoader(effectiveExportClassLoader,local);
      effectiveLocalClassLoader=new CachingClassLoader(localClassLoader);
    }
    export=null;
    local=null;
  }
}
