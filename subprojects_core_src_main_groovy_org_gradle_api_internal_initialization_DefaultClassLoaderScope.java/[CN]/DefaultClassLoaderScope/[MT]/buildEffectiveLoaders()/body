{
  if (effectiveLocalClassLoader == null) {
    if (locked) {
      if (local.isEmpty() && export.isEmpty()) {
        classLoaderCache.remove(id.localId());
        classLoaderCache.remove(id.exportId());
        effectiveLocalClassLoader=parent.getExportClassLoader();
        effectiveExportClassLoader=parent.getExportClassLoader();
      }
 else       if (export.isEmpty()) {
        classLoaderCache.remove(id.exportId());
        effectiveLocalClassLoader=buildLockedLoader(id.localId(),local);
        effectiveExportClassLoader=parent.getExportClassLoader();
      }
 else       if (local.isEmpty()) {
        classLoaderCache.remove(id.localId());
        effectiveLocalClassLoader=buildLockedLoader(id.exportId(),export);
        effectiveExportClassLoader=effectiveLocalClassLoader;
      }
 else {
        effectiveExportClassLoader=buildLockedLoader(id.exportId(),export);
        effectiveLocalClassLoader=buildLockedLoader(id.localId(),effectiveExportClassLoader,local);
      }
    }
 else {
      if (Boolean.getBoolean(STRICT_MODE_PROPERTY)) {
        throw new IllegalStateException("Attempt to define scope class loader before scope is locked");
      }
      exportingClassLoader=new MultiParentClassLoader(parent.getExportClassLoader(),loader(id.exportId(),export));
      effectiveExportClassLoader=new CachingClassLoader(exportingClassLoader);
      localClassLoader=new MultiParentClassLoader(effectiveExportClassLoader,loader(id.localId(),local));
      effectiveLocalClassLoader=new CachingClassLoader(localClassLoader);
    }
    export=null;
    local=null;
  }
}
