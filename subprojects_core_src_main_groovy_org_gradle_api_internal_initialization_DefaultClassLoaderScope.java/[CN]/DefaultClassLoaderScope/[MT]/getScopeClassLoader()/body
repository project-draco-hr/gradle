{
  if (scopeClassLoader == null) {
    if (locked) {
      if (local == null && exportingClassLoader == null) {
        scopeClassLoader=parent.getChildClassLoader();
        childrenParent=scopeClassLoader;
      }
 else       if (exportingClassLoader == null) {
        localClassLoader=new MultiParentClassLoader(parent.getChildClassLoader());
        scopeClassLoader=new CachingClassLoader(localClassLoader);
        childrenParent=parent.getChildClassLoader();
      }
 else       if (local == null) {
        scopeClassLoader=exportingClassLoader;
        childrenParent=scopeClassLoader;
      }
 else {
        createFlexibleLoaderStructure();
      }
    }
 else {
      if (Boolean.getBoolean(STRICT_MODE_PROPERTY)) {
        throw new IllegalStateException("Attempt to define scope class loader before scope is locked");
      }
      createFlexibleLoaderStructure();
    }
    if (local != null) {
      for (      ClassLoader localClassLoader : local) {
        addLocal(localClassLoader);
      }
    }
  }
  return scopeClassLoader;
}
