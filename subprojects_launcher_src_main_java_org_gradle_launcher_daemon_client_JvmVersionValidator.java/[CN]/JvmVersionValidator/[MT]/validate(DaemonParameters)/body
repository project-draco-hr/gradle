{
  if (parameters.getEffectiveJavaHome().equals(Jvm.current().getJavaHome())) {
    return;
  }
  ByteArrayOutputStream outputStream=new ByteArrayOutputStream();
  ExecHandleBuilder builder=new ExecHandleBuilder();
  builder.setWorkingDir(new File(".").getAbsolutePath());
  builder.setCommandLine(parameters.getEffectiveJavaExecutable(),"-version");
  builder.setStandardOutput(new ByteArrayOutputStream());
  builder.setErrorOutput(outputStream);
  builder.build().start().waitForFinish().assertNormalExitValue();
  JavaVersion javaVersion=parse(new BufferedReader(new InputStreamReader(new ByteArrayInputStream(outputStream.toByteArray()))));
  if (!javaVersion.isJava6Compatible()) {
    throw new GradleException(String.format("%s requires Java 6 or later to run. Your build is currently configured to use Java %s.",GradleVersion.current(),javaVersion.getMajorVersion()));
  }
}
