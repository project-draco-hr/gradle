{
  File buildDir=project.getRootDir();
  ProjectComponentRegistry projectComponentProvider=project.getServices().get(ProjectComponentRegistry.class);
  ProjectComponentIdentifier originalIdentifier=DefaultProjectComponentIdentifier.newId(project.getPath());
  DefaultLocalComponentMetadata originalComponent=(DefaultLocalComponentMetadata)projectComponentProvider.getProject(originalIdentifier);
  ProjectComponentIdentifier componentIdentifier=new DefaultProjectComponentIdentifier(createExternalProjectPath(buildName,project.getPath()));
  LocalComponentMetadata compositeComponent=createCompositeCopy(buildName,componentIdentifier,originalComponent,buildDir);
  context.register(compositeComponent.getId().getModule(),componentIdentifier,compositeComponent,project.getProjectDir());
  for (  ComponentArtifactMetadata artifactMetaData : projectComponentProvider.getAdditionalArtifacts(originalIdentifier)) {
    context.registerAdditionalArtifact(componentIdentifier,createCompositeCopy(componentIdentifier,artifactMetaData,buildDir));
  }
}
