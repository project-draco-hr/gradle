{
  if (hasBeenClosed) {
    throw new IOException("The stream has been closed.");
  }
  if (count == buf.length) {
    final int newBufLength=buf.length + bufferIncrement;
    final byte[] newBuf=new byte[newBufLength];
    System.arraycopy(buf,0,newBuf,0,buf.length);
    buf=newBuf;
  }
  buf[count]=(byte)b;
  count++;
  if (endsWithLineSeparator()) {
    flush();
  }
}
