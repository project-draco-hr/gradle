{
  DefaultModuleRegistry registry=new DefaultModuleRegistry();
  Set<File> bootstrapClasspath=new LinkedHashSet<File>();
  bootstrapClasspath.addAll(registry.getModule("gradle-launcher").getImplementationClasspath());
  if (registry.getGradleHome() == null) {
    bootstrapClasspath.addAll(registry.getFullClasspath());
  }
  if (bootstrapClasspath.isEmpty()) {
    throw new IllegalStateException("Unable to construct a bootstrap classpath when starting the daemon");
  }
  List<String> daemonArgs=new ArrayList<String>();
  daemonArgs.add(Jvm.current().getJavaExecutable().getAbsolutePath());
  daemonArgs.add("-Xmx1024m");
  daemonArgs.add("-XX:MaxPermSize=256m");
  daemonArgs.add("-XX:MaxPermSize=256m");
  daemonArgs.add("-cp");
  daemonArgs.add(GUtil.join(bootstrapClasspath,File.pathSeparator));
  daemonArgs.add(GradleDaemon.class.getName());
  daemonArgs.add(String.format("-D%s=%s",DaemonDir.SYSTEM_PROPERTY_KEY,daemonDir.getBaseDir().getAbsolutePath()));
  DaemonIdleTimeout idleTimeout=new DaemonIdleTimeout(System.getenv("GRADLE_OPTS"),this.idleTimeout);
  daemonArgs.add(idleTimeout.toSysArg());
  startProcess(daemonArgs,daemonDir.getVersionedDir());
}
