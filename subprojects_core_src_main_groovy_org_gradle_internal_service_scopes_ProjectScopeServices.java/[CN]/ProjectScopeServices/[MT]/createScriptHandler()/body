{
  ScriptHandlerFactory factory=new DefaultScriptHandlerFactory(get(DependencyManagementServices.class),get(FileResolver.class),get(DependencyMetaDataProvider.class));
  ScriptCompileScope parentScope;
  if (project.getParent() != null) {
    parentScope=project.getParent().getServices().get(ScriptCompileScope.class);
  }
 else {
    parentScope=get(BuildClassLoaderRegistry.class).getRootCompileScope();
  }
  return factory.create(project.getBuildScriptSource(),parentScope,project);
}
