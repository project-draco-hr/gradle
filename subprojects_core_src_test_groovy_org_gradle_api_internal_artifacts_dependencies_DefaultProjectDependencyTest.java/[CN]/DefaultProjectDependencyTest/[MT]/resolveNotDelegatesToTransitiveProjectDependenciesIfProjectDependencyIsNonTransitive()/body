{
  final DependencyResolveContext resolveContext=context.mock(DependencyResolveContext.class);
  final SelfResolvingDependency projectSelfResolvingDependency=context.mock(SelfResolvingDependency.class);
  final ProjectDependency transitiveProjectDependencyStub=context.mock(ProjectDependency.class);
  context.checking(new Expectations(){
{
      allowing(projectConfigurationsStub).getByName("conf1");
      will(returnValue(projectConfigurationStub));
      allowing(projectConfigurationStub).getAllDependencies();
      will(returnValue(toSet(projectSelfResolvingDependency,transitiveProjectDependencyStub)));
      one(resolveContext).add(projectSelfResolvingDependency);
    }
  }
);
  DefaultProjectDependency projectDependency=new DefaultProjectDependency(dependencyProjectStub,"conf1",instruction);
  projectDependency.setTransitive(false);
  projectDependency.resolve(resolveContext);
}
