{
  MutableModuleComponentResolveMetadata mutableMetadata=metadata.asMutable();
  ComponentMetadataDetails details=instantiator.newInstance(ComponentMetadataDetailsAdapter.class,mutableMetadata);
  processAllRules(mutableMetadata,details);
  if (!mutableMetadata.getStatusScheme().contains(mutableMetadata.getStatus())) {
    throw new ModuleVersionResolveException(mutableMetadata.getId(),String.format("Unexpected status '%s' specified for %s. Expected one of: %s",mutableMetadata.getStatus(),mutableMetadata.getComponentId().getDisplayName(),mutableMetadata.getStatusScheme()));
  }
  return mutableMetadata;
}
