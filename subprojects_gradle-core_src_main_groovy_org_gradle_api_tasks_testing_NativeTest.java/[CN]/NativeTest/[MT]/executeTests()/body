{
  final File testClassesDir=getTestClassesDir();
  if (testClassesDir == null)   throw new InvalidUserDataException("The testClassesDir property is not set, testing can't be triggered!");
  if (getTestResultsDir() == null)   throw new InvalidUserDataException("The testResultsDir property is not set, testing can't be triggered!");
  existingDirsFilter.checkExistenceAndThrowStopActionIfNot(testClassesDir);
  final TestOrchestrator orchestrator=new TestOrchestrator(this);
  orchestrator.execute();
  if (stopAtFailuresOrErrors && GUtil.isTrue(getProject().getAnt().getProject().getProperty(FAILURES_OR_ERRORS_PROPERTY))) {
    if (testReport)     throw new GradleException("There were failing tests. See the report at " + getTestReportDir() + ".");
 else     throw new GradleException("There were failing tests.");
  }
}
