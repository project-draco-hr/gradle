{
  resolver.resolveArtifacts(contextInternal,repositories,metadataHandler,results);
  ResolvedConfiguration resolvedConfiguration=results.getResolvedConfiguration();
  Configuration configuration=(Configuration)contextInternal;
  Set<Dependency> dependencies=configuration.getAllDependencies();
  CachingDependencyResolveContext resolveContext=new CachingDependencyResolveContext(configuration.isTransitive());
  SelfResolvingFilesProvider provider=new SelfResolvingFilesProvider(resolveContext,dependencies);
  results.withResolvedConfiguration(new FilesAggregatingResolvedConfiguration(resolvedConfiguration,provider));
}
