{
  Set<Artifact> allArtifacts=getAllArtifacts(moduleDescriptor);
  Map<Artifact,File> artifactsFiles=new LinkedHashMap<Artifact,File>();
  for (  Artifact artifact : allArtifacts) {
    addPublishedArtifact(artifact,artifactsFiles);
  }
  if (descriptorFile != null) {
    addPublishedDescriptor(artifactsFiles);
  }
  boolean successfullyPublished=false;
  try {
    boolean overwrite=true;
    resolver.beginPublishTransaction(moduleDescriptor.getModuleRevisionId(),overwrite);
    for (    Map.Entry<Artifact,File> entry : artifactsFiles.entrySet()) {
      Artifact artifact=entry.getKey();
      File artifactFile=entry.getValue();
      publish(artifact,artifactFile,resolver,overwrite);
    }
    resolver.commitPublishTransaction();
    successfullyPublished=true;
  }
  finally {
    if (!successfullyPublished) {
      resolver.abortPublishTransaction();
    }
  }
}
