{
  TaskExecution thisExecution=history.getCurrentExecution();
  TaskExecution lastExecution=history.getPreviousExecution();
  noHistoryState=NoHistoryStateChangeRule.create(task,lastExecution);
  taskTypeState=TaskTypeStateChangeRule.create(task,lastExecution,thisExecution);
  inputPropertiesState=InputPropertiesStateChangeRule.create(task,lastExecution,thisExecution);
  outputFilesState=caching(OutputFilesStateChangeRule.create(task,lastExecution,thisExecution,outputFilesSnapshotter));
  FileCollectionSnapshot inputFilesSnapshot=inputFilesSnapshotter.snapshot(task.getInputs().getFiles());
  this.inputFilesSnapshot=inputFilesSnapshot.getSnapshot();
  inputFilesState=caching(InputFilesStateChangeRule.create(lastExecution,thisExecution,inputFilesSnapshot));
  allTaskChanges=new SummaryTaskStateChanges(MAX_OUT_OF_DATE_MESSAGES,noHistoryState,taskTypeState,inputPropertiesState,outputFilesState,inputFilesState);
  rebuildChanges=new SummaryTaskStateChanges(1,noHistoryState,taskTypeState,inputPropertiesState,outputFilesState);
}
