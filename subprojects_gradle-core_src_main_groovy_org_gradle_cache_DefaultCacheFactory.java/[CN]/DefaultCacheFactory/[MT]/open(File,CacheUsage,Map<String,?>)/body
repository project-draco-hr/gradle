{
  File canonicalDir=GFileUtils.canonicalise(cacheDir);
  DefaultPersistentDirectoryCache cache=openCaches.get(canonicalDir);
  if (cache == null) {
    cache=new DefaultPersistentDirectoryCache(canonicalDir,usage,properties);
    openCaches.put(canonicalDir,cache);
  }
 else {
    if (!properties.equals(cache.getProperties())) {
      throw new UnsupportedOperationException("Cache is already open with different state.");
    }
  }
  return cache;
}
