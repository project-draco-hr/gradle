{
  Properties originalSystemProperties=new Properties();
  originalSystemProperties.putAll(System.getProperties());
  Properties clientSystemProperties=new Properties();
  clientSystemProperties.putAll(build.getParameters().getSystemProperties());
  System.setProperties(clientSystemProperties);
  LenientEnvHacker envHacker=new LenientEnvHacker();
  Map<String,String> originalEnv=System.getenv();
  envHacker.setenv(build.getParameters().getEnvVariables());
  envHacker.setProcessDir(build.getParameters().getCurrentDir().getAbsolutePath());
  try {
    return executer.execute(build.getAction(),build.getParameters());
  }
  finally {
    System.setProperties(originalSystemProperties);
    envHacker.setenv(originalEnv);
  }
}
