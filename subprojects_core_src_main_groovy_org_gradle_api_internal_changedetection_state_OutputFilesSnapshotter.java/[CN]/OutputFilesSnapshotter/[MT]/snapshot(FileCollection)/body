{
  Map<String,Long> snapshotDirIds=new HashMap<String,Long>();
  for (  File file : files) {
    Long dirId;
    if (file.exists()) {
      dirId=dirIdentiferCache.get(file.getAbsolutePath());
      if (dirId == null) {
        dirId=idGenerator.generateId();
        dirIdentiferCache.put(file.getAbsolutePath(),dirId);
      }
    }
 else {
      dirIdentiferCache.remove(file.getAbsolutePath());
      dirId=null;
    }
    snapshotDirIds.put(file.getAbsolutePath(),dirId);
  }
  return new OutputFilesSnapshot(snapshotDirIds,snapshotter.snapshot(files));
}
