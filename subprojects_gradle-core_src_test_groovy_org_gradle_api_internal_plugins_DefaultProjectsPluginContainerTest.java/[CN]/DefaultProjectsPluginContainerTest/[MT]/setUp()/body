{
  context.checking(new Expectations(){
{
      allowing(pluginRegistryStub).getTypeForId(pluginId);
      will(returnValue(TestPlugin1.class));
      allowing(pluginRegistryStub).getNameForType(TestPlugin1.class);
      will(returnValue(pluginId));
      allowing(pluginRegistryStub).loadPlugin(TestPlugin1.class);
      will(returnValue(pluginWithIdMock));
      allowing(pluginRegistryStub).loadPlugin(TestPlugin2.class);
      will(returnValue(pluginWithoutIdMock));
      allowing(pluginRegistryStub).getNameForType(TestPlugin2.class);
      will(returnValue(TestPlugin2.class.getName()));
    }
  }
);
}
