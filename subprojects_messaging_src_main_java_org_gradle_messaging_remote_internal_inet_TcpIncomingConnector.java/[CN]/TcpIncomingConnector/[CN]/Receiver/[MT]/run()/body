{
  try {
    try {
      while (true) {
        final SocketChannel socket=serverSocket.accept();
        InetSocketAddress remoteSocketAddress=(InetSocketAddress)socket.socket().getRemoteSocketAddress();
        InetAddress remoteInetAddress=remoteSocketAddress.getAddress();
        if (!allowRemote && !addressFactory.isLocal(remoteInetAddress)) {
          LOGGER.error("Cannot accept connection from remote address {}.",remoteInetAddress);
          socket.close();
          continue;
        }
        LOGGER.debug("Accepted connection from {} to {}.",socket.socket().getRemoteSocketAddress(),socket.socket().getLocalSocketAddress());
        action.execute(new ConnectCompletion(){
          public <T>Connection<T> create(          ClassLoader messageClassLoader){
            return new SocketConnection<T>(socket,new DefaultMessageSerializer<T>(messageClassLoader));
          }
          public <T>Connection<T> create(          MessageSerializer<T> serializer){
            return new SocketConnection<T>(socket,serializer);
          }
        }
);
      }
    }
 catch (    ClosedChannelException e) {
    }
catch (    Exception e) {
      LOGGER.error("Could not accept remote connection.",e);
    }
  }
  finally {
    CompositeStoppable.stoppable(serverSocket).stop();
  }
}
