{
  if (args.length < 4) {
    invalidArgs("Following arguments are required: <gradle-version> <daemon-dir> <timeout-millis> <daemonUid> <optional startup jvm opts>");
  }
  File daemonBaseDir=new File(args[1]);
  int idleTimeoutMs=0;
  try {
    idleTimeoutMs=Integer.parseInt(args[2]);
  }
 catch (  NumberFormatException e) {
    invalidArgs("Second argument must be a whole number (i.e. daemon idle timeout in ms)");
  }
  String daemonUid=args[3];
  List<String> startupOpts=new ArrayList<String>(args.length - 4);
  for (int i=4; i < args.length; i++) {
    startupOpts.add(args[i]);
  }
  LOGGER.debug("Assuming the daemon was started with following jvm opts: {}",startupOpts);
  NativeServices.initialize(daemonBaseDir);
  DaemonServerConfiguration parameters=new DefaultDaemonServerConfiguration(daemonUid,daemonBaseDir,idleTimeoutMs,startupOpts);
  LoggingServiceRegistry loggingRegistry=LoggingServiceRegistry.newCommandLineProcessLogging();
  LoggingManagerInternal loggingManager=loggingRegistry.newInstance(LoggingManagerInternal.class);
  DaemonServices daemonServices=new DaemonServices(parameters,loggingRegistry,loggingManager);
  File daemonLog=daemonServices.getDaemonLogFile();
  initialiseLogging(loggingManager,daemonLog);
  Daemon daemon=daemonServices.get(Daemon.class);
  daemon.start();
  try {
    DaemonContext daemonContext=daemonServices.get(DaemonContext.class);
    Long pid=daemonContext.getPid();
    daemonStarted(pid,daemon.getUid(),daemon.getAddress(),daemonLog);
    daemon.requestStopOnIdleTimeout(parameters.getIdleTimeout(),TimeUnit.MILLISECONDS);
  }
  finally {
    daemon.stop();
  }
}
