{
  StartParameter startParameter=new DefaultCommandLineConverter().convert(Arrays.asList(args));
  redirectOutputsAndInput(startParameter);
  LoggingServiceRegistry loggingServices=LoggingServiceRegistry.newChildProcessLogging();
  DaemonServerConnector connector=new DaemonTcpServerConnector();
  File registryDir=startParameter.getGradleUserHomeDir();
  DaemonRegistry daemonRegistry=new PersistentDaemonRegistry(registryDir);
  int idleTimeout=getIdleTimeout(startParameter);
  float idleTimeoutSecs=idleTimeout / 1000;
  LOGGER.lifecycle("Starting daemon (at {}) with settings: idleTimeout = {} secs, registryDir = {}",new Date(),idleTimeoutSecs,registryDir);
  Daemon daemon=new Daemon(connector,daemonRegistry,new DefaultDaemonCommandExecuter(loggingServices));
  daemon.start();
  boolean wasStopped=daemon.awaitStopOrIdleTimeout(idleTimeout);
  if (wasStopped) {
    LOGGER.info("Daemon stopping due to stop request");
  }
 else {
    LOGGER.info("Daemon hit idle timeout (" + idleTimeoutSecs + " secs), stopping");
    daemon.stop();
  }
}
