{
  if (message instanceof ChannelMessage) {
    ChannelMessage channelMessage=(ChannelMessage)message;
    getChannel(channelMessage.getChannel()).queue(channelMessage);
  }
 else   if (message.isBroadcast()) {
    for (    MultiEndPointQueue queue : channels.values()) {
      queue.queue(message);
    }
  }
 else {
    throw new IllegalArgumentException(String.format("Don't know how to route message %s",message));
  }
}
