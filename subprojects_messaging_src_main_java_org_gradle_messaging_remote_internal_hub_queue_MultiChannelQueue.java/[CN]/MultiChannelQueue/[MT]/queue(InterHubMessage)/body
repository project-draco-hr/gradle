{
switch (message.getDelivery()) {
case Stateful:
    mostRecentStateful=message;
case AllHandlers:
  for (  MultiEndPointQueue queue : channels.values()) {
    queue.queue(message);
  }
break;
case SingleHandler:
if (message instanceof Routable) {
Routable routableMessage=(Routable)message;
getChannel(routableMessage.getChannel()).queue(message);
}
 else {
throw new IllegalArgumentException(String.format("Don't know how to route message %s.",message));
}
break;
default :
throw new IllegalArgumentException("Unknown delivery type: " + message.getDelivery());
}
}
