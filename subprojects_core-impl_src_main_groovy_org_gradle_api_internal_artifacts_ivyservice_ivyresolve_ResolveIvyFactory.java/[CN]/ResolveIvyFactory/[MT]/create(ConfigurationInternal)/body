{
  UserResolverChain userResolverChain=new UserResolverChain();
  ResolutionRules resolutionRules=configuration.getResolutionStrategy().getResolutionRules();
  resolveModeOverride.overrideCachePolicy(resolutionRules);
  LoopbackDependencyResolver loopbackDependencyResolver=new LoopbackDependencyResolver(SettingsConverter.LOOPBACK_RESOLVER_NAME,userResolverChain,cacheLockingManager);
  List<DependencyResolver> rawResolvers=resolverProvider.getResolvers();
  IvySettings ivySettings=settingsConverter.convertForResolve(loopbackDependencyResolver,rawResolvers);
  Ivy ivy=ivyFactory.createIvy(ivySettings);
  ResolveData resolveData=createResolveData(ivy,configuration.getName());
  IvyContextualiser contextualiser=new IvyContextualiser(ivy,resolveData);
  for (  DependencyResolver rawResolver : rawResolvers) {
    String resolverId=new WharfResolverMetadata(rawResolver).getId();
    CacheLockingDependencyResolver cacheLockingResolver=new CacheLockingDependencyResolver(rawResolver,cacheLockingManager);
    cacheLockingResolver.setSettings(ivySettings);
    ModuleVersionRepository moduleVersionRepository=new DependencyResolverAdapter(resolverId,cacheLockingResolver);
    moduleVersionRepository=resolveModeOverride.overrideModuleVersionRepository(moduleVersionRepository);
    ModuleVersionRepository cachingRepository=new CachingModuleVersionRepository(moduleVersionRepository,moduleResolutionCache,moduleDescriptorCache,artifactResolutionCache,configuration.getResolutionStrategy().getCachePolicy());
    ModuleVersionRepository ivyContextualisedRepository=contextualiser.contextualise(ModuleVersionRepository.class,cachingRepository);
    userResolverChain.add(ivyContextualisedRepository);
  }
  return new DefaultIvyAdapter(resolveData,userResolverChain);
}
