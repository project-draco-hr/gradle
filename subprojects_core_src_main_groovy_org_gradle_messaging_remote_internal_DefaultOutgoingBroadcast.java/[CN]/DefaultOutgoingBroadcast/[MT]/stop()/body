{
  CompositeStoppable stoppable=new CompositeStoppable();
  lock.lock();
  try {
    stoppable.add(hub).add(discoveryBroadcast).add(executors).stop();
  }
  finally {
    executors.clear();
    connections.clear();
    lock.unlock();
  }
  stoppable.stop();
}
