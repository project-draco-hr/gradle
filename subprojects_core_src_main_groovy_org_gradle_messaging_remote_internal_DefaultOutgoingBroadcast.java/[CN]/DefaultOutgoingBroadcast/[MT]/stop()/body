{
  CompositeStoppable stoppable=new CompositeStoppable();
  lock.lock();
  try {
    stoppable.add(hub).add(discoveryBroadcast).add(executor);
  }
  finally {
    connections.clear();
    lock.unlock();
  }
  stoppable.stop();
}
