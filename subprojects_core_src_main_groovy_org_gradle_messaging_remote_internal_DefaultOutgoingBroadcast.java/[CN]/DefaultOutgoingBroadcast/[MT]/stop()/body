{
  CompositeStoppable stoppable=new CompositeStoppable();
  lock.lock();
  try {
    stoppable.add(hub,discoveryBroadcast,executor);
  }
  finally {
    connections.clear();
    lock.unlock();
  }
  stoppable.stop();
}
