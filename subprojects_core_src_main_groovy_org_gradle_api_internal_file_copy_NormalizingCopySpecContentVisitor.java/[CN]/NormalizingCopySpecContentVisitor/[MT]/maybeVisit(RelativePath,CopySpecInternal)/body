{
  if (path == null || path.getParent() == null || !visitedDirs.add(path)) {
    return;
  }
  maybeVisit(path.getParent(),copySpec);
  List<FileCopyDetailsInternal> detailsForPath=pendingDirs.removeAll(path);
  FileCopyDetailsInternal dir;
  if (detailsForPath.isEmpty()) {
    dir=new StubbedFileCopyDetails(path,copySpec);
  }
 else {
    dir=detailsForPath.get(0);
  }
  getVisitor().visit(dir);
}
