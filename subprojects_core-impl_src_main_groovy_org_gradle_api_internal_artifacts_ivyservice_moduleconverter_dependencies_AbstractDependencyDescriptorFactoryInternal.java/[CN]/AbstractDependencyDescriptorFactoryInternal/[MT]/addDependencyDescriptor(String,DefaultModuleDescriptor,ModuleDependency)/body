{
  ModuleRevisionId moduleRevisionId=createModuleRevisionId(dependency);
  DependencyDescriptor newDescriptor=createDependencyDescriptor(dependency,configuration,moduleDescriptor,moduleRevisionId);
  DefaultDependencyDescriptor matchingDependencyDescriptor=findMatchingDescriptorForSameConfiguration(moduleDescriptor,newDescriptor);
  if (matchingDependencyDescriptor != null) {
    mergeDescriptors(configuration,matchingDependencyDescriptor,newDescriptor,dependency);
    return;
  }
  moduleDescriptor.addDependency(newDescriptor);
}
