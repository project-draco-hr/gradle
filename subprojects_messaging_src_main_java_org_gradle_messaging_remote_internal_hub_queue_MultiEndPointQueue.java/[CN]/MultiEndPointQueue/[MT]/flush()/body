{
  EndPointQueue selected=waiting.isEmpty() ? null : waiting.get(0);
  while (!queue.isEmpty()) {
    InterHubMessage message=queue.get(0);
    if (message.isBroadcast()) {
      System.out.println(String.format("=== %s broadcasting: %s",this,message));
      for (      EndPointQueue endpoint : endpoints) {
        endpoint.put(message);
      }
      queue.remove(0);
      waiting.clear();
      continue;
    }
    if (selected == null) {
      System.out.println(String.format("=== %s nothing waiting for: %s",this,message));
      break;
    }
    System.out.println(String.format("=== %s unicasting: %s",this,message));
    queue.remove(0);
    waiting.remove(selected);
    selected.put(message);
  }
}
