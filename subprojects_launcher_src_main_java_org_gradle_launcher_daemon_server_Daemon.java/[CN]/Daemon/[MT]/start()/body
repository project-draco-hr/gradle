{
  LOGGER.info("start() called on daemon - {}",daemonContext);
  lifecyleLock.lock();
  try {
    if (stateCoordinator != null) {
      throw new IllegalStateException("cannot start daemon as it is already running");
    }
    registryUpdater=new DomainRegistryUpdater(daemonRegistry,daemonContext,password);
    Runnable onStart=new Runnable(){
      public void run(){
      }
    }
;
    Runnable onStartCommand=new Runnable(){
      public void run(){
        registryUpdater.onStartActivity();
      }
    }
;
    Runnable onFinishCommand=new Runnable(){
      public void run(){
        registryUpdater.onCompleteActivity();
      }
    }
;
    Runnable onStop=new Runnable(){
      public void run(){
        LOGGER.info("Daemon is stopping accepting new connections...");
        connector.stop();
      }
    }
;
    Runnable onStopRequested=new Runnable(){
      public void run(){
        LOGGER.info(DaemonMessages.REMOVING_PRESENCE_DUE_TO_STOP);
        registryUpdater.onStop();
      }
    }
;
    stateCoordinator=new DaemonStateCoordinator(workers,onStart,onStartCommand,onFinishCommand,onStop,onStopRequested);
    stateCoordinator.start();
    connectorAddress=connector.start(new DefaultIncomingConnectionHandler(commandExecuter,workers,daemonContext,stateCoordinator));
    LOGGER.debug("Daemon starting at: " + new Date() + ", with address: "+ connectorAddress);
    registryUpdater.onStart(connectorAddress);
  }
  finally {
    lifecyleLock.unlock();
  }
}
