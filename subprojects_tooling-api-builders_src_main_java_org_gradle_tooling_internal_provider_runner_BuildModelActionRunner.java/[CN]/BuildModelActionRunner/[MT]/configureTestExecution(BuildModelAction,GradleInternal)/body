{
  final TestConfiguration testConfiguration=buildModelAction.getTestConfiguration();
  final List<String> taskNames=new ArrayList<String>();
  if (testConfiguration != null) {
    gradle.addProjectEvaluationListener(new ProjectEvaluationListener(){
      @Override public void beforeEvaluate(      Project project){
      }
      @Override public void afterEvaluate(      Project project,      ProjectState state){
        TaskCollection<Test> testTaskCollection=project.getTasks().withType(Test.class);
        String[] includePatterns=testConfiguration.getIncludePatterns();
        String[] excludePatterns=testConfiguration.getExcludePatterns();
        if (excludePatterns.length > 0) {
          throw new UnsupportedOperationException("Excludes are not supported yet");
        }
        for (        Test test : testTaskCollection) {
          taskNames.add(test.getName());
          gradle.getStartParameter().setTaskNames(taskNames);
          test.getFilter().setIncludePatterns(includePatterns);
        }
      }
    }
);
  }
}
