{
  Clock clock=new Clock();
  GFileUtils.deleteDirectory(scriptCacheDir);
  scriptCacheDir.mkdirs();
  CompilerConfiguration configuration=createBaseCompilerConfiguration(scriptBaseClass);
  configuration.setTargetDirectory(scriptCacheDir);
  CompilationUnit unit=new CompilationUnit(configuration,null,new GroovyClassLoader(classLoader));
  unit.addSource(scriptName,new ByteArrayInputStream(scriptText == null ? new byte[0] : scriptText.getBytes()));
  try {
    unit.compile();
  }
 catch (  CompilationFailedException e) {
    throw new GradleException(e);
  }
  logger.debug("Timing: Writing script to cache at {} took: {}",scriptCacheDir.getAbsolutePath(),clock.getTime());
  if (unit.getClasses().isEmpty()) {
    return new EmptyScript();
  }
  return loadFromCache(0,classLoader,scriptName,scriptCacheDir,scriptBaseClass);
}
