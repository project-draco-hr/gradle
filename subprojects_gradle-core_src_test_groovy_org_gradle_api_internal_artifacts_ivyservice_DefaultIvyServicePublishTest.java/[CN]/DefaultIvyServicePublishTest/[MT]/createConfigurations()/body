{
  final Configuration configurationStub1=context.mock(Configuration.class,"confStub1");
  final Configuration configurationStub2=context.mock(Configuration.class,"confStub2");
  context.checking(new Expectations(){
{
      allowing(configurationStub1).getName();
      will(returnValue("conf1"));
      allowing(configurationStub1).getHierarchy();
      will(returnValue(WrapUtil.toLinkedSet(configurationStub1)));
      allowing(configurationStub1).getAll();
      will(returnValue(WrapUtil.toLinkedSet(configurationStub1,configurationStub2)));
      allowing(configurationStub2).getName();
      will(returnValue("conf2"));
      allowing(configurationStub2).getHierarchy();
      will(returnValue(WrapUtil.toLinkedSet(configurationStub2)));
      allowing(configurationStub2).getAll();
      will(returnValue(WrapUtil.toLinkedSet(configurationStub1,configurationStub2)));
    }
  }
);
  return WrapUtil.toSet(configurationStub1,configurationStub2);
}
