{
  if (scalaOptions.isUseAnt()) {
    Compiler<ScalaCompileSpec> scalaCompiler=new AntScalaCompiler(antBuilder);
    Compiler<JavaCompileSpec> javaCompiler=new AntJavaCompiler(antBuilderFactory);
    return new DefaultScalaJavaJointCompiler(scalaCompiler,javaCompiler);
  }
  Compiler<ScalaJavaJointCompileSpec> scalaCompiler=new ApiScalaCompiler();
  CompilerDaemonFactory daemonFactory;
  if (scalaOptions.isFork()) {
    daemonFactory=CompilerDaemonManager.getInstance();
  }
 else {
    daemonFactory=InProcessCompilerDaemonFactory.getInstance();
  }
  scalaCompiler=new DaemonScalaCompiler(project,scalaCompiler,daemonFactory);
  return new NormalizingScalaCompiler(scalaCompiler);
}
