{
  ScalaCompileOptions scalaOptions=spec.getScalaCompileOptions();
  if (scalaOptions.isUseAnt()) {
    Compiler<ScalaCompileSpec> scalaCompiler=new AntScalaCompiler(antBuilder);
    Compiler<JavaCompileSpec> javaCompiler=javaCompilerFactory.createForJointCompilation(spec.getCompileOptions());
    return new NormalizingScalaCompiler(new DefaultScalaJavaJointCompiler(scalaCompiler,javaCompiler));
  }
  if (!scalaOptions.isFork()) {
    throw new GradleException("The Zinc based Scala compiler ('scalaCompileOptions.useAnt=false') " + "requires forking ('scalaCompileOptions.fork=true'), but the latter is set to 'false'.");
  }
  Compiler<ScalaJavaJointCompileSpec> scalaCompiler;
  try {
    scalaCompiler=(Compiler<ScalaJavaJointCompileSpec>)getClass().getClassLoader().loadClass("org.gradle.api.internal.tasks.scala.jdk6.ZincScalaCompiler").newInstance();
  }
 catch (  Exception e) {
    throw new RuntimeException("Internal error: Failed to load org.gradle.api.internal.tasks.scala.jdk6.ZincScalaCompiler",e);
  }
  scalaCompiler=new DaemonScalaCompiler(project.getRootProject().getProjectDir(),scalaCompiler,compilerDaemonFactory);
  return new NormalizingScalaCompiler(scalaCompiler);
}
