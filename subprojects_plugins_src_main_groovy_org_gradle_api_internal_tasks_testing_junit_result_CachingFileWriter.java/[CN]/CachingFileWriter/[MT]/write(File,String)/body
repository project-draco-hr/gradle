{
  DataOutputStream out=null;
  try {
    if (openFiles.containsKey(file)) {
      out=openFiles.get(file);
    }
 else {
      out=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(file,true)));
      openFiles.put(file,out);
      if (openFiles.size() > openFilesCount) {
        Iterator<Map.Entry<File,DataOutputStream>> iterator=openFiles.entrySet().iterator();
        close(iterator.next().getValue(),file.toString());
        iterator.remove();
      }
    }
    out.writeUTF(text);
  }
 catch (  IOException e) {
    IOUtils.closeQuietly(out);
    throw new RuntimeException("Problems writing to file: " + file,e);
  }
}
