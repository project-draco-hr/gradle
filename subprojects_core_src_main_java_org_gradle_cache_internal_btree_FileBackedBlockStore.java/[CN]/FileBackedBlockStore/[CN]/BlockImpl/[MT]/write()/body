{
  long pos=getPos().getPos();
  DataOutputStream outputStream=output.start(pos);
  BlockPayload payload=getPayload();
  outputStream.writeByte(BLOCK_MARKER);
  outputStream.writeByte(payload.getType());
  outputStream.writeInt(payloadSize);
  long finalSize=pos + HEADER_SIZE + TAIL_SIZE+ payloadSize;
  payload.write(outputStream);
  outputStream.writeLong(output.getBytesWritten());
  output.done();
  if (currentFileSize < finalSize) {
    file.setLength(finalSize);
    currentFileSize=finalSize;
  }
}
