{
  ClassLoader classLoader=targetClass.getClassLoader();
  Short id=classLoaderIds.get(classLoader);
  if (id != null) {
    return id;
  }
  if (classLoaderIds.size() == Short.MAX_VALUE) {
    throw new UnsupportedOperationException();
  }
  ClassLoaderDetails details=classLoaderRegistry.getDetails(classLoader);
  id=(short)(classLoaderIds.size() + SYSTEM_CLASS_LOADER_ID + 1);
  classLoaderIds.put(classLoader,id);
  classLoaderDetails.put(id,details);
  return id;
}
