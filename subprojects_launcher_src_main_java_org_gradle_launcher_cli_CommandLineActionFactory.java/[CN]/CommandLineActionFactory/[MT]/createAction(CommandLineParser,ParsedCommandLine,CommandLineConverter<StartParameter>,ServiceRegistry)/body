{
  if (commandLine.hasOption(HELP)) {
    return new ActionAdapter(new ShowUsageAction(parser));
  }
  if (commandLine.hasOption(VERSION)) {
    return new ActionAdapter(new ShowVersionAction());
  }
  if (commandLine.hasOption(GUI)) {
    return new ActionAdapter(new ShowGuiAction());
  }
  final StartParameter startParameter=new StartParameter();
  startParameterConverter.convert(commandLine,startParameter);
  DaemonParameters daemonParameters=constructDaemonParameters(startParameter);
  if (commandLine.hasOption(FOREGROUND)) {
    ForegroundDaemonConfiguration conf=new ForegroundDaemonConfiguration(daemonParameters.getUid(),daemonParameters.getBaseDir(),daemonParameters.getIdleTimeout());
    return new ActionAdapter(new ForegroundDaemonMain(conf));
  }
  DaemonClientServices clientServices=new DaemonClientServices(loggingServices,daemonParameters,System.in);
  if (commandLine.hasOption(STOP)) {
    return stopAllDaemons(clientServices);
  }
  if (useDaemon(commandLine,daemonParameters)) {
    return runBuildWithDaemon(commandLine,daemonParameters,clientServices);
  }
  if (canUseCurrentProcess(daemonParameters)) {
    return runBuildInProcess(loggingServices,startParameter);
  }
  return runBuildInSingleUseDaemon(commandLine,daemonParameters,clientServices);
}
