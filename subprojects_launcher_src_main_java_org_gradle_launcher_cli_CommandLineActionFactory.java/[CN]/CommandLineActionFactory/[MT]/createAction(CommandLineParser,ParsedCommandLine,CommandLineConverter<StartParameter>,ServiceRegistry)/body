{
  if (commandLine.hasOption(HELP)) {
    return new ActionAdapter(new ShowUsageAction(parser));
  }
  if (commandLine.hasOption(VERSION)) {
    return new ActionAdapter(new ShowVersionAction());
  }
  if (commandLine.hasOption(GUI)) {
    return new ActionAdapter(new ShowGuiAction());
  }
  final StartParameter startParameter=new StartParameter();
  startParameterConverter.convert(commandLine,startParameter);
  DaemonConnector connector=new ExternalDaemonConnector(startParameter.getGradleUserHomeDir());
  GradleLauncherMetaData clientMetaData=clientMetaData();
  long startTime=ManagementFactory.getRuntimeMXBean().getStartTime();
  DaemonClient client=new DaemonClient(connector,clientMetaData,loggingServices.get(OutputEventListener.class));
  if (commandLine.hasOption(FOREGROUND)) {
    return new ActionAdapter(new DaemonMain(startParameter));
  }
  if (commandLine.hasOption(STOP)) {
    return new ActionAdapter(new StopDaemonAction(client));
  }
  boolean useDaemon=System.getProperty("org.gradle.daemon","false").equals("true");
  useDaemon=useDaemon || commandLine.hasOption(DAEMON);
  useDaemon=useDaemon && !commandLine.hasOption(NO_DAEMON);
  if (useDaemon) {
    return new ActionAdapter(new DaemonBuildAction(client,commandLine,new File(System.getProperty("user.dir")),clientMetaData,startTime,System.getProperties(),System.getenv()));
  }
  return new RunBuildAction(startParameter,loggingServices,new DefaultBuildRequestMetaData(clientMetaData,startTime));
}
