{
  Clock clock=new Clock();
  GFileUtils.deleteDirectory(scriptCacheDir);
  scriptCacheDir.mkdirs();
  CompilerConfiguration configuration=createBaseCompilerConfiguration(scriptBaseClass);
  configuration.setTargetDirectory(scriptCacheDir);
  CompilationUnit unit=new CompilationUnit(configuration,null,new GroovyClassLoader(classLoader));
  String scriptName=source.getClassName();
  String scriptText=source.getText();
  unit.addSource(scriptName,new ByteArrayInputStream(scriptText == null ? new byte[0] : scriptText.getBytes()));
  try {
    unit.compile();
  }
 catch (  MultipleCompilationErrorsException e) {
    throw new GradleScriptException(String.format("Could not compile %s.",source.getDisplayName()),e,source,e.getErrorCollector().getSyntaxError(0).getLine());
  }
catch (  CompilationFailedException e) {
    throw new GradleException(String.format("Could not compile %s.",source.getDisplayName()),e);
  }
  boolean emptyScript=false;
  if (unit.getClasses().isEmpty()) {
    emptyScript=true;
  }
  cachePropertiesHandler.writeProperties(scriptText,scriptCacheDir,emptyScript);
  logger.debug("Timing: Writing script to cache at {} took: {}",scriptCacheDir.getAbsolutePath(),clock.getTime());
}
