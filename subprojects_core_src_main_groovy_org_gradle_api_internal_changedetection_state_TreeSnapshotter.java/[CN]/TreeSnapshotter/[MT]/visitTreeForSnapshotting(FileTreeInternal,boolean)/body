{
  if (isDirectoryFileTree(fileTree)) {
    DirectoryFileTree directoryFileTree=DirectoryFileTree.class.cast(((FileTreeAdapter)fileTree).getTree());
    if (isEmptyPattern(directoryFileTree.getPatterns())) {
      final String absolutePath=directoryFileTree.getDir().getAbsolutePath();
      Collection<? extends FileVisitDetails> cachedTree=allowReuse ? cachedTrees.get(absolutePath) : null;
      if (cachedTree != null) {
        return cachedTree;
      }
 else {
        cachedTree=doVisitTree(fileTree);
        cachedTrees.put(absolutePath,cachedTree);
        return cachedTree;
      }
    }
  }
  return doVisitTree(fileTree);
}
