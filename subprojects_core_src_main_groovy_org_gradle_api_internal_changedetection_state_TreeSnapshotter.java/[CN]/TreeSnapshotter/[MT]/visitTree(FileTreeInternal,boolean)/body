{
  if (isDirectoryFileTree(fileTree)) {
    DirectoryFileTree directoryFileTree=DirectoryFileTree.class.cast(((FileTreeAdapter)fileTree).getTree());
    if (isEmptyPattern(directoryFileTree.getPatterns())) {
      final String absolutePath=directoryFileTree.getDir().getAbsolutePath();
      Collection<? extends FileVisitDetails> cachedTree=cachedTrees.get(absolutePath);
      if (cachedTree != null) {
        return cachedTree;
      }
 else {
        cachedTree=doVisitTree(fileTree);
        Collection<? extends FileVisitDetails> previous=cachedTrees.putIfAbsent(absolutePath,cachedTree);
        return previous != null ? previous : cachedTree;
      }
    }
  }
  return doVisitTree(fileTree);
}
