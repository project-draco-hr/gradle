{
  ModuleVersionSelector requested=dependency.getRequested();
  Collection<SpecRuleAction<? super ComponentSelection>> rules=componentSelectionRules.getRules();
  for (  Versioned candidate : sortLatestFirst(versions)) {
    ModuleComponentIdentifier candidateIdentifier=DefaultModuleComponentIdentifier.newId(requested.getGroup(),requested.getName(),candidate.getVersion());
    MetaDataSupplier metaDataSupplier=new MetaDataSupplier(dependency,candidateIdentifier,moduleAccess);
    if (!versionMatches(requested,candidateIdentifier,metaDataSupplier)) {
      continue;
    }
    if (isRejectedByRules(candidateIdentifier,rules,metaDataSupplier)) {
      if (versionMatcher.matchesUniqueVersion(requested.getVersion())) {
        break;
      }
 else {
        continue;
      }
    }
    return candidateIdentifier;
  }
  return null;
}
