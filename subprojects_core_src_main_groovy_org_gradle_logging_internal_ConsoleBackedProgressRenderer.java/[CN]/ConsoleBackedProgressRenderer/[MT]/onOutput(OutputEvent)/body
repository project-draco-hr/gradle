{
synchronized (lock) {
    queue.add(newEvent);
    if (newEvent instanceof FlushToOutputsEvent) {
      drain(timeProvider.getCurrentTime());
      return;
    }
    if (queue.size() > 1) {
      return;
    }
    long now=timeProvider.getCurrentTime();
    if (now - lastUpdate >= throttleMs) {
      drain(now);
      return;
    }
    executor.schedule(new Runnable(){
      @Override public void run(){
synchronized (lock) {
          drain(timeProvider.getCurrentTime());
        }
      }
    }
,throttleMs,TimeUnit.MILLISECONDS);
  }
}
