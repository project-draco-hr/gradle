{
  testTasks.all(new Action<Test>(){
    @Override public void execute(    Test test){
      UnionFileCollection testClasspath=new UnionFileCollection(test.getClasspath());
      Set<? extends Task> tasks=test.getTaskDependencies().getDependencies(test);
      for (      Task task : tasks) {
        if (task instanceof PlatformJavaCompile) {
          FileCollection cp=((PlatformJavaCompile)task).getClasspath();
          if (cp != null) {
            testClasspath.add(cp);
          }
        }
      }
      test.setClasspath(testClasspath);
    }
  }
);
}
