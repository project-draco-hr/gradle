{
  if (message instanceof EndOfStreamEvent) {
    eosReceived=true;
    if (eosSent) {
      context.stopped();
    }
 else {
      eosSent=true;
      context.dispatchOutgoing(new EndOfStreamEvent());
    }
    action.run();
    return;
  }
  context.dispatchIncoming(message);
}
