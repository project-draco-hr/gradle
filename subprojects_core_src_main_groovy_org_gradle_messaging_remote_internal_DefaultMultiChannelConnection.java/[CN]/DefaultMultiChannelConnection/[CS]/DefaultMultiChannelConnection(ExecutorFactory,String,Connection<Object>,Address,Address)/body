{
  this.connection=connection;
  this.executor=executorFactory.create(displayName);
  this.sourceAddress=sourceAddress;
  this.destinationAddress=destinationAddress;
  Dispatch<Object> outgoing=connection;
  Receive<Object> incoming=new EndOfStreamReceive(connection);
  Protocol<Object> endOfStream=new EndOfStreamHandshakeProtocol(new Runnable(){
    public void run(){
      requestStop();
    }
  }
);
  Protocol<Object> channel=new ChannelMultiplexProtocol();
  failureHandler=new DiscardingFailureHandler<Object>(LoggerFactory.getLogger(DefaultMultiChannelConnector.class));
  stack=new ProtocolStack<Object>(outgoing,incoming,executor,failureHandler,failureHandler,failureHandler,endOfStream,channel);
  incomingDemux=new IncomingDemultiplex(executor);
  stack.receiveOn(incomingDemux);
}
