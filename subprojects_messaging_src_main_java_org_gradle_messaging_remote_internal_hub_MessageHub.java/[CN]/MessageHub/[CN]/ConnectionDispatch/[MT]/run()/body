{
  List<Object> messages=new ArrayList<Object>();
  while (true) {
    lock.lock();
    try {
      outgoingQueue.take(messages);
    }
  finally {
      lock.unlock();
    }
    for (    Object message : messages) {
      if (message == END_OF_STREAM) {
        return;
      }
      InterHubMessage channelMessage=(InterHubMessage)message;
      try {
        connection.dispatch(channelMessage);
      }
 catch (      Throwable t) {
        errorHandler.execute(t);
        return;
      }
    }
    messages.clear();
  }
}
