{
  lock.lock();
  try {
    assertRunning("add handler");
    RejectedMessageListener rejectedMessageListener;
    if (handler instanceof RejectedMessageListener) {
      rejectedMessageListener=(RejectedMessageListener)handler;
    }
 else {
      rejectedMessageListener=DISCARD;
    }
    Dispatch<Object> dispatch;
    if (handler instanceof Dispatch) {
      dispatch=(Dispatch)handler;
    }
 else {
      dispatch=DISCARD;
    }
    HubStateListener stateListener;
    if (handler instanceof HubStateListener) {
      stateListener=(HubStateListener)handler;
    }
 else {
      stateListener=DISCARD;
    }
    ChannelIdentifier identifier=new ChannelIdentifier(channelName);
    EndPointQueue queue=incomingQueue.getChannel(identifier).newEndpoint();
    workers.execute(new Handler(queue,dispatch,rejectedMessageListener,stateListener));
  }
  finally {
    lock.unlock();
  }
}
