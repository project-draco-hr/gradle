{
  lock.lock();
  try {
    assertRunning("add handler");
    if (!(handler instanceof RejectedMessageListener)) {
      return;
    }
    RejectedMessageListener listener=(RejectedMessageListener)handler;
    EndpointQueue queue=new EndpointQueue(lock.newCondition());
    outgoingQueue.addIncomingHandler(queue);
    workers.execute(new Handler(new ChannelIdentifier(channelName),queue,listener));
  }
  finally {
    lock.unlock();
  }
}
