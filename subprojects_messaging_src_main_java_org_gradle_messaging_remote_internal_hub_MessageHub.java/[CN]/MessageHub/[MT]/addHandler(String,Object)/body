{
  lock.lock();
  try {
    assertRunning("add handler");
    RejectedMessageListener listener;
    if (handler instanceof RejectedMessageListener) {
      listener=(RejectedMessageListener)handler;
    }
 else {
      listener=DISCARD;
    }
    Dispatch<Object> dispatch;
    if (handler instanceof Dispatch) {
      dispatch=(Dispatch)handler;
    }
 else {
      dispatch=DISCARD;
    }
    ChannelIdentifier identifier=new ChannelIdentifier(channelName);
    EndPointQueue queue=incomingQueue.getChannel(identifier).newEndpoint();
    workers.execute(new Handler(queue,dispatch,listener));
  }
  finally {
    lock.unlock();
  }
}
