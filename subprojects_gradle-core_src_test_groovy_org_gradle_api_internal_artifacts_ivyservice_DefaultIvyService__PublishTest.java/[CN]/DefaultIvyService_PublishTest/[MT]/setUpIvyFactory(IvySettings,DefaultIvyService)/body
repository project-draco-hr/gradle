{
  final IvyFactory ivyFactoryStub=context.mock(IvyFactory.class);
  final Ivy ivyStub=context.mock(Ivy.class);
  context.checking(new Expectations(){
{
      allowing(ivyFactoryStub).createIvy(ivySettingsDummy);
      will(returnValue(ivyStub));
      allowing(ivyStub).getSettings();
      will(returnValue(ivySettingsDummy));
    }
  }
);
  ivyService.setIvyFactory(ivyFactoryStub);
  return ivyStub;
}
