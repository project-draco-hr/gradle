{
  final ScriptSource expectedScriptSource=new FileScriptSource("build file",testBuildScriptFile);
  context.checking(new Expectations(){
{
      allowing(testProject).getBuildScriptClassLoader();
      will(returnValue(expectedClassloader));
      allowing(testProject).getRootDir();
      will(returnValue(testProjectDir));
      allowing(testProject).getProjectDir();
      will(returnValue(testProjectDir));
      allowing(testProject).getBuildFileName();
      will(returnValue(TEST_BUILD_FILE_NAME));
      one(scriptProcessorMock).createScript(with(new ScriptSourceMatcher(expectedScriptSource)),with(same(expectedClassloader)),with(equal(ProjectScript.class)));
      will(returnValue(expectedScript));
      one(projectScriptMetaDataMock).applyMetaData(expectedScript,testProject);
    }
  }
);
  buildScriptProcessor.createScript(testProject);
}
