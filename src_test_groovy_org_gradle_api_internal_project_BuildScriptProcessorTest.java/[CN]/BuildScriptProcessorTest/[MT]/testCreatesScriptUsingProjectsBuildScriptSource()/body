{
  final ScriptSource expectedScriptSource=new ImportsScriptSource(scriptSource,importsReaderMock,testProjectDir);
  context.checking(new Expectations(){
{
      allowing(testProject).getBuildScriptSource();
      will(returnValue(scriptSource));
      allowing(testProject).getBuildScriptClassLoader();
      will(returnValue(expectedClassloader));
      allowing(testProject).getRootDir();
      will(returnValue(testProjectDir));
      one(scriptProcessorMock).createScript(with(Matchers.reflectionEquals(expectedScriptSource)),with(same(expectedClassloader)),with(equal(ProjectScript.class)));
      will(returnValue(expectedScript));
      one(projectScriptMetaDataMock).applyMetaData(expectedScript,testProject);
    }
  }
);
  buildScriptProcessor.createScript(testProject);
}
