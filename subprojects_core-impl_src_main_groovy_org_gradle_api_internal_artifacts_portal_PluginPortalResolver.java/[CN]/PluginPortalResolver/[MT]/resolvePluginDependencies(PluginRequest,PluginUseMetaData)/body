{
  if (!metadata.implementationType.equals("M2_JAR")) {
    throw new GradleException("Unsupported plugin implementation type: " + metadata.implementationType);
  }
  ResolverResults results=new ResolverResults();
  MavenArtifactRepository repository=repositoryFactory.createMavenRepository();
  repository.setUrl(metadata.implementation.get("repo"));
  Dependency dependency=dependencyHandler.create(metadata.implementation.get("gav"));
  ConfigurationInternal configuration=(ConfigurationInternal)configurationContainer.detachedConfiguration(dependency);
  try {
    resolver.resolve(configuration,Collections.singletonList((ResolutionAwareRepository)repository),new NoopMetadataProcessor(),results);
    Set<File> files=results.getResolvedConfiguration().getFiles(Specs.satisfyAll());
    return new DefaultClassPath(files);
  }
 catch (  ResolveException e) {
    throw new FailedPluginRequestException(pluginRequest,"Failed to resolve plugin module dependencies.",e);
  }
}
