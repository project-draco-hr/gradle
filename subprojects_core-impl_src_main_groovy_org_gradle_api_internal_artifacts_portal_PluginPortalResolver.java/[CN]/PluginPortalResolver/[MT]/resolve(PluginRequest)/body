{
  RepositoryTransport transport=transportFactory.createTransport(ImmutableSet.of("http"),"Plugin Portal",new DefaultPasswordCredentials());
  pluginRequest=applyTestSettings(pluginRequest);
  String requestUrl=String.format(portalUrl + REQUEST_URL,GradleVersion.current().getVersion(),pluginRequest.getId(),pluginRequest.getVersion());
  URI requestUri=toUri(requestUrl);
  PluginUseMetaData metaData=queryPluginMetadata(transport,pluginRequest,requestUri);
  ClassPath classPath=resolvePluginClassPath(metaData);
  return new ClassPathPluginResolution(instantiator,pluginRequest.getId(),Factories.constant(classPath));
}
