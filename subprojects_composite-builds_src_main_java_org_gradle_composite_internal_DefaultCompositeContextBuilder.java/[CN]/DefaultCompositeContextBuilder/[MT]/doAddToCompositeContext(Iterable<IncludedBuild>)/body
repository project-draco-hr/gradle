{
  CompositeBuildContext context=sharedServices.get(CompositeBuildContext.class);
  for (  IncludedBuild build : includedBuilds) {
    IncludedBuildInternal buildInternal=(IncludedBuildInternal)build;
    StartParameter includedBuildStartParam=buildStartParam.newBuild();
    includedBuildStartParam.setProjectDir(build.getProjectDir());
    includedBuildStartParam.setSearchUpwards(false);
    includedBuildStartParam.setConfigureOnDemand(false);
    DependencySubstitutionsInternal substitutions=((IncludedBuildInternal)build).resolveDependencySubstitutions();
    if (!substitutions.hasRules()) {
      configureBuildToDetermineSubstitutions(buildInternal,context,includedBuildStartParam);
    }
 else {
      context.registerBuild(((IncludedBuildInternal)build).getName(),build);
      context.registerSubstitution(substitutions.getRuleAction());
    }
  }
}
