{
  try {
    final int pipelineId=Integer.parseInt(arguments.get(0));
    final int forkId=Integer.parseInt(arguments.get(1));
    final int testServerPort=Integer.parseInt(arguments.get(2));
    final IoConnectorFactory ioConnectorFactory=new ExternalIoConnectorFactory(testServerPort);
    final DefaultTestControlClient testControlClient=new DefaultTestControlClient(forkId,ioConnectorFactory,testControlMessageQueue);
    try {
      testControlClient.open();
      testControlClient.reportStarted();
      final TestControlMessageDispatcher testControlMessageDispatcher=new TestControlMessageDispatcher(testControlClient,sandboxClassLoader);
      final TestControlMessageQueueConsumer controlMessageConsumer=new TestControlMessageQueueConsumer(testControlMessageQueue,100L,TimeUnit.MILLISECONDS,testControlMessageDispatcher);
      Thread controlMessageConsumerThread=new Thread(controlMessageConsumer);
      controlMessageConsumerThread.start();
      ThreadUtils.join(controlMessageConsumerThread);
      testControlClient.reportStopped();
    }
  finally {
      testControlClient.close();
    }
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
}
