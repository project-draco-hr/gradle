{
  project.getTasks().withType(ScalaCompile.class).allTasks(new Action<ScalaCompile>(){
    public void execute(    ScalaCompile compile){
      compile.setClasspath(project.getConfigurations().getByName(COMPILE_CONFIGURATION_NAME));
      compile.getConventionMapping().map(DefaultConventionsToPropertiesMapping.COMPILE);
      compile.conventionMapping("scalaSrcDirs",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return scala(convention).getScalaSrcDirs();
        }
      }
);
      compile.setDependsOn(WrapUtil.toSet(SCALA_DEFINE_TASK_NAME));
      addDependsOnProjectDependencies(compile,COMPILE_CONFIGURATION_NAME);
    }
  }
);
  project.getTasks().replace(COMPILE_TASK_NAME,ScalaCompile.class).setDescription("Compiles the Scala source code.");
}
