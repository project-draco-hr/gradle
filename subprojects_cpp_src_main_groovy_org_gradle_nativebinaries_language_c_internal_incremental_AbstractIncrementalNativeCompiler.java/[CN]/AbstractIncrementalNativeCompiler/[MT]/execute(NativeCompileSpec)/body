{
  final PersistentCache cache=openCache(task);
  try {
    return cache.useCache("incremental compile",new Factory<WorkResult>(){
      public WorkResult create(){
        IncrementalCompileProcessor processor=createProcessor(includes,cache);
        return doIncrementalCompile(processor,spec);
      }
    }
);
  }
  finally {
    if (cache instanceof ReferencablePersistentCache) {
      ((ReferencablePersistentCache)cache).close();
    }
  }
}
