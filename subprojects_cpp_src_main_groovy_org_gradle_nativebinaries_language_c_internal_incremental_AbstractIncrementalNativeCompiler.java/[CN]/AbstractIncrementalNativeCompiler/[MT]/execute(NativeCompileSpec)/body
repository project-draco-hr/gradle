{
  final AtomicReference<WorkResult> result=new AtomicReference<WorkResult>();
  final PersistentCache cache=openCache(task);
  try {
    cache.useCache("incremental compile",new Runnable(){
      public void run(){
        final IncrementalCompileProcessor processor=createProcessor(includes,cache);
        result.set(doIncrementalCompile(processor,spec));
      }
    }
);
  }
  finally {
    if (cache instanceof ReferencablePersistentCache) {
      ((ReferencablePersistentCache)cache).close();
    }
  }
  return result.get();
}
