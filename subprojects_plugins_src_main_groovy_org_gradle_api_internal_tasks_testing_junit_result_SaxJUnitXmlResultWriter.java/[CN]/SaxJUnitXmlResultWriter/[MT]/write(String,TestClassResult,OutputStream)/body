{
  OutputStreamWriter sw=null;
  try {
    sw=new OutputStreamWriter(output,"UTF-8");
    SimpleXmlWriter writer=new SimpleXmlWriter(sw);
    writer.writeXmlDeclaration("UTF-8","1.0");
    writer.writeCharacters("\n  ");
    writer.writeStartElement(new SimpleXmlWriter.Element("testsuite").attribute("name",className).attribute("tests",String.valueOf(result.getTestsCount())).attribute("failures",String.valueOf(result.getFailuresCount())).attribute("errors","0").attribute("timestamp",DateUtils.format(result.getStartTime(),DateUtils.ISO8601_DATETIME_PATTERN)).attribute("hostname",hostName).attribute("time",String.valueOf(result.getDuration() / 1000.0)));
    writer.writeCharacters("\n  ");
    writer.writeEmptyElement("properties");
    writeTests(writer,result.getResults(),className);
    writer.writeCharacters("\n  ");
    writer.writeStartElement("system-out");
    writer.writeCDATA(testResultsProvider.getOutputs(className,TestOutputEvent.Destination.StdOut));
    writer.writeEndElement();
    writer.writeCharacters("\n  ");
    writer.writeStartElement("system-err");
    writer.writeCDATA(testResultsProvider.getOutputs(className,TestOutputEvent.Destination.StdErr));
    writer.writeEndElement();
    writer.writeCharacters("\n");
    writer.writeEndElement();
    sw.close();
  }
 catch (  IOException e) {
    throw new RuntimeException("Problems writing the XML results for class: " + className,e);
  }
 finally {
    closeQuietly(sw);
  }
}
