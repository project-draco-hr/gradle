{
  lock.lock();
  try {
    final Object id=idGenerator.generateId();
    Protocol<Message> workerProtocol=new WorkerProtocol(dispatch);
    Protocol<Message> receiveProtocol=new ReceiveProtocol(id,nodeName,channel);
    ProtocolStack<Message> stack=new ProtocolStack<Message>(incomingExecutor,failureHandler,failureHandler,workerProtocol,receiveProtocol,new ConnectionDisconnectProtocol());
    handlers.add(stack);
    AsyncConnection<Message> incomingEndpoint=router.createLocalConnection();
    stack.getBottom().dispatchTo(incomingEndpoint);
    incomingEndpoint.dispatchTo(stack.getBottom());
  }
  finally {
    lock.unlock();
  }
}
