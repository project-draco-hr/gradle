{
  lock.lock();
  try {
    Connection<Message> wrapper=new EndOfStreamConnection(connection);
    AsyncConnectionAdapter<Message> asyncConnection=new AsyncConnectionAdapter<Message>(wrapper,failureHandler,executorFactory,new RemoteDisconnectProtocol());
    connections.add(asyncConnection);
    AsyncConnection<Message> incomingEndpoint=router.createRemoteConnection();
    incomingEndpoint.dispatchTo(new MethodInvocationMarshallingDispatch(asyncConnection));
    asyncConnection.dispatchTo(new MethodInvocationUnmarshallingDispatch(incomingEndpoint,messagingClassLoader));
  }
  finally {
    lock.unlock();
  }
}
