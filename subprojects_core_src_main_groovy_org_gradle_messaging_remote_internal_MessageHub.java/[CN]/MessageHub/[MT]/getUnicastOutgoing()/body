{
  lock.lock();
  try {
    if (unicastOutgoing == null) {
      Protocol<Message> unicastSendProtocol=new InstancePerChannelProtocolAdapter<Object>(Object.class,new InstancePerChannelProtocolAdapter.ChannelProtocolFactory<Object>(){
        public Protocol<Object> newChannel(        Object channelKey){
          return new UnicastSendProtocol();
        }
      }
);
      Protocol<Message> sendProtocol=new InstancePerChannelProtocolAdapter<Object>(Object.class,new InstancePerChannelProtocolAdapter.ChannelProtocolFactory<Object>(){
        public Protocol<Object> newChannel(        Object channelKey){
          return new SendProtocol(idGenerator.generateId(),nodeName);
        }
      }
);
      StoppableExecutor executor=executorFactory.create(displayName + " outgoing unicast");
      executors.add(executor);
      unicastOutgoing=new ProtocolStack<Message>(executor,failureHandler,failureHandler,unicastSendProtocol,sendProtocol,new ConnectionDisconnectProtocol());
      AsyncConnection<Message> outgoingEndpoint=router.createLocalConnection();
      unicastOutgoing.getBottom().dispatchTo(outgoingEndpoint);
      outgoingEndpoint.dispatchTo(unicastOutgoing.getBottom());
    }
    return unicastOutgoing.getTop();
  }
  finally {
    lock.unlock();
  }
}
