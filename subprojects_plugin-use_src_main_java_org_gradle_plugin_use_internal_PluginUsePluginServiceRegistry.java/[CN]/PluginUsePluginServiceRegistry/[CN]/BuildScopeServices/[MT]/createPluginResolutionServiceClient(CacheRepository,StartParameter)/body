{
  HttpClientHelper http=new HttpClientHelper(new DefaultHttpSettings(Collections.<Authentication>emptySet()));
  HttpResourceAccessor accessor=new HttpResourceAccessor(http);
  PluginResolutionServiceClient httpClient=startParameter.isOffline() ? new OfflinePluginResolutionServiceClient() : new HttpPluginResolutionServiceClient(accessor);
  PersistentCache cache=cacheRepository.cache(CACHE_NAME).withDisplayName("Plugin Resolution Cache").withLockOptions(mode(FileLockManager.LockMode.None)).open();
  PluginResolutionServiceClient persistentCachingClient=new PersistentCachingPluginResolutionServiceClient(httpClient,cache);
  PluginResolutionServiceClient inMemoryCachingClient=new InMemoryCachingPluginResolutionServiceClient(persistentCachingClient);
  return new DeprecationListeningPluginResolutionServiceClient(inMemoryCachingClient);
}
