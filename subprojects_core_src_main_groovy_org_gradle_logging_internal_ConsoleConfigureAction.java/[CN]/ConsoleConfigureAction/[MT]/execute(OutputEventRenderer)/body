{
  StartParameter startParameter=new StartParameter();
  NativeServices.initialize(startParameter.getGradleUserHomeDir());
  ConsoleDetector consoleDetector=NativeServices.getInstance().get(ConsoleDetector.class);
  final ConsoleMetaData stdoutConsole=consoleDetector.isConsole(FileDescriptor.out);
  final ConsoleMetaData stderrConsole=consoleDetector.isConsole(FileDescriptor.err);
  boolean stdOutIsTerminal=stdoutConsole != null;
  boolean stdErrIsTerminal=stderrConsole != null;
  if (stdOutIsTerminal) {
    PrintStream outStr=new PrintStream(org.fusesource.jansi.AnsiConsole.wrapOutputStream(renderer.getOriginalStdOut()));
    Console console=new AnsiConsole(outStr,outStr,renderer.getColourMap());
    renderer.addConsole(console,true,stdErrIsTerminal,stdoutConsole);
  }
 else   if (stdErrIsTerminal) {
    PrintStream errStr=new PrintStream(org.fusesource.jansi.AnsiConsole.wrapOutputStream(renderer.getOriginalStdErr()));
    Console console=new AnsiConsole(errStr,errStr,renderer.getColourMap());
    renderer.addConsole(console,false,true,stderrConsole);
  }
}
