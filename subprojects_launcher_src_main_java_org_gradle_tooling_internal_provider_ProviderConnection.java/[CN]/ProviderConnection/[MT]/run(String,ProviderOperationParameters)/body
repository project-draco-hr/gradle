{
  List<String> tasks=providerParameters.getTasks();
  if (modelName.equals(ModelIdentifier.NULL_MODEL) && tasks == null) {
    throw new IllegalArgumentException("No model type or tasks specified.");
  }
  Parameters params=initParams(providerParameters);
  Class<?> type=new ModelMapping().getProtocolTypeFromModelName(modelName);
  if (type == InternalBuildEnvironment.class) {
    if (tasks != null) {
      throw new IllegalArgumentException("Cannot run tasks and fetch the build environment model.");
    }
    return new DefaultBuildEnvironment(GradleVersion.current().getVersion(),params.daemonParams.getEffectiveJavaHome(),params.daemonParams.getEffectiveJvmArgs());
  }
  BuildAction<ToolingModel> action=new BuildModelAction(modelName,tasks != null);
  ToolingModel model;
  try {
    model=run(action,providerParameters,params.properties);
  }
 catch (  RuntimeException e) {
    for (Throwable t=e; t != null; t=t.getCause()) {
      if (t instanceof UnsupportedOperationException) {
        throw new InternalUnsupportedModelException();
      }
    }
    throw e;
  }
  ClassLoader classLoader=classLoaderRegistry.getClassLoaderFor(model.getClassPath());
  try {
    return Message.receive(new ByteArrayInputStream(model.getSerializedModel()),classLoader);
  }
 catch (  Exception e) {
    throw UncheckedException.throwAsUncheckedException(e);
  }
}
