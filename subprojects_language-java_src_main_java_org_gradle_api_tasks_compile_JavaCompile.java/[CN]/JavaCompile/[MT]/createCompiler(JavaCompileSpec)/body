{
  JavaVersion targetJavaVersion=spec.getTargetCompatibility() == null ? JavaVersion.current() : JavaVersion.toVersion(spec.getTargetCompatibility());
  JavaPlatform dummyPlatform=new DefaultJavaPlatform(targetJavaVersion);
  Compiler<JavaCompileSpec> javaCompiler=((JavaToolChainInternal)getToolChain()).select(dummyPlatform).newCompiler(spec);
  return new CleaningJavaCompiler(javaCompiler,getAntBuilderFactory(),getOutputs());
}
