{
  DefaultJavaCompileSpec spec=new DefaultJavaCompileSpec();
  spec.setSource(getSource());
  spec.setDestinationDir(getDestinationDir());
  spec.setWorkingDir(getProject().getProjectDir());
  spec.setTempDir(getTemporaryDir());
  spec.setClasspath(getClasspath());
  spec.setDependencyCacheDir(getDependencyCacheDir());
  if (platform == null) {
    spec.setTargetCompatibility(getTargetCompatibility());
    spec.setSourceCompatibility(getSourceCompatibility());
  }
 else   if (getTargetCompatibility() == null && getSourceCompatibility() == null) {
    spec.setTargetCompatibility(platform.getTargetCompatibility().toString());
    spec.setSourceCompatibility(platform.getTargetCompatibility().toString());
  }
 else   if (platform != null && getTargetCompatibility() != null && getSourceCompatibility() != null) {
    if (getTargetCompatibility().equals(platform.getTargetCompatibility().toString())) {
      spec.setTargetCompatibility(getTargetCompatibility());
      spec.setSourceCompatibility(getSourceCompatibility());
    }
 else {
      throw new RuntimeException("Cannot create Java Compile spec because platform target compatibility is different from Java Compile target compatibility");
    }
  }
 else {
    throw new RuntimeException("Cannot create Java Compile spec because either platform or source and target compatibility have not been set");
  }
  spec.setCompileOptions(compileOptions);
  return spec;
}
