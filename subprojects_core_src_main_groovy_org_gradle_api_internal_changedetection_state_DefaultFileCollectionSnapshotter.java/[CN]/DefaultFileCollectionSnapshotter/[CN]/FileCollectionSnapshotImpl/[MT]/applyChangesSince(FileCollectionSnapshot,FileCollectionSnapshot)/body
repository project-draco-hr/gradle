{
  FileCollectionSnapshotImpl oldSnapshotImpl=(FileCollectionSnapshotImpl)oldSnapshot;
  FileCollectionSnapshotImpl targetImpl=(FileCollectionSnapshotImpl)target;
  final Map<String,IncrementalFileSnapshot> newSnapshots=new HashMap<String,IncrementalFileSnapshot>(targetImpl.snapshots);
  diff(snapshots,oldSnapshotImpl.snapshots,ChangeType.AllChanges,new MapMergeChangeListener<String,IncrementalFileSnapshot>(newSnapshots));
  return new FileCollectionSnapshotImpl(newSnapshots);
}
