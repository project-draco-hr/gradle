{
  FileCollectionSnapshotImpl oldSnapshotImpl=(FileCollectionSnapshotImpl)oldSnapshot;
  FileCollectionSnapshotImpl targetImpl=(FileCollectionSnapshotImpl)target;
  Map<String,IncrementalFileSnapshot> newSnapshots=new HashMap<String,IncrementalFileSnapshot>(targetImpl.snapshots);
  diff(snapshots,oldSnapshotImpl.snapshots,newSnapshots);
  return new FileCollectionSnapshotImpl(newSnapshots);
}
