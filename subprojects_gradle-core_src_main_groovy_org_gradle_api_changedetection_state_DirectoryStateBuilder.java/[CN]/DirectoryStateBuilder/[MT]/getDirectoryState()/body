{
  if (directory == null)   throw new IllegalStateException("directory is null!");
  final String relativePath=stateFileUtil.getRelativePathToDirectoryToProcess(directory);
  final String relativePathDigest=stateFileUtil.getStringDigest(relativePath);
  final int level=StringUtils.countMatches(relativePath,System.getProperty("file.separator"));
  final DirectoryState directoryState=new DirectoryState(directory,relativePath,relativePathDigest,level);
  directory=null;
  return directoryState;
}
