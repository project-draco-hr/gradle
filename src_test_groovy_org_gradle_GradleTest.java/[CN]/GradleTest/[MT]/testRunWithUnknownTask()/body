{
  expectedStartParams.setTaskNames(WrapUtil.toList("unknown"));
  context.checking(new Expectations(){
{
      one(buildLoaderMock).load(expectedRootProjectDescriptor,expectedClassLoader,expectedStartParams,testGradleProperties);
      will(returnValue(buildMock));
      one(taskExecuterMock).addTaskExecutionGraphListener(with(notNullValue(TaskExecutionGraphListener.class)));
      one(settingsHandlerMock).findAndLoadSettings(expectedStartParams,gradlePropertiesLoaderMock);
      will(returnValue(settingsMock));
      one(buildConfigurerMock).process(expectedRootProject);
    }
  }
);
  BuildResult buildResult=gradle.run();
  assertThat(buildResult.getFailure(),notNullValue());
  assertThat(buildResult.getFailure().getClass(),equalTo((Object)UnknownTaskException.class));
}
