{
  final TaskInternal task=context.mock(TaskInternal.class);
  final ProjectInternal project=context.mock(ProjectInternal.class);
  final TaskInputs taskInputs=context.mock(TaskInputs.class);
  final FileCollection inputFiles=context.mock(FileCollection.class);
  context.checking(new Expectations(){
{
      one(delegate).createTask(project,map());
      will(returnValue(task));
      allowing(task).getInputs();
      will(returnValue(taskInputs));
      allowing(taskInputs).getFiles();
      will(returnValue(inputFiles));
      one(task).dependsOn(inputFiles);
    }
  }
);
  assertThat(factory.createTask(project,map()),sameInstance(task));
}
