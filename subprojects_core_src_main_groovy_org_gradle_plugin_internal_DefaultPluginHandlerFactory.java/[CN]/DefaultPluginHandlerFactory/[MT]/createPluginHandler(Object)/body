{
  if (target instanceof PluginAware) {
    PluginHandler pluginHandler=new DefaultPluginHandler((PluginAware)target,instantiator,new Action<PluginResolution>(){
      public void execute(      PluginResolution pluginResolution){
        Class<? extends Plugin> pluginClass=pluginResolution.resolve(this.getClass().getClassLoader());
        ((PluginAware)target).getPlugins().apply(pluginClass);
      }
    }
);
    addDefaultResolvers(pluginHandler);
    return pluginHandler;
  }
 else {
    return new NonPluggableTargetPluginHandler(target);
  }
}
