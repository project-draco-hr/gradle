{
  startParameter.setGradleUserHomeDir(tmpDir.getDir());
  context.checking(new Expectations(){
{
      allowing(parent).getFactory(CacheFactory.class);
      will(returnValue(cacheFactoryFactory));
      allowing(cacheFactoryFactory).create();
      will(returnValue(cacheFactory));
      allowing(parent).get(ClassLoaderRegistry.class);
      will(returnValue(classLoaderRegistry));
      allowing(parent).getFactory(LoggingManagerInternal.class);
      will(returnValue(context.mock(Factory.class)));
      allowing(parent).get(ModuleRegistry.class);
      will(returnValue(new DefaultModuleRegistry()));
      allowing(parent).get(PluginModuleRegistry.class);
      will(returnValue(context.mock(PluginModuleRegistry.class)));
    }
  }
);
}
