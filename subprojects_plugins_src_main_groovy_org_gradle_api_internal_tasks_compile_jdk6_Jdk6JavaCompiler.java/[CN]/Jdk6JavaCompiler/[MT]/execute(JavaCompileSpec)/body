{
  LOGGER.info("Compiling using JDK 6 Java Compiler API.");
  List<String> options=generateCommandLineOptions(spec);
  javax.tools.JavaCompiler compiler=ToolProvider.getSystemJavaCompiler();
  CompileOptions compileOptions=spec.getCompileOptions();
  StandardJavaFileManager fileManager=compiler.getStandardFileManager(null,null,compileOptions.getEncoding() != null ? Charset.forName(compileOptions.getEncoding()) : null);
  Iterable<? extends JavaFileObject> compilationUnits=fileManager.getJavaFileObjectsFromFiles(spec.getSource());
  javax.tools.JavaCompiler.CompilationTask task=compiler.getTask(null,null,null,options,null,compilationUnits);
  boolean success=task.call();
  if (!success) {
    throw new CompilationFailedException();
  }
  return new SimpleWorkResult(true);
}
