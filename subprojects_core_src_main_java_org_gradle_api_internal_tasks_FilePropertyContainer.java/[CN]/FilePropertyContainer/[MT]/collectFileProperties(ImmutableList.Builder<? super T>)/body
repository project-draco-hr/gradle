{
  Set<String> propertyNames=Sets.newHashSetWithExpectedSize(fileProperties.size());
  for (  T propertySpec : fileProperties) {
    String propertyName=propertySpec.getPropertyName();
    if (propertyName == null) {
      propertyName=nextLegacyPropertyName();
      propertySpec.withPropertyName(propertyName);
    }
    if (!propertyNames.add(propertyName)) {
      throw new IllegalArgumentException(String.format("Multiple file properties with name '%s'",propertyName));
    }
    builder.add(propertySpec);
  }
}
