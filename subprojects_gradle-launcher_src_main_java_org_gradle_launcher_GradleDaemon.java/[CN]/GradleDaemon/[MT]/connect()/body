{
  Socket socket=maybeConnect();
  if (socket != null) {
    return socket;
  }
  LOGGER.lifecycle("Starting Gradle daemon");
  List<String> daemonArgs=new ArrayList<String>();
  daemonArgs.add(Jvm.current().getJavaExecutable().getAbsolutePath());
  daemonArgs.add("-Xmx1024m");
  daemonArgs.add("-XX:MaxPermSize=256m");
  daemonArgs.add("-cp");
  daemonArgs.add(GUtil.join(new DefaultClassPathRegistry().getClassPathFiles("GRADLE_RUNTIME"),File.pathSeparator));
  daemonArgs.add(GradleDaemon.class.getName());
  ProcessBuilder builder=new ProcessBuilder(daemonArgs);
  Process process=builder.start();
  process.getOutputStream().close();
  process.getErrorStream().close();
  process.getInputStream().close();
  Date expiry=new Date(System.currentTimeMillis() + 30000L);
  do {
    socket=maybeConnect();
    if (socket != null) {
      return socket;
    }
    Thread.sleep(500L);
  }
 while (System.currentTimeMillis() < expiry.getTime());
  throw new RuntimeException("Timeout waiting to connect to Gradle daemon.");
}
