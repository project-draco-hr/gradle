{
  try {
    ObjectOutputStream oos=new ObjectOutputStream(new BufferedOutputStream(socket.getOutputStream()));
    oos.writeObject(command);
    oos.flush();
    OutputEventListener outputEventListener=loggingServices.get(OutputEventListener.class);
    ObjectInputStream ois=new ObjectInputStream(new BufferedInputStream(socket.getInputStream()));
    while (true) {
      Object object=ois.readObject();
      if (object instanceof Stop) {
        break;
      }
      OutputEvent outputEvent=(OutputEvent)object;
      outputEventListener.onOutput(outputEvent);
    }
  }
  finally {
    socket.close();
  }
}
