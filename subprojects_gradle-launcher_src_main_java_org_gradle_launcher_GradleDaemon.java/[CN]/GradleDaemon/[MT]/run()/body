{
  try {
    ServerSocket serverSocket=new ServerSocket(PORT);
    while (true) {
      LOGGER.lifecycle("Waiting for request");
      Socket socket=serverSocket.accept();
      try {
        OutputStream outputStream=new BufferedOutputStream(socket.getOutputStream());
        boolean finished=doRun(socket,outputStream);
        Message.send(new Stop(),outputStream);
        outputStream.flush();
        if (finished) {
          break;
        }
      }
  finally {
        socket.close();
      }
    }
  }
 catch (  IOException e) {
    throw new UncheckedIOException(e);
  }
}
