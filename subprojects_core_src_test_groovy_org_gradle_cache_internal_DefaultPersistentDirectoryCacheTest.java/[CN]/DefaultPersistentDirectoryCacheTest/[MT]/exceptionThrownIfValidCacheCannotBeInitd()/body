{
  TestFile dir=createCacheDir();
  context.checking(new Expectations(){
{
      allowing(action).execute(with(notNullValue(PersistentCache.class)));
    }
  }
);
  DefaultPersistentDirectoryCache cache=new DefaultPersistentDirectoryCache(dir,"<display-name>",CacheUsage.ON,null,properties,mode(LockMode.Shared),action,lockManager){
    @Override protected boolean determineIfCacheIsValid(    FileLock lock) throws IOException {
      return false;
    }
  }
;
  try {
    cache.open();
    fail("expected exception");
  }
 catch (  CacheOpenException e) {
    assertNotNull(e);
  }
}
