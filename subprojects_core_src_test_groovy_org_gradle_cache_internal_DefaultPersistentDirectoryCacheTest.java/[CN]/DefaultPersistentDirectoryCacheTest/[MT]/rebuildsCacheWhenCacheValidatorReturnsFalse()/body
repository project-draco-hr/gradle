{
  TestFile dir=createCacheDir();
  final CacheValidator invalidator=context.mock(CacheValidator.class);
  context.checking(new Expectations(){
{
      one(action).execute(with(notNullValue(PersistentCache.class)));
      exactly(2).of(invalidator).isValid();
      will(returnValue(false));
      allowing(invalidator).isValid();
      will(returnValue(true));
    }
  }
);
  DefaultPersistentDirectoryCache cache=new DefaultPersistentDirectoryCache(dir,"<display-name>",CacheUsage.ON,invalidator,properties,LockMode.Shared,action,lockManager);
  cache.open();
  assertThat(loadProperties(dir.file("cache.properties")),equalTo(properties));
}
