{
  if (pluginRequest.getVersion() == null) {
    result.notFound(getDescription(),"plugin dependency must include a version number for this source");
  }
 else {
    validatePluginRequest(pluginRequest);
    PluginResolutionServiceClient.Response<PluginUseMetaData> response=portalClient.queryPluginMetadata(pluginRequest,getUrl());
    if (response.isError()) {
      ErrorResponse errorResponse=response.getErrorResponse();
      if (response.getStatusCode() == 404) {
        String detail=null;
        if (errorResponse.is(ErrorResponse.Code.UNKNOWN_PLUGIN_VERSION)) {
          detail=String.format("version '%s' of this plugin does not exist",pluginRequest.getVersion());
        }
        result.notFound(getDescription(),detail);
      }
 else {
        throw new GradleException(String.format("Plugin resolution service returned HTTP %d with message '%s'.",response.getStatusCode(),errorResponse.message));
      }
    }
 else {
      PluginUseMetaData metaData=response.getResponse();
      ClassPath classPath=resolvePluginDependencies(metaData);
      PluginResolution resolution=new ClassPathPluginResolution(instantiator,pluginRequest.getId(),parentScope,Factories.constant(classPath));
      result.found(getDescription(),resolution);
    }
  }
}
