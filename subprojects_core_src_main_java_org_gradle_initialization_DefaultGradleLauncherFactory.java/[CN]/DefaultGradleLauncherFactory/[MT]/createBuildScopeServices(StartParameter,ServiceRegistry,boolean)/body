{
  if (newSession) {
    return BuildScopeServices.singleSession(parentRegistry,startParameter);
  }
  if (!(parentRegistry instanceof BuildSessionScopeServices)) {
    throw new IllegalArgumentException("Service registry must be of build session scope");
  }
  return BuildScopeServices.forSession((BuildSessionScopeServices)parentRegistry);
}
