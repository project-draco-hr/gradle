{
  final FileResolver fileResolver=serviceRegistry.get(FileResolver.class);
  ConfigurationContainer configurationContainer=serviceRegistry.get(ConfigurationContainer.class);
  DependencyHandler dependencyHandler=serviceRegistry.get(DependencyHandler.class);
  PlayToolChainInternal playToolChain=serviceRegistry.get(PlayToolChainInternal.class);
  final Dependency playDependency=dependencyHandler.create(playToolChain.select(binary.getTargetPlatform()).getPlayDependencyNotation());
  final Configuration appCompileClasspath=configurationContainer.detachedConfiguration(playDependency);
  Dependency zincDependency=dependencyHandler.create(String.format("com.typesafe.zinc:zinc:%s",ScalaLanguagePlugin.DEFAULT_ZINC_VERSION));
  final Configuration zincClasspath=configurationContainer.detachedConfiguration(zincDependency);
  final String scalaCompileTaskName=String.format("scalaCompile%s",StringUtils.capitalize(binary.getName()));
  tasks.create(scalaCompileTaskName,PlatformScalaCompile.class,new Action<PlatformScalaCompile>(){
    public void execute(    PlatformScalaCompile scalaCompile){
      scalaCompile.setDestinationDir(binary.getClasses().getClassesDir());
      scalaCompile.setClasspath(appCompileClasspath);
      scalaCompile.setPlatform(new DefaultScalaPlatform(binary.getTargetPlatform().getScalaVersion()));
      scalaCompile.setSourceCompatibility(binary.getTargetPlatform().getJavaVersion().getMajorVersion());
      scalaCompile.setTargetCompatibility(binary.getTargetPlatform().getJavaVersion().getMajorVersion());
      IncrementalCompileOptions incrementalOptions=scalaCompile.getScalaCompileOptions().getIncrementalOptions();
      incrementalOptions.setAnalysisFile(new File(buildDir,String.format("tmp/scala/compilerAnalysis/%s.analysis",scalaCompileTaskName)));
      scalaCompile.getScalaCompileOptions().setFork(true);
      scalaCompile.getScalaCompileOptions().setUseAnt(false);
      for (      LanguageSourceSet appSources : binary.getSource().withType(ScalaSources.class)) {
        scalaCompile.source(appSources.getSource());
        scalaCompile.dependsOn(appSources);
      }
      scalaCompile.source(binary.getGeneratedScala().getSource());
      scalaCompile.dependsOn(binary.getGeneratedScala());
      binary.getClasses().builtBy(scalaCompile);
    }
  }
);
}
