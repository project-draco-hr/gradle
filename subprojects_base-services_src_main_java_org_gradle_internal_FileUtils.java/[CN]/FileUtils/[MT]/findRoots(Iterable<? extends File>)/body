{
  List<File> roots=Lists.newLinkedList();
  Set<File> directories=new LinkedHashSet<File>();
  for (  File file : files) {
    File absoluteFile=file.getAbsoluteFile();
    directories.add(file.isDirectory() ? absoluteFile : absoluteFile.getParentFile());
  }
  files:   for (  File dir : directories) {
    String path=dir.getPath() + File.separator;
    Iterator<File> rootsIterator=roots.iterator();
    while (rootsIterator.hasNext()) {
      File root=rootsIterator.next();
      String rootPath=root.getPath() + File.separator;
      if (path.startsWith(rootPath)) {
        continue files;
      }
      if (rootPath.startsWith(path)) {
        rootsIterator.remove();
      }
    }
    roots.add(dir);
  }
  return roots;
}
