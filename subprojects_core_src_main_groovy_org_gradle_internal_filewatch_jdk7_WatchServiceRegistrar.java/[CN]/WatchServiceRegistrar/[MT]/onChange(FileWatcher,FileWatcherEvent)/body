{
  lock.lock();
  try {
    if (event.getType().equals(FileWatcherEvent.Type.UNDEFINED) || event.getFile() == null) {
      LOG.debug("Calling onChange with event {}",event);
      deliverEventToDelegate(watcher,event);
      return;
    }
    File file=event.getFile();
    maybeFire(watcher,event);
    if (!Thread.currentThread().isInterrupted() && watcher.isRunning() && file.isDirectory()&& event.getType().equals(FileWatcherEvent.Type.CREATE)) {
      try {
        newDirectory(watcher,file);
      }
 catch (      IOException e) {
        throw UncheckedException.throwAsUncheckedException(e);
      }
    }
  }
  finally {
    lock.unlock();
  }
}
