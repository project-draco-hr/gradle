{
  if (dir.isDirectory()) {
    Files.walkFileTree(dir.toPath(),new SimpleFileVisitor<Path>(){
      @Override public FileVisitResult preVisitDirectory(      Path dir,      BasicFileAttributes attrs) throws IOException {
        if (inUnfilteredSubsetOrAncestorOfAnyRoot(dir.toFile())) {
          dir.register(watchService,WATCH_KINDS,WATCH_MODIFIERS);
          return FileVisitResult.CONTINUE;
        }
 else {
          return FileVisitResult.SKIP_SUBTREE;
        }
      }
    }
);
  }
}
