{
  lock.lock();
  try {
    LOG.debug("Begin - adding watches for {}",fileSystemSubset);
    final WatchPointsRegistry.Delta delta=watchPointsRegistry.appendFileSystemSubset(fileSystemSubset);
    Iterable<? extends File> startingWatchPoints=delta.getStartingWatchPoints();
    for (    File dir : startingWatchPoints) {
      LOG.debug("Begin - handling starting point {}",dir);
      if (FILE_TREE_WATCHING_SUPPORTED) {
        watchDir(dir.toPath());
      }
 else {
        Files.walkFileTree(dir.toPath(),new SimpleFileVisitor<Path>(){
          @Override public FileVisitResult preVisitDirectory(          Path path,          BasicFileAttributes attrs) throws IOException {
            if (delta.inUnfilteredSubsetOrAncestorOfAnyRoot(path.toFile())) {
              watchDir(path);
              return FileVisitResult.CONTINUE;
            }
 else {
              LOG.debug("Skipping watching for {}, filtered by WatchPointsRegistry",path);
              return FileVisitResult.SKIP_SUBTREE;
            }
          }
        }
);
      }
      LOG.debug("End - handling starting point {}",dir);
    }
    LOG.debug("End - adding watches for {}",fileSystemSubset);
  }
  finally {
    lock.unlock();
  }
}
