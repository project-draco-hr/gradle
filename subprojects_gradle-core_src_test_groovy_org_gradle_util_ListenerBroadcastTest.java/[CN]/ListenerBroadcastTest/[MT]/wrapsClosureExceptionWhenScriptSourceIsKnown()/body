{
  ScriptSource source=new StringScriptSource("source","def c = { { -> throw new RuntimeException('failed') } }; return c()");
  broadcast.add("event1",toClosure(source));
  try {
    broadcast.getSource().event1("param");
    fail();
  }
 catch (  GradleScriptException e) {
    assertThat(e.getMessage(),containsString("Failed to notify test listener."));
    assertThat(e.getScriptSource(),sameInstance(source));
    assertThat(e.getCause().getMessage(),equalTo("failed"));
  }
}
