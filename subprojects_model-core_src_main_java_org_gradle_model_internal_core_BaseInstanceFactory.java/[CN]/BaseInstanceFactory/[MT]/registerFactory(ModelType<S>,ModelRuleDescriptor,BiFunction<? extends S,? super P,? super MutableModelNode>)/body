{
  Registration<S> registration=getRegistration(type);
  if (registration != null) {
    StringBuilder builder=new StringBuilder("Cannot register a factory for type ").append(type.getSimpleName()).append(" because a factory for this type was already registered");
    if (registration.source != null) {
      builder.append(" by ");
      registration.source.describeTo(builder);
    }
    builder.append(".");
    throw new GradleException(builder.toString());
  }
  factories.put(type.getConcreteClass(),new Registration<S>(sourceRule,factory));
}
