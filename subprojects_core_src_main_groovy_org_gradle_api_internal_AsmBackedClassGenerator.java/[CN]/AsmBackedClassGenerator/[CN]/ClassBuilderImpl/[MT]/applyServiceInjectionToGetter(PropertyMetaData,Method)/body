{
  Type serviceRegistryType=Type.getType(ServiceRegistry.class);
  Type classType=Type.getType(Class.class);
  String getterName=getter.getName();
  Type returnType=Type.getType(getter.getReturnType());
  String methodDescriptor=Type.getMethodDescriptor(returnType);
  Type serviceType=Type.getType(property.getType());
  MethodVisitor methodVisitor=visitor.visitMethod(Opcodes.ACC_PUBLIC,getterName,methodDescriptor,null,new String[0]);
  methodVisitor.visitCode();
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitFieldInsn(Opcodes.GETFIELD,generatedType.getInternalName(),propFieldName(property),serviceType.getDescriptor());
  Label alreadyLoaded=new Label();
  methodVisitor.visitJumpInsn(Opcodes.IFNONNULL,alreadyLoaded);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitMethodInsn(Opcodes.INVOKEVIRTUAL,generatedType.getInternalName(),"getServices",Type.getMethodDescriptor(serviceRegistryType));
  methodVisitor.visitLdcInsn(returnType.getClassName());
  methodVisitor.visitMethodInsn(Opcodes.INVOKESTATIC,classType.getInternalName(),"forName",Type.getMethodDescriptor(classType,Type.getType(String.class)));
  methodVisitor.visitMethodInsn(Opcodes.INVOKEINTERFACE,serviceRegistryType.getInternalName(),"get",Type.getMethodDescriptor(Type.getType(Object.class),classType));
  methodVisitor.visitTypeInsn(Opcodes.CHECKCAST,serviceType.getInternalName());
  methodVisitor.visitFieldInsn(Opcodes.PUTFIELD,generatedType.getInternalName(),propFieldName(property),serviceType.getDescriptor());
  methodVisitor.visitLabel(alreadyLoaded);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitFieldInsn(Opcodes.GETFIELD,generatedType.getInternalName(),propFieldName(property),serviceType.getDescriptor());
  methodVisitor.visitInsn(returnType.getOpcode(Opcodes.IRETURN));
  methodVisitor.visitMaxs(0,0);
  methodVisitor.visitEnd();
}
