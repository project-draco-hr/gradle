{
  if (fullRebuildReason != null) {
    return;
  }
  String name=input.getFile().getName();
  if (name.endsWith(".java")) {
    String className=sourceToNameConverter.getClassName(input.getFile());
    staleClasses.add(className);
    DependentsSet actualDependents=dependencyInfo.getRelevantDependents(className);
    if (actualDependents.isDependencyToAll()) {
      fullRebuildReason="change to " + className + " requires full rebuild";
      return;
    }
    staleClasses.addAll(actualDependents.getDependentClasses());
  }
  if (name.endsWith(".jar")) {
    JarArchive jarArchive=new JarArchive(input.getFile(),fileOperations.zipTree(input.getFile()));
    JarChangeDependentsFinder dependentsFinder=new JarChangeDependentsFinder(jarSnapshotFeeder);
    DependentsSet actualDependents=dependentsFinder.getActualDependents(input,jarArchive);
    if (actualDependents.isDependencyToAll()) {
      fullRebuildReason="change to " + input.getFile() + " requires full rebuild";
      return;
    }
    staleClasses.addAll(actualDependents.getDependentClasses());
  }
}
