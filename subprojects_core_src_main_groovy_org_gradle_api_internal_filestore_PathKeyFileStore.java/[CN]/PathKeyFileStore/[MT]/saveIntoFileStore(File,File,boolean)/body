{
  if (!source.exists()) {
    throw new GradleException(String.format("Cannot copy '%s' into filestore @ '%s' as it does not exist",source,destination));
  }
  File parentDir=destination.getParentFile();
  if (!parentDir.mkdirs() && !parentDir.exists()) {
    throw new GradleException(String.format("Unable to create filestore directory %s",parentDir));
  }
  String verb=isMove ? "move" : "copy";
  try {
    deleteAction.delete(destination);
    if (isMove) {
      FileUtils.moveFile(source,destination);
    }
 else {
      FileUtils.copyFile(source,destination);
    }
  }
 catch (  IOException e) {
    throw new GradleException(String.format("Failed to %s file '%s' into filestore at '%s' ",verb,source,destination),e);
  }
  return new DefaultFileStoreEntry<String>(destination);
}
