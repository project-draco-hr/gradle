{
  new MetricsHtml(writer){
{
      html();
      head();
      headSection(this);
      title().text("Profile report").end();
      end();
      body();
      div().id("content");
      List<String> testNames=store.getTestNames();
      div().id("controls").end();
      for (      String testName : testNames) {
        TestExecutionHistory testHistory=store.getTestResults(testName,5);
        h2().classAttr("test-execution");
        text(testName);
        end();
        table().classAttr("history");
        tr().classAttr("control-groups");
        th().colspan("2").end();
        th().colspan(String.valueOf(testHistory.getExperimentCount() * getColumnsForSamples())).text("Average execution time").end();
        th().colspan(String.valueOf(testHistory.getExperimentCount() * getColumnsForSamples())).text("Average heap usage").end();
        end();
        tr();
        th().text("Date").end();
        th().text("Branch").end();
        for (        String label : testHistory.getExperimentLabels()) {
          renderHeaderForSamples(label);
        }
        for (        String label : testHistory.getExperimentLabels()) {
          renderHeaderForSamples(label);
        }
        end();
        List<PerformanceResults> results=testHistory.getPerformanceResults();
        for (        PerformanceResults performanceResults : results) {
          tr();
          td().text(format.timestamp(new Date(performanceResults.getTestTime()))).end();
          td().text(performanceResults.getVcsBranch()).end();
          renderSamplesForExperiment(performanceResults.getExperiments(),new Transformer<DataSeries<Duration>,MeasuredOperationList>(){
            @Override public DataSeries<Duration> transform(            MeasuredOperationList measuredOperations){
              return measuredOperations.getTotalTime();
            }
          }
);
          renderSamplesForExperiment(performanceResults.getExperiments(),new Transformer<DataSeries<DataAmount>,MeasuredOperationList>(){
            @Override public DataSeries<DataAmount> transform(            MeasuredOperationList measuredOperations){
              return measuredOperations.getTotalMemoryUsed();
            }
          }
);
          end();
        }
        end();
        div().classAttr("details");
        String url="tests/" + testHistory.getId() + ".html";
        a().href(url).text("details...").end();
        end();
      }
      end();
      footer(this);
      endAll();
    }
  }
;
}
