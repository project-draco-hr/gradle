{
  final ClassLoader contextClassLoader=Thread.currentThread().getContextClassLoader();
  final PrintStream origOut=System.out;
  final PrintStream origErr=System.err;
  try {
    LOGGER.debug("Running findbugs specification {}",spec);
    final List<String> args=spec.getArguments();
    String[] strArray=new String[args.size()];
    args.toArray(strArray);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    System.setOut(new PrintStream(baos));
    System.setErr(new PrintStream(baos));
    Thread.currentThread().setContextClassLoader(FindBugs2.class.getClassLoader());
    FindBugs2 findBugs2=new FindBugs2();
    TextUICommandLine commandLine=new TextUICommandLine();
    FindBugs.processCommandLine(commandLine,strArray,findBugs2);
    findBugs2.execute();
    LOGGER.debug(baos.toString());
    LOGGER.info("Successfully executed in findbugs daemon.");
    return createFindbugsResult(findBugs2);
  }
  finally {
    System.setOut(origOut);
    System.setErr(origErr);
    Thread.currentThread().setContextClassLoader(contextClassLoader);
  }
}
