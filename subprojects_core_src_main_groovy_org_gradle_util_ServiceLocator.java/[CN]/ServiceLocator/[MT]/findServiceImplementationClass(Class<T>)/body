{
  String implementationClassName;
  try {
    implementationClassName=findServiceImplementationClassName(serviceType);
  }
 catch (  Exception e) {
    throw new RuntimeException(String.format("Could not determine implementation class for service '%s'.",serviceType.getName()),e);
  }
  if (implementationClassName == null) {
    return null;
  }
  try {
    Class<?> implClass=classLoader.loadClass(implementationClassName);
    if (!serviceType.isAssignableFrom(implClass)) {
      throw new RuntimeException(String.format("Implementation class '%s' is not assignable to service class '%s'.",implementationClassName,serviceType.getName()));
    }
    return implClass.asSubclass(serviceType);
  }
 catch (  Throwable t) {
    throw new RuntimeException(String.format("Could not load implementation class '%s' for service '%s'.",implementationClassName,serviceType.getName()),t);
  }
}
