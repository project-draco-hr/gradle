{
  ArtifactRepository localRepo=createLocalArtifactRepository();
  ParsedMavenPom parsedMavenPom=new ParsedMavenPom(pomFile);
  Artifact parentArtifact;
  if (mainArtifact == null) {
    Artifact pomArtifact=createPomArtifact(parsedMavenPom);
    publishArtifact(pomArtifact,pomFile,localRepo);
    parentArtifact=pomArtifact;
  }
 else {
    Artifact artifact=createMainArtifact(parsedMavenPom);
    ArtifactMetadata metadata=new ProjectArtifactMetadata(artifact,pomFile);
    artifact.addMetadata(metadata);
    publishArtifact(artifact,mainArtifact,localRepo);
    parentArtifact=artifact;
  }
  for (  AdditionalArtifact attachedArtifact : additionalArtifacts) {
    Artifact attach=createAttachedArtifact(parentArtifact,attachedArtifact.getType(),attachedArtifact.getClassifier());
    publishArtifact(attach,attachedArtifact.getFile(),localRepo);
  }
}
