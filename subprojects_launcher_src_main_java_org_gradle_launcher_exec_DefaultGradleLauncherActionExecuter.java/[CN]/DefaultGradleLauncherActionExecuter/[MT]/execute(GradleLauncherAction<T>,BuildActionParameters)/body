{
  StartParameter startParameter=new StartParameter();
  if (action instanceof InitializationAware) {
    InitializationAware initializationAware=(InitializationAware)action;
    initializationAware.configureStartParameter(startParameter);
  }
  LoggingManagerInternal loggingManager=loggingServices.getFactory(LoggingManagerInternal.class).create();
  loggingManager.setLevel(startParameter.getLogLevel());
  loggingManager.start();
  try {
    LOGGER.info("executing build with daemon context: {}",daemonContext);
    GradleLauncher gradleLauncher=gradleLauncherFactory.newInstance(startParameter,parameters.getBuildRequestMetaData());
    BuildResult buildResult=action.run(gradleLauncher);
    Throwable failure=buildResult.getFailure();
    if (failure != null) {
      throw new ReportedException(failure);
    }
    return action.getResult();
  }
 catch (  ReportedException e) {
    throw e;
  }
catch (  Throwable throwable) {
    BuildExceptionReporter exceptionReporter=new BuildExceptionReporter(loggingServices.get(StyledTextOutputFactory.class),new StartParameter(),parameters.getClientMetaData());
    exceptionReporter.reportException(throwable);
    throw new ReportedException(throwable);
  }
 finally {
    loggingManager.stop();
  }
}
