{
  final Instantiator instantiator=serviceRegistry.get(Instantiator.class);
  final FileResolver fileResolver=serviceRegistry.get(FileResolver.class);
  for (  final NativeComponentSpec component : components.values()) {
    final String suiteName=String.format("%sTest",component.getName());
    testSuites.create(suiteName,GoogleTestTestSuiteSpec.class,new Action<GoogleTestTestSuiteSpec>(){
      @Override public void execute(      GoogleTestTestSuiteSpec testSuite){
        DefaultGoogleTestTestSuiteSpec googleTestSuite=(DefaultGoogleTestTestSuiteSpec)testSuite;
        googleTestSuite.setTestedComponent(component);
        googleTestSuite.getSources().registerFactory(CppSourceSet.class,new NamedDomainObjectFactory<CppSourceSet>(){
          public CppSourceSet create(          String name){
            return BaseLanguageSourceSet.create(DefaultCppSourceSet.class,name,suiteName,fileResolver,instantiator);
          }
        }
);
      }
    }
);
  }
}
