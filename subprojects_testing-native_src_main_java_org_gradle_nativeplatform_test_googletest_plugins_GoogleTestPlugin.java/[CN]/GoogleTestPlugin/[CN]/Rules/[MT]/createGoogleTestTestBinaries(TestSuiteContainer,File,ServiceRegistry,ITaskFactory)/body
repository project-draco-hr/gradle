{
  testSuites.withType(GoogleTestTestSuiteSpec.class).afterEach(new Action<GoogleTestTestSuiteSpec>(){
    @Override public void execute(    GoogleTestTestSuiteSpec testSuiteSpec){
      for (      NativeBinarySpec testedBinary : testSuiteSpec.getTestedComponent().getBinaries().withType(NativeBinarySpec.class).values()) {
        if (testedBinary instanceof SharedLibraryBinary) {
          continue;
        }
        DefaultGoogleTestTestSuiteBinary testBinary=createTestBinary(serviceRegistry,testSuiteSpec,testedBinary,taskFactory);
        configure(testBinary,buildDir);
        ComponentSpecInternal testSuiteSpecInternal=(ComponentSpecInternal)testSuiteSpec;
        testSuiteSpecInternal.getBinariesContainer().add(testBinary);
      }
    }
  }
);
}
