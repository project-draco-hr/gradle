{
  File realJavaHome=currentJvmJavaHomeProvider.getDir();
  File javaHomeFromToolProvidersPointOfView=systemPropertiesJavaHomeProvider.getDir();
  if (realJavaHome.equals(javaHomeFromToolProvidersPointOfView)) {
    return javaCompilerProvider.getCompiler();
  }
  lock.lock();
  SystemProperties.setJavaHomeDir(realJavaHome);
  try {
    return javaCompilerProvider.getCompiler();
  }
  finally {
    SystemProperties.setJavaHomeDir(javaHomeFromToolProvidersPointOfView);
    lock.unlock();
  }
}
