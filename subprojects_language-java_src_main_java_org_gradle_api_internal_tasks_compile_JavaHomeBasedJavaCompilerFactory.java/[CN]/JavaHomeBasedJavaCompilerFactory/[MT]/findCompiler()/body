{
  File realJavaHome=currentJvmJavaHomeFactory.create();
  File javaHomeFromToolProvidersPointOfView=systemPropertiesJavaHomeFactory.create();
  if (realJavaHome.equals(javaHomeFromToolProvidersPointOfView)) {
    return systemJavaCompilerFactory.create();
  }
  lock.lock();
  SystemProperties.getInstance().setJavaHomeDir(realJavaHome);
  try {
    return systemJavaCompilerFactory.create();
  }
  finally {
    SystemProperties.getInstance().setJavaHomeDir(javaHomeFromToolProvidersPointOfView);
    lock.unlock();
  }
}
