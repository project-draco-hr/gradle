{
  String pluginId=request.getId();
  List<Pkg> results=BintrayClient.create(System.getProperty(BINTRAY_USER_TODO_REMOVE),System.getProperty(BINTRAY_APIKEY_TODO_REMOVE)).subject(GRADLE_PLUGINS_ORG).repository(GRADLE_PLUGINS_REPO).searchForPackage().byAttributeName(PLUGIN_ID_ATTRIBUTE_NAME).equals(pluginId).search();
  if (results.isEmpty()) {
    throw new InvalidPluginRequest("No plugins found for plugin id " + pluginId);
  }
  if (results.size() > 1) {
    throw new InvalidPluginRequest("Found more than one plugin for plugin id " + pluginId);
  }
  Pkg pluginPackage=results.get(0);
  List<String> systemIds=pluginPackage.systemIds();
  if (systemIds.isEmpty()) {
    throw new InvalidPluginRequest("No artifacts in maven layout found for plugin id" + pluginId);
  }
  String version=request.getVersion();
  if (version == null) {
    List<String> versions=pluginPackage.versions();
    if (versions.isEmpty()) {
      throw new InvalidPluginRequest("No versions found for plugin id " + pluginId);
    }
    sort(versions);
    version=versions.get(versions.size() - 1);
  }
  return dependencyHandler.create(systemIds.get(0) + ":" + version);
}
