{
  Set<File> bootstrapClasspath=new DefaultClassPathRegistry().getClassPathFiles("GRADLE_BOOTSTRAP");
  if (bootstrapClasspath.isEmpty()) {
    throw new IllegalStateException("Unable to construct a bootstrap classpath when starting the daemon");
  }
  List<String> daemonArgs=new ArrayList<String>();
  daemonArgs.add(Jvm.current().getJavaExecutable().getAbsolutePath());
  daemonArgs.add("-Xmx1024m");
  daemonArgs.add("-XX:MaxPermSize=256m");
  daemonArgs.add("-cp");
  daemonArgs.add(GUtil.join(bootstrapClasspath,File.pathSeparator));
  daemonArgs.add(GradleDaemon.class.getName());
  daemonArgs.add(String.format("-%s",DefaultCommandLineConverter.GRADLE_USER_HOME));
  daemonArgs.add(userHomeDir.getAbsolutePath());
  daemonArgs.add("-Dorg.gradle.daemon.idletimeout=" + idleTimeout);
  DaemonStartAction daemon=new DaemonStartAction();
  daemon.args(daemonArgs);
  daemon.workingDir(userHomeDir);
  daemon.start();
}
