{
  GeneratedArchiveBuildOutcome source=association.getSource();
  GeneratedArchiveBuildOutcome target=association.getTarget();
  Set<ArchiveEntry> sourceEntries;
  if (source.getArchiveFile() != null && source.getArchiveFile().exists()) {
    sourceEntries=archiveToEntriesTransformer.transform(source.getArchiveFile());
  }
 else {
    sourceEntries=Collections.emptySet();
  }
  Set<ArchiveEntry> targetEntries;
  if (target.getArchiveFile() != null && target.getArchiveFile().exists()) {
    targetEntries=archiveToEntriesTransformer.transform(target.getArchiveFile());
  }
 else {
    targetEntries=Collections.emptySet();
  }
  CollectionUtils.SetDiff<ArchiveEntry> diff=CollectionUtils.diffSetsBy(sourceEntries,targetEntries,new Transformer<String,ArchiveEntry>(){
    public String transform(    ArchiveEntry entry){
      return entry.getPath();
    }
  }
);
  SortedSet<ArchiveEntryComparison> entryComparisons=new TreeSet<ArchiveEntryComparison>(new Comparator<ArchiveEntryComparison>(){
    public int compare(    ArchiveEntryComparison o1,    ArchiveEntryComparison o2){
      return o1.getPath().compareTo(o2.getPath());
    }
  }
);
  for (  ArchiveEntry sourceOnly : diff.leftOnly) {
    entryComparisons.add(new ArchiveEntryComparison(sourceOnly.getPath(),sourceOnly,null));
  }
  for (  CollectionUtils.SetDiff.Pair<ArchiveEntry> pair : diff.common) {
    entryComparisons.add(new ArchiveEntryComparison(pair.left.getPath(),pair.left,pair.right));
  }
  for (  ArchiveEntry targetOnly : diff.rightOnly) {
    entryComparisons.add(new ArchiveEntryComparison(targetOnly.getPath(),null,targetOnly));
  }
  return new GeneratedArchiveBuildOutcomeComparisonResult(association,entryComparisons);
}
