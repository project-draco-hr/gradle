{
  try {
    LOGGER.debug("Executing test {}",testClass.getTestClassName());
    JUnitTest test=new JUnitTest(testClass.getTestClassName());
    ClassLoader applicationClassLoader=Thread.currentThread().getContextClassLoader();
    JUnitTestRunner testRunner=new JUnitTestRunner(test,false,false,false,false,false,applicationClassLoader);
    forkedField.set(testRunner,true);
    File testResultFile=new File(testResultsDir,"TEST-" + test.getName() + ".xml");
    XMLJUnitResultFormatter xmlFormatter=new XMLJUnitResultFormatter();
    xmlFormatter.setOutput(new BufferedOutputStream(new FileOutputStream(testResultFile)));
    testRunner.addFormatter(xmlFormatter);
    testRunner.addFormatter(formatter);
    testRunner.run();
  }
 catch (  Throwable e) {
    throw new GradleException(String.format("Could not execute test class '%s'.",testClass.getTestClassName()),e);
  }
}
