{
  Class<?>[] parameterTypes=closure.getParameterTypes();
  if (parameterTypes.length == 0) {
    throw new InvalidUserCodeException("A component metadata rule needs to have at least one parameter.");
  }
  List<Object> args=Lists.newArrayList();
  if (parameterTypes[0].isAssignableFrom(ComponentMetadataDetails.class)) {
    args.add(details);
  }
 else {
    throw new InvalidUserCodeException(String.format("First parameter of a component metadata rule needs to be of type '%s'.",ComponentMetadataDetails.class.getSimpleName()));
  }
  for (  Class<?> parameterType : Arrays.asList(parameterTypes).subList(1,parameterTypes.length)) {
    if (parameterType == IvyModuleMetadata.class) {
      if (!(metadata instanceof IvyModuleVersionMetaData)) {
        return;
      }
      args.add(new DefaultIvyModuleMetadata(((IvyModuleVersionMetaData)metadata).getExtraInfo()));
    }
 else {
      throw new InvalidUserCodeException(String.format("Unsupported parameter type for component metadata rule: %s",parameterType.getName()));
    }
  }
  closure.call(args.toArray());
}
