{
  WorkerProcessBuilder builder=project.getServices().getFactory(WorkerProcessBuilder.class).create();
  File toolsJar=Jvm.current().getToolsJar();
  if (toolsJar != null) {
    builder.getApplicationClasspath().add(toolsJar);
  }
  ForkOptions forkOptions=getCompileOptions().getForkOptions();
  JavaExecHandleBuilder javaCommand=builder.getJavaCommand();
  javaCommand.setMinHeapSize(forkOptions.getMemoryInitialSize());
  javaCommand.setMaxHeapSize(forkOptions.getMemoryMaximumSize());
  javaCommand.setJvmArgs(forkOptions.getJvmArgs());
  javaCommand.setWorkingDir(project.getProjectDir());
  return builder.worker(action.makeSerializable()).build();
}
