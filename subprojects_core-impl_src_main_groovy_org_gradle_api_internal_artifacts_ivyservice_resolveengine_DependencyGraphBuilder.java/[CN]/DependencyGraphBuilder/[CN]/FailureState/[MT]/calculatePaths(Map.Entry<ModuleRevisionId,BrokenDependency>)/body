{
  Map<DefaultModuleRevisionResolveState,List<ModuleRevisionId>> shortestPaths=new LinkedHashMap<DefaultModuleRevisionResolveState,List<ModuleRevisionId>>();
  List<ModuleRevisionId> rootPath=new ArrayList<ModuleRevisionId>();
  rootPath.add(root.moduleRevision.id);
  shortestPaths.put(root.moduleRevision,rootPath);
  Set<DefaultModuleRevisionResolveState> directDependees=new LinkedHashSet<DefaultModuleRevisionResolveState>();
  for (  ConfigurationNode node : entry.getValue().requiredBy) {
    directDependees.add(node.moduleRevision);
  }
  Set<DefaultModuleRevisionResolveState> seen=new HashSet<DefaultModuleRevisionResolveState>();
  LinkedList<DefaultModuleRevisionResolveState> queue=new LinkedList<DefaultModuleRevisionResolveState>();
  queue.addAll(directDependees);
  while (!queue.isEmpty()) {
    DefaultModuleRevisionResolveState version=queue.getFirst();
    if (version == root.moduleRevision) {
      queue.removeFirst();
    }
 else     if (seen.add(version)) {
      for (      ConfigurationNode configuration : version.configurations) {
        for (        DependencyEdge dependencyEdge : configuration.incomingEdges) {
          queue.add(0,dependencyEdge.from.moduleRevision);
        }
      }
    }
 else {
      queue.remove();
      List<ModuleRevisionId> shortest=null;
      for (      ConfigurationNode configuration : version.configurations) {
        for (        DependencyEdge dependencyEdge : configuration.incomingEdges) {
          List<ModuleRevisionId> candidate=shortestPaths.get(dependencyEdge.from.moduleRevision);
          if (candidate == null) {
            continue;
          }
          if (shortest == null) {
            shortest=candidate;
          }
 else           if (shortest.size() > candidate.size()) {
            shortest=candidate;
          }
        }
      }
      if (shortest == null) {
        continue;
      }
      List<ModuleRevisionId> path=new ArrayList<ModuleRevisionId>();
      path.addAll(shortest);
      path.add(version.id);
      shortestPaths.put(version,path);
    }
  }
  List<List<ModuleRevisionId>> paths=new ArrayList<List<ModuleRevisionId>>();
  for (  DefaultModuleRevisionResolveState version : directDependees) {
    List<ModuleRevisionId> path=shortestPaths.get(version);
    paths.add(path);
  }
  return paths;
}
