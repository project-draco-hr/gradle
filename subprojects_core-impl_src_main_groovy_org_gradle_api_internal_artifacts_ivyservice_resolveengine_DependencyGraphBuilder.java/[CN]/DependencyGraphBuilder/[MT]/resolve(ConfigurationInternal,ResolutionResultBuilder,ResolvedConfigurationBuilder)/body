{
  DefaultBuildableComponentResolveResult rootModule=new DefaultBuildableComponentResolveResult();
  moduleResolver.resolve(configuration.getModule(),configuration.getAll(),rootModule);
  ResolveState resolveState=new ResolveState(rootModule,configuration.getName(),dependencyResolver,dependencyToConfigurationResolver,artifactResolver);
  traverseGraph(resolveState);
  DependencyGraphVisitor oldListener=new ResolvedConfigurationDependencyGraphVisitor(oldModelBuilder,artifactResolver);
  DependencyGraphVisitor newListener=new ResolutionResultDependencyGraphVisitor(newModelBuilder);
  DependencyGraphVisitor listener=new CompositeDependencyGraphVisitor(oldListener,newListener);
  assembleResult(resolveState,listener);
}
