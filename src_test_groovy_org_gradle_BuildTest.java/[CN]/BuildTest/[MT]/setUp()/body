{
  context.setImposteriser(ClassImposteriser.INSTANCE);
  HelperUtil.deleteTestDir();
  rootFinderMock=context.mock(RootFinder.class);
  settingsMock=context.mock(DefaultSettings.class);
  buildExecuterMock=context.mock(BuildExecuter.class);
  settingsProcessorMock=context.mock(SettingsProcessor.class);
  projectsLoaderMock=context.mock(ProjectsLoader.class);
  buildConfigurerMock=context.mock(BuildConfigurer.class);
  buildListenerMock=context.mock(BuildListener.class);
  build=new Build(rootFinderMock,settingsProcessorMock,projectsLoaderMock,buildConfigurerMock,buildExecuterMock);
  testGradleProperties=WrapUtil.toMap(Project.SYSTEM_PROP_PREFIX + ".prop1","value1");
  testGradleProperties.put("prop2","value2");
  expectedSearchUpwards=false;
  expectedClassLoader=new URLClassLoader(new URL[0]);
  expectedProjectProperties=WrapUtil.toMap("prop","value");
  expectedSystemPropertiesArgs=WrapUtil.toMap("systemProp","systemPropValue");
  expectedRootDir=new File("rootDir");
  expectedCurrentDir=new File(expectedRootDir,"currentDir");
  expectedGradleUserHomeDir=new File(HelperUtil.TMP_DIR_FOR_TEST,"gradleUserHomeDir");
  expectedRootProject=HelperUtil.createRootProject(expectedRootDir);
  expectedCurrentProject=HelperUtil.createRootProject(expectedCurrentDir);
  expectTasks("a","b");
  expectedStartParams=new StartParameter();
  expectedStartParams.setTaskNames(expectedTaskNames);
  expectedStartParams.setCurrentDir(expectedCurrentDir);
  expectedStartParams.setSearchUpwards(expectedSearchUpwards);
  expectedStartParams.setGradleUserHomeDir(expectedGradleUserHomeDir);
  expectedStartParams.setSystemPropertiesArgs(expectedSystemPropertiesArgs);
  expectedStartParams.setProjectProperties(expectedProjectProperties);
  context.checking(new Expectations(){
{
      allowing(rootFinderMock).find(with(any(StartParameter.class)));
      allowing(rootFinderMock).getGradleProperties();
      will(returnValue(testGradleProperties));
      allowing(rootFinderMock).getRootDir();
      will(returnValue(expectedRootDir));
      allowing(settingsMock).createClassLoader();
      will(returnValue(expectedClassLoader));
      allowing(projectsLoaderMock).getRootProject();
      will(returnValue(expectedRootProject));
      allowing(projectsLoaderMock).getCurrentProject();
      will(returnValue(expectedCurrentProject));
    }
  }
);
}
