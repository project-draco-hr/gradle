{
  context.checking(new Expectations(){
{
      one(buildConfigurerMock).process(expectedRootProject);
      one(buildExecuterMock).execute(expectedTasks.get(0),expectedRootProject);
      will(returnValue(rebuildDagReturnValue));
      one(buildExecuterMock).execute(expectedTasks.get(1),expectedRootProject);
      will(returnValue(rebuildDagReturnValue));
      one(projectsLoaderMock).load(settingsMock,expectedClassLoader,expectedStartParams,expectedProjectProperties,System.getProperties(),System.getenv());
      if (rebuildDagReturnValue) {
        one(buildConfigurerMock).process(expectedRootProject);
        one(projectsLoaderMock).load(settingsMock,expectedClassLoader,expectedStartParams,expectedProjectProperties,System.getProperties(),System.getenv());
      }
    }
  }
);
}
