{
  LOGGER.debug(DaemonMessages.STARTED_EXECUTING_COMMAND + command + " with connection: "+ connection+ ".");
  DefaultDaemonConnection daemonConnection=new DefaultDaemonConnection(connection,executorFactory);
  try {
    try {
      commandExecuter.executeCommand(daemonConnection,command,daemonContext,daemonStateControl,new Runnable(){
        public void run(){
          onFinishHandling(connection);
        }
      }
);
    }
 catch (    Throwable e) {
      String message=String.format("Uncaught exception when executing command: '%s' from connection: '%s'.",command,connection);
      LOGGER.warn(message + ". Dispatching the failure to the daemon client...",e);
      daemonConnection.completed(new DaemonFailure(new RuntimeException(message,e)));
    }
 finally {
      LOGGER.debug(DaemonMessages.FINISHED_EXECUTING_COMMAND + command);
    }
  }
  finally {
    daemonConnection.stop();
  }
}
