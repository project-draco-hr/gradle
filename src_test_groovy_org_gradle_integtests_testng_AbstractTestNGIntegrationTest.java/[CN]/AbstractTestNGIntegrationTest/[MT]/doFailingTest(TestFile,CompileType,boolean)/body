{
  writeTestNGbuildFile(buildFile,compileType,testReport);
  writeClass(compileType);
  writeFailingTestClass(compileType);
  final GradleExecutionFailure failureResult=usingBuildFile(buildFile).runTasksAndExpectFailure("test");
  failureResult.getFailure().printStackTrace();
  failureResult.assertContext(endsWith("Execution failed for task ':test'."));
  failureResult.assertDescription(startsWith("There were failing tests. See the report at "));
  return failureResult;
}
