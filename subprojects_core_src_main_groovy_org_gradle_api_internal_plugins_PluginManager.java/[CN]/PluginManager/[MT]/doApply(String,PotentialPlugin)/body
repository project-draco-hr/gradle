{
  Class<?> pluginClass=potentialPlugin.asClass();
  try {
    if (potentialPlugin.getType().equals(PotentialPlugin.Type.UNKNOWN)) {
      throw new InvalidPluginException("'" + pluginClass.getName() + "' is neither a plugin or a rule source and cannot be applied.");
    }
 else {
      final Class<? extends Plugin<?>> asImperativeClass=potentialPlugin.asImperativeClass();
      if (asImperativeClass == null) {
        if (addPluginDirect(pluginClass)) {
          applicator.applyRules(pluginId,pluginClass);
        }
      }
 else {
        SingleMessageLogger.whileDisabled(new Runnable(){
          public void run(){
            if (pluginId == null) {
              pluginContainer.apply(asImperativeClass);
            }
 else {
              pluginContainer.apply(pluginId);
            }
          }
        }
);
      }
    }
  }
 catch (  PluginApplicationException e) {
    throw e;
  }
catch (  Exception e) {
    throw new PluginApplicationException(pluginId == null ? "class '" + pluginClass.getName() + "'" : "id '" + pluginId + "'",e);
  }
}
