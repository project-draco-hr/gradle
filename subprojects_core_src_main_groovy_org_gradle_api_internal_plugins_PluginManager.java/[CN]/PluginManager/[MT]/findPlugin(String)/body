{
  for (  PluginWithId plugin : pluginsWithIds) {
    PotentialPluginWithId potentialPluginWithId=pluginRegistry.lookup(id);
    if (potentialPluginWithId == null) {
      potentialPluginWithId=pluginRegistry.lookup(id,plugin.clazz.getClassLoader());
    }
    if (potentialPluginWithId != null && potentialPluginWithId.asClass().equals(plugin.clazz)) {
      return plugin.asAppliedPlugin();
    }
  }
  for (  Class<?> noIdPlugin : noIdPlugins) {
    PotentialPluginWithId potentialPluginWithId=pluginRegistry.lookup(id);
    if (potentialPluginWithId == null) {
      potentialPluginWithId=pluginRegistry.lookup(id,noIdPlugin.getClassLoader());
    }
    if (potentialPluginWithId != null && potentialPluginWithId.asClass().equals(noIdPlugin)) {
      PluginWithId pluginWithId=new PluginWithId(potentialPluginWithId.getPluginId().toString(),noIdPlugin);
      pluginsWithIds.add(pluginWithId);
      noIdPlugins.remove(noIdPlugin);
      return pluginWithId.asAppliedPlugin();
    }
  }
  unclaimedIds.add(id);
  return null;
}
