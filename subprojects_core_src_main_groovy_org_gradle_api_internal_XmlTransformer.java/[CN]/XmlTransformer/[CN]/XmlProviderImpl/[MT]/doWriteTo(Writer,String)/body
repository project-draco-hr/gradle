{
  writeXmlDeclaration(writer,encoding);
  try {
    if (node != null) {
      final PrintWriter printWriter=new PrintWriter(writer);
      IndentPrinter indentPrinter=new IndentPrinter(printWriter,indentation){
        @Override public void println(){
          printWriter.print(TextUtil.LINE_SEPARATOR);
        }
      }
;
      XmlNodePrinter nodePrinter=new XmlNodePrinter(indentPrinter);
      nodePrinter.setPreserveWhitespace(true);
      nodePrinter.print(node);
      printWriter.flush();
    }
 else     if (element != null) {
      printNode(element,writer);
    }
 else     if (builder != null) {
      writer.append(TextUtil.toNativeLineSeparators(removeAnyXmlDeclaration(builder)));
    }
 else {
      writer.append(TextUtil.toNativeLineSeparators(removeAnyXmlDeclaration(stringValue)));
    }
  }
 catch (  IOException e) {
    throw UncheckedException.asUncheckedException(e);
  }
}
