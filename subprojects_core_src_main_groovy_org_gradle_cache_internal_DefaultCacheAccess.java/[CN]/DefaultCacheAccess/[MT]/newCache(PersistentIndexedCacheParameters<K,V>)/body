{
  Factory<BTreePersistentIndexedCache<K,V>> indexedCacheFactory=new Factory<BTreePersistentIndexedCache<K,V>>(){
    public BTreePersistentIndexedCache<K,V> create(){
      return doCreateCache(parameters.getCacheFile(),parameters.getKeySerializer(),parameters.getValueSerializer());
    }
  }
;
  MultiProcessSafePersistentIndexedCache<K,V> indexedCache=parameters.decorate(new DefaultMultiProcessSafePersistentIndexedCache<K,V>(indexedCacheFactory,fileAccess));
  lock.lock();
  try {
    caches.add(indexedCache);
    if (fileLock != null) {
      indexedCache.onStartWork(operations.getDescription(),stateAtOpen);
    }
  }
  finally {
    lock.unlock();
  }
  return indexedCache;
}
