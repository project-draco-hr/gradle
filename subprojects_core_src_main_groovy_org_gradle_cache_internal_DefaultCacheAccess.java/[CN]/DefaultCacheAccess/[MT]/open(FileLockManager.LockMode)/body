{
  lock.lock();
  try {
    if (owner != null) {
      throw new IllegalStateException(String.format("Cannot open the %s, as it is already in use.",cacheDiplayName));
    }
    this.lockMode=lockMode;
    if (lockMode == FileLockManager.LockMode.None) {
      return;
    }
    if (lockedFiles.containsKey(lockFile)) {
      throw new IllegalStateException("File lock " + lockFile + " is already open.");
    }
    fileLock=lockManager.lock(lockFile,lockMode,cacheDiplayName,whenContended());
    if (lockMode.equals(FileLockManager.LockMode.Exclusive)) {
      lockedFiles.put(lockFile,fileLock);
    }
    takeOwnership(String.format("Access %s",cacheDiplayName));
  }
  finally {
    lock.unlock();
  }
}
