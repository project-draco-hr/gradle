{
  Gradle gradle=project.getGradle();
  final PerformanceCounterMeasurement performanceCounterMeasurement=new PerformanceCounterMeasurement(project.getRootProject().getBuildDir());
  performanceCounterMeasurement.recordStart();
  gradle.addBuildListener(new BuildAdapter(){
    @Override public void projectsEvaluated(    Gradle gradle){
      BuildEventTimeStamps.projectsEvaluated(gradle);
    }
    @Override public void buildFinished(    BuildResult result){
      BuildEventTimeStamps.buildFinished(result);
      performanceCounterMeasurement.recordFinish();
      Project rootProject=result.getGradle().getRootProject();
      HeapDumper.handle(rootProject,rootProject.getLogger());
      new HeapMeasurement().handle(rootProject,rootProject.getLogger());
      ExternalResources.printAndResetStats();
    }
  }
);
  gradle.getTaskGraph().addTaskExecutionGraphListener(new TaskExecutionGraphListener(){
    @Override public void graphPopulated(    TaskExecutionGraph graph){
      BuildEventTimeStamps.configurationEvaluated();
    }
  }
);
}
