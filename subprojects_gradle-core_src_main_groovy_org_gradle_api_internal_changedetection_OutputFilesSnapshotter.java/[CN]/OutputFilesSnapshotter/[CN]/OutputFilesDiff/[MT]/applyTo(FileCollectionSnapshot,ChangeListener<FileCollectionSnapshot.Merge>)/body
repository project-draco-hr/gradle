{
  OutputFilesSnapshot other=(OutputFilesSnapshot)snapshot;
  Map<String,Long> dirIds=new HashMap<String,Long>(other.rootFileIds);
  DiffUtil.diff(newFileIds,oldFileIds,new MapMergeChangeListener<String,Long>(new NoOpChangeListener<FileCollectionSnapshot.Merge>(),dirIds));
  return new OutputFilesSnapshot(newFileIds,filesDiff.applyTo(other.filesSnapshot,listener));
}
