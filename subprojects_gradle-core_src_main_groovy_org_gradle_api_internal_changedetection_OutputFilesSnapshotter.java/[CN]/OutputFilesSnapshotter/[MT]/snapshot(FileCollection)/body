{
  Map<String,Long> snapshotDirIds=new HashMap<String,Long>();
  for (  File file : files) {
    Long counter;
    if (file.exists()) {
      counter=dirIdentifiers.get(file);
      if (counter == null) {
        counter=nextCounter++;
        dirIdentifiers.put(file,counter);
      }
    }
 else {
      dirIdentifiers.remove(file);
      counter=null;
    }
    snapshotDirIds.put(file.getAbsolutePath(),counter);
  }
  return new OutputFilesSnapshot(snapshotDirIds,snapshotter.snapshot(files.getAsFileTree()));
}
