{
  ConnectRequest request=(ConnectRequest)connection.receive();
  Channel channel;
  lock.lock();
  try {
    channel=pending.remove(request.getDestinationAddress());
    if (channel == null) {
      throw new IllegalStateException(String.format("Request to connect received for unknown address '%s'.",request.getDestinationAddress()));
    }
  }
  finally {
    lock.unlock();
  }
  channel.setConnection(connection);
}
