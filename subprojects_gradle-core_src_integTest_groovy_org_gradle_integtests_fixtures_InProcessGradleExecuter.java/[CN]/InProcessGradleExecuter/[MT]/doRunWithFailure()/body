{
  OutputListenerImpl outputListener=new OutputListenerImpl();
  OutputListenerImpl errorListener=new OutputListenerImpl();
  BuildListenerImpl buildListener=new BuildListenerImpl();
  try {
    doRun(outputListener,errorListener,buildListener).rethrowFailure();
    throw new AssertionFailedError("expected build to fail.");
  }
 catch (  GradleException e) {
    return new InProcessExecutionFailure(buildListener.executedTasks,buildListener.skippedTasks,outputListener.writer.toString(),errorListener.writer.toString(),e);
  }
}
