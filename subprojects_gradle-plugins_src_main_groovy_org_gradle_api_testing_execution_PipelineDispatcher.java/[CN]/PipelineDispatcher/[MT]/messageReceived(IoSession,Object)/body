{
  if (message != null) {
    final Class<?> messageClass=message.getClass();
    final TestControlMessageHandler handler=messageClassHandlers.get(messageClass);
    if (handler != null) {
      try {
        final int forkId=((TestClientControlMessage)message).getForkId();
        final TestServerClientHandle client=clientHandles.get(forkId);
        if (client == null) {
          ioSession.write(new WaitActionMesssage(pipeline.getId(),1000L));
        }
 else {
          handler.handle(ioSession,message,client);
        }
      }
 catch (      Throwable t) {
        LOGGER.error("failed to handle " + message,t);
      }
    }
 else {
      LOGGER.error("received unknown message of type {} on pipeline ",messageClass,pipeline.getName());
      ioSession.write(new StopForkActionMessage(pipeline.getId()));
    }
  }
}
