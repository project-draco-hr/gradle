{
  stopping.set(true);
  ThreadUtils.run(new Runnable(){
    public void run(){
      ThreadUtils.interleavedConditionWait(runningClientsLock,allClientsStopped,100L,TimeUnit.MILLISECONDS,new ConditionWaitHandle(){
        public boolean checkCondition(){
          return runningClients.isEmpty();
        }
        public void conditionMatched(){
          pipeline.stopped();
        }
      }
);
    }
  }
);
}
