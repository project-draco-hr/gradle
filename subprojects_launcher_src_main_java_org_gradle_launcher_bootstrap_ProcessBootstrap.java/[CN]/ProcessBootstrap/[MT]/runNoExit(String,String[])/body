{
  ClassPathRegistry classPathRegistry=new DefaultClassPathRegistry(new DefaultClassPathProvider(new DefaultModuleRegistry(CurrentGradleInstallation.get())));
  ClassLoaderFactory classLoaderFactory=new DefaultClassLoaderFactory();
  ClassPath antClasspath=classPathRegistry.getClassPath("ANT");
  ClassPath runtimeClasspath=classPathRegistry.getClassPath("GRADLE_RUNTIME");
  ClassLoader antClassLoader=classLoaderFactory.createIsolatedClassLoader(antClasspath);
  ClassLoader runtimeClassLoader=new VisitableURLClassLoader(antClassLoader,runtimeClasspath);
  Thread.currentThread().setContextClassLoader(runtimeClassLoader);
  Class<?> mainClass=runtimeClassLoader.loadClass(mainClassName);
  Object entryPoint=mainClass.newInstance();
  Method mainMethod=mainClass.getMethod("run",String[].class);
  mainMethod.invoke(entryPoint,new Object[]{args});
}
