{
  LOGGER.warn("Note: the Gradle build daemon is an experimental feature.");
  LOGGER.warn("As such, you may experience unexpected build failures. You may need to occasionally stop the daemon.");
  while (true) {
    DaemonConnection daemonConnection=connector.connect(compatibilitySpec);
    Connection<Object> connection=daemonConnection.getConnection();
    Build build=new Build(action,parameters);
    Object firstResult;
    try {
      LOGGER.info("Connected to the daemon. Dispatching {} request.",build);
      connection.dispatch(build);
      firstResult=connection.receive();
    }
 catch (    Exception e) {
      LOGGER.info("Unable to receive the first result from the daemon. Trying a different daemon...",e);
      continue;
    }
    if (firstResult instanceof BuildStarted) {
      return (T)monitorBuild(build,connection).getValue();
    }
 else     if (firstResult instanceof DaemonBusy) {
      LOGGER.info("The daemon we connected to was busy. Trying a different daemon...");
    }
 else     if (firstResult instanceof Failure) {
      throw ((Failure)firstResult).getValue();
    }
 else     if (firstResult == null) {
      LOGGER.warn("The first result from the daemon was empty. Most likely the daemon has died. Trying a different daemon...");
    }
 else {
      throw new IllegalStateException(String.format("Daemon returned %s for which there is no strategy to handle (i.e. is an unknown Result type)",firstResult));
    }
  }
}
