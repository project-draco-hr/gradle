{
  boolean versionMatcherRequiresMetadata=versionMatcher.needModuleMetadata(dependency.getRequested().getVersion());
  ModuleVersionSelector requested=dependency.getRequested();
  for (  Versioned candidate : sortLatestFirst(versions)) {
    ModuleComponentIdentifier candidateIdentifier=DefaultModuleComponentIdentifier.newId(requested.getGroup(),requested.getName(),candidate.getVersion());
    if (versionMatcherRequiresMetadata) {
      MutableModuleVersionMetaData metaData=resolveComponentMetaData(dependency,candidate,moduleAccess);
      if (!versionMatcher.accept(requested.getVersion(),metaData)) {
        continue;
      }
    }
 else {
      if (!versionMatcher.accept(requested.getVersion(),candidate.getVersion())) {
        continue;
      }
    }
    if (isRejectedByRules(candidateIdentifier,dependency,moduleAccess)) {
      continue;
    }
    return candidateIdentifier;
  }
  return null;
}
