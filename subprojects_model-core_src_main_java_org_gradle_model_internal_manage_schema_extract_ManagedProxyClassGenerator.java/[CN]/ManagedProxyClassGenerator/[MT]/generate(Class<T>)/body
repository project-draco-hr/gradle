{
  ClassWriter visitor=new ClassWriter(ClassWriter.COMPUTE_MAXS | ClassWriter.COMPUTE_FRAMES);
  String generatedTypeName=managedTypeClass.getName() + "_Impl";
  Type generatedType=Type.getType("L" + generatedTypeName.replaceAll("\\.","/") + ";");
  Class<?> superclass;
  List<String> interfaceInternalNames;
  if (managedTypeClass.isInterface()) {
    superclass=Object.class;
    interfaceInternalNames=ImmutableList.of(Type.getInternalName(managedTypeClass),MANAGED_INSTANCE_TYPE);
  }
 else {
    superclass=managedTypeClass;
    interfaceInternalNames=ImmutableList.of(MANAGED_INSTANCE_TYPE);
  }
  generateProxyClass(visitor,managedTypeClass,interfaceInternalNames,generatedType,Type.getType(superclass));
  return defineClass(visitor,managedTypeClass.getClassLoader(),generatedTypeName);
}
