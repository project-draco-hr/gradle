{
  project.getTasks().withType(GroovyCompile.class).allTasks(new Action<GroovyCompile>(){
    public void execute(    GroovyCompile compile){
      compile.setGroovyClasspath(project.getConfigurations().getByName(GROOVY_CONFIGURATION_NAME));
      compile.getConventionMapping().map("groovySourceDirs",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return new ArrayList<File>(mainGroovy(convention).getGroovy().getSrcDirs());
        }
      }
);
    }
  }
);
}
