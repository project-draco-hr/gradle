{
  project.getTasks().withType(GroovyCompile.class).allTasks(new Action<GroovyCompile>(){
    public void execute(    GroovyCompile compile){
      compile.setGroovyClasspath(project.getConfigurations().getByName(GROOVY_CONFIGURATION_NAME));
      compile.conventionMapping("groovySourceDirs",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return groovy(convention).getGroovySrcDirs();
        }
      }
);
    }
  }
);
  GroovyCompile groovyCompile=project.getTasks().replace(COMPILE_TASK_NAME,GroovyCompile.class);
  javaPlugin.configureForSourceSet(JavaPlugin.MAIN_SOURCE_SET_NAME,groovyCompile);
  groovyCompile.setDescription("Compiles the Java and Groovy source code.");
}
