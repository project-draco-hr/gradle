{
  StartParameter startParameter=new StartParameter();
  startParameterConverter.convert(commandLine,startParameter);
  DaemonParameters daemonParameters=constructDaemonParameters(startParameter);
  if (commandLine.hasOption(STOP)) {
    return stopAllDaemons(daemonParameters,loggingServices);
  }
  if (commandLine.hasOption(FOREGROUND)) {
    ForegroundDaemonConfiguration conf=new ForegroundDaemonConfiguration(daemonParameters.getUid(),daemonParameters.getBaseDir(),daemonParameters.getIdleTimeout());
    return new ActionAdapter(new ForegroundDaemonMain(conf));
  }
  if (useDaemon(commandLine,daemonParameters)) {
    return runBuildWithDaemon(startParameter,daemonParameters,loggingServices);
  }
  if (canUseCurrentProcess(daemonParameters)) {
    return runBuildInProcess(loggingServices,startParameter);
  }
  return runBuildInSingleUseDaemon(startParameter,daemonParameters,loggingServices);
}
