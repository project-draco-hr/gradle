{
  StartParameter startParameter=new StartParameter();
  startParameterConverter.convert(commandLine,startParameter);
  GradleProperties gradleProperties=propertiesConfigurer.configureStartParameter(startParameter);
  DaemonParameters daemonParameters=constructDaemonParameters(gradleProperties);
  if (commandLine.hasOption(STOP)) {
    return stopAllDaemons(daemonParameters,loggingServices);
  }
  if (commandLine.hasOption(FOREGROUND)) {
    ForegroundDaemonConfiguration conf=new ForegroundDaemonConfiguration(daemonParameters.getUid(),daemonParameters.getBaseDir(),daemonParameters.getIdleTimeout());
    return Actions.toAction(new ForegroundDaemonMain(conf));
  }
  if (useDaemon(commandLine,daemonParameters)) {
    return runBuildWithDaemon(startParameter,daemonParameters,loggingServices);
  }
  if (canUseCurrentProcess(daemonParameters)) {
    return runBuildInProcess(startParameter,daemonParameters,loggingServices);
  }
  return runBuildInSingleUseDaemon(startParameter,daemonParameters,loggingServices);
}
