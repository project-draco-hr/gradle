{
  if (environment.isLongLivingProcess()) {
    final MapBackedInMemoryStore inMemoryStore=new MapBackedInMemoryStore();
    CachingFileSnapshotter fileSnapshotter=new CachingFileSnapshotter(new DefaultHasher(),inMemoryStore,stringInterner);
    return new HashClassPathSnapshotter(fileSnapshotter,inMemoryStore);
  }
 else {
    return new FileClassPathSnapshotter();
  }
}
