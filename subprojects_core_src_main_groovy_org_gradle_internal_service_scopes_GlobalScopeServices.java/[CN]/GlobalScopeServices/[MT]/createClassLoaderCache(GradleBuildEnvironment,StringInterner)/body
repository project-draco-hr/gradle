{
  ClassPathSnapshotter classPathSnapshotter;
  if (environment.isLongLivingProcess()) {
    CachingFileSnapshotter fileSnapshotter=new CachingFileSnapshotter(new DefaultHasher(),new NonThreadsafeInMemoryStore(),stringInterner);
    classPathSnapshotter=new HashClassPathSnapshotter(fileSnapshotter);
  }
 else {
    classPathSnapshotter=new FileClassPathSnapshotter();
  }
  return new DefaultClassLoaderCache(classPathSnapshotter);
}
