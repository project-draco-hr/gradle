{
  ClassPathSnapshotter classPathSnapshotter;
  if (environment.isLongLivingProcess()) {
    final MapBackedInMemoryStore inMemoryStore=new MapBackedInMemoryStore();
    CachingFileSnapshotter fileSnapshotter=new CachingFileSnapshotter(new DefaultHasher(),inMemoryStore,stringInterner);
    classPathSnapshotter=new HashClassPathSnapshotter(fileSnapshotter,inMemoryStore);
  }
 else {
    classPathSnapshotter=new FileClassPathSnapshotter();
  }
  return new DefaultClassLoaderCache(classPathSnapshotter);
}
