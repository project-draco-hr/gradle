{
  CodeSource codeSource=getClass().getProtectionDomain().getCodeSource();
  if (codeSource != null) {
    URL location=codeSource.getLocation();
    if (location.getProtocol().equals("file") && location.getPath().endsWith("gradle-api-" + GradleVersion.current().getVersion() + ".jar")) {
      return new FlatClassLoaderRegistry(getClass().getClassLoader());
    }
  }
  return new DefaultClassLoaderRegistry(classPathRegistry,classLoaderFactory);
}
