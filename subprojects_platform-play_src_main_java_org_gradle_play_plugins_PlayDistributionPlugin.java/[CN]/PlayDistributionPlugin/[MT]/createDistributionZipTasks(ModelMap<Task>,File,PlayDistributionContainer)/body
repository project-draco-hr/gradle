{
  for (  final PlayDistribution distribution : distributions.withType(PlayDistribution.class)) {
    final String stageTaskName=String.format("stage%sDist",StringUtils.capitalize(distribution.getName()));
    final File stageDir=new File(buildDir,"stage");
    final String baseName=StringUtils.isNotEmpty(distribution.getBaseName()) ? distribution.getBaseName() : distribution.getName();
    tasks.create(stageTaskName,Copy.class,new Action<Copy>(){
      @Override public void execute(      Copy copy){
        copy.setDescription("Copies the '" + distribution.getName() + "' distribution to a staging directory.");
        copy.setDestinationDir(stageDir);
        CopySpecInternal baseSpec=copy.getRootSpec().addChild();
        baseSpec.into(baseName);
        baseSpec.with(distribution.getContents());
      }
    }
);
    tasks.named("stage",new Action<Task>(){
      @Override public void execute(      Task task){
        task.dependsOn(stageTaskName);
      }
    }
);
    final Task stageTask=tasks.get(stageTaskName);
    final String distributionTaskName=String.format("create%sDist",StringUtils.capitalize(distribution.getName()));
    tasks.create(distributionTaskName,Zip.class,new Action<Zip>(){
      @Override public void execute(      final Zip zip){
        zip.setDescription("Packages the '" + distribution.getName() + "' distribution as a zip file.");
        zip.setArchiveName(String.format("%s.zip",baseName));
        zip.setDestinationDir(new File(buildDir,"distributions"));
        zip.from(stageTask);
      }
    }
);
    tasks.named("dist",new Action<Task>(){
      @Override public void execute(      Task task){
        task.dependsOn(distributionTaskName);
      }
    }
);
  }
}
