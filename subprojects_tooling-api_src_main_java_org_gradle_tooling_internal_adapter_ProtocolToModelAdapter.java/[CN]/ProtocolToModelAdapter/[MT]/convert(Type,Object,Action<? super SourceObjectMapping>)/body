{
  if (targetType instanceof ParameterizedType) {
    ParameterizedType parameterizedTargetType=(ParameterizedType)targetType;
    if (parameterizedTargetType.getRawType() instanceof Class) {
      Class<?> rawClass=(Class<?>)parameterizedTargetType.getRawType();
      if (Iterable.class.isAssignableFrom(rawClass)) {
        Type targetElementType=getElementType(parameterizedTargetType,0);
        return convertCollectionInternal(rawClass,targetElementType,(Iterable<?>)sourceObject,mapping);
      }
      if (Map.class.isAssignableFrom(rawClass)) {
        Type targetKeyType=getElementType(parameterizedTargetType,0);
        Type targetValueType=getElementType(parameterizedTargetType,1);
        return convertMap(rawClass,targetKeyType,targetValueType,(Map<?,?>)sourceObject,mapping);
      }
    }
  }
  if (targetType instanceof Class) {
    if (((Class)targetType).isPrimitive()) {
      return sourceObject;
    }
    return adapt((Class)targetType,sourceObject,mapping);
  }
  throw new UnsupportedOperationException(String.format("Cannot convert object of %s to %s.",sourceObject.getClass(),targetType));
}
