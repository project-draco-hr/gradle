{
  final ScriptSource expectedScriptSource=new ImportsScriptSource(scriptSource,importsReader,rootDir);
  context.checking(new Expectations(){
{
      one(scriptProcessorFactory).createProcessor(with(reflectionEquals(expectedScriptSource)));
      will(returnValue(processor));
      one(classLoaderProvider).getClassLoader();
      will(returnValue(classLoader));
      one(processor).setClassloader(classLoader);
      one(processor).setTransformer(with(notNullValue(BuildScriptClasspathScriptTransformer.class)));
      one(processor).process(ProjectScript.class);
      will(returnValue(classpathScript));
      one(projectScriptMetaData).applyMetaData(classpathScript,project);
      one(standardOutputRedirector).on(LogLevel.QUIET);
      one(classpathScript).run();
      one(standardOutputRedirector).flush();
      one(classLoaderProvider).updateClassPath();
      one(processor).setTransformer(with(notNullValue(BuildScriptTransformer.class)));
      one(processor).process(ProjectScript.class);
      will(returnValue(buildScript));
      one(projectScriptMetaData).applyMetaData(buildScript,project);
      one(project).setBuildScript(buildScript);
    }
  }
);
  evaluator.evaluate(project);
}
