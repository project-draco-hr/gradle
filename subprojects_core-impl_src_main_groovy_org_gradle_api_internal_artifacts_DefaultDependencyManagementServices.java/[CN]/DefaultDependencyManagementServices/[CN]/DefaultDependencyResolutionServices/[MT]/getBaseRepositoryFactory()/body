{
  if (baseRepositoryFactory == null) {
    Instantiator instantiator=parent.get(Instantiator.class);
    baseRepositoryFactory=new DefaultBaseRepositoryFactory(get(LocalMavenRepositoryLocator.class),fileResolver,instantiator,get(RepositoryTransportFactory.class),get(LocallyAvailableResourceFinder.class),get(ByUrlCachedExternalResourceIndex.class),new DefaultArtifactPublisherFactory(new Transformer<ArtifactPublisher,ResolverProvider>(){
      public ArtifactPublisher transform(      ResolverProvider resolverProvider){
        return createArtifactPublisher(resolverProvider);
      }
    }
));
  }
  return baseRepositoryFactory;
}
