{
  TestFile testDir=dist.getTestDir();
  TestFile buildFile=testDir.file("build.gradle");
  buildFile.writelns("usePlugin('java')","repositories { mavenCentral() }","dependencies { testCompile 'junit:junit:4.4' }");
  testDir.file("src/test/java/org/gradle/BrokenTest.java").writelns("package org.gradle;","public class BrokenTest {","@org.junit.Test public void broken() { org.junit.Assert.fail(); }","}");
  ExecutionFailure failure=executer.withTasks("libs").runWithFailure();
  failure.assertHasFileName(String.format("Build file '%s'",buildFile));
  failure.assertHasContext("Execution failed for task ':test'.");
  failure.assertDescription(startsWith("There were failing tests."));
}
