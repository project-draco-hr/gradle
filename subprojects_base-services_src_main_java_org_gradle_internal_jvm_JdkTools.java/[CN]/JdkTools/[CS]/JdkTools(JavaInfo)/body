{
  DefaultClassLoaderFactory defaultClassLoaderFactory=new DefaultClassLoaderFactory();
  JavaVersion javaVersion=Jvm.current().getJavaVersion();
  FilteringClassLoader filteringClassLoader=defaultClassLoaderFactory.createSystemFilteringClassLoader();
  if (!javaVersion.isJava9Compatible()) {
    File toolsJar=javaInfo.getToolsJar();
    if (toolsJar == null) {
      throw new IllegalStateException("Could not find tools.jar. Please check that " + javaInfo.getJavaHome().getAbsolutePath() + " contains a valid JDK installation.");
    }
    DefaultClassPath defaultClassPath=new DefaultClassPath(toolsJar);
    isolatedToolsLoader=new MutableURLClassLoader(filteringClassLoader,defaultClassPath.getAsURLs());
  }
 else {
    filteringClassLoader.allowPackage("com.sun.tools");
    isolatedToolsLoader=filteringClassLoader;
  }
}
