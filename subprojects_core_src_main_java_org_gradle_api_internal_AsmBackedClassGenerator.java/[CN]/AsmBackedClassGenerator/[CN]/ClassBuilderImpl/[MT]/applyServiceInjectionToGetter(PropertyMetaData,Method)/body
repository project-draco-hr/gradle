{
  Type serviceRegistryType=Type.getType(ServiceRegistry.class);
  Type classType=Type.getType(Class.class);
  Type methodType=Type.getType(Method.class);
  Type typeType=Type.getType(java.lang.reflect.Type.class);
  String getterName=getter.getName();
  Type returnType=Type.getType(getter.getReturnType());
  String methodDescriptor=Type.getMethodDescriptor(returnType);
  Type serviceType=Type.getType(property.getType());
  String propFieldName=propFieldName(property);
  MethodVisitor methodVisitor=visitor.visitMethod(Opcodes.ACC_PUBLIC,getterName,methodDescriptor,signature(getter),new String[0]);
  methodVisitor.visitCode();
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitFieldInsn(Opcodes.GETFIELD,generatedType.getInternalName(),propFieldName,serviceType.getDescriptor());
  Label alreadyLoaded=new Label();
  methodVisitor.visitJumpInsn(Opcodes.IFNONNULL,alreadyLoaded);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitMethodInsn(Opcodes.INVOKEVIRTUAL,generatedType.getInternalName(),"getServices",Type.getMethodDescriptor(serviceRegistryType));
  if (getter.getGenericReturnType() instanceof Class) {
    methodVisitor.visitLdcInsn(Type.getType((Class)getter.getGenericReturnType()));
  }
 else {
    methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
    methodVisitor.visitMethodInsn(Opcodes.INVOKEVIRTUAL,generatedType.getInternalName(),"getClass",Type.getMethodDescriptor(classType));
    methodVisitor.visitLdcInsn(getterName);
    methodVisitor.visitInsn(Opcodes.ICONST_0);
    methodVisitor.visitTypeInsn(Opcodes.ANEWARRAY,classType.getInternalName());
    methodVisitor.visitMethodInsn(Opcodes.INVOKEVIRTUAL,classType.getInternalName(),"getDeclaredMethod",Type.getMethodDescriptor(methodType,Type.getType(String.class),Type.getType(Class[].class)));
    methodVisitor.visitMethodInsn(Opcodes.INVOKEVIRTUAL,methodType.getInternalName(),"getGenericReturnType",Type.getMethodDescriptor(typeType));
  }
  methodVisitor.visitMethodInsn(Opcodes.INVOKEINTERFACE,serviceRegistryType.getInternalName(),"get",Type.getMethodDescriptor(Type.getType(Object.class),typeType));
  methodVisitor.visitTypeInsn(Opcodes.CHECKCAST,serviceType.getInternalName());
  methodVisitor.visitFieldInsn(Opcodes.PUTFIELD,generatedType.getInternalName(),propFieldName,serviceType.getDescriptor());
  methodVisitor.visitLabel(alreadyLoaded);
  methodVisitor.visitVarInsn(Opcodes.ALOAD,0);
  methodVisitor.visitFieldInsn(Opcodes.GETFIELD,generatedType.getInternalName(),propFieldName,serviceType.getDescriptor());
  methodVisitor.visitInsn(returnType.getOpcode(Opcodes.IRETURN));
  methodVisitor.visitMaxs(0,0);
  methodVisitor.visitEnd();
}
