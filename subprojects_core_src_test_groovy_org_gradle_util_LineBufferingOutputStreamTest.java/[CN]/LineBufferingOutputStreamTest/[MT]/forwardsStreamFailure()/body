{
  LineBufferingOutputStream outputStream=new LineBufferingOutputStream(action,8);
  final RuntimeException failure=new RuntimeException();
  context.checking(new Expectations(){
{
      one(action).endOfStream(failure);
    }
  }
);
  outputStream.endOfStream(failure);
}
