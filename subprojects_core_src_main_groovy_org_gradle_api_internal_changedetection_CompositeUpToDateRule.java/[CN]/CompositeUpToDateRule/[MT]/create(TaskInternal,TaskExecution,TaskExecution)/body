{
  final List<TaskUpToDateState> states=new ArrayList<TaskUpToDateState>();
  for (  UpToDateRule rule : rules) {
    states.add(rule.create(task,previousExecution,currentExecution));
  }
  return new TaskUpToDateState(){
    public void checkUpToDate(    Collection<String> messages){
      for (int i=0; messages.isEmpty() && i < states.size(); i++) {
        TaskUpToDateState state=states.get(i);
        state.checkUpToDate(messages);
      }
    }
    public void snapshotBeforeTask(){
      for (      TaskUpToDateState state : states) {
        state.snapshotBeforeTask();
      }
    }
    public void snapshotAfterTask(){
      for (      TaskUpToDateState state : states) {
        state.snapshotAfterTask();
      }
    }
  }
;
}
