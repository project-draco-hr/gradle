{
  if (gradleHome == null || !gradleHome.exists()) {
    throw new RuntimeException("Gradle home not defined!");
  }
  if (bootStrapDebug) {
    System.out.println("Gradle Home is declared by system property gradle.home to: " + gradleHome.getAbsolutePath());
  }
  System.setProperty("gradle.home",gradleHome.getAbsolutePath());
  List<URL> loggingJars=toUrl(getLoggingJars());
  List<File> nonLoggingJarFiles=getNonLoggingJars();
  removeUnwantedJarFiles(nonLoggingJarFiles,loadOpenAPI);
  List<URL> nonLoggingJars=toUrl(nonLoggingJarFiles);
  if (bootStrapDebug) {
    System.out.println("Parent Classloader of new context classloader is: " + parentClassloader);
    System.out.println("Adding the following files to new logging classloader: " + loggingJars);
    System.out.println("Adding the following files to new lib classloader: " + nonLoggingJars);
  }
  URLClassLoader loggingClassLoader=new URLClassLoader(loggingJars.toArray(new URL[loggingJars.size()]),parentClassloader);
  if (useParentLastClassLoader) {
    libClassLoader=new ParentLastClassLoader(nonLoggingJars.toArray(new URL[nonLoggingJars.size()]),loggingClassLoader);
  }
 else {
    libClassLoader=new URLClassLoader(nonLoggingJars.toArray(new URL[nonLoggingJars.size()]),loggingClassLoader);
  }
  if (bootStrapDebug) {
    System.out.println("Logging class loader: " + loggingClassLoader);
    System.out.println("Lib class loader: " + libClassLoader);
  }
}
