{
  ImplementationFactory<? extends PUBLIC,? extends BASEIMPL> implementationFactory=factories.get(implementationClass);
  if (implementationFactory != null) {
    return Cast.uncheckedCast(implementationFactory);
  }
  Class<?> superclass=implementationClass.getSuperclass();
  if (superclass != null && baseImplementation.isAssignableFrom(superclass)) {
    implementationFactory=findFactory(superclass.asSubclass(baseImplementation));
    factories.put(implementationClass,implementationFactory);
    return Cast.uncheckedCast(implementationFactory);
  }
  return null;
}
