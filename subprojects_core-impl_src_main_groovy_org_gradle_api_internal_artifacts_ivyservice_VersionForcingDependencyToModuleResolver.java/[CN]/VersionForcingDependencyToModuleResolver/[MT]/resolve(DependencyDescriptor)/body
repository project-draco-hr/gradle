{
  ModuleVersionSelector module=new DefaultModuleVersionSelector(dependencyDescriptor.getDependencyRevisionId().getOrganisation(),dependencyDescriptor.getDependencyRevisionId().getName(),dependencyDescriptor.getDependencyRevisionId().getRevision());
  DefaultDependencyResolveDetails details=new DefaultDependencyResolveDetails(module);
  try {
    rule.execute(details);
  }
 catch (  Throwable e) {
    return new FailedDependencyResolveRuleResult(module,e);
  }
  if (details.isUpdated()) {
    ModuleId moduleId=new ModuleId(details.getTarget().getGroup(),details.getTarget().getName());
    ModuleRevisionId revisionId=new ModuleRevisionId(moduleId,details.getTarget().getVersion());
    DependencyDescriptor descriptor=descriptorFactory.create(dependencyDescriptor,revisionId);
    ModuleVersionIdResolveResult result=resolver.resolve(descriptor);
    return new SubstitutedModuleVersionIdResolveResult(result,details.getSelectionReason());
  }
  return resolver.resolve(dependencyDescriptor);
}
