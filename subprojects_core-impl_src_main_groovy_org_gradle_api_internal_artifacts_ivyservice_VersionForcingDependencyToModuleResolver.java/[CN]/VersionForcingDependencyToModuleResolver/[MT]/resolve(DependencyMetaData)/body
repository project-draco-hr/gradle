{
  ModuleVersionSelector module=dependency.getRequested();
  DefaultDependencyResolveDetails details=new DefaultDependencyResolveDetails(module);
  try {
    rule.execute(details);
  }
 catch (  Throwable e) {
    return new FailedDependencyResolveRuleResult(module,e);
  }
  if (details.isUpdated()) {
    DependencyMetaData substitutedDependency=dependency.withRequestedVersion(details.getTarget());
    ModuleVersionIdResolveResult result=resolver.resolve(substitutedDependency);
    return new SubstitutedModuleVersionIdResolveResult(result,details.getSelectionReason(),details.getPreferredTarget());
  }
  return resolver.resolve(dependency);
}
