{
  return new CompilerDaemon(){
    public <T extends CompileSpec>CompileResult execute(    Compiler<T> compiler,    T spec){
      ClassLoader groovyClassLoader=classLoaderFactory.createIsolatedClassLoader(new DefaultClassPath(forkOptions.getClasspath()));
      GroovySystemLoader groovyLoader=groovySystemLoaderFactory.forClassLoader(groovyClassLoader);
      FilteringClassLoader filteredGroovy=classLoaderFactory.createFilteringClassLoader(groovyClassLoader);
      for (      String packageName : forkOptions.getSharedPackages()) {
        filteredGroovy.allowPackage(packageName);
      }
      FilteringClassLoader loggingClassLoader=classLoaderFactory.createFilteringClassLoader(compiler.getClass().getClassLoader());
      loggingClassLoader.allowPackage("org.slf4j");
      loggingClassLoader.allowClass(Logger.class);
      loggingClassLoader.allowClass(LogLevel.class);
      ClassLoader groovyAndLoggingClassLoader=new CachingClassLoader(new MultiParentClassLoader(loggingClassLoader,filteredGroovy));
      ClassLoader workerClassLoader=new MutableURLClassLoader(groovyAndLoggingClassLoader,ClasspathUtil.getClasspath(compiler.getClass().getClassLoader()));
      try {
        byte[] serializedWorker=GUtil.serialize(new Worker<T>(compiler,spec,gradleUserHomeDir));
        ClassLoaderObjectInputStream inputStream=new ClassLoaderObjectInputStream(new ByteArrayInputStream(serializedWorker),workerClassLoader);
        Callable<?> worker=(Callable<?>)inputStream.readObject();
        Object result=worker.call();
        byte[] serializedResult=GUtil.serialize(result);
        inputStream=new ClassLoaderObjectInputStream(new ByteArrayInputStream(serializedResult),getClass().getClassLoader());
        return (CompileResult)inputStream.readObject();
      }
 catch (      Exception e) {
        throw UncheckedException.throwAsUncheckedException(e);
      }
 finally {
        groovyLoader.shutdown();
      }
    }
  }
;
}
