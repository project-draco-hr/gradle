{
  ModelRegistryDslHelperStatementGenerator statementGenerator=new ModelRegistryDslHelperStatementGenerator();
  BlockStatement rootStatementBlock=source.getAST().getStatementBlock();
  ListIterator<Statement> statementsIterator=rootStatementBlock.getStatements().listIterator();
  while (statementsIterator.hasNext()) {
    Statement statement=statementsIterator.next();
    ScriptBlock scriptBlock=AstUtils.detectScriptBlock(statement,SCRIPT_BLOCK_NAMES);
    if (scriptBlock != null) {
      statementsIterator.remove();
      ScopeVisitor scopeVisitor=new ScopeVisitor(source,statementGenerator);
      scriptBlock.getClosureExpression().getCode().visit(scopeVisitor);
    }
  }
  rootStatementBlock.addStatements(statementGenerator.getGeneratedStatements());
}
