{
  try {
    try {
      InputStream inputStream=new BufferedInputStream(Channels.newInputStream(socket));
      ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
      while (true) {
        Message message=Message.receive(inputStream,classLoader);
        if (message instanceof EndOfStream) {
          return;
        }
        Event event=(Event)message;
        try {
          broadcaster.dispatch(event);
        }
 catch (        Exception e) {
          if (exceptionListener != null) {
            exceptionListener.receiverThrewException(e);
          }
        }
      }
    }
  finally {
      socket.close();
    }
  }
 catch (  Exception e) {
    LOGGER.warn("Could not handle remote event connection.",e);
  }
}
