{
  this.executor=executor;
  this.sourceAddress=sourceAddress;
  this.destinationAddress=destinationAddress;
  outgoingQueue=new AsyncDispatch<Message>(executor);
  outgoingQueue.dispatchTo(wrapFailures(connection));
  outgoingDispatch=new EndOfStreamDispatch(outgoingQueue);
  incomingDemux=new IncomingDemultiplex();
  incomingDispatch=new EndOfStreamFilter(incomingDemux,new Runnable(){
    public void run(){
      requestStop();
    }
  }
);
  incomingQueue=new AsyncDispatch<Message>(executor);
  incomingQueue.dispatchTo(wrapFailures(incomingDispatch));
  incomingQueue.receiveFrom(connection);
}
