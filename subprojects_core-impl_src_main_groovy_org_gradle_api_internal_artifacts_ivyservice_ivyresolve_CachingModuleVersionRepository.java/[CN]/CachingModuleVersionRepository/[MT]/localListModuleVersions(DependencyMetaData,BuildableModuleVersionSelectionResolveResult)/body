{
  ModuleVersionSelector requested=dependency.getRequested();
  final ModuleIdentifier moduleId=moduleExtractor.transform(requested);
  ModuleVersionsCache.CachedModuleVersionList cachedModuleVersionList=moduleVersionsCache.getCachedModuleResolution(delegate,moduleId);
  if (cachedModuleVersionList != null) {
    ModuleVersionListing versionList=cachedModuleVersionList.getModuleVersions();
    Set<ModuleVersionIdentifier> versions=CollectionUtils.collect(versionList.getVersions(),new Transformer<ModuleVersionIdentifier,Versioned>(){
      public ModuleVersionIdentifier transform(      Versioned original){
        return new DefaultModuleVersionIdentifier(moduleId,original.getVersion());
      }
    }
);
    if (cachePolicy.mustRefreshVersionList(moduleId,versions,cachedModuleVersionList.getAgeMillis())) {
      LOGGER.debug("Version listing in dynamic revision cache is expired: will perform fresh resolve of '{}' in '{}'",requested,delegate.getName());
    }
 else {
      if (versionList.isEmpty()) {
        if (cachedModuleVersionList.getAgeMillis() == 0) {
          result.noVersions();
        }
 else {
          result.probablyNoVersions();
        }
      }
 else {
        result.listed(versionList);
      }
    }
  }
}
