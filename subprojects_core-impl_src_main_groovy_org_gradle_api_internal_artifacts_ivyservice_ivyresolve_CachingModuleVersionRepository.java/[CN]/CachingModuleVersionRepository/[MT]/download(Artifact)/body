{
  if (isLocal()) {
    return delegate.download(artifact);
  }
  CachedArtifactResolution cachedArtifactResolution=artifactResolutionCache.getCachedArtifactResolution(delegate,artifact.getId());
  if (cachedArtifactResolution != null) {
    ArtifactIdentifier artifactIdentifier=createArtifactIdentifier(artifact);
    File cachedArtifactFile=cachedArtifactResolution.getArtifactFile();
    if (cachedArtifactFile == null) {
      if (!cachePolicy.mustRefreshArtifact(artifactIdentifier,null,cachedArtifactResolution.getAgeMillis())) {
        LOGGER.debug("Detected non-existence of artifact '{}' in resolver cache",artifact.getId());
        return null;
      }
    }
 else     if (cachedArtifactFile.exists()) {
      if (!cachePolicy.mustRefreshArtifact(artifactIdentifier,cachedArtifactFile,cachedArtifactResolution.getAgeMillis())) {
        LOGGER.debug("Found artifact '{}' in resolver cache: {}",artifact.getId(),cachedArtifactFile);
        return new DownloadedArtifact(cachedArtifactFile,cachedArtifactResolution.getArtifactLastModified(),cachedArtifactResolution.getArtifactUrl());
      }
    }
  }
  DownloadedArtifact downloadedArtifact=delegate.download(artifact);
  LOGGER.debug("Downloaded artifact '{}' from resolver: {}",artifact.getId(),downloadedArtifact.getLocalFile());
  artifactResolutionCache.storeArtifactFile(delegate,artifact.getId(),downloadedArtifact.getLocalFile(),downloadedArtifact.getLastModified(),downloadedArtifact.getSource());
  return downloadedArtifact;
}
