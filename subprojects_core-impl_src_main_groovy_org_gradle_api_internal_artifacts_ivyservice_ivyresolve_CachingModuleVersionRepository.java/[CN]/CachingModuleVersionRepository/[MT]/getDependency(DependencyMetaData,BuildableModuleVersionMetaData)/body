{
  DependencyMetaData forced=dependency.withChanging();
  delegate.getDependency(forced,result);
switch (result.getState()) {
case Missing:
    final ModuleRevisionId dependencyRevisionId=dependency.getDescriptor().getDependencyRevisionId();
  final DefaultModuleVersionIdentifier moduleVersionIdentifier=new DefaultModuleVersionIdentifier(dependencyRevisionId.getOrganisation(),dependencyRevisionId.getName(),dependencyRevisionId.getRevision());
moduleDescriptorCache.cacheModuleDescriptor(delegate,moduleVersionIdentifier,null,null,dependency.isChanging());
break;
case Resolved:
moduleResolutionCache.cacheModuleResolution(delegate,dependency.getDescriptor().getDependencyRevisionId(),result.getId());
final ModuleSource moduleSource=result.getModuleSource();
final ModuleDescriptorCache.CachedModuleDescriptor cachedModuleDescriptor=moduleDescriptorCache.cacheModuleDescriptor(delegate,result.getId(),result.getDescriptor(),moduleSource,isChangingDependency(dependency,result));
result.setModuleSource(new CachingModuleSource(cachedModuleDescriptor.getDescriptorHash(),cachedModuleDescriptor.isChangingModule(),moduleSource));
break;
case Failed:
break;
default :
throw new IllegalStateException("Unexpected resolve state: " + result.getState());
}
}
