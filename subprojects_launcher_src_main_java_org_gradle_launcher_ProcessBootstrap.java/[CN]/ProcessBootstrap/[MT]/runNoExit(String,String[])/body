{
  ClassPathRegistry classPathRegistry=new DefaultClassPathRegistry(new DefaultClassPathProvider(new DefaultModuleRegistry()));
  ClassLoaderFactory classLoaderFactory=new DefaultClassLoaderFactory();
  Set<URL> antClasspath=classPathRegistry.getClassPath("ANT");
  URL[] runtimeClasspath=classPathRegistry.getClassPathUrls("GRADLE_RUNTIME");
  ClassLoader antClassLoader=classLoaderFactory.createIsolatedClassLoader(antClasspath);
  ClassLoader runtimeClassLoader=new URLClassLoader(runtimeClasspath,antClassLoader);
  Thread.currentThread().setContextClassLoader(runtimeClassLoader);
  Class mainClass=runtimeClassLoader.loadClass(mainClassName);
  Method mainMethod=mainClass.getMethod("main",String[].class);
  mainMethod.invoke(null,new Object[]{args});
}
