{
  ClassPathRegistry classPathRegistry=new DefaultClassPathRegistry(new DefaultClassPathProvider(new DefaultModuleRegistry()));
  ClassLoaderFactory classLoaderFactory=new DefaultClassLoaderFactory();
  ClassPath antClasspath=classPathRegistry.getClassPath("ANT");
  ClassPath runtimeClasspath=classPathRegistry.getClassPath("GRADLE_RUNTIME");
  ClassLoader antClassLoader=classLoaderFactory.createIsolatedClassLoader(antClasspath);
  ClassLoader runtimeClassLoader=new MutableURLClassLoader(antClassLoader,runtimeClasspath);
  Thread.currentThread().setContextClassLoader(runtimeClassLoader);
  Class<?> mainClass=runtimeClassLoader.loadClass(mainClassName);
  Method mainMethod=mainClass.getMethod("main",String[].class);
  mainMethod.invoke(null,new Object[]{args});
}
