{
  return new ForkingGradleHandle(getResultAssertion(),getDefaultCharacterEncoding(),new Factory<JavaExecHandleBuilder>(){
    public JavaExecHandleBuilder create(){
      JavaExecHandleBuilder builder=new JavaExecHandleBuilder(TestFiles.resolver());
      builder.workingDir(getWorkingDir());
      Collection<File> classpath=GLOBAL_SERVICES.get(ModuleRegistry.class).getAdditionalClassPath().getAsFiles();
      builder.classpath(classpath);
      builder.jvmArgs(getLauncherJvmOpts());
      builder.setMain(Main.class.getName());
      builder.args(getAllArgs());
      builder.setStandardInput(getStdin());
      if (isDebug()) {
        builder.jvmArgs(DEBUG_ARGS);
      }
      return builder;
    }
  }
).start();
}
