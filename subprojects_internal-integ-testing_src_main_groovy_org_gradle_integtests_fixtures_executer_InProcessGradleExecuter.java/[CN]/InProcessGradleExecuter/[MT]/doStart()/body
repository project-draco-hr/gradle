{
  return new ForkingGradleHandle(getResultAssertion(),getDefaultCharacterEncoding(),new Factory<JavaExecHandleBuilder>(){
    public JavaExecHandleBuilder create(){
      JavaExecHandleBuilder builder=new JavaExecHandleBuilder(TestFiles.resolver());
      builder.workingDir(getWorkingDir());
      Set<File> classpath=new DefaultModuleRegistry().getFullClasspath();
      builder.classpath(classpath);
      builder.setMain(Main.class.getName());
      builder.args(getAllArgs());
      builder.setStandardInput(getStdin());
      if (isDebugModeEnabled()) {
        builder.args("--debug");
        builder.jvmArgs("-Xdebug","-Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005");
      }
      return builder;
    }
  }
).start();
}
