{
  InputStream originalStdIn=System.in;
  Properties originalSysProperties=new Properties();
  originalSysProperties.putAll(System.getProperties());
  File originalUserDir=new File(originalSysProperties.getProperty("user.dir"));
  Map<String,String> originalEnv=new HashMap<String,String>(System.getenv());
  System.setIn(getStdin());
  processEnvironment.maybeSetProcessDir(getWorkingDir());
  for (  Map.Entry<String,String> entry : getEnvironmentVars().entrySet()) {
    processEnvironment.maybeSetEnvironmentVariable(entry.getKey(),entry.getValue());
  }
  Map<String,String> implicitJvmSystemProperties=getImplicitJvmSystemProperties();
  System.getProperties().putAll(implicitJvmSystemProperties);
  StartParameter startParameter=new StartParameter();
  startParameter.setCurrentDir(getWorkingDir());
  startParameter.setShowStacktrace(ShowStacktrace.ALWAYS);
  CommandLineParser parser=new CommandLineParser();
  DefaultCommandLineConverter converter=new DefaultCommandLineConverter();
  converter.configure(parser);
  ParsedCommandLine parsedCommandLine=parser.parse(getAllArgs());
  BuildLayoutParameters layout=converter.getLayoutConverter().convert(parsedCommandLine,new BuildLayoutParameters());
  Map<String,String> properties=new HashMap<String,String>();
  new LayoutToPropertiesConverter().convert(layout,properties);
  converter.getSystemPropertiesConverter().convert(parsedCommandLine,properties);
  new PropertiesToStartParameterConverter().convert(properties,startParameter);
  converter.convert(parsedCommandLine,startParameter);
  BuildActionExecuter<BuildActionParameters> actionExecuter=GLOBAL_SERVICES.get(BuildActionExecuter.class);
  ListenerManager listenerManager=GLOBAL_SERVICES.get(ListenerManager.class);
  listenerManager.addListener(listener);
  try {
    BuildAction action=new ExecuteBuildAction(startParameter);
    BuildActionParameters buildActionParameters=new DefaultBuildActionParameters(System.getProperties(),System.getenv(),SystemProperties.getInstance().getCurrentDir(),startParameter.getLogLevel(),DaemonUsage.EXPLICITLY_DISABLED);
    BuildRequestContext buildRequestContext=new DefaultBuildRequestContext(new DefaultBuildRequestMetaData(new GradleLauncherMetaData(),ManagementFactory.getRuntimeMXBean().getStartTime()),new FixedBuildCancellationToken(),new NoOpBuildEventConsumer(),outputListener,errorListener);
    actionExecuter.execute(action,buildRequestContext,buildActionParameters);
    return new BuildResult(null,null);
  }
 catch (  ReportedException e) {
    return new BuildResult(null,e.getCause());
  }
 finally {
    System.setProperties(originalSysProperties);
    processEnvironment.maybeSetProcessDir(originalUserDir);
    for (    String envVar : getEnvironmentVars().keySet()) {
      String oldValue=originalEnv.get(envVar);
      if (oldValue != null) {
        processEnvironment.maybeSetEnvironmentVariable(envVar,oldValue);
      }
 else {
        processEnvironment.maybeRemoveEnvironmentVariable(envVar);
      }
    }
    listenerManager.removeListener(listener);
    System.setIn(originalStdIn);
  }
}
