{
  InputStream originalStdIn=System.in;
  Properties originalSysProperties=new Properties();
  originalSysProperties.putAll(System.getProperties());
  File originalUserDir=new File(originalSysProperties.getProperty("user.dir"));
  Map<String,String> originalEnv=new HashMap<String,String>(System.getenv());
  GradleInvocation invocation=buildInvocation();
  System.setIn(connectStdIn());
  processEnvironment.maybeSetProcessDir(getWorkingDir());
  for (  Map.Entry<String,String> entry : invocation.environmentVars.entrySet()) {
    processEnvironment.maybeSetEnvironmentVariable(entry.getKey(),entry.getValue());
  }
  Map<String,String> implicitJvmSystemProperties=getImplicitJvmSystemProperties();
  System.getProperties().putAll(implicitJvmSystemProperties);
  StartParameter startParameter=new StartParameter();
  startParameter.setCurrentDir(getWorkingDir());
  startParameter.setShowStacktrace(ShowStacktrace.ALWAYS);
  CommandLineParser parser=new CommandLineParser();
  ParametersConverter parametersConverter=new ParametersConverter();
  parametersConverter.configure(parser);
  parametersConverter.convert(parser.parse(getAllArgs()),new Parameters(startParameter));
  BuildActionExecuter<BuildActionParameters> actionExecuter=GLOBAL_SERVICES.get(BuildActionExecuter.class);
  ListenerManager listenerManager=GLOBAL_SERVICES.get(ListenerManager.class);
  listenerManager.addListener(listener);
  try {
    BuildAction action=new ExecuteBuildAction(startParameter);
    BuildActionParameters buildActionParameters=new DefaultBuildActionParameters(System.getProperties(),System.getenv(),SystemProperties.getInstance().getCurrentDir(),startParameter.getLogLevel(),DaemonUsage.EXPLICITLY_DISABLED,startParameter.isContinuous(),interactive,classpath);
    BuildRequestContext buildRequestContext=new DefaultBuildRequestContext(new DefaultBuildRequestMetaData(new GradleLauncherMetaData(),System.currentTimeMillis()),new DefaultBuildCancellationToken(),new NoOpBuildEventConsumer(),outputListener,errorListener);
    actionExecuter.execute(action,buildRequestContext,buildActionParameters,GLOBAL_SERVICES);
    return new BuildResult(null,null);
  }
 catch (  ReportedException e) {
    return new BuildResult(null,e.getCause());
  }
 finally {
    System.setProperties(originalSysProperties);
    processEnvironment.maybeSetProcessDir(originalUserDir);
    for (    String envVar : invocation.environmentVars.keySet()) {
      String oldValue=originalEnv.get(envVar);
      if (oldValue != null) {
        processEnvironment.maybeSetEnvironmentVariable(envVar,oldValue);
      }
 else {
        processEnvironment.maybeRemoveEnvironmentVariable(envVar);
      }
    }
    listenerManager.removeListener(listener);
    System.setIn(originalStdIn);
  }
}
