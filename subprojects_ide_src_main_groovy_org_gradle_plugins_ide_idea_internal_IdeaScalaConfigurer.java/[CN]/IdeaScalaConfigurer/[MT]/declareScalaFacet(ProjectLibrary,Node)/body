{
  Node facetManager=findFirstChildWithAttributeValue(iml,"component","name","FacetManager");
  if (facetManager == null) {
    Map<String,Object> attributes=Maps.newHashMapWithExpectedSize(1);
    attributes.put("name","FacetManager");
    facetManager=iml.appendNode("component",attributes);
  }
  Node scalaFacet=findFirstChildWithAttributeValue(facetManager,"facet","type","scala");
  if (scalaFacet == null) {
    Map<String,Object> attributes=Maps.newHashMapWithExpectedSize(2);
    attributes.put("type","scala");
    attributes.put("name","Scala");
    scalaFacet=facetManager.appendNode("facet",attributes);
  }
  Node configuration=findFirstChildNamed(scalaFacet,"configuration");
  if (configuration == null) {
    configuration=scalaFacet.appendNode("configuration");
  }
  Node libraryLevel=findFirstChildWithAttributeValue(configuration,"option","name","compilerLibraryLevel");
  if (libraryLevel == null) {
    Map<String,Object> attributes=Maps.newHashMapWithExpectedSize(2);
    attributes.put("name","compilerLibraryLevel");
    libraryLevel=configuration.appendNode("option",attributes);
  }
  libraryLevel.attributes().put("value","Project");
  Node libraryName=findFirstChildWithAttributeValue(configuration,"option","name","compilerLibraryName");
  if (libraryName == null) {
    Map<String,Object> attributes=Maps.newHashMapWithExpectedSize(2);
    attributes.put("name","compilerLibraryName");
    libraryName=configuration.appendNode("option",attributes);
  }
  libraryName.attributes().put("value",scalaCompilerLibrary.getName());
}
