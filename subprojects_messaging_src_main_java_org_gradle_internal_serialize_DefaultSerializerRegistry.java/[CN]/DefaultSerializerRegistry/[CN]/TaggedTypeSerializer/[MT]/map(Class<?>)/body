{
  Class<?> targetType=Throwable.class.isAssignableFrom(valueType) ? Throwable.class : valueType;
  TypeInfo typeInfo=serializersByType.get(targetType);
  if (typeInfo != null) {
    return typeInfo;
  }
  for (  Class<?> candidate : javaSerialization) {
    if (candidate.isAssignableFrom(targetType)) {
      return JAVA_SERIALIZATION;
    }
  }
  throw new IllegalArgumentException(String.format("Don't know how to serialize an object of type %s.",valueType.getName()));
}
