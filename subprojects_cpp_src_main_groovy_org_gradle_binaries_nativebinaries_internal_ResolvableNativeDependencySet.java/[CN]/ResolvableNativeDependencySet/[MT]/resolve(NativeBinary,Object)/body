{
  if (lib instanceof NativeDependencySet) {
    return (NativeDependencySet)lib;
  }
  if (lib instanceof Library) {
    return resolve(target,((Library)lib).getShared());
  }
  if (lib instanceof ConfigurableLibraryResolver) {
    return ((ConfigurableLibraryResolver)lib).withFlavor(target.getFlavor()).resolve();
  }
  if (lib instanceof LibraryResolver) {
    return ((LibraryResolver)lib).resolve();
  }
  throw new InvalidUserDataException("Not a valid type for a library dependency: " + lib);
}
