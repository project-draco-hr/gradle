{
  execSpec.classpath(classPathRegistry.getClassPath("WORKER_MAIN").getAsFiles());
  Object requestedSecurityManager=execSpec.getSystemProperties().get("java.security.manager");
  if (requestedSecurityManager != null) {
    execSpec.systemProperty("org.gradle.security.manager",requestedSecurityManager);
  }
  execSpec.systemProperty("java.security.manager",BootstrapSecurityManager.class.getName());
  try {
    ByteArrayOutputStream bytes=new ByteArrayOutputStream();
    DataOutputStream outstr=new DataOutputStream(new EncodedStream.EncodedOutput(bytes));
    LOGGER.debug("Writing an application classpath to child process' standard input.");
    outstr.writeInt(processBuilder.getApplicationClasspath().size());
    for (    File file : processBuilder.getApplicationClasspath()) {
      outstr.writeUTF(file.getAbsolutePath());
    }
    outstr.close();
    final InputStream originalStdin=execSpec.getStandardInput();
    InputStream input=ByteStreams.join(ByteStreams.newInputStreamSupplier(bytes.toByteArray()),new InputSupplier<InputStream>(){
      public InputStream getInput() throws IOException {
        return originalStdin;
      }
    }
).getInput();
    execSpec.setStandardInput(input);
  }
 catch (  IOException e) {
    throw new UncheckedIOException(e);
  }
}
