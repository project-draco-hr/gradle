{
  final SelfResolvingDependency dependency=context.mock(SelfResolvingDependency.class);
  context.checking(new Expectations(){
{
      one(delegate).resolve(configuration,ivy,moduleDescriptor);
      will(returnValue(resolvedConfiguration));
      allowing(configuration).getAllDependencies(SelfResolvingDependency.class);
      will(returnValue(toSet(dependency)));
    }
  }
);
  ResolvedConfiguration actualResolvedConfiguration=resolver.resolve(this.configuration,ivy,moduleDescriptor);
  assertThat(actualResolvedConfiguration,not(sameInstance(resolvedConfiguration)));
  final File configFile=new File("from config");
  final File depFile=new File("from dep");
  final boolean transitive=true;
  context.checking(new Expectations(){
{
      allowing(configuration);
      will(returnValue(transitive));
      one(resolvedConfiguration).getFiles(Specs.SATISFIES_ALL);
      will(returnValue(toSet(configFile)));
      one(dependency).resolve(transitive);
      will(returnValue(toSet(depFile)));
    }
  }
);
  assertThat(actualResolvedConfiguration.getFiles(Specs.SATISFIES_ALL),equalTo(toLinkedSet(depFile,configFile)));
}
