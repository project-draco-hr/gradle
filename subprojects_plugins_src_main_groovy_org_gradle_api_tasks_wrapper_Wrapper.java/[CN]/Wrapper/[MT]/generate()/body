{
  File jarFileDestination=getJarFile();
  File propertiesFileDestination=getPropertiesFile();
  File scriptFileDestination=getScriptFile();
  FileResolver resolver=getServices().get(FileResolver.class).withBaseDir(scriptFileDestination.getParentFile());
  String jarFileRelativePath=resolver.resolveAsRelativePath(jarFileDestination);
  String propertiesFileRelativePath=resolver.resolveAsRelativePath(propertiesFileDestination);
  propertiesFileDestination.delete();
  jarFileDestination.delete();
  scriptFileDestination.delete();
  writeProperties(propertiesFileDestination);
  URL jarFileSource=getClass().getResource("/gradle-wrapper.jar");
  if (jarFileSource == null) {
    throw new GradleException("Cannot locate wrapper JAR resource.");
  }
  GFileUtils.copyURLToFile(jarFileSource,jarFileDestination);
  wrapperScriptGenerator.generate(jarFileRelativePath,propertiesFileRelativePath,scriptFileDestination);
}
