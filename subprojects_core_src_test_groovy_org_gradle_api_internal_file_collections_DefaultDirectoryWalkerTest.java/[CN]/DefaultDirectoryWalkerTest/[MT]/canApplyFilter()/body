{
  final MockFile root=new MockFile(context,"root",false);
  root.addFile("rootFile1");
  final MockFile dir1=root.addDir("dir1");
  dir1.addFile("dirFile1");
  final MockFile dirFile2=dir1.addFile("dirFile2");
  root.addFile("rootFile2");
  root.setExpectations();
  final Sequence visiting=context.sequence("visiting");
  context.checking(new Expectations(){
{
      one(visitor).visitDir(with(file(dir1)));
      inSequence(visiting);
      one(visitor).visitFile(with(file(dirFile2)));
      inSequence(visiting);
    }
  }
);
  PatternSet patterns=new PatternSet();
  patterns.include("**/*2");
  PatternSet filter=new PatternSet();
  filter.include("dir1/**");
  DirectoryFileTree fileTree=new DirectoryFileTree(root.getMock(),patterns,directoryWalkerFactory).filter(filter);
  fileTree.visit(visitor);
}
