{
  final Task target=context.mock(Task.class,"target");
  final Task projectDepTaskDummy=context.mock(Task.class,"projectDepTask");
  final Task fileDepTaskDummy=context.mock(Task.class,"fileDepTask");
  final ProjectDependency projectDependencyStub=context.mock(ProjectDependency.class);
  final FileCollectionDependency fileCollectionDependencyStub=context.mock(FileCollectionDependency.class);
  context.checking(new Expectations(){
{
      TaskDependency projectTaskDependencyDummy=context.mock(TaskDependency.class,"projectDep");
      TaskDependency fileTaskDependencyStub=context.mock(TaskDependency.class,"fileDep");
      allowing(projectDependencyStub).getBuildDependencies();
      will(returnValue(projectTaskDependencyDummy));
      allowing(projectTaskDependencyDummy).getDependencies(target);
      will(returnValue(toSet(projectDepTaskDummy)));
      allowing(fileCollectionDependencyStub).getBuildDependencies();
      will(returnValue(fileTaskDependencyStub));
      allowing(fileTaskDependencyStub).getDependencies(target);
      will(returnValue(toSet(fileDepTaskDummy)));
    }
  }
);
  configuration.addDependency(projectDependencyStub);
  configuration.addDependency(fileCollectionDependencyStub);
  assertThat(configuration.getBuildDependencies().getDependencies(target),equalTo((Set)toSet(fileDepTaskDummy,projectDepTaskDummy)));
}
