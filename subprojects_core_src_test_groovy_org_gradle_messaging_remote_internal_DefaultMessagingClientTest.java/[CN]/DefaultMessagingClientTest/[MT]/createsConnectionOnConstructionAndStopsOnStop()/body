{
  final Address serverAddress=context.mock(Address.class);
  final MultiChannelConnection<Message> connection=context.mock(MultiChannelConnection.class);
  context.checking(new Expectations(){
{
      one(connector).connect(serverAddress);
      will(returnValue(connection));
    }
  }
);
  DefaultMessagingClient client=new DefaultMessagingClient(connector,getClass().getClassLoader(),serverAddress);
  context.checking(new Expectations(){
{
      one(connection).stop();
    }
  }
);
  client.stop();
}
