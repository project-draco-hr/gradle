{
  try {
    try {
      while (true) {
        SocketChannel socket=serverSocket.accept();
        InetSocketAddress remoteSocketAddress=(InetSocketAddress)socket.socket().getRemoteSocketAddress();
        if (!localAddresses.contains(remoteSocketAddress.getAddress())) {
          LOGGER.error("Cannot accept connection from remote address {}.",remoteSocketAddress.getAddress());
          socket.close();
          continue;
        }
        Address remoteAddress=new SocketInetAddress(remoteSocketAddress.getAddress(),remoteSocketAddress.getPort());
        LOGGER.debug("Accepted connection from {}.",remoteAddress);
        action.execute(new ConnectEvent<Connection<Object>>(new SocketConnection<Object>(socket,localAddress,remoteAddress,classLoader),localAddress,remoteAddress));
      }
    }
 catch (    ClosedChannelException e) {
    }
catch (    Exception e) {
      LOGGER.error("Could not accept remote connection.",e);
    }
  }
  finally {
    new CompositeStoppable(serverSocket).stop();
    serverSockets.remove(serverSocket);
  }
}
