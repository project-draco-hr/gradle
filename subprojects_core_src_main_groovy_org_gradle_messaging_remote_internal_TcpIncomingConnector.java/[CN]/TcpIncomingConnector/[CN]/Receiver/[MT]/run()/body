{
  try {
    try {
      while (true) {
        SocketChannel socket=serverSocket.accept();
        InetSocketAddress remoteAddress=(InetSocketAddress)socket.socket().getRemoteSocketAddress();
        if (!localAddresses.contains(remoteAddress.getAddress())) {
          LOGGER.error("Cannot accept connection from remote address {}.",remoteAddress.getAddress());
          socket.close();
          continue;
        }
        URI remoteUri=new URI(String.format("tcp://localhost:%d",remoteAddress.getPort()));
        LOGGER.debug("Accepted connection from {}.",remoteUri);
        action.execute(new ConnectEvent<Connection<Object>>(new SocketConnection<Object>(socket,localAddress,remoteUri,classLoader),localAddress,remoteUri));
      }
    }
 catch (    ClosedChannelException e) {
    }
catch (    Exception e) {
      LOGGER.error("Could not accept remote connection.",e);
    }
  }
  finally {
    new CompositeStoppable(serverSocket).stop();
    serverSockets.remove(serverSocket);
  }
}
