{
  final Test test=(Test)project.createTask(GUtil.map("type",Test.class,"dependsOn",TEST_COMPILE),TEST);
  test.conventionMapping(DefaultConventionsToPropertiesMapping.TEST);
  test.setResolveInstruction(new ConfigurationResolveInstructionModifier(TEST_RUNTIME));
  addDependsOnProjectDependencies(test,TEST_RUNTIME);
  test.doFirst(new TaskAction(){
    public void execute(    Task task){
      Test test=(Test)task;
      List unmanagedClasspathFromTestCompile=((Compile)test.getProject().task(TEST_COMPILE)).getUnmanagedClasspath();
      test.unmanagedClasspath(unmanagedClasspathFromTestCompile.toArray(new Object[unmanagedClasspathFromTestCompile.size()]));
    }
  }
);
}
