{
  final Test test=(Test)project.createTask(GUtil.map("type",Test.class,"dependsOn",TEST_COMPILE),TEST);
  test.conventionMapping(DefaultConventionsToPropertiesMapping.TEST);
  test.getOptions().setFork(true);
  test.getOptions().getForkOptions().setForkMode(ForkMode.PER_TEST);
  test.getOptions().getForkOptions().setDir(project.getProjectDir());
  test.doFirst(new TaskAction(){
    public void execute(    Task task,    Dag tasksGraph){
      Test test=(Test)task;
      List unmanagedClasspathFromTestCompile=((Compile)test.getProject().task(TEST_COMPILE)).getUnmanagedClasspath();
      test.unmanagedClasspath(unmanagedClasspathFromTestCompile.toArray(new Object[unmanagedClasspathFromTestCompile.size()]));
    }
  }
);
}
