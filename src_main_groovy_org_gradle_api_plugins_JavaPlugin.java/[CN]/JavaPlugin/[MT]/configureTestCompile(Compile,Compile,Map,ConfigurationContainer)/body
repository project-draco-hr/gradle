{
  testCompile.setDependsOn(WrapUtil.toSet(TEST_RESOURCES));
  testCompile.getSkipProperties().add(Task.AUTOSKIP_PROPERTY_PREFIX + TEST);
  configureCompileInternal(testCompile,propertyMapping);
  testCompile.setConfiguration(configurations.get(TEST_COMPILE));
  addDependsOnProjectDependencies(testCompile,TEST_COMPILE);
  return (Compile)testCompile.doFirst(new TaskAction(){
    public void execute(    Task task){
      Compile testCompile=(Compile)task;
      if (compile.getUnmanagedClasspath() != null) {
        testCompile.unmanagedClasspath((Object[])compile.getUnmanagedClasspath().toArray(new Object[compile.getUnmanagedClasspath().size()]));
      }
    }
  }
);
}
