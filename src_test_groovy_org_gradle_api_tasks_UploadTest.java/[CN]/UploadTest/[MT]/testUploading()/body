{
  final Configuration configurationMock=context.mock(Configuration.class);
  final PublishInstruction publishInstruction=new PublishInstruction();
  upload.setPublishInstruction(publishInstruction);
  upload.setConfiguration(configurationMock);
  upload.setProject(HelperUtil.createRootProject(projectRootDir));
  final DependencyResolver repository=upload.getRepositories().addMavenRepo();
  context.checking(new Expectations(){
{
      one(configurationMock).publish(WrapUtil.toList(repository),publishInstruction);
    }
  }
);
  upload.execute();
}
