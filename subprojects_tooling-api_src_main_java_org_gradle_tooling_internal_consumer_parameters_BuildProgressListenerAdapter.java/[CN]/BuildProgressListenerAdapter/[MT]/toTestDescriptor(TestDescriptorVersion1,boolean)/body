{
  if (fromCache) {
    TestOperationDescriptor cachedTestDescriptor=this.testDescriptorCache.get(testDescriptor.getId());
    if (cachedTestDescriptor == null) {
      throw new IllegalStateException(String.format("%s not available.",toString(testDescriptor)));
    }
 else {
      this.testDescriptorCache.remove(testDescriptor.getId());
      return cachedTestDescriptor;
    }
  }
 else {
    TestOperationDescriptor cachedTestDescriptor=this.testDescriptorCache.get(testDescriptor.getId());
    if (cachedTestDescriptor != null) {
      throw new IllegalStateException(String.format("%s already available.",toString(testDescriptor)));
    }
 else {
      final TestOperationDescriptor parent=getParentTestDescriptor(testDescriptor);
      TestOperationDescriptor newTestDescriptor=toTestDescriptor(testDescriptor,parent);
      testDescriptorCache.put(testDescriptor.getId(),newTestDescriptor);
      return newTestDescriptor;
    }
  }
}
