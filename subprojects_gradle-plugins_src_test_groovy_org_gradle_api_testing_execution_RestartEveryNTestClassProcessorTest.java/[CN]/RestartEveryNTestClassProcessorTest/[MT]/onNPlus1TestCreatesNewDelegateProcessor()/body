{
  context.checking(new Expectations(){
{
      one(factory).create();
      will(returnValue(delegate));
      one(delegate).processTestClass(test1);
      one(delegate).processTestClass(test2);
      one(delegate).endProcessing();
      TestClassProcessor delegate2=context.mock(TestClassProcessor.class,"delegate2");
      one(factory).create();
      will(returnValue(delegate2));
      one(delegate2).processTestClass(test3);
    }
  }
);
  processor.processTestClass(test1);
  processor.processTestClass(test2);
  processor.processTestClass(test3);
}
