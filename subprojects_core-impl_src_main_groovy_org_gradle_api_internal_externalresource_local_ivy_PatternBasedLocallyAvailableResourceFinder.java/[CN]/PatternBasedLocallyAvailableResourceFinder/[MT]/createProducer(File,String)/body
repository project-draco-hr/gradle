{
  return new Transformer<Factory<List<File>>,ArtifactRevisionId>(){
    public Factory<List<File>> transform(    final ArtifactRevisionId artifactId){
      return new Factory<List<File>>(){
        public List<File> create(){
          final List<File> files=new LinkedList<File>();
          if (artifactId != null) {
            getMatchingFiles(artifactId).visit(new EmptyFileVisitor(){
              public void visitFile(              FileVisitDetails fileDetails){
                files.add(fileDetails.getFile());
              }
            }
);
          }
          return files;
        }
      }
;
    }
    private MinimalFileTree getMatchingFiles(    ArtifactRevisionId artifact){
      String patternString=getArtifactPattern(artifact);
      return new SingleIncludePatternFileTree(baseDir,patternString);
    }
    private String getArtifactPattern(    ArtifactRevisionId artifactId){
      String substitute=pattern;
      substitute=IvyPatternHelper.substituteToken(substitute,"organisation",artifactId.getModuleRevisionId().getOrganisation().replace('/','.'));
      substitute=IvyPatternHelper.substituteToken(substitute,"organisation-path",artifactId.getModuleRevisionId().getOrganisation().replace('.','/'));
      Artifact dummyArtifact=new DefaultArtifact(artifactId,null,null,false);
      substitute=IvyPatternHelper.substitute(substitute,dummyArtifact);
      return substitute;
    }
  }
;
}
