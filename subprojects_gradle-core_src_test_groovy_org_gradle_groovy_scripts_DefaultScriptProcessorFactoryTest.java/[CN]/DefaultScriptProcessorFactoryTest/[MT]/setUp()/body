{
  context.setImposteriser(ClassImposteriser.INSTANCE);
  scriptCompilationHandlerMock=context.mock(ScriptCompilationHandler.class);
  scriptRunnerFactoryMock=context.mock(ScriptRunnerFactory.class);
  testClassLoader=new URLClassLoader(new URL[0]);
  testScriptFileDir=HelperUtil.makeNewTestDir("projectdir");
  testScriptFile=new File(testScriptFileDir,TEST_BUILD_FILE_NAME);
  testCacheDir=new File(new File(new File(testScriptFileDir,Project.CACHE_DIR_NAME),TEST_BUILD_FILE_NAME),"NoTransformer");
  expectedScript=context.mock(Script.class);
  expectedScriptRunner=context.mock(ScriptRunner.class);
  scriptProcessor=new DefaultScriptProcessorFactory(scriptCompilationHandlerMock,CacheUsage.ON,scriptRunnerFactoryMock);
  source=context.mock(ScriptSource.class);
  context.checking(new Expectations(){
{
      allowing(source).getDisplayName();
      will(returnValue("[script source]"));
    }
  }
);
  originalClassLoader=Thread.currentThread().getContextClassLoader();
  Thread.currentThread().setContextClassLoader(testClassLoader);
}
