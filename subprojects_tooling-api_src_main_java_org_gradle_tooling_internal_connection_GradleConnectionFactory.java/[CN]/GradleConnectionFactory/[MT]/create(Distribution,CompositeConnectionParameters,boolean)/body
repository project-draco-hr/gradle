{
  ConsumerActionExecutor lazyConnection;
  if (useDaemonCoordinator) {
    lazyConnection=new LazyConsumerActionExecutor(distribution,toolingImplementationLoader,loggingProvider,parameters);
  }
 else {
    lazyConnection=new LazyConsumerActionExecutor(distribution,new EmbeddedCoordinator(),loggingProvider,parameters);
  }
  ConsumerActionExecutor cancellableConnection=new CancellableConsumerActionExecutor(lazyConnection);
  ConsumerActionExecutor progressLoggingConnection=new ProgressLoggingConsumerActionExecutor(cancellableConnection,loggingProvider);
  ConsumerActionExecutor rethrowingErrorsConnection=new RethrowingErrorsConsumerActionExecutor(progressLoggingConnection);
  AsyncConsumerActionExecutor asyncConnection=new DefaultAsyncConsumerActionExecutor(rethrowingErrorsConnection,executorFactory);
  return new DefaultGradleConnection(asyncConnection,parameters);
}
