{
  final ServiceRegistry parent=context.mock(ServiceRegistry.class);
  @SuppressWarnings("unchecked") final Factory<Long> factory=context.mock(Factory.class);
  ServiceRegistry registry=new RegistryWithDecoratorMethods(parent);
  context.checking(new Expectations(){
{
      one(parent).getFactory(Long.class);
      will(returnValue(factory));
      allowing(factory).create();
      will(onConsecutiveCalls(returnValue(10L),returnValue(20L)));
    }
  }
);
  assertThat(registry.newInstance(Long.class),equalTo(12L));
  assertThat(registry.newInstance(Long.class),equalTo(22L));
}
