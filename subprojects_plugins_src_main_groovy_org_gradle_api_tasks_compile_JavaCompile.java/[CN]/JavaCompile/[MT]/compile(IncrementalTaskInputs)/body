{
  if (!compileOptions.isIncremental()) {
    compile();
    return;
  }
  SingleMessageLogger.incubatingFeatureUsed("Incremental java compilation");
  ClassDependenciesAnalyzer analyzer=new ClassDependenciesAnalyzer();
  JarSnapshotCache jarSnapshotCache=new JarSnapshotCache(new File(getProject().getBuildDir(),"jar-snapshot-cache.bin"));
  JarSnapshotter jarSnapshotter=new JarSnapshotter(new DefaultHasher(),analyzer);
  JarSnapshotsMaker jarSnapshotsMaker=new JarSnapshotsMaker(jarSnapshotCache,jarSnapshotter,new ClasspathJarFinder((FileOperations)getProject()));
  ClassDependencyInfoSerializer dependencyInfoSerializer=new ClassDependencyInfoSerializer(new File(getProject().getBuildDir(),"class-info.bin"));
  CompilationSourceDirs sourceDirs=new CompilationSourceDirs(source);
  SourceToNameConverter sourceToNameConverter=new SourceToNameConverter(sourceDirs);
  RecompilationSpecProvider recompilationSpecProvider=new RecompilationSpecProvider(sourceToNameConverter,dependencyInfoSerializer,(FileOperations)getProject(),jarSnapshotter,jarSnapshotCache);
  IncrementalCompilationSupport incrementalSupport=new IncrementalCompilationSupport(jarSnapshotsMaker,dependencyInfoSerializer,(FileOperations)getProject(),createCompiler(),getPath(),recompilationSpecProvider,new ClassDependencyInfoUpdater(dependencyInfoSerializer,(FileOperations)getProject(),analyzer));
  org.gradle.api.internal.tasks.compile.Compiler<JavaCompileSpec> compiler=incrementalSupport.prepareCompiler(inputs,sourceDirs);
  performCompilation(compiler);
}
