{
  final FileCopyDetails mappedDetails=expectActionExecutedWhenFileVisited();
  mappedDetails.setMode(0644);
  context.checking(new Expectations(){
{
      one(details).open();
      will(returnValue(new ByteArrayInputStream("content".getBytes())));
      one(details).isDirectory();
      will(returnValue(false));
      one(details).getLastModified();
      will(returnValue(90L));
    }
  }
);
  mappedDetails.filter(HelperUtil.toClosure("{ 'PREFIX: ' + it } "));
  TestFile destDir=tmpDir.getTestDirectory().file("test.txt");
  mappedDetails.copyTo(destDir);
  destDir.assertContents(equalTo("PREFIX: content"));
}
