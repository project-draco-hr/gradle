{
  GradleInternal gradle=buildController.getGradle();
  PayloadSerializer payloadSerializer=gradle.getServices().get(PayloadSerializer.class);
  final InternalBuildAction<?> action=(InternalBuildAction<?>)payloadSerializer.deserialize(this.action);
  gradle.addListener(new ModelConfigurationListener(){
    public void onConfigure(    final GradleInternal gradle){
      ensureAllProjectsEvaluated(gradle);
    }
  }
);
  buildController.configure();
  InternalBuildController internalBuildController=new DefaultBuildController(gradle);
  Object model=null;
  Throwable failure=null;
  try {
    model=action.execute(internalBuildController);
  }
 catch (  BuildCancelledException e) {
    failure=new InternalBuildCancelledException(e);
  }
catch (  RuntimeException e) {
    failure=new InternalBuildActionFailureException(e);
  }
  if (failure != null) {
    return new BuildActionResult(null,payloadSerializer.serialize(failure));
  }
  return new BuildActionResult(payloadSerializer.serialize(model),null);
}
