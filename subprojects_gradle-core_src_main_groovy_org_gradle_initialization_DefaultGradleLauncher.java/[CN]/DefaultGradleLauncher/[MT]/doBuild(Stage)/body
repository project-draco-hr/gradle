{
  addOutputListeners();
  outputCapture.start();
  buildListener.buildStarted(gradle);
  Throwable failure=null;
  try {
    doBuildStages(upTo);
  }
 catch (  Throwable t) {
    failure=exceptionAnalyser.transform(t);
  }
  BuildResult buildResult=new BuildResult(gradle,failure);
  buildListener.buildFinished(buildResult);
  outputCapture.stop();
  removeOutputListeners();
  return buildResult;
}
