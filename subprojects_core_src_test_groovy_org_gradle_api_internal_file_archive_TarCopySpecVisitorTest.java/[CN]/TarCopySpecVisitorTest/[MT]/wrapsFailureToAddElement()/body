{
  final TestFile tarFile=initializeTarFile(tmpDir.getDir().file("test.tar"),new SimpleCompressor());
  visitor.startVisit(copyAction);
  visitor.visitSpec(copySpec);
  Throwable failure=new RuntimeException("broken");
  try {
    visitor.visitFile(brokenFile("dir/file1",failure));
    fail();
  }
 catch (  GradleException e) {
    assertThat(e.getMessage(),equalTo(String.format("Could not add [dir/file1] to TAR '%s'.",tarFile)));
    assertThat(e.getCause(),sameInstance(failure));
  }
}
