{
  Class c=toClass(type);
  if (!Factory.class.isAssignableFrom(c)) {
    return null;
  }
  if (type instanceof ParameterizedType) {
    ParameterizedType parameterizedType=(ParameterizedType)type;
    if (parameterizedType.getRawType().equals(Factory.class) && parameterizedType.getActualTypeArguments()[0].equals(elementType)) {
      return getService(Factory.class);
    }
  }
  for (  Type interfaceType : c.getGenericInterfaces()) {
    Factory f=getFactory(interfaceType,elementType);
    if (f != null) {
      return f;
    }
  }
  return null;
}
