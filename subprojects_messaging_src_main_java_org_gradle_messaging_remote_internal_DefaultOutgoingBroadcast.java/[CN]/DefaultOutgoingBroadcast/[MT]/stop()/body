{
  CompositeStoppable stoppable;
  lock.lock();
  try {
    stoppable=CompositeStoppable.stoppable(hub,discoveryBroadcast,executor);
  }
  finally {
    connections.clear();
    lock.unlock();
  }
  stoppable.stop();
}
