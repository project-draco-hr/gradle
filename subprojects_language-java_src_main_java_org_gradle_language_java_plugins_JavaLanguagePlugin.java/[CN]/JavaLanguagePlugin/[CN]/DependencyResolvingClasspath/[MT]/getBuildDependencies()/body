{
  if (taskDependency == null) {
    final DefaultTaskDependency result=new DefaultTaskDependency();
    result.add(super.getBuildDependencies());
    final List<Throwable> notFound=new LinkedList<Throwable>();
    resolve(createResolveContext(),new Action<ResolverResults>(){
      @Override public void execute(      ResolverResults resolverResults){
        if (!resolverResults.hasError()) {
          ResolvedArtifactsBuilder artifactsBuilder=resolverResults.getArtifactsBuilder();
          ResolvedArtifactResults resolve=artifactsBuilder.resolve();
          for (          ResolvedArtifact resolvedArtifact : resolve.getArtifacts()) {
            if (resolvedArtifact instanceof Buildable) {
              result.add(((Buildable)resolvedArtifact).getBuildDependencies());
            }
          }
          for (          ResolvedArtifact resolvedArtifact : resolve.getArtifacts()) {
            dependencies.add(resolvedArtifact.getFile());
          }
        }
        resolverResults.getResolutionResult().allDependencies(new Action<DependencyResult>(){
          @Override public void execute(          DependencyResult dependencyResult){
            if (dependencyResult instanceof UnresolvedDependencyResult) {
              UnresolvedDependencyResult unresolved=(UnresolvedDependencyResult)dependencyResult;
              notFound.add(unresolved.getFailure());
            }
          }
        }
);
      }
    }
);
    if (!notFound.isEmpty()) {
      throw new LibraryResolveException(String.format("Could not resolve all dependencies for source set '%s'",sourceSet.getDisplayName()),notFound);
    }
    taskDependency=result;
  }
  return taskDependency;
}
