{
  if (mode != LockMode.Exclusive) {
    throw new InsufficientLockModeException("An exclusive lock is required for this operation");
  }
  try {
    integrityViolated=true;
    markDirty();
    action.run();
    markClean();
    integrityViolated=false;
  }
 catch (  Throwable t) {
    throw throwAsUncheckedException(t);
  }
}
