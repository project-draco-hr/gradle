{
  do {
    java.nio.channels.FileLock fileLock=lockFileAccess.getChannel().tryLock(start,size,lockMode == LockMode.Shared);
    if (fileLock != null) {
      return fileLock;
    }
    failAction.run();
    Thread.sleep(200L);
  }
 while (System.currentTimeMillis() < timeout);
  return null;
}
