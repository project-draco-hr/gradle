{
  return new Bundle.ConfigureAction(){
    public void configure(    final AbstractArchiveTask archiveTask){
      if (archiveTask instanceof Jar) {
        archiveTask.getProject().addAfterEvaluateListener(new AfterEvaluateListener(){
          public void afterEvaluate(          Project project){
            archiveTask.dependsOn(project.getDependencies().configuration(JavaPlugin.RUNTIME).getBuildProjectDependencies());
          }
        }
);
        archiveTask.defineProperty("osgi",createDefaultOsgiManifest(archiveTask.getProject()));
        archiveTask.doFirst(new TaskAction(){
          public void execute(          Task task){
            Jar jarTask=(Jar)task;
            OsgiManifest osgiManifest=(OsgiManifest)jarTask.getAdditionalProperties().get("osgi");
            osgiManifest.setClasspath(getDependencies(osgiManifest,jarTask.getProject().getDependencies().configuration(JavaPlugin.RUNTIME).resolve()));
            osgiManifest.overwrite(jarTask.getManifest());
          }
        }
);
      }
    }
  }
;
}
