{
  ClassLoader stopAt=ClassLoader.getSystemClassLoader() == null ? null : ClassLoader.getSystemClassLoader().getParent();
  for (ClassLoader cl=classLoader; cl != null && cl != stopAt; cl=cl.getParent()) {
    if (cl instanceof ClasspathSource) {
      ClasspathSource classpathSource=(ClasspathSource)cl;
      classpathSource.collectClasspath(classpath);
      break;
    }
    if (cl instanceof URLClassLoader) {
      classpath.addAll(Arrays.asList(((URLClassLoader)cl).getURLs()));
    }
  }
}
