{
  if (participants.isEmpty()) {
    throw new IllegalStateException("At least one participant must be specified before creating a connection.");
  }
  DefaultCompositeConnectionParameters.Builder compositeConnectionParametersBuilder=DefaultCompositeConnectionParameters.builder();
  compositeConnectionParametersBuilder.setBuilds(participants);
  compositeConnectionParametersBuilder.setGradleUserHomeDir(gradleUserHomeDir);
  compositeConnectionParametersBuilder.setEmbedded(embeddedCoordinator);
  compositeConnectionParametersBuilder.setDaemonMaxIdleTimeValue(daemonMaxIdleTimeValue);
  compositeConnectionParametersBuilder.setDaemonMaxIdleTimeUnits(daemonMaxIdleTimeUnits);
  compositeConnectionParametersBuilder.setDaemonBaseDir(daemonBaseDir);
  compositeConnectionParametersBuilder.setEmbeddedParticipants(emeddedParticipants);
  DefaultCompositeConnectionParameters connectionParameters=compositeConnectionParametersBuilder.build();
  final Distribution distribution;
  if (useClasspathDistribution) {
    distribution=distributionFactory.getClasspathDistribution();
  }
 else {
    distribution=FirstParticipantDistributionChooser.chooseDistribution(distributionFactory,participants);
  }
  return gradleConnectionFactory.create(distribution,connectionParameters);
}
