{
  if (repository.getId().equals(repository.getUrl())) {
    repository.setId("remote");
  }
  updateRepositoryWithSettings(repository);
  ArtifactRepositoryLayout repositoryLayout=(ArtifactRepositoryLayout)lookup(ArtifactRepositoryLayout.ROLE,repository.getLayout());
  ArtifactRepositoryFactory repositoryFactory=null;
  ArtifactRepository artifactRepository;
  try {
    repositoryFactory=getArtifactRepositoryFactory(repository);
    artifactRepository=repositoryFactory.createDeploymentArtifactRepository(repository.getId(),repository.getUrl(),repositoryLayout,uniqueVersion);
  }
  finally {
    releaseArtifactRepositoryFactory(repositoryFactory);
  }
  return artifactRepository;
}
