{
  try {
    final FileLock lock=lockManager.lock(propertiesFile,lockMode,toString());
    try {
      boolean valid=determineIfCacheIsValid(cacheUsage,properties,lock);
      if (!valid) {
        lock.writeToFile(new Runnable(){
          public void run(){
            buildCacheDir(initAction,lock);
          }
        }
);
      }
    }
 catch (    Throwable throwable) {
      lock.close();
      throw throwable;
    }
    return lock;
  }
 catch (  Throwable e) {
    throw new CacheOpenException(String.format("Could not open %s.",this),e);
  }
}
