{
  boolean valid=determineIfCacheIsValid(getLock());
  int tries=3;
  while (!valid) {
    if (--tries < 0) {
      throw new CacheOpenException(String.format("Failed to init valid cache for %s",this));
    }
    withExclusiveLock(new Action<FileLock>(){
      public void execute(      final FileLock fileLock){
        boolean exclusiveLockValid;
        try {
          exclusiveLockValid=determineIfCacheIsValid(fileLock);
        }
 catch (        IOException e) {
          throw new UncheckedIOException(e);
        }
        if (!exclusiveLockValid) {
          fileLock.writeFile(new Runnable(){
            public void run(){
              buildCacheDir(initAction,fileLock);
            }
          }
);
        }
      }
    }
);
    valid=determineIfCacheIsValid(getLock());
  }
}
