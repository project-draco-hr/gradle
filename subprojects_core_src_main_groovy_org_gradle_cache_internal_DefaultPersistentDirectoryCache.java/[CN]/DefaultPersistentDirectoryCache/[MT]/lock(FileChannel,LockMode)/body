{
  long timeout=System.currentTimeMillis() + 20000;
  do {
    FileLock fileLock=lockChannel.tryLock(0,Long.MAX_VALUE,lockMode == LockMode.Shared);
    if (fileLock != null) {
      return fileLock;
    }
    Thread.sleep(200L);
  }
 while (System.currentTimeMillis() < timeout);
  throw new GradleException(String.format("Timeout waiting to acquire %s lock on %s. It is currently in use by another Gradle instance.",lockMode.toString().toLowerCase(),this));
}
