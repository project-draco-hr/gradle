{
  if (documentBuilder == null) {
    documentBuilder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
  }
  Document document=documentBuilder.newDocument();
  renderer.render(document,model);
  if (transformer == null) {
    TransformerFactory factory=TransformerFactory.newInstance();
    transformer=factory.newTransformer();
    transformer.setOutputProperty(OutputKeys.INDENT,"yes");
    transformer.setOutputProperty(OutputKeys.METHOD,"html");
    transformer.setOutputProperty(OutputKeys.MEDIA_TYPE,"text/html");
  }
  outputFile.getParentFile().mkdirs();
  Writer writer=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(outputFile),"utf-8"));
  try {
    writer.write("<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">\n");
    transformer.transform(new DOMSource(document),new StreamResult(writer));
  }
  finally {
    writer.close();
  }
}
