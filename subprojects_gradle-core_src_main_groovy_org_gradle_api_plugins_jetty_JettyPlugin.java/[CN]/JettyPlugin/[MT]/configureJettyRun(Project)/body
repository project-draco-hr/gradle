{
  project.getTasks().withType(JettyRun.class).whenTaskAdded(new Action<JettyRun>(){
    public void execute(    JettyRun jettyRun){
      jettyRun.dependsOn(JavaPlugin.COMPILE_TASK_NAME,JavaPlugin.PROCESS_RESOURCES_TASK_NAME);
      jettyRun.setConfiguration(project.getConfigurations().getByName(JavaPlugin.RUNTIME_CONFIGURATION_NAME));
      jettyRun.getConventionMapping().map("webXml",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return getWebXml(project);
        }
      }
);
      jettyRun.getConventionMapping().map("classesDirectory",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return getJavaConvention(project).getSource().getByName(SourceSet.MAIN_SOURCE_SET_NAME).getClassesDir();
        }
      }
);
      jettyRun.getConventionMapping().map("webAppSourceDirectory",new ConventionValue(){
        public Object getValue(        Convention convention,        IConventionAware conventionAwareObject){
          return getWarConvention(project).getWebAppDir();
        }
      }
);
    }
  }
);
  JettyRun jettyRun=project.getTasks().add(JETTY_RUN,JettyRun.class);
  jettyRun.setDescription("Uses your files as and where they are and deploys them to Jetty.");
}
