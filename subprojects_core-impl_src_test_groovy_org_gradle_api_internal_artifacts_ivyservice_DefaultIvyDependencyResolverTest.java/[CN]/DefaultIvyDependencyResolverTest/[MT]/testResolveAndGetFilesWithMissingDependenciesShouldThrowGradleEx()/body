{
  ModuleDescriptor moduleDescriptor=createAnonymousModuleDescriptor();
  prepareTestsThatRetrieveDependencies(moduleDescriptor);
  prepareResolveReportWithError();
  ResolvedConfiguration configuration=ivyDependencyResolver.resolve(configurationStub,ivyStub,moduleDescriptor);
  context.checking(new Expectations(){
{
      allowing(configurationStub).getAllDependencies();
      allowing(configurationStub).getAllDependencies(ModuleDependency.class);
    }
  }
);
  try {
    configuration.getFiles(Specs.SATISFIES_ALL);
    fail();
  }
 catch (  GradleException e) {
    assertThat(e.getMessage(),startsWith("Could not resolve all dependencies for <configuration>"));
  }
}
