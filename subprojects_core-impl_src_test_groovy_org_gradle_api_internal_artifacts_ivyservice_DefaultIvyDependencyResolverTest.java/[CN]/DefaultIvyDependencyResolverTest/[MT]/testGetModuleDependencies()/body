{
  prepareResolveReport();
  final ResolvedDependency root=context.mock(ResolvedDependency.class,"root");
  final ResolvedDependency resolvedDependency1=context.mock(ResolvedDependency.class,"resolved1");
  final ResolvedDependency resolvedDependency2=context.mock(ResolvedDependency.class,"resolved2");
  final IvyConversionResult conversionResultStub=context.mock(IvyConversionResult.class);
  final Set<ResolvedDependency> resolvedDependenciesSet=toSet(resolvedDependency1,resolvedDependency2);
  context.checking(new Expectations(){
{
      allowing(ivyReportConverterStub).convertReport(resolveReportMock,configurationStub);
      will(returnValue(conversionResultStub));
      allowing(conversionResultStub).getRoot();
      will(returnValue(root));
      allowing(root).getChildren();
      will(returnValue(resolvedDependenciesSet));
    }
  }
);
  ModuleDescriptor moduleDescriptor=createAnonymousModuleDescriptor();
  prepareTestsThatRetrieveDependencies(moduleDescriptor);
  Set<ResolvedDependency> actualFirstLevelModuleDependencies=ivyDependencyResolver.resolve(configurationStub,ivyStub,moduleDescriptor).getFirstLevelModuleDependencies();
  assertThat(actualFirstLevelModuleDependencies,equalTo(resolvedDependenciesSet));
}
