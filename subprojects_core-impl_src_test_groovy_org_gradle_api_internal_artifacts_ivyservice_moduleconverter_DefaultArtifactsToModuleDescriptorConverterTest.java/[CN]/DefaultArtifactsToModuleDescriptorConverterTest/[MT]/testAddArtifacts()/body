{
  final PublishArtifact publishArtifactConf1=createNamedPublishArtifact("conf1");
  Configuration configurationStub1=createConfigurationStub(publishArtifactConf1);
  final PublishArtifact publishArtifactConf2=createNamedPublishArtifact("conf2");
  Configuration configurationStub2=createConfigurationStub(publishArtifactConf2);
  final DefaultModuleDescriptor moduleDescriptor=TestUtil.createModuleDescriptor(WrapUtil.toSet(configurationStub1.getName(),configurationStub2.getName()));
  final BuildableModuleVersionPublishMetaData publishMetaData=context.mock(BuildableModuleVersionPublishMetaData.class);
  context.checking(new Expectations(){
{
      allowing(publishMetaData).getModuleDescriptor();
      will(returnValue(moduleDescriptor));
      exactly(2).of(publishMetaData).addArtifact(with(notNullValue(Artifact.class)),with(notNullValue(File.class)));
    }
  }
);
  DefaultArtifactsToModuleDescriptorConverter artifactsToModuleDescriptorConverter=new DefaultArtifactsToModuleDescriptorConverter();
  artifactsToModuleDescriptorConverter.addArtifacts(publishMetaData,WrapUtil.toSet(configurationStub1,configurationStub2));
  assertArtifactIsAdded(configurationStub1,moduleDescriptor);
  assertArtifactIsAdded(configurationStub2,moduleDescriptor);
  assertThat(moduleDescriptor.getAllArtifacts().length,equalTo(2));
}
