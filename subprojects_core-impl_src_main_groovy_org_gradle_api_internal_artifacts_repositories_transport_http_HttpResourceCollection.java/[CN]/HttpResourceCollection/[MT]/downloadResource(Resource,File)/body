{
  if (!(res instanceof ExternalResource)) {
    throw new IllegalArgumentException("Can only download ExternalResource");
  }
  ExternalResource resource=(ExternalResource)res;
  fireTransferInitiated(resource,TransferEvent.REQUEST_GET);
  try {
    progress.setTotalLength(resource.getContentLength() > 0 ? resource.getContentLength() : null);
    resource.writeTo(destination,progress);
  }
 catch (  IOException e) {
    fireTransferError(e);
    throw e;
  }
catch (  Exception e) {
    fireTransferError(e);
    throw UncheckedException.throwAsUncheckedException(e);
  }
 finally {
    progress.setTotalLength(null);
    openResources.remove(resource);
  }
}
