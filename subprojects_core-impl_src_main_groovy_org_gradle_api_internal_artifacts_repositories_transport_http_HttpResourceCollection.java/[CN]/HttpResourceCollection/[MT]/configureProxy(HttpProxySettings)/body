{
  ProxySelectorRoutePlanner routePlanner=new ProxySelectorRoutePlanner(client.getConnectionManager().getSchemeRegistry(),ProxySelector.getDefault());
  client.setRoutePlanner(routePlanner);
  HttpProxySettings.HttpProxy proxy=proxySettings.getProxy();
  if (proxy != null && proxy.credentials != null) {
    useCredentials(proxy.credentials,proxy.host,proxy.port);
  }
}
