{
  String method=request.getMethod();
  configurer.configureMethod(request);
  if (cachedExternalResource != null && cachedExternalResource.getExternalResourceMetaData() != null && cachedExternalResource.getExternalResourceMetaData().getLastModified() != null) {
    String formattedDate=DateUtils.formatDate(cachedExternalResource.getExternalResourceMetaData().getLastModified());
    LOGGER.info("Adding If-Modified-Since: {}. [HTTP {}: {}]",new Object[]{formattedDate,method,source});
    request.addHeader("If-Modified-Since",formattedDate);
  }
  HttpResponse response;
  try {
    response=executeGetOrHead(request);
  }
 catch (  IOException e) {
    throw new UncheckedIOException(String.format("Could not %s '%s'.",method,source),e);
  }
  if (wasMissing(response)) {
    LOGGER.info("Resource missing. [HTTP {}: {}]",method,source);
    return new MissingHttpResource(source);
  }
  if (cachedExternalResource != null && wasUnmodified(response)) {
    LOGGER.info("Resource was unmodified. [HTTP {}: {}]",method,source);
    return new CachedHttpResource(source,cachedExternalResource,HttpResourceCollection.this);
  }
  if (!wasSuccessful(response)) {
    LOGGER.info("Failed to get resource: {}. [HTTP {}: {}]",new Object[]{method,response.getStatusLine(),source});
    throw new UncheckedIOException(String.format("Could not %s '%s'. Received status code %s from server: %s",method,source,response.getStatusLine().getStatusCode(),response.getStatusLine().getReasonPhrase()));
  }
  LOGGER.info("Resource found. [HTTP {}: {}]",method,source);
  return new HttpResponseResource(method,source,response){
    @Override public void close() throws IOException {
      super.close();
      HttpResourceCollection.this.openResources.remove(this);
    }
  }
;
}
