{
  statusLock.lock();
  try {
    if (status != ForkStatus.STARTED && status != ForkStatus.STARTING && status != ForkStatus.RESTARTING && status != ForkStatus.STOPPING) {
      throw new IllegalArgumentException("can't change status to FAILED, current status is " + status);
    }
    final ForkStatus previousStatus=status;
    status=ForkStatus.FAILED;
    pipelineDispatcher.removeRunningHandle(this);
    signalAllClientsStoppedWhenNeeded(previousStatus,pipelineDispatcher);
  }
  finally {
    statusLock.unlock();
  }
}
