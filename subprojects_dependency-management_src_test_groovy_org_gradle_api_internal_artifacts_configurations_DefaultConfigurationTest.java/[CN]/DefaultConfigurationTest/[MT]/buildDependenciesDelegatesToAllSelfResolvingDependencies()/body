{
  final Task target=context.mock(Task.class,"target");
  final Task fileDepTaskDummy=context.mock(Task.class,"fileDepTask");
  final FileCollectionDependency fileCollectionDependencyStub=context.mock(FileCollectionDependency.class);
  context.checking(new Expectations(){
{
      TaskDependency fileTaskDependencyStub=context.mock(TaskDependency.class,"fileDep");
      allowing(fileCollectionDependencyStub).getBuildDependencies();
      will(returnValue(fileTaskDependencyStub));
      allowing(fileTaskDependencyStub).getDependencies(target);
      will(returnValue(toSet(fileDepTaskDummy)));
    }
  }
);
  configuration.getDependencies().add(fileCollectionDependencyStub);
  resolveSuccessfullyAsResolvedConfiguration();
  assertThat(configuration.getBuildDependencies().getDependencies(target),equalTo((Set)toSet(fileDepTaskDummy)));
}
