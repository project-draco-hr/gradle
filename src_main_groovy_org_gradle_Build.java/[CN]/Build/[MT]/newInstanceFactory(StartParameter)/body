{
  if (customFactory != null) {
    return customFactory.newInstanceFactory(startParameter);
  }
  return new BuildFactory(){
    public Build newInstance(    String inMemoryScriptText,    File buildResolverDir){
      DefaultDependencyManagerFactory dependencyManagerFactory=new DefaultDependencyManagerFactory();
      ImportsReader importsReader=new ImportsReader(startParameter.getDefaultImportsFile());
      IScriptProcessor scriptProcessor=new DefaultScriptProcessor(new DefaultScriptHandler(),startParameter.getCacheUsage());
      Dag tasksGraph=new Dag();
      Build build=new Build(new ParentDirSettingsFinder(),new DefaultGradlePropertiesLoader(),new SettingsProcessor(new DefaultSettingsScriptMetaData(),scriptProcessor,importsReader,new SettingsFactory(),dependencyManagerFactory,null,buildResolverDir),new ProjectsLoader(new ProjectFactory(new TaskFactory(tasksGraph),dependencyManagerFactory,new BuildScriptProcessor(scriptProcessor,new DefaultProjectScriptMetaData(),importsReader),new PluginRegistry(startParameter.getPluginPropertiesFile()),startParameter.getBuildFileName(),new ProjectRegistry(),inMemoryScriptText)),new BuildConfigurer(new ProjectDependencies2TaskResolver(),new ProjectTasksPrettyPrinter()),new BuildExecuter(tasksGraph));
      if (buildResolverDir == null) {
        build.addBuildListener(new DefaultBuildListener());
      }
      return build;
    }
  }
;
}
