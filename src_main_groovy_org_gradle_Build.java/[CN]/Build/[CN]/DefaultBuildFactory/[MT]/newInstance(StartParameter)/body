{
  DefaultDependencyManagerFactory dependencyManagerFactory=new DefaultDependencyManagerFactory();
  ImportsReader importsReader=new ImportsReader(startParameter.getDefaultImportsFile());
  IScriptProcessor scriptProcessor=new DefaultScriptProcessor(new DefaultScriptHandler(),startParameter.getCacheUsage());
  Dag tasksGraph=new Dag();
  File buildResolverDir=startParameter.getBuildResolverDirectory();
  ISettingsFinder settingsFinder=startParameter.getSettingsScriptSource() == null ? new DefaultSettingsFinder(WrapUtil.<ISettingsFileSearchStrategy>toList(new MasterDirSettingsFinderStrategy(),new ParentDirSettingsFinderStrategy())) : new EmbeddedScriptSettingsFinder();
  Build build=new Build(settingsFinder,new DefaultGradlePropertiesLoader(),new SettingsProcessor(new DefaultSettingsScriptMetaData(),scriptProcessor,importsReader,new SettingsFactory(new DefaultProjectDescriptorRegistry()),dependencyManagerFactory,null,buildResolverDir),new ProjectsLoader(new ProjectFactory(new TaskFactory(tasksGraph),dependencyManagerFactory,new BuildScriptProcessor(scriptProcessor,new DefaultProjectScriptMetaData(),importsReader),new PluginRegistry(startParameter.getPluginPropertiesFile()),startParameter,new DefaultProjectRegistry(),tasksGraph,startParameter.getBuildScriptSource())),new BuildConfigurer(new ProjectDependencies2TaskResolver(),new ProjectTasksPrettyPrinter()),new BuildExecuter(tasksGraph));
  build.getSettingsProcessor().setBuildSourceBuilder(new BuildSourceBuilder(new EmbeddedBuildExecuter(this)));
  if (buildResolverDir == null) {
    build.addBuildListener(new BuildCleanupListener());
  }
  return build;
}
