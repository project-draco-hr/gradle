{
  DefaultDependencyManagerFactory dependencyManagerFactory=new DefaultDependencyManagerFactory();
  ImportsReader importsReader=new ImportsReader(startParameter.getDefaultImportsFile());
  IScriptProcessor scriptProcessor=new DefaultScriptProcessor(new DefaultScriptHandler(),startParameter.getCacheUsage());
  Dag tasksGraph=new Dag();
  File buildResolverDir=startParameter.getBuildResolverDirectory();
  Build build=new Build(new ParentDirSettingsFinder(),new DefaultGradlePropertiesLoader(),new SettingsProcessor(new DefaultSettingsScriptMetaData(),scriptProcessor,importsReader,new SettingsFactory(),dependencyManagerFactory,null,buildResolverDir),new ProjectsLoader(new ProjectFactory(new TaskFactory(tasksGraph),dependencyManagerFactory,new BuildScriptProcessor(scriptProcessor,new DefaultProjectScriptMetaData(),importsReader),new PluginRegistry(startParameter.getPluginPropertiesFile()),startParameter.getBuildFileName(),new ProjectRegistry(),startParameter.getBuildScriptSource())),new BuildConfigurer(new ProjectDependencies2TaskResolver(),new ProjectTasksPrettyPrinter()),new BuildExecuter(tasksGraph));
  build.getSettingsProcessor().setBuildSourceBuilder(new BuildSourceBuilder(new EmbeddedBuildExecuter(this)));
  if (buildResolverDir == null) {
    build.addBuildListener(new DefaultBuildListener());
  }
  return build;
}
