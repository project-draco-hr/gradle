{
  project.afterEvaluate(new Action<Project>(){
    public void execute(    Project project){
      Upload uploadArchives=project.getTasks().withType(Upload.class).findByName(BasePlugin.UPLOAD_ARCHIVES_TASK_NAME);
      if (uploadArchives == null) {
        return;
      }
      for (      MavenResolver resolver : uploadArchives.getRepositories().withType(MavenResolver.class)) {
        MavenPom pom=resolver.getPom();
        ModuleVersionIdentifier publicationId=new DefaultModuleVersionIdentifier(pom.getGroupId(),pom.getArtifactId(),pom.getVersion());
        publicationRegistry.registerPublication(project.getPath(),new DefaultProjectPublication(publicationId));
      }
    }
  }
);
}
