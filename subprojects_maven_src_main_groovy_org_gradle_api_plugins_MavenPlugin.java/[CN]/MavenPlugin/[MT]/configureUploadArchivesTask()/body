{
  project.afterEvaluate(new Action<Project>(){
    public void execute(    Project project){
      Upload uploadArchives=project.getTasks().withType(Upload.class).findByName(BasePlugin.UPLOAD_ARCHIVES_TASK_NAME);
      if (uploadArchives == null) {
        return;
      }
      ConfigurationInternal configuration=(ConfigurationInternal)uploadArchives.getConfiguration();
      ModuleInternal module=configuration.getModule();
      for (      MavenResolver resolver : uploadArchives.getRepositories().withType(MavenResolver.class)) {
        MavenPom pom=resolver.getPom();
        ModuleVersionIdentifier publicationId=new DefaultModuleVersionIdentifier(pom.getGroupId().equals("unknown") ? module.getGroup() : pom.getGroupId(),pom.getArtifactId().equals("empty-project") ? module.getName() : pom.getArtifactId(),pom.getVersion() == "0" ? module.getVersion() : pom.getVersion());
        publicationRegistry.registerPublication(project.getPath(),new DefaultProjectPublication(publicationId));
      }
    }
  }
);
}
