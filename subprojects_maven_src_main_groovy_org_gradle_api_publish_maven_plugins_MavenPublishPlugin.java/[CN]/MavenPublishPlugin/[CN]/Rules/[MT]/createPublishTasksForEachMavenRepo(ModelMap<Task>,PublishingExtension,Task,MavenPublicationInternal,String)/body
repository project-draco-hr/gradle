{
  for (  final MavenArtifactRepository repository : extension.getRepositories().withType(MavenArtifactRepository.class)) {
    final String repositoryName=repository.getName();
    String publishTaskName=String.format("publish%sPublicationTo%sRepository",capitalize(publicationName),capitalize(repositoryName));
    tasks.create(publishTaskName,PublishToMavenRepository.class,new Action<PublishToMavenRepository>(){
      public void execute(      PublishToMavenRepository publishTask){
        publishTask.setPublication(publication);
        publishTask.setRepository(repository);
        publishTask.setGroup(PublishingPlugin.PUBLISH_TASK_GROUP);
        publishTask.setDescription(String.format("Publishes Maven publication '%s' to Maven repository '%s'.",publicationName,repositoryName));
      }
    }
);
    publishLifecycleTask.dependsOn(publishTaskName);
  }
}
